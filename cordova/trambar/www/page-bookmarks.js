webpackJsonp(["page-bookmarks"],{"../../common/node_modules/emoji-regex/index.js":function(e,t,r){"use strict";e.exports=function(){return/\uD83C\uDFF4(?:\uDB40\uDC67\uDB40\uDC62(?:\uDB40\uDC65\uDB40\uDC6E\uDB40\uDC67|\uDB40\uDC77\uDB40\uDC6C\uDB40\uDC73|\uDB40\uDC73\uDB40\uDC63\uDB40\uDC74)\uDB40\uDC7F|\u200D\u2620\uFE0F)|\uD83D\uDC69\u200D\uD83D\uDC69\u200D(?:\uD83D\uDC66\u200D\uD83D\uDC66|\uD83D\uDC67\u200D(?:\uD83D[\uDC66\uDC67]))|\uD83D\uDC68(?:\u200D(?:\u2764\uFE0F\u200D(?:\uD83D\uDC8B\u200D)?\uD83D\uDC68|(?:\uD83D[\uDC68\uDC69])\u200D(?:\uD83D\uDC66\u200D\uD83D\uDC66|\uD83D\uDC67\u200D(?:\uD83D[\uDC66\uDC67]))|\uD83D\uDC66\u200D\uD83D\uDC66|\uD83D\uDC67\u200D(?:\uD83D[\uDC66\uDC67])|\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDB0-\uDDB3])|(?:\uD83C[\uDFFB-\uDFFF])\u200D(?:\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDB0-\uDDB3]))|\uD83D\uDC69\u200D(?:\u2764\uFE0F\u200D(?:\uD83D\uDC8B\u200D(?:\uD83D[\uDC68\uDC69])|\uD83D[\uDC68\uDC69])|\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDB0-\uDDB3])|\uD83D\uDC69\u200D\uD83D\uDC66\u200D\uD83D\uDC66|(?:\uD83D\uDC41\uFE0F\u200D\uD83D\uDDE8|\uD83D\uDC69(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2695\u2696\u2708]|\uD83D\uDC68(?:(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2695\u2696\u2708]|\u200D[\u2695\u2696\u2708])|(?:(?:\u26F9|\uD83C[\uDFCB\uDFCC]|\uD83D\uDD75)\uFE0F|\uD83D\uDC6F|\uD83E[\uDD3C\uDDDE\uDDDF])\u200D[\u2640\u2642]|(?:\u26F9|\uD83C[\uDFCB\uDFCC]|\uD83D\uDD75)(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642]|(?:\uD83C[\uDFC3\uDFC4\uDFCA]|\uD83D[\uDC6E\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4-\uDEB6]|\uD83E[\uDD26\uDD37-\uDD39\uDD3D\uDD3E\uDDB8\uDDB9\uDDD6-\uDDDD])(?:(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642]|\u200D[\u2640\u2642])|\uD83D\uDC69\u200D[\u2695\u2696\u2708])\uFE0F|\uD83D\uDC69\u200D\uD83D\uDC67\u200D(?:\uD83D[\uDC66\uDC67])|\uD83D\uDC69\u200D\uD83D\uDC69\u200D(?:\uD83D[\uDC66\uDC67])|\uD83D\uDC68(?:\u200D(?:(?:\uD83D[\uDC68\uDC69])\u200D(?:\uD83D[\uDC66\uDC67])|\uD83D[\uDC66\uDC67])|\uD83C[\uDFFB-\uDFFF])|\uD83C\uDFF3\uFE0F\u200D\uD83C\uDF08|\uD83D\uDC69\u200D\uD83D\uDC67|\uD83D\uDC69(?:\uD83C[\uDFFB-\uDFFF])\u200D(?:\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDB0-\uDDB3])|\uD83D\uDC69\u200D\uD83D\uDC66|\uD83C\uDDF6\uD83C\uDDE6|\uD83C\uDDFD\uD83C\uDDF0|\uD83C\uDDF4\uD83C\uDDF2|\uD83D\uDC69(?:\uD83C[\uDFFB-\uDFFF])|\uD83C\uDDED(?:\uD83C[\uDDF0\uDDF2\uDDF3\uDDF7\uDDF9\uDDFA])|\uD83C\uDDEC(?:\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEE\uDDF1-\uDDF3\uDDF5-\uDDFA\uDDFC\uDDFE])|\uD83C\uDDEA(?:\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDED\uDDF7-\uDDFA])|\uD83C\uDDE8(?:\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDEE\uDDF0-\uDDF5\uDDF7\uDDFA-\uDDFF])|\uD83C\uDDF2(?:\uD83C[\uDDE6\uDDE8-\uDDED\uDDF0-\uDDFF])|\uD83C\uDDF3(?:\uD83C[\uDDE6\uDDE8\uDDEA-\uDDEC\uDDEE\uDDF1\uDDF4\uDDF5\uDDF7\uDDFA\uDDFF])|\uD83C\uDDFC(?:\uD83C[\uDDEB\uDDF8])|\uD83C\uDDFA(?:\uD83C[\uDDE6\uDDEC\uDDF2\uDDF3\uDDF8\uDDFE\uDDFF])|\uD83C\uDDF0(?:\uD83C[\uDDEA\uDDEC-\uDDEE\uDDF2\uDDF3\uDDF5\uDDF7\uDDFC\uDDFE\uDDFF])|\uD83C\uDDEF(?:\uD83C[\uDDEA\uDDF2\uDDF4\uDDF5])|\uD83C\uDDF8(?:\uD83C[\uDDE6-\uDDEA\uDDEC-\uDDF4\uDDF7-\uDDF9\uDDFB\uDDFD-\uDDFF])|\uD83C\uDDEE(?:\uD83C[\uDDE8-\uDDEA\uDDF1-\uDDF4\uDDF6-\uDDF9])|\uD83C\uDDFF(?:\uD83C[\uDDE6\uDDF2\uDDFC])|\uD83C\uDDEB(?:\uD83C[\uDDEE-\uDDF0\uDDF2\uDDF4\uDDF7])|\uD83C\uDDF5(?:\uD83C[\uDDE6\uDDEA-\uDDED\uDDF0-\uDDF3\uDDF7-\uDDF9\uDDFC\uDDFE])|\uD83C\uDDE9(?:\uD83C[\uDDEA\uDDEC\uDDEF\uDDF0\uDDF2\uDDF4\uDDFF])|\uD83C\uDDF9(?:\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDED\uDDEF-\uDDF4\uDDF7\uDDF9\uDDFB\uDDFC\uDDFF])|\uD83C\uDDE7(?:\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEF\uDDF1-\uDDF4\uDDF6-\uDDF9\uDDFB\uDDFC\uDDFE\uDDFF])|[#\*0-9]\uFE0F\u20E3|\uD83C\uDDF1(?:\uD83C[\uDDE6-\uDDE8\uDDEE\uDDF0\uDDF7-\uDDFB\uDDFE])|\uD83C\uDDE6(?:\uD83C[\uDDE8-\uDDEC\uDDEE\uDDF1\uDDF2\uDDF4\uDDF6-\uDDFA\uDDFC\uDDFD\uDDFF])|\uD83C\uDDF7(?:\uD83C[\uDDEA\uDDF4\uDDF8\uDDFA\uDDFC])|\uD83C\uDDFB(?:\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDEE\uDDF3\uDDFA])|\uD83C\uDDFE(?:\uD83C[\uDDEA\uDDF9])|(?:\uD83C[\uDFC3\uDFC4\uDFCA]|\uD83D[\uDC6E\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4-\uDEB6]|\uD83E[\uDD26\uDD37-\uDD39\uDD3D\uDD3E\uDDB8\uDDB9\uDDD6-\uDDDD])(?:\uD83C[\uDFFB-\uDFFF])|(?:\u26F9|\uD83C[\uDFCB\uDFCC]|\uD83D\uDD75)(?:\uD83C[\uDFFB-\uDFFF])|(?:[\u261D\u270A-\u270D]|\uD83C[\uDF85\uDFC2\uDFC7]|\uD83D[\uDC42\uDC43\uDC46-\uDC50\uDC66\uDC67\uDC70\uDC72\uDC74-\uDC76\uDC78\uDC7C\uDC83\uDC85\uDCAA\uDD74\uDD7A\uDD90\uDD95\uDD96\uDE4C\uDE4F\uDEC0\uDECC]|\uD83E[\uDD18-\uDD1C\uDD1E\uDD1F\uDD30-\uDD36\uDDB5\uDDB6\uDDD1-\uDDD5])(?:\uD83C[\uDFFB-\uDFFF])|(?:[\u231A\u231B\u23E9-\u23EC\u23F0\u23F3\u25FD\u25FE\u2614\u2615\u2648-\u2653\u267F\u2693\u26A1\u26AA\u26AB\u26BD\u26BE\u26C4\u26C5\u26CE\u26D4\u26EA\u26F2\u26F3\u26F5\u26FA\u26FD\u2705\u270A\u270B\u2728\u274C\u274E\u2753-\u2755\u2757\u2795-\u2797\u27B0\u27BF\u2B1B\u2B1C\u2B50\u2B55]|\uD83C[\uDC04\uDCCF\uDD8E\uDD91-\uDD9A\uDDE6-\uDDFF\uDE01\uDE1A\uDE2F\uDE32-\uDE36\uDE38-\uDE3A\uDE50\uDE51\uDF00-\uDF20\uDF2D-\uDF35\uDF37-\uDF7C\uDF7E-\uDF93\uDFA0-\uDFCA\uDFCF-\uDFD3\uDFE0-\uDFF0\uDFF4\uDFF8-\uDFFF]|\uD83D[\uDC00-\uDC3E\uDC40\uDC42-\uDCFC\uDCFF-\uDD3D\uDD4B-\uDD4E\uDD50-\uDD67\uDD7A\uDD95\uDD96\uDDA4\uDDFB-\uDE4F\uDE80-\uDEC5\uDECC\uDED0-\uDED2\uDEEB\uDEEC\uDEF4-\uDEF9]|\uD83E[\uDD10-\uDD3A\uDD3C-\uDD3E\uDD40-\uDD45\uDD47-\uDD70\uDD73-\uDD76\uDD7A\uDD7C-\uDDA2\uDDB0-\uDDB9\uDDC0-\uDDC2\uDDD0-\uDDFF])|(?:[#\*0-9\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u261D\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u267F\u2692-\u2697\u2699\u269B\u269C\u26A0\u26A1\u26AA\u26AB\u26B0\u26B1\u26BD\u26BE\u26C4\u26C5\u26C8\u26CE\u26CF\u26D1\u26D3\u26D4\u26E9\u26EA\u26F0-\u26F5\u26F7-\u26FA\u26FD\u2702\u2705\u2708-\u270D\u270F\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763\u2764\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC04\uDCCF\uDD70\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDDE6-\uDDFF\uDE01\uDE02\uDE1A\uDE2F\uDE32-\uDE3A\uDE50\uDE51\uDF00-\uDF21\uDF24-\uDF93\uDF96\uDF97\uDF99-\uDF9B\uDF9E-\uDFF0\uDFF3-\uDFF5\uDFF7-\uDFFF]|\uD83D[\uDC00-\uDCFD\uDCFF-\uDD3D\uDD49-\uDD4E\uDD50-\uDD67\uDD6F\uDD70\uDD73-\uDD7A\uDD87\uDD8A-\uDD8D\uDD90\uDD95\uDD96\uDDA4\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDE8\uDDEF\uDDF3\uDDFA-\uDE4F\uDE80-\uDEC5\uDECB-\uDED2\uDEE0-\uDEE5\uDEE9\uDEEB\uDEEC\uDEF0\uDEF3-\uDEF9]|\uD83E[\uDD10-\uDD3A\uDD3C-\uDD3E\uDD40-\uDD45\uDD47-\uDD70\uDD73-\uDD76\uDD7A\uDD7C-\uDDA2\uDDB0-\uDDB9\uDDC0-\uDDC2\uDDD0-\uDDFF])\uFE0F|(?:[\u261D\u26F9\u270A-\u270D]|\uD83C[\uDF85\uDFC2-\uDFC4\uDFC7\uDFCA-\uDFCC]|\uD83D[\uDC42\uDC43\uDC46-\uDC50\uDC66-\uDC69\uDC6E\uDC70-\uDC78\uDC7C\uDC81-\uDC83\uDC85-\uDC87\uDCAA\uDD74\uDD75\uDD7A\uDD90\uDD95\uDD96\uDE45-\uDE47\uDE4B-\uDE4F\uDEA3\uDEB4-\uDEB6\uDEC0\uDECC]|\uD83E[\uDD18-\uDD1C\uDD1E\uDD1F\uDD26\uDD30-\uDD39\uDD3D\uDD3E\uDDB5\uDDB6\uDDB8\uDDB9\uDDD1-\uDDDD])/g}},"../../common/node_modules/invariant/browser.js":function(e,t,r){"use strict";var n=function(e,t,r,n,a,o,s,u){if(!e){var i;if(void 0===t)i=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var d=[r,n,a,o,s,u],l=0;i=new Error(t.replace(/%s/g,function(){return d[l++]})),i.name="Invariant Violation"}throw i.framesToPop=1,i}};e.exports=n},"../../common/node_modules/lodash.assign/index.js":function(e,t){function r(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}function n(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}function a(e,t){var r=A(e)||m(e)?n(e.length,String):[],a=r.length,o=!!a;for(var s in e)!t&&!_.call(e,s)||o&&("length"==s||d(s,a))||r.push(s);return r}function o(e,t,r){var n=e[t];_.call(e,t)&&f(n,r)&&(void 0!==r||t in e)||(e[t]=r)}function s(e){if(!c(e))return F(e);var t=[];for(var r in Object(e))_.call(e,r)&&"constructor"!=r&&t.push(r);return t}function u(e,t){return t=I(void 0===t?e.length-1:t,0),function(){for(var n=arguments,a=-1,o=I(n.length-t,0),s=Array(o);++a<o;)s[a]=n[t+a];a=-1;for(var u=Array(t+1);++a<t;)u[a]=n[a];return u[t]=s,r(e,this,u)}}function i(e,t,r,n){r||(r={});for(var a=-1,s=t.length;++a<s;){var u=t[a],i=n?n(r[u],e[u],u,r,e):void 0;o(r,u,void 0===i?e[u]:i)}return r}function d(e,t){return!!(t=null==t?k:t)&&("number"==typeof e||x.test(e))&&e>-1&&e%1==0&&e<t}function l(e,t,r){if(!b(r))return!1;var n=typeof t;return!!("number"==n?p(r)&&d(t,r.length):"string"==n&&t in r)&&f(r[t],e)}function c(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||j)}function f(e,t){return e===t||e!==e&&t!==t}function m(e){return h(e)&&_.call(e,"callee")&&(!S.call(e,"callee")||R.call(e)==C)}function p(e){return null!=e&&g(e.length)&&!v(e)}function h(e){return y(e)&&p(e)}function v(e){var t=b(e)?R.call(e):"";return t==E||t==w}function g(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=k}function b(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function y(e){return!!e&&"object"==typeof e}function D(e){return p(e)?a(e):s(e)}var k=9007199254740991,C="[object Arguments]",E="[object Function]",w="[object GeneratorFunction]",x=/^(?:0|[1-9]\d*)$/,j=Object.prototype,_=j.hasOwnProperty,R=j.toString,S=j.propertyIsEnumerable,F=function(e,t){return function(r){return e(t(r))}}(Object.keys,Object),I=Math.max,B=!S.call({valueOf:1},"valueOf"),A=Array.isArray,N=function(e){return u(function(t,r){var n=-1,a=r.length,o=a>1?r[a-1]:void 0,s=a>2?r[2]:void 0;for(o=e.length>3&&"function"==typeof o?(a--,o):void 0,s&&l(r[0],r[1],s)&&(o=a<3?void 0:o,a=1),t=Object(t);++n<a;){var u=r[n];u&&e(t,u,n,o)}return t})}(function(e,t){if(B||c(t)||p(t))return void i(t,D(t),e);for(var r in t)_.call(t,r)&&o(e,r,t[r])});e.exports=N},"../../common/node_modules/lodash.flatten/index.js":function(e,t,r){(function(t){function r(e,t){for(var r=-1,n=t.length,a=e.length;++r<n;)e[a+r]=t[r];return e}function n(e,t,o,s,u){var i=-1,d=e.length;for(o||(o=a),u||(u=[]);++i<d;){var l=e[i];t>0&&o(l)?t>1?n(l,t-1,o,s,u):r(u,l):s||(u[u.length]=l)}return u}function a(e){return j(e)||s(e)||!!(x&&e&&e[x])}function o(e){return(e?e.length:0)?n(e,1):[]}function s(e){return i(e)&&k.call(e,"callee")&&(!w.call(e,"callee")||C.call(e)==p)}function u(e){return null!=e&&l(e.length)&&!d(e)}function i(e){return f(e)&&u(e)}function d(e){var t=c(e)?C.call(e):"";return t==h||t==v}function l(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=m}function c(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function f(e){return!!e&&"object"==typeof e}var m=9007199254740991,p="[object Arguments]",h="[object Function]",v="[object GeneratorFunction]",g="object"==typeof t&&t&&t.Object===Object&&t,b="object"==typeof self&&self&&self.Object===Object&&self,y=g||b||Function("return this")(),D=Object.prototype,k=D.hasOwnProperty,C=D.toString,E=y.Symbol,w=D.propertyIsEnumerable,x=E?E.isConcatSpreadable:void 0,j=Array.isArray;e.exports=o}).call(t,r("../node_modules/webpack/buildin/global.js"))},"../../common/node_modules/lodash.isstring/index.js":function(e,t){function r(e){return!!e&&"object"==typeof e}function n(e){return"string"==typeof e||!u(e)&&r(e)&&s.call(e)==a}var a="[object String]",o=Object.prototype,s=o.toString,u=Array.isArray;e.exports=n},"../../common/node_modules/mark-gor/lib/react-renderer.js":function(e,t,r){function n(){for(var e=0;e<arguments.length;e++)for(var t=arguments[e],r=Object.keys(t),a=0;a<r.length;a++){var o=r[a];this[o]=t[o]}this.options||(this.options=n.defaults)}var a=r("../../common/node_modules/react/index.js");n.defaults={sanitize:!1,langPrefix:"lang-",headerPrefix:""},n.prototype.render=function(e){return this.renderTokens(e)},n.prototype.renderChildren=function(e){return e.children?this.renderTokens(e.children):null},n.prototype.renderTokens=function(e,t){for(var r=[],n=0;n<e.length;n++){var a=this.renderToken(e[n],n);if(a instanceof Array)for(var o=0,s=a;o<s.length;o++)r.push(s[o]);else a&&r.push(a)}return r},n.prototype.renderToken=function(e,t){switch(e.type){case"code":return this.renderCode(e,t);case"blockquote":return this.renderBlockquote(e,t);case"html":return this.renderHtml(e,t);case"heading":return this.renderHeading(e,t);case"hr":return this.renderHorizontalLine(e,t);case"list":return this.renderList(e,t);case"list_item":return this.renderListItem(e,t);case"loose_item":return this.renderLooseItem(e,t);case"paragraph":return this.renderParagraph(e,t);case"table":return this.renderTable(e,t);case"table_header":return this.renderTableHeader(e,t);case"table_row":return this.renderTableRow(e,t);case"table_header_cell":return this.renderTableHeaderCell(e,t);case"table_row_cell":return this.renderTableRowCell(e,t);case"strong":return this.renderStrong(e,t);case"em":return this.renderEmphasized(e,t);case"codespan":return this.renderCodeSpan(e,t);case"del":return this.renderDeleted(e,t);case"br":return this.renderLineBreak(e,t);case"link":return this.renderLink(e,t);case"autolink":return this.renderAutolink(e,t);case"url":return this.renderUrl(e,t);case"image":return this.renderImage(e,t);case"text":return this.renderText(e,t);case"text_block":return this.renderTextBlock(e,t);case"html_block":return this.renderHtmlBlock(e,t);case"space":return this.renderSpace(e,t);case"def":return this.renderRefDefinition(e,t);default:throw new Error("Unrecognized token: "+e.type)}},n.prototype.renderCode=function(e,t){var r,n=e.text,o=e.lang;return o&&(r=this.options.langPrefix+o),a.createElement("pre",{key:t},a.createElement("code",{className:r},n,"\n"))},n.prototype.renderBlockquote=function(e,t){return a.createElement("blockquote",{key:t},this.renderChildren(e))},n.prototype.renderHtml=function(e,t){return null},n.prototype.renderHeading=function(e,t){var r=this.options.headerPrefix+e.name;return a.createElement("h"+e.depth,{id:r,key:t},this.renderChildren(e))},n.prototype.renderHorizontalLine=function(e,t){return a.createElement("hr",{key:t})},n.prototype.renderList=function(e,t){return e.ordered?a.createElement("ol",{key:t},this.renderChildren(e)):a.createElement("ul",{key:t},this.renderChildren(e))},n.prototype.renderLooseItem=n.prototype.renderListItem=function(e,t){return a.createElement("li",{key:t},this.renderChildren(e))},n.prototype.renderParagraph=function(e,t){return a.createElement("p",{key:t},this.renderChildren(e))},n.prototype.renderTable=function(e,t){var r=e.children,n=a.createElement("thead",null,this.renderTableHeader(r[0])),o=a.createElement("tbody",null,this.renderTokens(r.slice(1)));return a.createElement("table",{key:t},n,o)},n.prototype.renderTableHeader=n.prototype.renderTableRow=function(e,t){return a.createElement("tr",{key:t},this.renderChildren(e))},n.prototype.renderTableHeaderCell=function(e,t){return a.createElement("th",{key:t,style:{textALign:e.align}},this.renderChildren(e))},n.prototype.renderTableRowCell=function(e,t){return a.createElement("td",{key:t,style:{textALign:e.align}},this.renderChildren(e))},n.prototype.renderStrong=function(e,t){return a.createElement("strong",{key:t},this.renderChildren(e))},n.prototype.renderEmphasized=function(e,t){return a.createElement("em",{key:t},this.renderChildren(e))},n.prototype.renderCodeSpan=function(e,t){var r=e.text;return a.createElement("code",{key:t},r)},n.prototype.renderLineBreak=function(e,t){return a.createElement("br",{key:t})},n.prototype.renderDeleted=function(e,t){return a.createElement("del",{key:t},this.renderChildren(e))},n.prototype.renderUrl=n.prototype.renderAutolink=function(e,t){if(!this.sanitizeUrl(e.href))return"";var r=e.href,n=e.text;return a.createElement("a",{key:t,href:r},n)},n.prototype.renderLink=function(e,t){if(!this.sanitizeUrl(e.href))return null;var r=e.href,n=e.title;return a.createElement("a",{key:t,href:r,title:n},this.renderChildren(e))},n.prototype.sanitizeUrl=function(e){if(this.options.sanitize){try{var t=decodeURIComponent(e).replace(/[^\w:]/g,"").toLowerCase()}catch(e){return!1}if(0===t.indexOf("javascript:")||0===t.indexOf("vbscript:")||0===t.indexOf("data:"))return!1}return!0},n.prototype.renderImage=function(e,t){var r=e.href,n=e.title,o=e.text;return a.createElement("img",{key:t,src:r,alt:o,title:n})},n.prototype.renderText=function(e,t){return e.text},n.prototype.renderHtmlBlock=n.prototype.renderTextBlock=function(e,t){return e.paragraph?this.renderParagraph(e,t):this.renderChildren(e)},n.prototype.renderRefDefinition=n.prototype.renderSpace=function(e,t){return null},e.exports=n},"../../common/node_modules/mark-gor/react.js":function(e,t,r){function n(e,t){var r=new a({options:l(t,a.defaults)}),n=new u({options:l(t,u.defaults)}),o=r.parse(e);return n.render(o)}var a=r("../../common/node_modules/mark-gor/lib/parser.js"),o=r("../../common/node_modules/mark-gor/lib/block-lexer.js"),s=r("../../common/node_modules/mark-gor/lib/inline-lexer.js"),u=r("../../common/node_modules/mark-gor/lib/react-renderer.js"),i=r("../../common/node_modules/mark-gor/lib/helpers.js"),d=i.merge,l=i.pick;t.parse=n,t.defaults=d({},a.defaults,u.defaults),t.BlockLexer=o,t.InlineLexer=s,t.Parser=a,t.Renderer=u},"../../common/node_modules/react-easy-emoji/index.js":function(e,t,r){var n=r("../../common/node_modules/react-easy-emoji/lib/replaceEmoji.js"),a=r("../../common/node_modules/react-easy-emoji/lib/makeTwemojiRenderer.js");e.exports=function(e,t){var r="function"==typeof t?t:a(t);return n(e,r)}},"../../common/node_modules/react-easy-emoji/lib/makeTwemojiRenderer.js":function(e,t,r){function n(e){return e&&e.length>0&&":"!==e.charAt(e.length-1)?e+":":e}var a=r("../../common/node_modules/react/index.js"),o=r("../../common/node_modules/lodash.assign/index.js"),s="undefined"==typeof location?"":"https:"===location.protocol?"https:":"http:",u={height:"1em",width:"1em",margin:"0 .05em 0 .1em",verticalAlign:"-0.1em"};e.exports=function(e){return e=o({},{protocol:s,baseUrl:"//twemoji.maxcdn.com/2/",size:"72x72",ext:".png",props:null},e),function(t,r,s){var i=n(e.protocol)+e.baseUrl+e.size+"/"+t+e.ext;return a.createElement("img",o({key:s,alt:r,draggable:!1,src:i,style:u},e.props))}}},"../../common/node_modules/react-easy-emoji/lib/replaceEmoji.js":function(e,t,r){function n(e,t){for(var r=[],n=0,a=0,o=0;o<e.length;)n=e.charCodeAt(o++),a?(r.push((65536+(a-55296<<10)+(n-56320)).toString(16)),a=0):55296<=n&&n<=56319?a=n:r.push(n.toString(16));return r.join(t||"-")}function a(e){return n(e.indexOf(i)<0?e.replace(u,""):e)}var o=r("../../common/node_modules/string-replace-to-array/string-replace-to-array.js"),s=/(?:\ud83d[\udc68\udc69])(?:\ud83c[\udffb-\udfff])?\u200d(?:\u2695\ufe0f|\u2696\ufe0f|\u2708\ufe0f|\ud83c[\udf3e\udf73\udf93\udfa4\udfa8\udfeb\udfed]|\ud83d[\udcbb\udcbc\udd27\udd2c\ude80\ude92]|\ud83e[\uddb0-\uddb3])|(?:\ud83c[\udfcb\udfcc]|\ud83d[\udd74\udd75]|\u26f9)((?:\ud83c[\udffb-\udfff]|\ufe0f)\u200d[\u2640\u2642]\ufe0f)|(?:\ud83c[\udfc3\udfc4\udfca]|\ud83d[\udc6e\udc71\udc73\udc77\udc81\udc82\udc86\udc87\ude45-\ude47\ude4b\ude4d\ude4e\udea3\udeb4-\udeb6]|\ud83e[\udd26\udd35\udd37-\udd39\udd3d\udd3e\uddb8\uddb9\uddd6-\udddd])(?:\ud83c[\udffb-\udfff])?\u200d[\u2640\u2642]\ufe0f|(?:\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d[\udc68\udc69]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc68|\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d[\udc68\udc69]|\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83c\udff3\ufe0f\u200d\ud83c\udf08|\ud83c\udff4\u200d\u2620\ufe0f|\ud83d\udc41\u200d\ud83d\udde8|\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc6f\u200d\u2640\ufe0f|\ud83d\udc6f\u200d\u2642\ufe0f|\ud83e\udd3c\u200d\u2640\ufe0f|\ud83e\udd3c\u200d\u2642\ufe0f|\ud83e\uddde\u200d\u2640\ufe0f|\ud83e\uddde\u200d\u2642\ufe0f|\ud83e\udddf\u200d\u2640\ufe0f|\ud83e\udddf\u200d\u2642\ufe0f)|[\u0023\u002a\u0030-\u0039]\ufe0f?\u20e3|(?:[\u00a9\u00ae\u2122\u265f]\ufe0f)|(?:\ud83c[\udc04\udd70\udd71\udd7e\udd7f\ude02\ude1a\ude2f\ude37\udf21\udf24-\udf2c\udf36\udf7d\udf96\udf97\udf99-\udf9b\udf9e\udf9f\udfcd\udfce\udfd4-\udfdf\udff3\udff5\udff7]|\ud83d[\udc3f\udc41\udcfd\udd49\udd4a\udd6f\udd70\udd73\udd76-\udd79\udd87\udd8a-\udd8d\udda5\udda8\uddb1\uddb2\uddbc\uddc2-\uddc4\uddd1-\uddd3\udddc-\uddde\udde1\udde3\udde8\uddef\uddf3\uddfa\udecb\udecd-\udecf\udee0-\udee5\udee9\udef0\udef3]|[\u203c\u2049\u2139\u2194-\u2199\u21a9\u21aa\u231a\u231b\u2328\u23cf\u23ed-\u23ef\u23f1\u23f2\u23f8-\u23fa\u24c2\u25aa\u25ab\u25b6\u25c0\u25fb-\u25fe\u2600-\u2604\u260e\u2611\u2614\u2615\u2618\u2620\u2622\u2623\u2626\u262a\u262e\u262f\u2638-\u263a\u2640\u2642\u2648-\u2653\u2660\u2663\u2665\u2666\u2668\u267b\u267f\u2692-\u2697\u2699\u269b\u269c\u26a0\u26a1\u26aa\u26ab\u26b0\u26b1\u26bd\u26be\u26c4\u26c5\u26c8\u26cf\u26d1\u26d3\u26d4\u26e9\u26ea\u26f0-\u26f5\u26f8\u26fa\u26fd\u2702\u2708\u2709\u270f\u2712\u2714\u2716\u271d\u2721\u2733\u2734\u2744\u2747\u2757\u2763\u2764\u27a1\u2934\u2935\u2b05-\u2b07\u2b1b\u2b1c\u2b50\u2b55\u3030\u303d\u3297\u3299])(?:\ufe0f|(?!\ufe0e))|(?:(?:\ud83c[\udfcb\udfcc]|\ud83d[\udd74\udd75\udd90]|[\u261d\u26f7\u26f9\u270c\u270d])(?:\ufe0f|(?!\ufe0e))|(?:\ud83c[\udf85\udfc2-\udfc4\udfc7\udfca]|\ud83d[\udc42\udc43\udc46-\udc50\udc66-\udc69\udc6e\udc70-\udc78\udc7c\udc81-\udc83\udc85-\udc87\udcaa\udd7a\udd95\udd96\ude45-\ude47\ude4b-\ude4f\udea3\udeb4-\udeb6\udec0\udecc]|\ud83e[\udd18-\udd1c\udd1e\udd1f\udd26\udd30-\udd39\udd3d\udd3e\uddb5\uddb6\uddb8\uddb9\uddd1-\udddd]|[\u270a\u270b]))(?:\ud83c[\udffb-\udfff])?|(?:\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc65\udb40\udc6e\udb40\udc67\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc73\udb40\udc63\udb40\udc74\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc77\udb40\udc6c\udb40\udc73\udb40\udc7f|\ud83c\udde6\ud83c[\udde8-\uddec\uddee\uddf1\uddf2\uddf4\uddf6-\uddfa\uddfc\uddfd\uddff]|\ud83c\udde7\ud83c[\udde6\udde7\udde9-\uddef\uddf1-\uddf4\uddf6-\uddf9\uddfb\uddfc\uddfe\uddff]|\ud83c\udde8\ud83c[\udde6\udde8\udde9\uddeb-\uddee\uddf0-\uddf5\uddf7\uddfa-\uddff]|\ud83c\udde9\ud83c[\uddea\uddec\uddef\uddf0\uddf2\uddf4\uddff]|\ud83c\uddea\ud83c[\udde6\udde8\uddea\uddec\udded\uddf7-\uddfa]|\ud83c\uddeb\ud83c[\uddee-\uddf0\uddf2\uddf4\uddf7]|\ud83c\uddec\ud83c[\udde6\udde7\udde9-\uddee\uddf1-\uddf3\uddf5-\uddfa\uddfc\uddfe]|\ud83c\udded\ud83c[\uddf0\uddf2\uddf3\uddf7\uddf9\uddfa]|\ud83c\uddee\ud83c[\udde8-\uddea\uddf1-\uddf4\uddf6-\uddf9]|\ud83c\uddef\ud83c[\uddea\uddf2\uddf4\uddf5]|\ud83c\uddf0\ud83c[\uddea\uddec-\uddee\uddf2\uddf3\uddf5\uddf7\uddfc\uddfe\uddff]|\ud83c\uddf1\ud83c[\udde6-\udde8\uddee\uddf0\uddf7-\uddfb\uddfe]|\ud83c\uddf2\ud83c[\udde6\udde8-\udded\uddf0-\uddff]|\ud83c\uddf3\ud83c[\udde6\udde8\uddea-\uddec\uddee\uddf1\uddf4\uddf5\uddf7\uddfa\uddff]|\ud83c\uddf4\ud83c\uddf2|\ud83c\uddf5\ud83c[\udde6\uddea-\udded\uddf0-\uddf3\uddf7-\uddf9\uddfc\uddfe]|\ud83c\uddf6\ud83c\udde6|\ud83c\uddf7\ud83c[\uddea\uddf4\uddf8\uddfa\uddfc]|\ud83c\uddf8\ud83c[\udde6-\uddea\uddec-\uddf4\uddf7-\uddf9\uddfb\uddfd-\uddff]|\ud83c\uddf9\ud83c[\udde6\udde8\udde9\uddeb-\udded\uddef-\uddf4\uddf7\uddf9\uddfb\uddfc\uddff]|\ud83c\uddfa\ud83c[\udde6\uddec\uddf2\uddf3\uddf8\uddfe\uddff]|\ud83c\uddfb\ud83c[\udde6\udde8\uddea\uddec\uddee\uddf3\uddfa]|\ud83c\uddfc\ud83c[\uddeb\uddf8]|\ud83c\uddfd\ud83c\uddf0|\ud83c\uddfe\ud83c[\uddea\uddf9]|\ud83c\uddff\ud83c[\udde6\uddf2\uddfc]|\ud83c[\udccf\udd8e\udd91-\udd9a\udde6-\uddff\ude01\ude32-\ude36\ude38-\ude3a\ude50\ude51\udf00-\udf20\udf2d-\udf35\udf37-\udf7c\udf7e-\udf84\udf86-\udf93\udfa0-\udfc1\udfc5\udfc6\udfc8\udfc9\udfcf-\udfd3\udfe0-\udff0\udff4\udff8-\udfff]|\ud83d[\udc00-\udc3e\udc40\udc44\udc45\udc51-\udc65\udc6a-\udc6d\udc6f\udc79-\udc7b\udc7d-\udc80\udc84\udc88-\udca9\udcab-\udcfc\udcff-\udd3d\udd4b-\udd4e\udd50-\udd67\udda4\uddfb-\ude44\ude48-\ude4a\ude80-\udea2\udea4-\udeb3\udeb7-\udebf\udec1-\udec5\uded0-\uded2\udeeb\udeec\udef4-\udef9]|\ud83e[\udd10-\udd17\udd1d\udd20-\udd25\udd27-\udd2f\udd3a\udd3c\udd40-\udd45\udd47-\udd70\udd73-\udd76\udd7a\udd7c-\udda2\uddb4\uddb7\uddc0-\uddc2\uddd0\uddde-\uddff]|[\u23e9-\u23ec\u23f0\u23f3\u267e\u26ce\u2705\u2728\u274c\u274e\u2753-\u2755\u2795-\u2797\u27b0\u27bf\ue50a])|\ufe0f/g,u=/\uFE0F/g,i=String.fromCharCode(8205);e.exports=function(e,t){return o(e,s,function(e,r,n){var o=a(e);return t(o,e,n)})}},"../../common/node_modules/relaks-media-capture/index.js":function(e,t,r){function n(e){p.call(this),this.options={},this.status=void 0,this.duration=void 0,this.volume=void 0,this.liveVideo=void 0,this.liveAudio=void 0,this.capturedVideo=void 0,this.capturedAudio=void 0,this.capturedImage=void 0,this.lastError=null,this.devices=[],this.chosenDeviceID=void 0,this.stream=void 0,this.audioProcessor=void 0,this.audioContext=void 0,this.audioSource=void 0,this.mediaRecorder=null,this.mediaRecorderStartTime=null,this.mediaRecorderDuration=0,this.mediaRecorderInterval=0,this.mediaRecorderBlobs=[],this.orientationChanged=!1,this.videoDimensions=null,this.handleDeviceChange=this.handleDeviceChange.bind(this),this.handleStreamEnd=this.handleStreamEnd.bind(this),this.handleAudioProcess=this.handleAudioProcess.bind(this),this.handleMediaRecorderData=this.handleMediaRecorderData.bind(this),this.handleMediaRecorderStart=this.handleMediaRecorderStart.bind(this),this.handleMediaRecorderStop=this.handleMediaRecorderStop.bind(this),this.handleMediaRecorderPause=this.handleMediaRecorderPause.bind(this),this.handleMediaRecorderResume=this.handleMediaRecorderResume.bind(this),this.handleMediaRecorderInterval=this.handleMediaRecorderInterval.bind(this),this.handleOrientationChange=this.handleOrientationChange.bind(this),this.handleResize=this.handleResize.bind(this);for(var t in v)e&&void 0!==e[t]?this.options[t]=e[t]:this.options[t]=v[t]}function a(e){try{return navigator.mediaDevices.getUserMedia(e)}catch(e){return Promise.reject(e)}}function o(e){return new Promise(function(t,r){var n=document.createElement("VIDEO");n.srcObject=e,n.muted=!0,n.onloadedmetadata=n.onloadeddata=n.oncanplay=function(e){if(t){var r;if("VIDEO"===n.tagName){var a=n.videoWidth,o=n.videoHeight;a&&o&&(r={width:a,height:o})}else r={};r&&(t(r),t=null,n.pause(),n.srcObject=null)}},n.onerror=function(e){var t=new m("Unable to obtain metadata");r(t),n.pause()},n.play()})}function s(e){return new Promise(function(t,r){var n=document.createElement("VIDEO");n.srcObject=e,n.muted=!0,n.oncanplay=function(e){if(t){var r=n.videoWidth,a=n.videoHeight,o=document.createElement("CANVAS");o.width=r,o.height=a;o.getContext("2d").drawImage(n,0,0,r,a),t(o),t=null,n.pause(),n.srcObject=null}},n.onerror=function(e){var t=new m("Unable to capture image");r(t),n.pause(),n.srcObject=null},n.play()})}function u(e){for(var t=e.getTracks(),r=0;r<t.length;r++)t[r].stop()}function i(e){var t;return e.video?t="videoinput":e.audio&&(t="audioinput"),d(t).then(function(r){for(var n=0,o=0;o<r.length;o++)r[o].label||n++;return n>0&&n===r.length?a(e).then(function(e){return u(e),d(t)}):r}).then(function(e){return e.map(function(e){return{id:e.deviceId,label:e.label}})})}function d(e){var t=navigator.mediaDevices;return t&&t.enumerateDevices?t.enumerateDevices().then(function(t){return t.filter(function(t){return t.kind===e})}).catch(function(e){return[]}):Promise.resolve([])}function l(e,t){if(t){for(var r=0;r<e.length;r++){var n=e[r];if(n.id===t)return n}for(var a=t.toLowerCase(),r=0;r<e.length;r++){var n=e[r],o=n.label;if(o&&-1!==o.toLowerCase().indexOf(a))return n}}return e[0]}function c(e,t,r){return new Promise(function(n,a){if("function"==typeof e.toBlob)e.toBlob(n,t,90);else try{var o=e.toDataURL(t,r),s=new XMLHttpRequest;s.responseType="blob",s.onload=function(e){s.status>=400?a(new m("Error parsing data URL")):n(s.response)},s.onerror=function(){a(new m("Unable to load image"))},s.open("GET",o,!0),s.send()}catch(e){a(e)}})}function f(e,t,r){h.call(this,e,t,r)}function m(e){this.message=e}var p=r("../../common/node_modules/relaks-event-emitter/index.js"),h=p.GenericEvent,v={video:!0,audio:!0,preferredDevice:"front",chooseNewDevice:!0,captureImageOnly:!1,watchVolume:!1,segmentDuration:void 0,videoMIMEType:"video/webm",audioMIMEType:"audio/webm",imageMIMEType:"image/jpeg",audioBitsPerSecond:128e3,videoBitsPerSecond:25e5},g=n.prototype=Object.create(p.prototype);g.activate=function(){if(!this.active){if(this.capturedVideo||this.capturedAudio||this.capturedImage)return;this.acquire(),this.active=!0,this.notifyChange(),this.watchDevices()}},g.deactivate=function(){this.active&&(this.mediaRecorder&&(clearInterval(this.mediaRecorderInterval),this.mediaRecorder.removeEventListener("dataavailable",this.handleMediaRecorderData),this.mediaRecorder.removeEventListener("start",this.handleMediaRecorderStart),this.mediaRecorder.removeEventListener("stop",this.handleMediaRecorderStop),this.mediaRecorder.removeEventListener("pause",this.handleMediaRecorderPause),this.mediaRecorder.removeEventListener("resume",this.handleMediaRecorderResume),this.mediaRecorder.stop(),this.mediaRecorder=null,this.mediaRecorderStartTime=null,this.mediaRecorderDuration=0,this.mediaRecorderInterval=0,this.mediaRecorderBlobs=[]),this.releaseInput(),this.revokeBlobURLs(),this.unwatchDevices(),this.active=!1,this.notifyChange())},g.acquire=function(){var e=this;this.status||(this.status="acquiring");var t={video:this.options.video,audio:this.options.audio};return i(t).then(function(r){var n=e.chosenDeviceID||e.options.preferredDevice,s=l(r,n);if(s){var u={deviceId:s.id};t.video?t.video=u:t.audio&&(t.audio=u)}return a(t).then(function(n){if(e.status="initiating",e.devices=r,e.chosenDeviceID=s?s.id:void 0,e.notifyChange(),t.video)return o(n).then(function(r){e.stream=n,e.liveVideo={stream:n,height:r.height,width:r.width},e.options.watchVolume&&t.audio&&e.watchAudioVolume(),e.watchStreamStatus(),e.status="previewing",e.notifyChange()});t.audio&&(e.stream=n,e.liveAudio={stream:n},e.options.watchVolume&&e.watchAudioVolume(),e.watchStreamStatus(),e.status="previewing",e.notifyChange())})}).catch(function(t){return e.lastError=t,e.status="denied",e.notifyChange(),console.error(t),null})},g.start=function(){try{if(this.mediaRecorder)return;var e=this.options.segmentDuration,t={};this.options.audio&&(t.audioBitsPerSecond=this.options.audioBitsPerSecond,t.mimeType=this.options.audioMIMEType),this.options.video&&(t.videoBitsPerSecond=this.options.videoBitsPerSecond,t.mimeType=this.options.videoMIMEType),this.liveVideo&&(this.videoDimensions={width:this.liveVideo.width,height:this.liveVideo.height}),this.mediaRecorder=new MediaRecorder(this.stream,t),this.mediaRecorder.addEventListener("dataavailable",this.handleMediaRecorderData),this.mediaRecorder.addEventListener("start",this.handleMediaRecorderStart),this.mediaRecorder.addEventListener("stop",this.handleMediaRecorderStop),this.mediaRecorder.addEventListener("pause",this.handleMediaRecorderPause),this.mediaRecorder.addEventListener("resume",this.handleMediaRecorderResume),this.mediaRecorder.start(e)}catch(e){this.lastError=e,console.error(e)}},g.stop=function(){try{this.mediaRecorder.stop()}catch(e){this.lastError=e,console.error(e)}},g.pause=function(){try{this.mediaRecorder.pause()}catch(e){this.lastError=e,console.error(e)}},g.resume=function(){try{this.mediaRecorder.resume()}catch(e){this.lastError=e,console.error(e)}},g.snap=function(){try{var e=this,t=this.options.imageMIMEType,r=this.options.imageQuality||90,n=this.options.captureImageOnly;if(!this.liveVideo)throw new m("No video stream");s(this.stream).then(function(a){c(a,t,r).then(function(t){var r=URL.createObjectURL(t);e.capturedImage={url:r,blob:t,width:a.width,height:a.height},n&&(e.status="captured"),e.notifyChange()}).catch(function(e){console.error(e)})})}catch(e){this.lastError=e,console.error(e)}},g.watchDevices=function(){var e=navigator.mediaDevices;e&&e.addEventListener&&e.addEventListener("devicechange",this.handleDeviceChange),window.addEventListener("orientationchange",this.handleOrientationChange),window.addEventListener("resize",this.handleResize)},g.unwatchDevices=function(){var e=navigator.mediaDevices;e&&e.removeEventListener&&e.removeEventListener("devicechange",this.handleDeviceChange),window.removeEventListener("orientationchange",this.handleOrientationChange),window.removeEventListener("resize",this.handleResize)},g.watchStreamStatus=function(){for(var e=this.stream.getTracks(),t=0;t<e.length;t++)e[t].onended=this.handleStreamEnd},g.unwatchStreamStatus=function(){for(var e=this.stream.getTracks(),t=0;t<e.length;t++)e[t].onended=null},g.watchAudioVolume=function(){"function"==typeof AudioContext&&(this.audioContext=new AudioContext,this.audioProcessor=this.audioContext.createScriptProcessor(4096,1,1),this.audioSource=this.audioContext.createMediaStreamSource(this.stream),this.audioProcessor.addEventListener("audioprocess",this.handleAudioProcess),this.audioSource.connect(this.audioProcessor),this.audioProcessor.connect(this.audioContext.destination))},g.unwatchAudioVolume=function(){this.audioContext&&(this.audioProcessor.disconnect(this.audioContext.destination),this.audioSource.disconnect(this.audioProcessor),this.audioProcessor.removeEventListener("audioprocess",this.handleAudioProcess),this.audioContext=void 0,this.audioSource=void 0,this.audioProcessor=void 0),this.volume=void 0},g.releaseInput=function(){this.stream&&(this.unwatchAudioVolume(),this.unwatchStreamStatus(),u(this.stream),this.stream=void 0,this.liveVideo=void 0,this.liveAudio=void 0)},g.revokeBlobURLs=function(){this.capturedVideo&&(URL.revokeObjectURL(this.capturedVideo.url),this.capturedVideo=void 0),this.capturedAudio&&(URL.revokeObjectURL(this.capturedAudio.url),this.capturedAudio=void 0),this.capturedImage&&(URL.revokeObjectURL(this.capturedImage.url),this.capturedImage=void 0)},g.reacquire=function(){return this.status="initiating",this.releaseInput(),this.notifyChange(),this.acquire()},g.choose=function(e){try{return this.chosenDeviceID===e&&this.stream?Promise.resolve():(this.chosenDeviceID=e,this.reacquire())}catch(e){return this.lastError=e,console.error(e),Promise.reject(e)}},g.clear=function(){this.revokeBlobURLs(),this.liveVideo||this.liveAudio?this.status="previewing":(this.status=void 0,this.active&&this.acquire()),this.duration=void 0,this.notifyChange()},g.change=function(){return this.waitForEvent("change")},g.notifyChange=function(){this.triggerEvent(new f("change",this))},g.handleDeviceChange=function(e){if(!this.scanningDevices){this.scanningDevices=!0;var t=this,r=this.devices;i({video:this.options.video,audio:this.options.audio}).then(function(e){var n=null,a=!1;if("initiating"!==t.status&&"previewing"!==t.status&&"denied"!==t.status||(a=t.options.chooseNewDevice),a)for(var o=0;o<e.length;o++){for(var s=e[o],u=!0,i=0;i<r.length;i++){var d=r[i];if(s.id===d.id){u=!1;break}}if(u){n=e[o];break}}t.devices=e,t.scanningDevices=!1,n?t.choose(n.id):t.notifyChange()})}},g.handleStreamEnd=function(e){if(this.stream)for(var t=this.stream.getTracks(),r=0;r<t.length;r++)if(e.target===t[r]){"previewing"===this.status?this.reacquire():"capturing"!==this.status&&"paused"!==this.status||(this.releaseInput(),this.stop());break}},g.handleAudioProcess=function(e){for(var t=e.inputBuffer.getChannelData(0),r=0,n=t.length,a=0;a<n;a++){var o=t[a];o>r&&(r=o)}var s=Math.round(100*r);s!==this.volume&&(this.volume=s,this.notifyChange())},g.handleMediaRecorderData=function(e){if(this.mediaRecorderBlobs.push(e.data),this.options.segmentDuration){var e=new f("chunk",this,{blob:e.data});this.triggerEvent(e)}},g.handleMediaRecorderStart=function(e){this.mediaRecorderInterval=setInterval(this.handleMediaRecorderInterval,100),this.mediaRecorderStartTime=new Date,this.status="capturing",this.notifyChange()},g.handleMediaRecorderStop=function(e){clearInterval(this.mediaRecorderInterval);var t=this.mediaRecorderBlobs;if(t.length>0){var r;r=1===t.length?t[0]:new Blob(t,{type:t[0].type});var n=URL.createObjectURL(r);if(this.videoDimensions?this.capturedVideo={url:n,blob:r,blobs:t,duration:this.duration,width:this.videoDimensions.width,height:this.videoDimensions.height}:this.capturedAudio={url:n,blob:r,blobs:t,duration:this.duration},this.mediaRecorderStartTime){var a=new Date,o=a-this.mediaRecorderStartTime;this.duration=this.mediaRecorderDuration+o}this.status="captured"}else this.duration=void 0,this.status="previewing";if(this.mediaRecorder=null,this.mediaRecorderBlobs=[],this.mediaRecorderInterval=0,this.mediaRecorderStartTime=null,this.mediaRecorderDuration=0,this.notifyChange(),this.options.segmentDuration){var e=new f("end",this);this.triggerEvent(e)}},g.handleMediaRecorderPause=function(e){clearInterval(this.mediaRecorderInterval);var t=new Date,r=t-this.mediaRecorderStartTime;this.duration=this.mediaRecorderDuration+r,this.mediaRecorderDuration=this.duration,this.mediaRecorderStartTime=null,this.status="paused",this.notifyChange()},g.handleMediaRecorderResume=g.handleMediaRecorderStart,g.handleOrientationChange=function(e){this.orientationChanged=!0},g.handleResize=function(e){if(this.orientationChanged){this.orientationChanged=!1;var t=this,r=this.liveVideo;r&&o(this.stream).then(function(e){r.width===e.width&&r.height===e.height||(t.liveVideo={stream:r.stream,width:e.width,height:e.height},t.notifyChange())})}},g.handleMediaRecorderInterval=function(){var e=new Date,t=e-this.mediaRecorderStartTime;this.duration=this.mediaRecorderDuration+t,this.notifyChange()},m.prototype=Object.create(Error.prototype),e.exports=n},"../../common/node_modules/string-replace-to-array/string-replace-to-array.js":function(e,t,r){function n(e,t,r){return s("string"==typeof e,"First param must be a string"),s("string"==typeof t||t instanceof RegExp,"Second param must be a string pattern or a regular expression"),("string"==typeof t?a:o)(e,t,r)}function a(e,t,r){var n=e.indexOf(t);if(n>=0){var a=[],o=n+t.length;return n>0&&a.push(e.substring(0,n)),a.push("function"==typeof r?r(e.substring(n,o),n,e):r),o<e.length&&a.push(e.substring(o)),a}return[e]}function o(e,t,r){var n=[],a="function"==typeof r,o=t.lastIndex;t.lastIndex=0;for(var s,u=0;s=t.exec(e);){var i=s.index;""===s[0]&&t.lastIndex++,i!==u&&n.push(e.substring(u,i));u=i+s[0].length;var d=a?r.apply(this,s.concat(i,s.input)):r;if(n.push(d),!t.global)break}return u<e.length&&n.push(e.substring(u)),t.lastIndex=o,n}var s=r("../../common/node_modules/invariant/browser.js"),u=r("../../common/node_modules/lodash.isstring/index.js"),i=r("../../common/node_modules/lodash.flatten/index.js");e.exports=function(e,t,r){if(u(e))return n(e,t,r);if(Array.isArray(e)&&e[0])return i(e.map(function(e){return u(e)?n(e,t,r):e}));throw new TypeError("First argument must be an array or non-empty string")}},"../../common/src/media/media-tag-reader.js":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.extractAlbumArt=void 0;var a=r("../../common/node_modules/babel-runtime/regenerator/index.js"),o=n(a),s=r("../../common/node_modules/babel-runtime/core-js/promise.js"),u=n(s),i=r("../../common/node_modules/babel-runtime/helpers/asyncToGenerator.js"),d=n(i),l=function(){var e=(0,d.default)(o.default.mark(function e(t){var n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.e("jsmediatags").then(r.bind(null,"../node_modules/jsmediatags/dist/jsmediatags.js"));case 2:return n=e.sent,e.abrupt("return",new u.default(function(e,r){var a=new n.Reader(t);a.setTagsToRead(["picture"]),a.read({onSuccess:function(t){var r=f.default.get(t,"tags.picture");if(r&&r.data){var n=r.data,a=new Uint8Array(n),o=new Blob([a],{type:r.format});e(o)}else e(null)},onError:function(t){e(null)}})}));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),c=r("../../common/node_modules/lodash/lodash.js"),f=n(c);t.extractAlbumArt=l},"../../common/src/media/quick-start.js":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t,r,n,i,d){for(;t<r;){var l=o(e,t),c=u(e,t+4);if(l<8)break;switch(c){case"stco":for(var f=0,m=o(e,t+12);f<m;f++){var p=t+16+4*f,h=o(e,p);n<=h&&h<=i&&(h+=d,e[p+0]=h>>24&255,e[p+1]=h>>16&255,e[p+2]=h>>8&255,e[p+3]=h>>0&255)}break;case"co64":for(var v=0,g=o(e,t+12);v<g;v++){var b=t+16+8*v,y=s(e,b);n<=y&&y<=i&&(y+=d,e[b+0]=y>>56&255,e[b+1]=y>>48&255,e[b+2]=y>>40&255,e[b+3]=y>>32&255,e[b+4]=y>>24&255,e[b+5]=y>>16&255,e[b+6]=y>>8&255,e[b+7]=y>>0&255)}break;case"trak":case"mdia":case"minf":case"stbl":a(e,t+8,t+l,n,i,d)}t+=l}}function o(e,t){return e[t+0]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function s(e,t){return e[t+0]<<56|e[t+1]<<48|e[t+2]<<40|e[t+3]<<32|e[t+4]<<24|e[t+5]<<16|e[t+6]<<8|e[t+7]}function u(e,t){return String.fromCharCode(e[t+0])+String.fromCharCode(e[t+1])+String.fromCharCode(e[t+2])+String.fromCharCode(e[t+3])}Object.defineProperty(t,"__esModule",{value:!0}),t.process=void 0;var i=r("../../common/node_modules/babel-runtime/core-js/promise.js"),d=n(i),l=r("../../common/node_modules/babel-runtime/regenerator/index.js"),c=n(l),f=r("../../common/node_modules/babel-runtime/helpers/asyncToGenerator.js"),m=n(f),p=function(){var e=(0,m.default)(c.default.mark(function e(t){var r,n,o,s,u,i,d,l,f,m,p,v;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,h(t);case 3:if(r=e.sent,n=y.default.findIndex(r,{name:"ftyp"}),o=y.default.findIndex(r,{name:"moov"}),0===n&&o>1){e.next=8;break}return e.abrupt("return",null);case 8:return s=r[n],u=r[o],e.next=12,g(t,s);case 12:return i=e.sent,e.next=15,g(t,u);case 15:return d=e.sent,l=new Uint8Array(d),a(l,8,l.length,s.offset+s.size,u.offset,u.size),f=t.slice(s.offset+s.size,u.offset),m=t.slice(u.offset+u.size),p=[i,d,f,m],v=new Blob(p,{type:t.type}),e.abrupt("return",v);case 25:return e.prev=25,e.t0=e.catch(0),e.abrupt("return",null);case 28:case"end":return e.stop()}},e,this,[[0,25]])}));return function(t){return e.apply(this,arguments)}}(),h=function(){var e=(0,m.default)(c.default.mark(function e(t){var r,n,a,o,s,u,i;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=[],n=0,a=t.size,o=!1,s=!1;case 5:if(o&&s){e.next=18;break}return e.next=8,v(t,n);case 8:if(u=e.sent,i=!1,o?"moov"===u.name&&(s=!0):"ftyp"===u.name?o=!0:i=!0,n+=u.size,n>a&&(i=!0),!i){e.next=15;break}throw new Error("File does not appear to a QuickTime container");case 15:r.push(u),e.next=5;break;case 18:return e.abrupt("return",r);case 19:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),v=function(){var e=(0,m.default)(c.default.mark(function e(t,r){return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new d.default(function(e,n){var a=t.slice(r,r+16),i=new FileReader;i.readAsArrayBuffer(a),i.onload=function(t){var a=new Uint8Array(t.target.result),i=o(a,0),d=8;1===i&&(i=s(a,8),d=16),i>=d||n(new Error("Invalid atom size"));var l=u(a,4);e({offset:r,size:i,name:l})},i.onerror=function(e){n(new Error("Unable to load data"))}}));case 1:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}(),g=function(){var e=(0,m.default)(c.default.mark(function e(t,r){return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new d.default(function(e,n){var a=t.slice(r.offset,r.offset+r.size),o=new FileReader;o.readAsArrayBuffer(a),o.onload=function(t){e(t.target.result)},o.onerror=function(e){n(new Error("Unable to load data"))}}));case 1:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}(),b=r("../../common/node_modules/lodash/lodash.js"),y=n(b);t.process=p},"../../common/src/objects/finders/bookmark-finder.js":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.findBookmarksForUser=t.findBookmarksByUser=void 0;var a=r("../../common/node_modules/babel-runtime/regenerator/index.js"),o=n(a),s=r("../../common/node_modules/babel-runtime/helpers/asyncToGenerator.js"),u=n(s),i=function(){var e=(0,u.default)(o.default.mark(function e(t,r,n,a){var s;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=c.default.map(n,"id"),s=c.default.sortBy(c.default.uniq(s)),!c.default.isEmpty(s)&&r){e.next=4;break}return e.abrupt("return",f);case 4:return e.abrupt("return",t.find({table:"bookmark",criteria:{user_ids:[r.id],story_ids:s},minimum:a}));case 5:case"end":return e.stop()}},e,this)}));return function(t,r,n,a){return e.apply(this,arguments)}}(),d=function(){var e=(0,u.default)(o.default.mark(function e(t,r,n){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.find({table:"bookmark",criteria:{target_user_id:r.id,hidden:!1},prefetch:!0,minimum:n}));case 1:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}(),l=r("../../common/node_modules/lodash/lodash.js"),c=n(l),f=[];t.findBookmarksByUser=i,t.findBookmarksForUser=d},"../../common/src/objects/finders/reaction-finder.js":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.findReactionsToStories=void 0;var a=r("../../common/node_modules/babel-runtime/regenerator/index.js"),o=n(a),s=r("../../common/node_modules/babel-runtime/helpers/asyncToGenerator.js"),u=n(s),i=function(){var e=(0,u.default)(o.default.mark(function e(t,r,n,a){var s;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=l.default.filter(l.default.uniq(l.default.map(r,"id")),function(e){return e>=1}),!l.default.isEmpty(s)&&n){e.next=3;break}return e.abrupt("return",c);case 3:return e.abrupt("return",t.find({table:"reaction",criteria:{story_id:s,public:"guest"===n.type||void 0},minimum:a}));case 4:case"end":return e.stop()}},e,this)}));return function(t,r,n,a){return e.apply(this,arguments)}}(),d=r("../../common/node_modules/lodash/lodash.js"),l=n(d),c=[];t.findReactionsToStories=i},"../../common/src/objects/finders/repo-finder.js":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.findProjectRepos=t.findExistingRepos=t.findAllRepos=t.findRepo=void 0;var a=r("../../common/node_modules/babel-runtime/regenerator/index.js"),o=n(a),s=r("../../common/node_modules/babel-runtime/helpers/asyncToGenerator.js"),u=n(s),i=function(){var e=(0,u.default)(o.default.mark(function e(t,r){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.findOne({schema:"global",table:"repo",criteria:{id:r},required:!0}));case 1:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}(),d=function(){var e=(0,u.default)(o.default.mark(function e(t,r){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.find({schema:"global",table:"repo",criteria:{},minimum:r}));case 1:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}(),l=function(){var e=(0,u.default)(o.default.mark(function e(t,r){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.find({schema:"global",table:"repo",criteria:{deleted:!1},minimum:r}));case 1:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}(),c=function(){var e=(0,u.default)(o.default.mark(function e(t,r){var n,a;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r instanceof Array)){e.next=8;break}if(n=m.default.flatten(m.default.map(r,"repo_ids")),!m.default.isEmpty(n)){e.next=4;break}return e.abrupt("return",p);case 4:return n=m.default.sortBy(m.default.uniq(n)),e.abrupt("return",t.find({schema:"global",table:"repo",criteria:{id:n,deleted:!1}}));case 8:if(a=r){e.next=11;break}return e.abrupt("return",p);case 11:return e.abrupt("return",t.find({schema:"global",table:"repo",criteria:{id:a.repo_ids,deleted:!1},prefetch:!0}));case 12:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}(),f=r("../../common/node_modules/lodash/lodash.js"),m=n(f),p=[];t.findRepo=i,t.findAllRepos=d,t.findExistingRepos=l,t.findProjectRepos=c},"../../common/src/objects/finders/story-finder.js":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){if(!e||"guest"===e.type)return!0}Object.defineProperty(t,"__esModule",{value:!0}),t.findStoriesOfBookmarks=t.findStoriesOfNotifications=t.findStoriesWithRolesInListing=t.findStoriesByUsersInListings=t.findStoriesByUserInListing=t.findStoriesByUserOnDate=t.findStoriesByUserWithTags=t.findStoriesByUserMatchingText=t.findStoriesInListing=t.findStoriesOnDate=t.findStoriesWithTags=t.findStoriesMatchingText=t.findUnlistedStories=t.findDraftStories=t.findStories=t.findStory=void 0;var o=r("../../common/node_modules/babel-runtime/regenerator/index.js"),s=n(o),u=r("../../common/node_modules/babel-runtime/helpers/asyncToGenerator.js"),i=n(u),d=function(){var e=(0,i.default)(s.default.mark(function e(t,r){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.findOne({table:"story",criteria:{id:r},required:!0}));case 1:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}(),l=function(){var e=(0,i.default)(s.default.mark(function e(t,r){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!_.default.isEmpty(r)){e.next=2;break}return e.abrupt("return",F);case 2:return r=_.default.sortBy(_.default.uniq(r)),e.abrupt("return",t.find({table:"story",criteria:{id:r}}));case 4:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}(),c=function(){var e=(0,i.default)(s.default.mark(function e(t,r,n){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!_.default.isEmpty(r)&&n){e.next=2;break}return e.abrupt("return",F);case 2:return r=_.default.sortBy(_.default.uniq(r)),e.abrupt("return",t.find({table:"story",criteria:{id:r,published:!0,ready:!0,public:a(n)}}));case 4:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}(),f=function(){var e=(0,i.default)(s.default.mark(function e(t,r){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}return e.abrupt("return",F);case 2:return e.abrupt("return",t.find({table:"story",criteria:{published:!1,user_ids:[r.id]}}));case 3:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}(),m=function(){var e=(0,i.default)(s.default.mark(function e(t,r,n,a){var o,u;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}return e.abrupt("return",F);case 2:if(n){e.next=4;break}return e.abrupt("return",F);case 4:return o=_.default.filter(n,function(e){if(_.default.includes(e.user_ids,r.id)&&e.ptime>a)return!0}),u=_.default.map(o,"id"),e.abrupt("return",t.find({table:"story",criteria:{exclude:u,user_ids:[r.id],newer_than:a,published:!0}}));case 7:case"end":return e.stop()}},e,this)}));return function(t,r,n,a){return e.apply(this,arguments)}}(),p=function(){var e=(0,i.default)(s.default.mark(function e(t,r,n,o,u){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.find({table:"story",criteria:{search:{lang:n.languageCode,text:r},published:!0,ready:!0,public:a(o),limit:u?void 0:100,per_user_limit:u},remote:!0}));case 1:case"end":return e.stop()}},e,this)}));return function(t,r,n,a,o){return e.apply(this,arguments)}}(),h=function(){var e=(0,i.default)(s.default.mark(function e(t,r,n,o,u){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.find({table:"story",criteria:{tags:r,published:!0,ready:!0,public:a(n),limit:o?void 0:500,per_user_limit:o},minimum:u}));case 1:case"end":return e.stop()}},e,this)}));return function(t,r,n,a,o){return e.apply(this,arguments)}}(),v=function(){var e=(0,i.default)(s.default.mark(function e(t,r,n,o,u){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.find({table:"story",criteria:{time_range:S.getDayRange(r),published:!0,ready:!0,public:a(n),limit:o?void 0:500,per_user_limit:o},minimum:u}));case 1:case"end":return e.stop()}},e,this)}));return function(t,r,n,a,o){return e.apply(this,arguments)}}(),g=function(){var e=(0,i.default)(s.default.mark(function e(t,r,n,o){var u,i,d;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return",F);case 2:return u={table:"listing",criteria:{type:r,target_user_id:n.id,filters:{public:a(n)}},prefetch:!0},o&&(u.blocking="stale"),e.next=6,t.findOne(u);case 6:if(i=e.sent){e.next=9;break}throw new Error("No story listing");case 9:if(!_.default.isEmpty(i.story_ids)||!i.dirty){e.next=15;break}return e.next=12,t.waitForChange({table:"listing"},i,5e3);case 12:return d=e.sent,d||t.refresh({table:"listing"},i),e.abrupt("return",g(t,r,n));case 15:return e.abrupt("return",c(t,i.story_ids,n));case 16:case"end":return e.stop()}},e,this)}));return function(t,r,n,a){return e.apply(this,arguments)}}(),b=function(){var e=(0,i.default)(s.default.mark(function e(t,r,n,o,u){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.find({table:"story",criteria:{user_ids:[r.id],search:{lang:o.languageCode,text:n},published:!0,ready:!0,public:a(u),limit:100},remote:!0}));case 1:case"end":return e.stop()}},e,this)}));return function(t,r,n,a,o){return e.apply(this,arguments)}}(),y=function(){var e=(0,i.default)(s.default.mark(function e(t,r,n,o,u){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.find({table:"story",criteria:{user_ids:[r.id],tags:n,published:!0,ready:!0,public:a(o),limit:500},minimum:u}));case 1:case"end":return e.stop()}},e,this)}));return function(t,r,n,a,o){return e.apply(this,arguments)}}(),D=function(){var e=(0,i.default)(s.default.mark(function e(t,r,n,o,u){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.find({table:"story",criteria:{user_ids:[r.id],time_range:S.getDayRange(n),published:!0,ready:!0,public:a(o),limit:500},minimum:u}));case 1:case"end":return e.stop()}},e,this)}));return function(t,r,n,a,o){return e.apply(this,arguments)}}(),k=function(){var e=(0,i.default)(s.default.mark(function e(t,r,n,o,u){var i,d,l;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o){e.next=2;break}return e.abrupt("return",F);case 2:return i={table:"listing",criteria:{type:r,target_user_id:o.id,filters:{user_ids:[n.id],public:a(o)}},prefetch:!0},u&&(i.blocking="stale"),e.next=6,t.findOne(i);case 6:if(d=e.sent){e.next=9;break}return e.abrupt("return",null);case 9:if(!_.default.isEmpty(d.story_ids)||!d.dirty){e.next=15;break}return e.next=12,t.waitForChange({table:"listing"},d,5e3);case 12:return l=e.sent,l||t.refresh({table:"listing"},d),e.abrupt("return",k(t,r,n,o));case 15:return e.abrupt("return",c(t,d.story_ids,o));case 16:case"end":return e.stop()}},e,this)}));return function(t,r,n,a,o){return e.apply(this,arguments)}}(),C=function(){var e=(0,i.default)(s.default.mark(function e(t,r,n,o,u,i){var d,l,f;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return d={table:"listing",criteria:{type:r,target_user_id:o.id,filters:_.default.map(n,function(e){return{user_ids:[e.id],public:a(o)}})},prefetch:!0},i&&(d.blocking="stale"),e.next=4,t.find(d);case 4:if(l=e.sent,f=_.default.flatten(_.default.map(l,function(e){return _.default.slice(e.story_ids,-u)})),!_.default.isEmpty(f)){e.next=9;break}if(!_.default.some(l,{dirty:!0})){e.next=9;break}return e.abrupt("return",null);case 9:return e.abrupt("return",c(t,f,o));case 10:case"end":return e.stop()}},e,this)}));return function(t,r,n,a,o,s){return e.apply(this,arguments)}}(),E=function(){var e=(0,i.default)(s.default.mark(function e(t,r,n,o,u){var i,d;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o){e.next=2;break}return e.abrupt("return",F);case 2:return i={table:"listing",criteria:{type:r,target_user_id:o.id,filters:{role_ids:n,public:a(o)}},prefetch:!0},u&&(i.blocking="stale"),e.next=6,t.findOne(i);case 6:if(d=e.sent){e.next=9;break}return e.abrupt("return",null);case 9:if(!_.default.isEmpty(d.story_ids)||!d.dirty){e.next=11;break}return e.abrupt("return",null);case 11:return e.abrupt("return",c(t,d.story_ids,o));case 12:case"end":return e.stop()}},e,this)}));return function(t,r,n,a,o){return e.apply(this,arguments)}}(),w=function(){var e=(0,i.default)(s.default.mark(function e(t,r,n){var a;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=_.default.filter(_.default.map(r,"story_id")),e.abrupt("return",c(t,a,n));case 2:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}(),x=function(){var e=(0,i.default)(s.default.mark(function e(t,r,n){var a;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=_.default.map(r,"story_id"),e.abrupt("return",c(t,a,n));case 2:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}(),j=r("../../common/node_modules/lodash/lodash.js"),_=n(j),R=r("../../common/src/utils/date-utils.js"),S=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(R),F=[];t.findStory=d,t.findStories=l,t.findDraftStories=f,t.findUnlistedStories=m,t.findStoriesMatchingText=p,t.findStoriesWithTags=h,t.findStoriesOnDate=v,t.findStoriesInListing=g,t.findStoriesByUserMatchingText=b,t.findStoriesByUserWithTags=y,t.findStoriesByUserOnDate=D,t.findStoriesByUserInListing=k,t.findStoriesByUsersInListings=C,t.findStoriesWithRolesInListing=E,t.findStoriesOfNotifications=w,t.findStoriesOfBookmarks=x},"../../common/src/objects/types/resource-types.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=["image","video","audio","website"];t.default=n,t.ResourceTypes=n},"../../common/src/objects/utils/external-data-utils.js":function(e,t,r){"use strict";function n(e,t){return D.default.assign({type:e.type,server_id:e.id},t)}function a(e,t,r){var n=i(t,e);if(!n)throw new Error("Parent object is not linked to server");return n=D.default.pickBy(n,function(e,t){return"_"!==t.charAt(0)}),D.default.assign(n,r)}function o(e,t,r){return u(e,n(t,r))}function s(e,t,r,n){return u(e,a(t,r,n))}function u(e,t){var r=-1;return e.external?r=D.default.findIndex(e.external,{server_id:t.server_id}):e.external=[],-1!==r?e.external[r]=t:e.external.push(t),t}function i(e,t,r){var n=D.default.find(e.external,{server_id:t.id});return!n||r&&!D.default.isMatch(n,r)?null:n}function d(e,t,r){var n=D.default.find(e.external,{type:t});return!n||r&&!D.default.isMatch(n,r)?null:n}function l(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return D.default.find(e.external,function(e){if(D.default.every(D.default.pick(e,r)))return!0})||null}function c(e,t){for(var r=arguments.length,n=Array(r>2?r-2:0),a=2;a<r;a++)n[a-2]=arguments[a];return D.default.find(e.external,function(e){return D.default.find(t.external,function(t){if(e.type===t.type&&e.server_id===t.server_id){if(D.default.isEmpty(n))return!0;if(D.default.isEqual(D.default.pick(e,n),D.default.pick(t,n)))return!0}})})||null}function f(e,t,r){D.default.remove(e.external,function(e){if(e.server_id===t.id&&(!r||D.default.isMatch(e,r)))return!0})}function m(e){return D.default.size(e.external)}function p(e,t,r,n){if(!n.ignore){var a=D.default.get(e,r),o=n.overwrite,s=void 0,u=D.default.indexOf(o,":");if(-1!==u&&(s=o.substr(u+1),o=o.substr(0,u)),"always"===o)void 0!==n.value?D.default.set(e,r,n.value):D.default.unset(e,r);else if("never"===o)void 0===a&&void 0!==n.value&&D.default.set(e,r,n.value);else{if("match-previous"!==o)throw new Error("Unknown option: "+o);var i=g(e,t),d=D.default.get(i,s);D.default.isEqual(a,d)&&(void 0!==n.value?(D.default.set(e,r,n.value),D.default.set(i,s,n.value)):(D.default.unset(e,r),D.default.unset(i,s)))}}}function h(e,t,r){if(!r.ignore){var n="details.resources",a=D.default.get(e,n,[]),o=D.default.findIndex(a,{type:r.type}),s=a[o],u=r.replace;if("always"===u)void 0===s?r.value&&a.push(r.value):r.value?a[o]=r.value:a.splice(o,1);else if("never"===u)void 0===s&&r.value&&a.push(r.value);else{if("match-previous"!==u)throw new Error("Unknown option: "+u);var i=g(e,t),d=D.default.get(i,"resources",[]),l=D.default.findIndex(d,{type:r.type}),c=d[l];D.default.isEqual(s,c)&&(void 0===s?r.value&&(a.push(r.value),d.push(r.value)):r.value?(a[o]=r.value,d[l]=r.value):(a.splice(o,1),d.splice(l,1))),D.default.isEmpty(d)?D.default.unset(i,"resources"):D.default.set(i,"resources",d)}D.default.isEmpty(a)?D.default.unset(e,n):D.default.set(e,n,a)}}function v(e,t,r,n,a){if(!a.ignore){var o=D.default.get(n,r),s=a.overwrite,u=void 0,i=D.default.indexOf(s,":");if(-1!==i&&(u=s.substr(i+1),s=s.substr(0,i)),"always"===s)D.default.set(n,r,a.value);else if("never"===s)void 0===o&&D.default.set(n,r,a.value);else{if("match-previous"!==s)throw new Error("Unknown option: "+s);var d=g(e,t),l=D.default.get(d,u);D.default.isEqual(o,l)&&(D.default.set(n,r,a.value),D.default.set(d,u,a.value))}}}function g(e,t){var r=D.default.find(e.exchange,{server_id:t.id});return r||(r={type:t.type,server_id:t.id,previous:{}},e.exchange||(e.exchange=[]),e.exchange.push(r)),r.previous}function b(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=D.default.first(t),a=D.default.slice(t,1),o=D.default.find(n.external,function(e){var t=D.default.pick(e,"server_id","type");return D.default.every(a,function(e){return D.default.some(e.external,t)})});return o?{id:o.server_id,type:o.type}:null}Object.defineProperty(t,"__esModule",{value:!0}),t.findCommonServer=t.exportProperty=t.importResource=t.importProperty=t.countLinks=t.removeLink=t.findLinkByRelative=t.findLinkByRelations=t.findLinkByServerType=t.findLink=t.attachLink=t.inheritLink=t.addLink=t.extendLink=t.createLink=void 0;var y=r("../../common/node_modules/lodash/lodash.js"),D=function(e){return e&&e.__esModule?e:{default:e}}(y);t.createLink=n,t.extendLink=a,t.addLink=o,t.inheritLink=s,t.attachLink=u,t.findLink=i,t.findLinkByServerType=d,t.findLinkByRelations=l,t.findLinkByRelative=c,t.removeLink=f,t.countLinks=m,t.importProperty=p,t.importResource=h,t.exportProperty=v,t.findCommonServer=b},"../../common/src/objects/utils/issue-utils.js":function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!e||!t)return null;var r=void 0,n=void 0,a=!0,o=!1,s=void 0;try{for(var i,d=(0,u.default)(t);!(a=(i=d.next()).done);a=!0){var c=i.value,f=l.findLinkByRelative(e,c,"project");f&&f.issue&&(r=c,n=f)}}catch(e){o=!0,s=e}finally{try{!a&&d.return&&d.return()}finally{if(o)throw s}}return r?{id:n.issue.id,number:n.issue.number,title:e.details.title||"",labels:e.details.labels||[],repo_id:r.id}:null}Object.defineProperty(t,"__esModule",{value:!0}),t.extractIssueDetails=void 0;var s=r("../../common/node_modules/babel-runtime/core-js/get-iterator.js"),u=a(s),i=r("../../common/node_modules/lodash/lodash.js"),d=(a(i),r("../../common/src/objects/utils/external-data-utils.js")),l=n(d),c=r("../../common/src/utils/tag-scanner.js");n(c);t.extractIssueDetails=o},"../../common/src/objects/utils/project-utils.js":function(e,t,r){"use strict";function n(e,t){if(e&&t&&!t.disabled){if("admin"===t.type||s.default.includes(e.user_ids,t.id))return e.archived?"read-only":"read-write";if(s.default.get(e,"settings.access_control.grant_view_access"))return e.archived?"read-only":s.default.get(e,"settings.access_control.grant_comment_access")?"read-comment":"read-only"}return null}function a(e,t){if(n(e,t))return!0;if("guest"===t.type){if(s.default.get(e,"settings.membership.allow_guest_request"))return!0}else if(s.default.get(e,"settings.membership.allow_user_request"))return!0;return!1}Object.defineProperty(t,"__esModule",{value:!0}),t.getUserAccessLevel=t.isVisibleToUser=void 0;var o=r("../../common/node_modules/lodash/lodash.js"),s=function(e){return e&&e.__esModule?e:{default:e}}(o);t.isVisibleToUser=a,t.getUserAccessLevel=n},"../../common/src/objects/utils/repo-utils.js":function(e,t,r){"use strict";function n(e,t){var r=t.locale.p,n=void 0;return e&&e.details&&(n=r(e.details.title)||e.name),n||""}function a(e){var t=void 0;return e&&e.details&&(t=e.details.web_url),t}function o(e){var t=void 0,r=a(e);return r&&(r=y.default.trimEnd(r," /"),t=r+"/settings/members"),t}function s(e,t){var r=k.findLinkByRelations(t,"issue");return y.default.get(r,"issue.number")||""}function u(e,t){var r=void 0,n=a(e),o=s(e,t);return n&&o&&(r=n+"/issues/"+o),r}function i(e,t){var r=void 0,n=a(e),o=k.findLinkByRelations(t,"milestone"),s=y.default.get(o,"milestone.id");return n&&s&&(r=e.details.web_url+"/milestones/"+s),r}function d(e,t){var r=void 0,n=a(e),o=k.findLinkByRelations(t,"merge_request"),s=y.default.get(o,"merge_request.number");return n&&s&&(r=e.details.web_url+"/merge_requests/"+s),r}function l(e,t){var r=void 0,n=y.default.get(t,"details.commit_before"),o=y.default.get(t,"details.commit_after"),s=a(e);return s&&(n?r=s+"/compare/"+n+"..."+o:o&&(r=s+"/commit/"+o)),r}function c(e,t){var r=void 0,n=y.default.get(t,"details.branch"),o=a(e);return o&&("branch"===t.type?r=o+"/commits/"+n:"tag"===t.type&&(r=o+"/tags/"+n)),r}function f(e,t){var r=void 0;if(e){var n=(y.default.get(e,"details.labels"),y.default.get(e,"details.label_colors")),a=y.default.indexOf(e.details.labels,t),o=y.default.get(n,a);o&&(r={backgroundColor:o},g(o)&&(r.color="#000000"))}return r}function m(e){var t=y.default.get(e,"note.id");return t?"#note_"+t:""}function p(e,t){var r=void 0,n=a(e),o=k.findLinkByRelations(t,"note","commit");if(n&&o){r=n+"/commit/"+o.commit.id+m(o)}return r}function h(e,t){var r=void 0,n=a(e),o=k.findLinkByRelations(t,"note","issue"),s=y.default.get(o,"issue.number");if(n&&s){r=n+"/issues/"+s+m(o)}return r}function v(e,t){var r=void 0,n=a(e),o=k.findLinkByRelations(t,"note","merge_request"),s=y.default.get(o,"merge_request.number");if(n&&s){r=n+"/merge_requests/"+s+m(o)}return r}function g(e){var t=void 0,r=void 0,n=void 0;return 4===e.length?(t=parseInt(e.substr(1,1),16)*(1/15),r=parseInt(e.substr(2,1),16)*(1/15),n=parseInt(e.substr(3,1),16)*(1/15)):7===e.length&&(t=parseInt(e.substr(1,2),16)*(1/255),r=parseInt(e.substr(3,2),16)*(1/255),n=parseInt(e.substr(5,2),16)*(1/255)),Math.sqrt(.299*t*t+.587*r*r+.114*n*n)>.8}Object.defineProperty(t,"__esModule",{value:!0}),t.getMergeRequestNoteURL=t.getIssueNoteURL=t.getCommitNoteURL=t.getLabelStyle=t.getBranchURL=t.getPushURL=t.getMergeRequestURL=t.getMilestoneURL=t.getIssueURL=t.getIssueNumber=t.getMembershipPageURL=t.getURL=t.getDisplayName=void 0;var b=r("../../common/node_modules/lodash/lodash.js"),y=function(e){return e&&e.__esModule?e:{default:e}}(b),D=r("../../common/src/objects/utils/external-data-utils.js"),k=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(D);t.getDisplayName=n,t.getURL=a,t.getMembershipPageURL=o,t.getIssueNumber=s,t.getIssueURL=u,t.getMilestoneURL=i,t.getMergeRequestURL=d,t.getPushURL=l,t.getBranchURL=c,t.getLabelStyle=f,t.getCommitNoteURL=p,t.getIssueNoteURL=h,t.getMergeRequestNoteURL=v},"../../common/src/utils/focus-manager.js":function(e,t,r){"use strict";function n(e,t){i.unshift({component:e,props:t}),d=u.default.filter(d,function(r){return!u.default.isMatch(t,r)||(e.focus(),!1)})}function a(e){i=u.default.filter(i,function(t){return t.component!==e})}function o(e){var t=u.default.find(i,{props:e});t?t.component.focus():d.push(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.focus=t.unregister=t.register=void 0;var s=r("../../common/node_modules/lodash/lodash.js"),u=function(e){return e&&e.__esModule?e:{default:e}}(s),i=[],d=[];t.register=n,t.unregister=a,t.focus=o},"../../common/src/utils/list-parser.js":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){e=e||"";for(var t=[],r=0,n=void 0,a=null,o=1,s=1;n=g.exec(e);){var u=e.substring(r,n.index);if(u)if(a)if(v.default.trim(u))a=null,s++,t.push(u);else{var i=v.default.last(a);i.after+=u}else t.push(u);var d=n[1],l=n[2],c=!!v.default.trim(l),f=n[3],m=n[4],p=n[5],h={label:m,checked:c,answer:l,before:d,between:f,after:p,list:s,key:o};a?a.push(h):(a=[h],t.push(a)),r=n.index+n[0].length,o++}var b=e.substring(r);return b&&t.push(b),t}function o(e){if("object"===(void 0===e?"undefined":(0,p.default)(e)))return v.default.some(e,o);var t=a(e);return v.default.some(t,function(e){return e instanceof Array})}function s(e,t,r,n,a){var o=!0,s=!1,u=void 0;try{for(var i,d=(0,f.default)(e);!(o=(i=d.next()).done);o=!0){var c=i.value;if(c instanceof Array){var m=!0,p=!1,h=void 0;try{for(var v,g=(0,f.default)(c);!(m=(v=g.next()).done);m=!0){var b=v.value;b.list==t&&(b.key==r?(b.checked=n,l(b)):n&&a&&(b.checked=!1,l(b)))}}catch(e){p=!0,h=e}finally{try{!m&&g.return&&g.return()}finally{if(p)throw h}}}}}catch(e){s=!0,u=e}finally{try{!o&&d.return&&d.return()}finally{if(s)throw u}}}function u(e,t,r){var n=!0,a=!1,o=void 0;try{for(var s,u=(0,f.default)(e);!(n=(s=u.next()).done);n=!0){var i=s.value;if(i instanceof Array){var d=v.default.find(i,function(e){if(e.list==t&&e.key==r)return!0});if(d)return d}}}catch(e){a=!0,o=e}finally{try{!n&&u.return&&u.return()}finally{if(a)throw o}}return null}function i(e,t){var r=0,n=!0,a=!1,o=void 0;try{for(var s,u=(0,f.default)(e);!(n=(s=u.next()).done);n=!0){var i=s.value;if(i instanceof Array){var d=!0,l=!1,c=void 0;try{for(var m,p=(0,f.default)(i);!(d=(m=p.next()).done);d=!0){var h=m.value;void 0!==t&&h.checked!==t||r++}}catch(e){l=!0,c=e}finally{try{!d&&p.return&&p.return()}finally{if(l)throw c}}}}}catch(e){a=!0,o=e}finally{try{!n&&u.return&&u.return()}finally{if(a)throw o}}return r}function d(e){e=v.default.flattenDeep(e);var t=[],r=!0,n=!1,a=void 0;try{for(var o,s=(0,f.default)(e);!(r=(o=s.next()).done);r=!0){var u=o.value;u instanceof Object?t.push(u.before+"* ["+u.answer+"]"+u.between+u.label+u.after):t.push(u)}}catch(e){n=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(n)throw a}}return t.join("")}function l(e){if(e.checked){var t=void 0;t=/[\u0x0400-\u0x04ff]/.test(e.label)?"":/[\u0x0370-\u0x03ff]/.test(e.label)?"":"x",e.answer=t}else e.answer=" "}Object.defineProperty(t,"__esModule",{value:!0}),t.join=t.count=t.find=t.set=t.detect=t.extract=void 0;var c=r("../../common/node_modules/babel-runtime/core-js/get-iterator.js"),f=n(c),m=r("../../common/node_modules/babel-runtime/helpers/typeof.js"),p=n(m),h=r("../../common/node_modules/lodash/lodash.js"),v=n(h),g=/^([ \t]*)\*\s+\[([ x])\]([ \t]*)(.*?)([ \t]*?)$/gim;t.extract=a,t.detect=o,t.set=s,t.find=u,t.count=i,t.join=d},"../../common/src/utils/markdown.js":function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if("object"===(void 0===e?"undefined":(0,E.default)(e)))return x.default.some(e,o);var r=c(t),n=r.extractBlocks(e);return x.default.some(n,function(e){switch(e.type){case"space":return!1;case"paragraph":case"text_block":var t=void 0,n=r.inlineLexer;for(n.start(e.markdown);t=n.captureToken();)switch(t.type){case"url":case"text":case"autolink":case"br":break;default:return!0}break;case"list":return x.default.every(e.children,function(e){var t=e.children[0];return"text_block"!==t.type||!/^\s*\[/.test(t.markdown)});default:return!0}})}function s(e,t){var r=c(t),n=f(),a=r.parse(e);return n.render(a)}function u(e,t,r,n){var a=I.extract(e),o=l(a,n);return x.default.map(a,function(e,n){if(e instanceof Array){var a=x.default.map(e,function(e,a){var s=e.checked,u=o[n][a];if(t){var i=t[e.list];void 0!==i&&(s=e.key==i)}return _.default.createElement("div",{className:"list-item",key:a},_.default.createElement("label",{onClick:g},_.default.createElement("input",{type:"radio",name:e.list,value:e.key,checked:s,readOnly:!r,onChange:r})," ",u))});return _.default.createElement("div",{key:n},a)}return o[n]})}function i(e,t,r){var n=I.extract(e),a=l(n,r);return x.default.map(n,function(e,r){if(e instanceof Array){var n=x.default.map(e,function(e,n){var o=a[r][n],s=t[e.list],u=x.default.get(s,"total",0),i=x.default.get(s,["answers",e.key],0),d=Math.round(u>0?i/u*100:0)+"%",l="color-"+e.key%12,c="vote-count";return i===u&&(c+=" unanimous"),_.default.createElement("div",{className:c,key:n},_.default.createElement("div",{className:"label"},o),_.default.createElement("div",{className:"bar"},_.default.createElement("span",{className:"filled "+l,style:{width:d}}),_.default.createElement("span",{className:"percent"},d),_.default.createElement("span",{className:"count"},i+"/"+u)))});return _.default.createElement("div",{key:r},n)}return a[r]})}function d(e,t,r,n){var a=I.extract(e),o=l(a,n);return x.default.map(a,function(e,n){if(e instanceof Array){var a=x.default.map(e,function(e,a){var s=e.checked,u=o[n][a];if(t){var i=t[e.list];if(void 0!==i){var d=i[e.key];void 0!==d&&(s=d)}}return _.default.createElement("div",{className:"list-item",key:a},_.default.createElement("label",{onClick:g},_.default.createElement("input",{type:"checkbox",name:e.list,value:e.key,checked:s,readOnly:!r,onChange:r})," ",u))});return _.default.createElement("div",{key:n},a)}return o[n]})}function l(e,t){var r=c(t),n=x.default.map(e,function(e,t){return e instanceof Array?x.default.map(e,function(e){return r.extractBlocks(e.label)}):r.extractBlocks(e)}),a=!0,o=!1,s=void 0;try{for(var u,i=(0,y.default)(x.default.entries(e));!(a=(u=i.next()).done);a=!0){var d=u.value,l=(0,k.default)(d,2),m=l[0],p=l[1],h=n[m];if(p instanceof Array){var v=!0,g=!1,b=void 0;try{for(var D,C=(0,y.default)(h);!(v=(D=C.next()).done);v=!0){var E=D.value;r.processInline(E)}}catch(e){g=!0,b=e}finally{try{!v&&C.return&&C.return()}finally{if(g)throw b}}}else r.processInline(h)}}catch(e){o=!0,s=e}finally{try{!a&&i.return&&i.return()}finally{if(o)throw s}}var w=f();return x.default.map(e,function(e,t){var r=n[t];return e instanceof Array?x.default.map(e,function(e,t){var n=x.default.first(w.render(r[t]));return n&&n.props&&"p"===n.type&&(n=n.props.children),n}):w.render(r)})}function c(e){var t=new S.default.BlockLexer,r=new S.default.InlineLexer({links:t.links,findRefLink:h,onReference:e});return new S.default.Parser({blockLexer:t,inlineLexer:r})}function f(){return new S.default.Renderer({renderImage:m,renderText:p})}function m(e,t){var r=e.href,n=e.title,a=e.text,o=P.parseJSONEncodedURL(r);return o?_.default.createElement(M.default,{key:t,resource:o,alt:a,title:n}):_.default.createElement("img",{key:t,src:r,alt:a,title:n})}function p(e,t){return A.renderEmoji(e.text,{key:t})}function h(e,t){var r=this.links[e];return r||(this.onReference&&(r=this.onReference({type:"reference",target:this,name:e,forImage:t})),r)}function v(e,t){var r=/^(picture|image|photo|video|audio|website)(-(\d+))?$/.exec(t);if(r){var n=r[1];"picture"!==n&&"photo"!==n||(n="image");var a=x.default.filter(e,{type:n}),o=parseInt(r[3])||1,s=a[o-1];if(s)return s}return null}function g(e){switch(e.target.tagName){case"IMG":case"svg":case"CANVAS":e.preventDefault()}}Object.defineProperty(t,"__esModule",{value:!0}),t.findReferencedResource=t.createRenderer=t.createParser=t.renderTaskList=t.renderSurveyResults=t.renderSurvey=t.render=t.detect=void 0;var b=r("../../common/node_modules/babel-runtime/core-js/get-iterator.js"),y=a(b),D=r("../../common/node_modules/babel-runtime/helpers/slicedToArray.js"),k=a(D),C=r("../../common/node_modules/babel-runtime/helpers/typeof.js"),E=a(C),w=r("../../common/node_modules/lodash/lodash.js"),x=a(w),j=r("../../common/node_modules/react/index.js"),_=a(j),R=r("../../common/node_modules/mark-gor/react.js"),S=a(R),F=r("../../common/src/utils/list-parser.js"),I=n(F),B=r("../../common/src/utils/plain-text.js"),A=n(B),N=r("../../common/src/objects/utils/resource-utils.js"),P=n(N),T=r("../../common/src/widgets/resource-view.jsx"),M=a(T);t.detect=o,t.render=s,t.renderSurvey=u,t.renderSurveyResults=i,t.renderTaskList=d,t.createParser=c,t.createRenderer=f,t.findReferencedResource=v},"../../common/src/utils/plain-text.js":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t,r){var n=C.extract(e);return p.default.map(n,function(e,n){return e instanceof Array?p.default.map(e,function(e,n){var a=e.checked;if(t){var o=t[e.list];void 0!==o&&(a=e.key==o)}var s={type:"radio",name:e.list,value:e.key,readOnly:!r,checked:a,onChange:r};return v.default.createElement("span",{key:n},e.before,v.default.createElement("label",null,v.default.createElement("input",s),e.between,u(e.label)),e.after)}):e})}function o(e,t){var r=C.extract(e);return p.default.map(r,function(e,r){return e instanceof Array?p.default.map(e,function(e,r){var n=t[e.list],a=p.default.get(n,"total",0),o=p.default.get(n,["answers",e.key],0),s=Math.round(a>0?o/a*100:0)+"%",i="color-"+e.key%12,d="vote-count";return o===a&&(d+=" unanimous"),v.default.createElement("span",{key:r},e.before,v.default.createElement("span",{className:d},v.default.createElement("span",{className:"label"},u(e.label)),v.default.createElement("span",{className:"bar"},v.default.createElement("span",{className:"filled "+i,style:{width:s}}),v.default.createElement("span",{className:"percent"},s),v.default.createElement("span",{className:"count"},o+"/"+a))),e.after)}):e})}function s(e,t,r){var n=C.extract(e);return p.default.map(n,function(e,n){return e instanceof Array?p.default.map(e,function(e,n){var a=e.checked;if(t){var o=t[e.list];if(void 0!==o){var s=o[e.key];void 0!==s&&(a=s)}}var i={type:"checkbox",name:e.list,value:e.key,readOnly:!r,checked:a,onChange:r};return v.default.createElement("span",{key:n},e.before,v.default.createElement("label",null,v.default.createElement("input",i),e.between,u(e.label)),e.after)}):e})}function u(e,t){if(!E)return w&&(e=c(e)),[e];var r=p.default.get(t,"key");return(0,D.default)(e,i.bind(null,r))}function i(e,t,r,n){var a=void 0!==e?e+"."+n:n,o="https://twemoji.maxcdn.com/2/72x72/"+t+".png";return v.default.createElement("img",{key:a,alt:r,draggable:!1,src:o,style:x})}function d(){return l("")}function l(e){var t=document.createElement("canvas");if(!t.getContext)return!1;var r=t.getContext("2d");return!!r.fillText&&(r.textBaseline="top",r.font="32px Arial",r.fillText(e,0,0),0!==r.getImageData(16,16,1,1).data[0])}function c(e){return e.replace(j,"")}function f(e){return"string"!=typeof e?0:(_||(_=(0,b.default)()),e.match(_))}Object.defineProperty(t,"__esModule",{value:!0}),t.hasEmojiSupport=t.findEmoji=t.renderEmoji=t.renderTaskList=t.renderSurveyResults=t.renderSurvey=void 0;var m=r("../../common/node_modules/lodash/lodash.js"),p=n(m),h=r("../../common/node_modules/react/index.js"),v=n(h),g=r("../../common/node_modules/emoji-regex/index.js"),b=n(g),y=r("../../common/node_modules/react-easy-emoji/index.js"),D=n(y),k=r("../../common/src/utils/list-parser.js"),C=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(k),E=!d(),w=!E&&!function(){return l("")}(),x={height:"1em",width:"1em",margin:"0 .05em 0 .1em",verticalAlign:"-0.1em"},j=/\ud83c\udffb|\ud83c\udffc|\ud83c\udffd|\ud83c\udffe|\ud83c\udfff/g,_=void 0;t.renderSurvey=a,t.renderSurveyResults=o,t.renderTaskList=s,t.renderEmoji=u,t.findEmoji=f,t.hasEmojiSupport=d},"../../common/src/widgets/image-cropper.jsx":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t,r){e.left<0?e.left=0:e.left+e.width>t&&(e.left=t-e.width),e.top<0?e.top=0:e.top+e.height>r&&(e.top=r-e.height)}Object.defineProperty(t,"__esModule",{value:!0}),t.ImageCropper=t.default=void 0;var o=r("../../common/node_modules/babel-runtime/core-js/object/get-prototype-of.js"),s=n(o),u=r("../../common/node_modules/babel-runtime/helpers/classCallCheck.js"),i=n(u),d=r("../../common/node_modules/babel-runtime/helpers/createClass.js"),l=n(d),c=r("../../common/node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),f=n(c),m=r("../../common/node_modules/babel-runtime/helpers/inherits.js"),p=n(m),h=r("../../common/node_modules/lodash/lodash.js"),v=n(h),g=r("../../common/node_modules/react/index.js"),b=n(g),y=r("../../common/node_modules/react-dom/index.js"),D=(n(y),r("../../common/node_modules/hammerjs/hammer.js")),k=n(D),C=r("../../common/src/utils/component-refs.js"),E=n(C),w=r("../../common/src/widgets/bitmap-view.jsx"),x=n(w),j=r("../../common/src/widgets/vector-view.jsx"),_=n(j);r("../../common/src/widgets/image-cropper.scss");var R=function(e){function t(e){(0,i.default)(this,t);var r=(e.clippingRect,(0,f.default)(this,(t.__proto__||(0,s.default)(t)).call(this,e)));return S.call(r),r.components=(0,E.default)({container:HTMLElement,image:x.default}),r.state={uncommittedClippingRect:null,hasFocus:!1},r}return(0,p.default)(t,e),(0,l.default)(t,[{key:"render",value:function(){var e=this.props,t=e.url,r=e.disabled,n=e.vector,a=e.onLoad,o=(this.state.hasFocus,this.components.setters),s=this.getClippingRect(),u={ref:o.container,className:"image-cropper"};r||v.default.assign(u,{tabIndex:0,onMouseDown:this.handleMouseDown,onFocus:this.handleFocus,onBlur:this.handleBlur,onWheel:this.handleMouseWheel,onKeyDown:this.handleKeyDown});var i={ref:o.image,url:t,clippingRect:s,onLoad:a},d=x.default;return n&&(d=_.default),b.default.createElement("div",u,b.default.createElement(d,i))}},{key:"componentDidUpdate",value:function(e,t){var r=this.props.clippingRect,n=this.state,a=n.hasFocus,o=n.uncommittedClippingRect;!t.hasFocus&&a?this.activateTouchHandling():t.hasFocus&&!a&&this.deactivateTouchHandling(),e.clippingRect!==r&&o&&v.default.isEqual(o,r)&&this.setState({uncommittedClippingRect:null})}},{key:"componentWillUnmount",value:function(){this.dragStart&&this.handleMouseUp(),this.zoomChangeTimeout&&(clearTimeout(this.zoomChangeTimeout),this.handleZoomTimeout()),this.deactivateTouchHandling()}},{key:"focus",value:function(){this.components.container.focus()}},{key:"getClippingRect",value:function(){var e=this.props.clippingRect;return this.state.uncommittedClippingRect||e}},{key:"activateTouchHandling",value:function(){var e=this.components.container;if(e&&!this.hammer){this.hammer=new k.default(e);var t=this.hammer.get("pan").set({direction:k.default.DIRECTION_ALL,threshold:5});this.hammer.get("pinch").set({enable:!0}).recognizeWith(t),this.hammer.on("panstart",this.handlePanStart),this.hammer.on("panmove",this.handlePanMove),this.hammer.on("panend",this.handlePanEnd),this.hammer.on("pinchstart",this.handlePinchStart),this.hammer.on("pinchmove",this.handlePinchMove),this.hammer.on("pinchend",this.handlePinchEnd)}}},{key:"deactivateTouchHandling",value:function(){this.hammer&&(this.hammer.off("panstart",this.handlePanStart),this.hammer.off("panmove",this.handlePanMove),this.hammer.off("panend",this.handlePanEnd),this.hammer.off("pinchstart",this.handlePinchStart),this.hammer.off("pinchmove",this.handlePinchMove),this.hammer.off("pinchend",this.handlePinchEnd),this.hammer.stop(!0),this.hammer.element.style.touchAction="",this.hammer.destroy(),this.hammer=null)}},{key:"triggerChangeEvent",value:function(){var e=this.props.onChange,t=this.state.uncommittedClippingRect;t&&e&&e({type:"change",target:this,rect:t})}}]),t}(g.PureComponent);R.displayName="ImageCropper";var S=function(){var e=this;this.handleFocus=function(t){e.setState({hasFocus:!0})},this.handleBlur=function(t){e.setState({hasFocus:!1})},this.handleMouseDown=function(t){var r=e.components,n=r.image,a=r.container,o=e.getClippingRect();if(0===t.button&&n&&a&&o){var s=a.getBoundingClientRect();e.dragStart={clippingRect:o,boundingRect:s,pageX:t.pageX,pageY:t.pageY,naturalWidth:n.naturalWidth,naturalHeight:n.naturalHeight},document.addEventListener("mousemove",e.handleMouseMove),document.addEventListener("mouseup",e.handleMouseUp)}},this.handleMouseMove=function(t){if(t.preventDefault(),e.dragStart){var r={x:e.dragStart.pageX-t.pageX,y:e.dragStart.pageY-t.pageY},n=e.dragStart.boundingRect,o=v.default.clone(e.dragStart.clippingRect),s=r.x*o.width/n.width,u=r.y*o.height/n.height;o.left+=Math.round(s),o.top+=Math.round(u),a(o,e.dragStart.naturalWidth,e.dragStart.naturalHeight),e.setState({uncommittedClippingRect:o})}},this.handleMouseUp=function(t){e.dragStart&&(document.removeEventListener("mousemove",e.handleMouseMove),document.removeEventListener("mouseup",e.handleMouseUp),e.triggerChangeEvent(),e.dragStart=null)},this.handleMouseWheel=function(t){var r=e.state.hasFocus,n=e.components,o=n.image,s=n.container,u=e.getClippingRect();if(t.preventDefault(),o&&s&&u){r||e.focus();var i=4;t.shiftKey&&(i=1);var d=s.getBoundingClientRect(),l=void 0;switch(t.deltaMode){case 0:l=t.deltaY;break;case 1:l=18*t.deltaY;break;case 2:l=480*t.deltaY}var c=Math.round(l*u.height/d.height/i),f=u.width+c;f>o.naturalWidth&&(f=o.naturalWidth,c=f-u.width);var m=u.height+c;m>o.naturalHeight&&(m=o.naturalHeight,c=m-u.height,f=u.width+c);var p={x:t.pageX-d.left,y:t.pageY-d.top},h=-p.x*c/d.width,g=-p.y*c/d.height;u=v.default.clone(u),u.left+=Math.round(h),u.top+=Math.round(g),u.width=f,u.height=m,a(u,o.naturalWidth,o.naturalHeight),e.setState({uncommittedClippingRect:u},function(){e.zoomChangeTimeout&&clearTimeout(e.zoomChangeTimeout),e.zoomChangeTimeout=setTimeout(e.handleZoomTimeout,1e3)}),e.dragStart&&(e.dragStart={clippingRect:u,boundingRect:d,pageX:t.pageX,pageY:t.pageY,naturalWidth:o.naturalWidth,naturalHeight:o.naturalHeight})}},this.handleZoomTimeout=function(){e.triggerChangeEvent(),e.zoomChangeTimeout=0},this.handlePanStart=function(t){var r=e.components,n=r.image,a=r.container,o=e.getClippingRect();if("mouse"!==t.pointerType&&n&&a&&o){var s=a.getBoundingClientRect();e.panStart={clippingRect:o,boundingRect:s,naturalWidth:n.naturalWidth,naturalHeight:n.naturalHeight},e.handlePanMove(t)}},this.handlePanMove=function(t){if(e.panStart){var r=e.panStart.boundingRect,n=v.default.clone(e.panStart.clippingRect),o=-t.deltaX*n.width/r.width,s=-t.deltaY*n.height/r.height;n.left+=Math.round(o),n.top+=Math.round(s),a(n,e.panStart.naturalWidth,e.panStart.naturalHeight),e.setState({uncommittedClippingRect:n})}},this.handlePanEnd=function(t){e.panStart&&(e.triggerChangeEvent(),e.panStart=null)},this.handlePinchStart=function(t){var r=e.components,n=r.image,a=r.container,o=e.getClippingRect();if("mouse"!==t.pointerType&&n&&a&&o){var s=a.getBoundingClientRect();e.pinchStart={clippingRect:o,boundingRect:s,pointers:v.default.map(t.pointers,function(e){return{pageX:e.pageX,pageY:e.pageY}})},e.handlePinchMove(t)}},this.handlePinchMove=function(t){var r=e.components.image;if(e.pinchStart){var n=v.default.clone(e.pinchStart.clippingRect),o=e.pinchStart.boundingRect,s=1/t.scale,u=Math.round(n.width*s);u>r.naturalWidth&&(u=r.naturalWidth,s=u/n.width);var i=Math.round(n.height*s);i>r.naturalHeight&&(i=r.naturalHeight,s=i/n.height,u=Math.round(n.width*s));var d={x:e.pinchStart.pointers[0].pageX-o.left,y:e.pinchStart.pointers[0].pageY-o.top},l={x:e.pinchStart.pointers[1].pageX-o.left,y:e.pinchStart.pointers[1].pageY-o.top},c={x:t.pointers[0].pageX-o.left,y:t.pointers[0].pageY-o.top},f={x:t.pointers[1].pageX-o.left,y:t.pointers[1].pageY-o.top},m=(d.x*n.width-c.x*u)/o.width,p=(l.x*n.width-f.x*u)/o.width,h=(d.y*n.height-c.y*i)/o.height,g=(l.y*n.height-f.y*i)/o.height;n.left+=Math.round((m+p)/2),n.top+=Math.round((h+g)/2),n.width=u,n.height=i,a(n,r.naturalWidth,r.naturalHeight),e.setState({uncommittedClippingRect:n})}},this.handlePinchEnd=function(t){e.pinchStart&&(e.triggerChangeEvent(),e.pinchStart=null)},this.handleKeyDown=function(t){var r=e.state.hasFocus,n=e.components.container;r&&27===t.keyCode&&n.blur()}};R.defaultProps={vector:!1},t.default=R,t.ImageCropper=R},"../../common/src/widgets/image-cropper.scss":function(e,t){},"../../common/src/widgets/live-video.jsx":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.LiveVideo=t.default=void 0;var a=r("../../common/node_modules/babel-runtime/helpers/extends.js"),o=n(a),s=r("../../common/node_modules/babel-runtime/helpers/objectWithoutProperties.js"),u=n(s),i=r("../../common/node_modules/babel-runtime/core-js/object/get-prototype-of.js"),d=n(i),l=r("../../common/node_modules/babel-runtime/helpers/classCallCheck.js"),c=n(l),f=r("../../common/node_modules/babel-runtime/helpers/createClass.js"),m=n(f),p=r("../../common/node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),h=n(p),v=r("../../common/node_modules/babel-runtime/helpers/inherits.js"),g=n(v),b=r("../../common/node_modules/react/index.js"),y=n(b),D=function(e){function t(){var e,r,n,a;(0,c.default)(this,t);for(var o=arguments.length,s=Array(o),u=0;u<o;u++)s[u]=arguments[u];return r=n=(0,h.default)(this,(e=t.__proto__||(0,d.default)(t)).call.apply(e,[this].concat(s))),n.setNode=function(e){n.node=e},a=r,(0,h.default)(n,a)}return(0,g.default)(t,e),(0,m.default)(t,[{key:"render",value:function(){var e=this.props,t=e.srcObject,r=(0,u.default)(e,["srcObject"]);return t instanceof Blob&&(r.src=this.blobURL=URL.createObjectURL(t)),y.default.createElement("video",(0,o.default)({ref:this.setNode},r))}},{key:"setSrcObject",value:function(){var e=this.props.srcObject;e&&(e instanceof Blob||(this.node.srcObject=e),this.node.play())}},{key:"componentDidMount",value:function(){this.setSrcObject()}},{key:"componentDidUpdate",value:function(e,t){var r=this.props.srcObject;e.srcObject!==r&&this.setSrcObject()}},{key:"componentWillUnmount",value:function(){this.blobURL&&URL.revokeObjectURL(this.blobURL)}}]),t}(b.PureComponent);t.default=D,t.LiveVideo=D},"../../common/src/widgets/smart-list.jsx":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){this.node=e}Object.defineProperty(t,"__esModule",{value:!0}),t.SmartList=t.default=void 0;var o=r("../../common/node_modules/babel-runtime/helpers/slicedToArray.js"),s=n(o),u=r("../../common/node_modules/babel-runtime/core-js/get-iterator.js"),i=n(u),d=r("../../common/node_modules/babel-runtime/core-js/object/get-prototype-of.js"),l=n(d),c=r("../../common/node_modules/babel-runtime/helpers/classCallCheck.js"),f=n(c),m=r("../../common/node_modules/babel-runtime/helpers/createClass.js"),p=n(m),h=r("../../common/node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),v=n(h),g=r("../../common/node_modules/babel-runtime/helpers/inherits.js"),b=n(g),y=r("../../common/node_modules/lodash/lodash.js"),D=n(y),k=r("../../common/node_modules/react/index.js"),C=n(k),E=r("../../common/src/utils/component-refs.js"),w=n(E);r("../../common/src/widgets/smart-list.scss");var x=/iPhone|iPad|iPod/.test(navigator.userAgent),j=function(e){function t(e){(0,f.default)(this,t);var r=(0,v.default)(this,(t.__proto__||(0,l.default)(t)).call(this,e));return r.handleScroll=function(e){var t=r.state,n=t.slots,a=t.currentAnchor;if(!r.scrollPositionInterval){if(r.resizing)return void r.maintainScrollPosition();var o=r.findAnchorSlot(n),s=void 0;o&&(s=o.id),s!==a&&r.setState({currentAnchor:s}),r.scrolling=!0,r.scrollingEndTimeout&&clearTimeout(r.scrollingEndTimeout),r.scrollingEndTimeout=setTimeout(function(){r.scrolling=!1,r.scrollingEndTimeout=0,r.triggerAnchorChangeEvent(o)},500)}},r.handleWindowResize=function(e){var t=r.state.slots;if(r.scrollContainerWidth!==r.scrollContainer.clientWidth){r.scrollContainerWidth=r.scrollContainer.clientWidth,t=D.default.slice(t);var n=!0,a=!1,o=void 0;try{for(var s,u=(0,i.default)(t);!(n=(s=u.next()).done);n=!0){s.value.height=void 0}}catch(e){a=!0,o=e}finally{try{!n&&u.return&&u.return()}finally{if(a)throw o}}r.setState({slots:t,estimatedHeight:void 0}),r.resizing=!0,r.resizingEndTimeout&&clearTimeout(r.resizingEndTimeout),r.resizingEndTimeout=setTimeout(function(){r.resizing=!1,r.resizingEndTimeout=0},50)}},r.handleTransitionEnd=function(e){var t=r.state,n=t.slots,a=t.currentAnchor;n=D.default.slice(n);var o=D.default.find(n,{node:e.target});if(o)if("appearing"===o.state)"opacity"===e.propertyName&&(o.state="present",o.transition=!1,r.setState({slots:n}),r.scrollToAnchorNode===e.target&&(r.maintainScrollPosition(),clearInterval(r.scrollPositionInterval),r.scrollPositionInterval=null,r.scrollToAnchorNode=null));else if("disappearing"===o.state&&("height"===e.propertyName||0===o.node.clientHeight)){var s=D.default.indexOf(n,o);n.splice(s,1);var u=r.findAnchorSlot(n);u&&u.id!==a&&(a=u.id,r.triggerAnchorChangeEvent(u)),r.setState({slots:n,currentAnchor:a})}},r.components=(0,w.default)({container:HTMLDivElement}),r.state={},r.scrolling=!1,r.scrollingInterrupted=!1,r.scrollContainer=null,r.scrollContainerWidth=0,r.scrollPositionInterval=0,r.scrollToAnchorNode=null,r.lastReportedAnchor=null,r.updateAnchor(e,r.state),r.updateSlots(e,r.state),r}return(0,b.default)(t,e),(0,p.default)(t,[{key:"componentWillReceiveProps",value:function(e){var t=this.props,r=t.anchor,n=t.items,a=D.default.clone(this.state);e.anchor!==r&&(!e.anchor&&e.noReset||this.updateAnchor(e,a)),e.items!==n&&this.updateSlots(e,a);var o=D.default.shallowDiff(a,this.state);D.default.isEmpty(o)||this.setState(o)}},{key:"shouldComponentUpdate",value:function(e,t){return!this.lastReportedAnchor||this.lastReportedAnchor!==t.currentAnchor||(this.lastReportedAnchor=null,!1)}},{key:"updateAnchor",value:function(e,t){t.currentAnchor!==e.anchor&&(t.currentAnchor=e.anchor||void 0,this.anchorOffset=e.offset,this.scrolling&&(this.scrollingInterrupted=!0))}},{key:"updateSlots",value:function(e,t){var r=this,n=this.props.transitioning,a=e.items||[],o=function(t,n,a){return e.onIdentity({type:"identity",target:r,item:t,currentIndex:n,alternative:a||!1})},u=D.default.slice(t.slots),d=D.default.transform(u,function(e,t){e[t.id]=t},{}),l=!D.default.isEmpty(u),c={},f=!0,m=!1,p=void 0;try{for(var h,v=(0,i.default)(a.entries());!(f=(h=v.next()).done);f=!0){var g=h.value,b=(0,s.default)(g,2),y=b[0],k=b[1],C=o(k,y),E=d[C];if(!E){var w=o(k,y,!0);w&&(E=d[w])&&(E.id=C)}if(E)E.item=k,E.index=y,"disappearing"===E.state&&(E.state="present");else{var x="present";l&&function(t,n){return!e.onTransition||e.onTransition({type:"transition",target:r,item:t,currentIndex:n})}(k,y)&&(x="appearing"),E=this.createSlot(C,k,y,x),u.push(E)}c[C]=!0}}catch(e){m=!0,p=e}finally{try{!f&&v.return&&v.return()}finally{if(m)throw p}}var j=!0,_=!1,R=void 0;try{for(var S,F=(0,i.default)(u);!(j=(S=F.next()).done);j=!0){var E=S.value;c[E.id]||(l&&this.isSlotVisible(E)?E.state="disappearing":E.state="gone")}}catch(e){_=!0,R=e}finally{try{!j&&F.return&&F.return()}finally{if(_)throw R}}var I=0,B=0,A=!0,N=!1,P=void 0;try{for(var T,M=(0,i.default)(u);!(A=(T=M.next()).done);A=!0){var L=T.value;"appearing"===L.state?I<n?I++:L.state="present":"disappearing"===L.state&&(B<n?B++:L.state="gone")}}catch(e){N=!0,P=e}finally{try{!A&&M.return&&M.return()}finally{if(N)throw P}}var U=D.default.remove(u,{state:"gone"});if(D.default.some(U,{unseen:!0})){var O=D.default.filter(u,{unseen:!0});this.triggerBeforeAnchorEvent(O)}t.slots=D.default.sortBy(u,"index")}},{key:"createSlot",value:function(e,t,r,n){var o={id:e,key:e,index:r,state:n,item:t,transition:!1,rendering:void 0,contents:null,unseen:!1,height:void 0,node:null,setter:null};return o.setter=a.bind(o),o}},{key:"render",value:function(){var e=this,t=this.props,r=t.onRender,n=t.ahead,a=t.behind,o=t.inverted,s=this.state,u=s.slots,i=s.currentAnchor,d=s.estimatedHeight,l=this.components.setters,c=0;i&&(c=D.default.findIndex(u,{id:i}));var f=Math.max(0,c-a),m=Math.min(D.default.size(u),c+n+1),p=D.default.map(u,function(t,n){var a=f<=n&&n<m,o=void 0;if("disappearing"!==t.state){var s={type:"render",target:e,item:t.item,needed:a,startIndex:f,currentIndex:n,endIndex:m,previousHeight:t.height,estimatedHeight:d};o=t.contents=r(s)}else o=t.contents;a&&(t.rendering=!0);var u="slot",i=void 0;return"appearing"===t.state?(u+=" transition in",t.transition?i={height:t.height}:u+=" hidden"):"disappearing"===t.state&&(u+=" transition out",t.transition?u+=" hidden":i={height:t.height}),C.default.createElement("div",{key:t.key,ref:t.setter,className:u,style:i},o)});return this.startIndex=f,this.endIndex=m,o&&D.default.reverse(p),C.default.createElement("div",{ref:l.container,className:"smart-list",onTransitionEnd:this.handleTransitionEnd},p)}},{key:"componentDidMount",value:function(){for(var e=this.components.container,t=e.parentNode;t;t=t.parentNode){var r=getComputedStyle(t);if("auto"===r.overflowY||"scroll"===r.overflowY){this.scrollContainer=t;break}}this.scrollContainerWidth=this.scrollContainer.clientWidth,this.scrollContainer.addEventListener("scroll",this.handleScroll),window.addEventListener("resize",this.handleWindowResize),this.maintainScrollPosition(),this.setSlotHeights()}},{key:"componentDidUpdate",value:function(e,t){this.state.currentAnchor;this.scrolling&&!this.scrollingInterrupted||(this.maintainScrollPosition(),this.scrolling&&(clearTimeout(this.scrollingEndTimeout),this.scrolling=!1,this.scrollingInterrupted=!1,this.scrollingEndTimeout=0)),this.setSlotHeights(),this.markUnseenSlots(),this.setTransitionState()}},{key:"maintainScrollPosition",value:function(){var e=this.props.inverted,t=this.state,r=t.slots,n=t.currentAnchor,a=void 0,o=void 0;if(n?(a=D.default.find(r,{id:n}),o=this.anchorOffset):e&&(a=D.default.first(r),o=1/0),a&&a.node){if(void 0!==o){var s=this.scrollContainer.offsetTop,u=this.scrollContainer.scrollTop,i=a.node.offsetTop-s;if(e){var d=this.scrollContainer.scrollHeight,l=this.scrollContainer.offsetHeight,c=d-u-l,f=a.node.offsetHeight,m=d-i-f,p=m-c;if(p!==o){var h=Math.max(0,m-o),v=d-h-l;this.scrollContainer.scrollTop=v,this.scrollContainer.scrollTop!==v&&(this.scrollContainer.scrollTop=v)}}else{var g=i-u;if(g!==o){var b=Math.max(0,i-o);this.scrollContainer.scrollTop!==b&&(this.scrollContainer.scrollTop=b)}}}}else 0!==this.scrollContainer.scrollTop&&(e||(x&&this.scrolling?(this.scrollContainer.style.overflowY="hidden",this.scrollContainer.scrollTop=0,this.scrollContainer.style.overflowY="scroll"):this.scrollContainer.scrollTop=0))}},{key:"isSlotVisible",value:function(e){if(!e.rendering||!e.node)return!1;if(e.transition)return!0;if(this.scrollContainer){var t=this.scrollContainer.offsetHeight,r=this.scrollContainer.offsetTop,n=this.scrollContainer.scrollTop,a=n+t,o=e.node.offsetTop-r;if(n<o&&o<=a)return!0;var s=o+e.height;if(n<s&&s<=a)return!0}return!1}},{key:"setSlotHeights",value:function(){var e=this.state,t=e.slots,r=e.estimatedHeight,n=[],a=!0,o=!1,s=void 0;try{for(var u,d=(0,i.default)(t);!(a=(u=d.next()).done);a=!0){var l=u.value;if(l.rendering){var c=l.node.firstChild,f=c?c.offsetHeight:0;l.height=f,n.push(f)}}}catch(e){o=!0,s=e}finally{try{!a&&d.return&&d.return()}finally{if(o)throw s}}if(void 0===r&&!D.default.isEmpty(n)){var m=D.default.sum(n)/n.length,p=Math.round(m);0!==p&&this.setState({estimatedHeight:p})}}},{key:"markUnseenSlots",value:function(){var e=this.state,t=e.slots,r=e.currentAnchor,n=D.default.findIndex(t,{id:r}),a=!1,o=!0,u=!1,d=void 0;try{for(var l,c=(0,i.default)(t.entries());!(o=(l=c.next()).done);o=!0){var f=l.value,m=(0,s.default)(f,2),p=m[0],h=m[1];"appearing"===h.state?p<n&&(this.isSlotVisible(h)||(h.unseen=!0,a=!0)):h.unseen&&p>=n&&(h.unseen=!1,a=!0)}}catch(e){u=!0,d=e}finally{try{!o&&c.return&&c.return()}finally{if(u)throw d}}if(a){var v=D.default.filter(t,{unseen:!0});this.triggerBeforeAnchorEvent(v)}}},{key:"setTransitionState",value:function(){var e=this,t=this.props.inverted,r=this.state,n=r.slots,a=r.currentAnchor,o=!1,s=!0,u=!1,d=void 0;try{for(var l,c=(0,i.default)(n);!(s=(l=c.next()).done);s=!0){var f=l.value;if(("appearing"===f.state||"disappearing"===f.state)&&!f.transition){var m=this.isSlotVisible(f);t&&("appearing"!==f.state||a||(this.scrollPositionInterval||(this.scrollPositionInterval=setInterval(function(){e.maintainScrollPosition()},10)),this.scrollToAnchorNode=f.node,m=!0)),m?f.transition=!0:f.state="present",o=!0}}}catch(e){u=!0,d=e}finally{try{!s&&c.return&&c.return()}finally{if(u)throw d}}o&&this.setState({slots:n})}},{key:"componentWillUnmount",value:function(){this.scrollContainer.removeEventListener("scroll",this.handleScroll),window.removeEventListener("resize",this.handleWindowResize),this.scrollingEndTimeout&&clearTimeout(this.scrollingEndTimeout)}},{key:"triggerAnchorChangeEvent",value:function(e){var t=this.props.onAnchorChange;if(t){var r=e?e.item:null;t({type:"anchorchange",target:this,anchor:this.lastReportedAnchor=e?e.id:null,item:r})}}},{key:"triggerBeforeAnchorEvent",value:function(e){var t=this.props.onBeforeAnchor;t&&t({type:"beforeanchor",target:this,items:D.default.map(e,"item")})}},{key:"findAnchorSlot",value:function(e){var t=this.props.inverted,r=this.scrollContainer.scrollTop,n=this.scrollContainer.offsetTop,a=void 0;if(t){var o=this.scrollContainer.scrollHeight,s=this.scrollContainer.offsetHeight,u=o-r-s;if(u>0)for(var i=0;i<e.length;i++){var d=e[i];a=d;var l=a.node.offsetTop-n,c=a.node.offsetHeight,f=o-l-c;if(f>u)break}}else{var m=void 0;if(r>0)for(var p=0;p<e.length;p++){var h=e[p];if(a=h,(m=a.node.offsetTop-n)>r)break}this.anchorOffset=a?m-r:void 0}return a}}]),t}(k.Component);j.displayName="SmartList",j.defaultProps={behind:5,ahead:10,offset:0,inverted:!1,transitioning:5,noReset:!1},t.default=j,t.SmartList=j},"../../common/src/widgets/smart-list.scss":function(e,t){},"./dialogs/app-component-dialog-box.jsx":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.AppComponentDialogBox=t.default=void 0;var a=r("../../common/node_modules/babel-runtime/core-js/object/get-prototype-of.js"),o=n(a),s=r("../../common/node_modules/babel-runtime/helpers/classCallCheck.js"),u=n(s),i=r("../../common/node_modules/babel-runtime/helpers/createClass.js"),d=n(i),l=r("../../common/node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),c=n(l),f=r("../../common/node_modules/babel-runtime/helpers/inherits.js"),m=n(f),p=r("../../common/node_modules/react/index.js"),h=n(p),v=r("../../common/node_modules/mark-gor/react.js"),g=n(v),b=r("../../common/src/widgets/overlay.jsx"),y=n(b),D=r("./widgets/push-button.jsx"),k=n(D),C=r("../../common/src/widgets/resource-view.jsx"),E=n(C);r("./dialogs/app-component-dialog-box.scss");var w=r("../../common/src/env/environment.js"),x=(n(w),function(e){function t(){return(0,u.default)(this,t),(0,c.default)(this,(t.__proto__||(0,o.default)(t)).apply(this,arguments))}return(0,m.default)(t,e),(0,d.default)(t,[{key:"render",value:function(){var e=this.props,t=e.component,r=e.show,n=e.onClose;if(!t)return null;var a={show:r,onBackgroundClick:n};return h.default.createElement(y.default,a,h.default.createElement("div",{className:"app-component-dialog-box"},h.default.createElement("div",{className:"contents"},this.renderPicture(),this.renderText()),this.renderButtons()))}},{key:"renderPicture",value:function(){var e=this.props,t=e.env,r=e.component;if(r.image)return h.default.createElement("div",{className:"picture"},h.default.createElement(E.default,{resource:r.image,height:128,env:t}));var n=r.icon||{},a=n.class||"fa-cubes",o={color:n.color,backgroundColor:n.backgroundColor};return h.default.createElement("div",{className:"picture"},h.default.createElement("div",{className:"icon",style:o},h.default.createElement("i",{className:"fa fa-fw "+a})))}},{key:"renderText",value:function(){var e=this.props,t=e.env,r=e.component,n=t.locale.p,a=n(r.text),o=g.default.parse(a);return h.default.createElement("div",{className:"text"},o)}},{key:"renderButtons",value:function(){var e=this.props,t=e.env,r=e.onClose,n=t.locale.t,a={label:n("app-component-close"),emphasized:!0,onClick:r};return h.default.createElement("div",{className:"buttons"},h.default.createElement(k.default,a))}}]),t}(p.PureComponent));x.displayName="AppComponentDialogBox",t.default=x,t.AppComponentDialogBox=x},"./dialogs/app-component-dialog-box.scss":function(e,t){},"./dialogs/audio-capture-dialog-box-browser.jsx":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.AudioCaptureDialogBoxBrowserSync=t.AudioCaptureDialogBoxBrowser=t.default=void 0;var a=r("../../common/node_modules/babel-runtime/regenerator/index.js"),o=n(a),s=r("../../common/node_modules/babel-runtime/helpers/asyncToGenerator.js"),u=n(s),i=r("../../common/node_modules/babel-runtime/core-js/object/get-prototype-of.js"),d=n(i),l=r("../../common/node_modules/babel-runtime/helpers/classCallCheck.js"),c=n(l),f=r("../../common/node_modules/babel-runtime/helpers/createClass.js"),m=n(f),p=r("../../common/node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),h=n(p),v=r("../../common/node_modules/babel-runtime/helpers/inherits.js"),g=n(v),b=r("../../common/node_modules/lodash/lodash.js"),y=n(b),D=r("../../common/node_modules/bluebird/js/browser/bluebird.js"),k=(n(D),r("../../common/node_modules/react/index.js")),C=n(k),E=r("../../common/node_modules/relaks/index.js"),w=r("../../common/node_modules/relaks-media-capture/index.js"),x=n(w),j=r("../../common/src/widgets/overlay.jsx"),_=n(j),R=r("./widgets/push-button.jsx"),S=n(R),F=r("./widgets/device-placeholder.jsx"),I=n(F),B=r("./widgets/duration-indicator.jsx"),A=n(B),N=r("./widgets/volume-indicator.jsx"),P=n(N);r("./dialogs/audio-capture-dialog-box-browser.scss");var T=r("../../common/src/transport/payloads.js"),M=(n(T),r("../../common/src/env/environment.js")),L=(n(M),function(e){function t(e){(0,c.default)(this,t);var r=(0,h.default)(this,(t.__proto__||(0,d.default)(t)).call(this,e));r.handleStart=function(e){var t=r.props.payloads;r.stream=t.stream(),r.stream.start(),r.capture.start()},r.handleStop=function(e){r.capture.stop()},r.handlePause=function(e){r.capture.pause()},r.handleResume=function(e){r.capture.resume()},r.handleClear=function(e){r.capture.clear(),r.stream&&(r.stream.cancel(),r.stream=null)},r.handleChoose=function(e){r.capture.choose(e.id)},r.handleCancel=function(e){var t=r.props.onClose;t&&t({type:"cancel",target:r})},r.handleAccept=function(e){var t=r.props,n=t.payloads,a=t.onCapture;if(a){var o=r.capture.capturedAudio,s=n.add("audio");s.attachStream(r.stream);var u={type:"audio",payload_token:s.id,duration:o.duration,format:y.default.last(y.default.split(r.capture.options.audioMIMEType,"/")),bitrates:{audio:r.capture.options.audioBitsPerSecond}};a({type:"capture",target:r,resource:u})}r.capture.deactivate(),r.handleCancel()},r.handleCaptureChunk=function(e){r.stream&&r.stream.push(e.blob)},r.handleCaptureEnd=function(e){r.stream&&r.stream.close()};var n={video:!1,audio:!0,watchVolume:!0,segmentDuration:5e3};return r.capture=new x.default(n),r.capture.addEventListener("chunk",r.handleCaptureChunk),r.capture.addEventListener("end",r.handleCaptureEnd),r.stream=null,r}return(0,g.default)(t,e),(0,m.default)(t,[{key:"renderAsync",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,u.default)(o.default.mark(function e(t){var r,n,a,s;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.props,n=r.env,a=r.show,t.delay(50,50),s={env:n,show:a,onStart:this.handleStart,onStop:this.handleStop,onPause:this.handlePause,onResume:this.handleResume,onClear:this.handleClear,onChoose:this.handleChoose,onAccept:this.handleAccept,onCancel:this.handleCancel},!a){e.next=16;break}this.capture.activate();case 5:return s.status=this.capture.status,s.devices=this.capture.devices,s.chosenDeviceID=this.capture.chosenDeviceID,s.duration=this.capture.duration,s.volume=this.capture.volume<5?0:this.capture.volume,s.capturedImage=this.capture.capturedImage,s.capturedAudio=this.capture.capturedAudio,t.show(C.default.createElement(U,s)),e.next=15,this.capture.change();case 15:if(this.capture.active){e.next=5;break}case 16:return e.abrupt("return",C.default.createElement(U,s));case 17:case"end":return e.stop()}},e,this)}));return e}()},{key:"componentDidUpdate",value:function(e,t){var r=this;e.show&&setTimeout(function(){r.props.show||(r.capture.deactivate(),r.capture.clear())},500)}},{key:"componentWillUnmount",value:function(){this.capture.deactivate()}}]),t}(E.AsyncComponent)),U=function(e){function t(){return(0,c.default)(this,t),(0,h.default)(this,(t.__proto__||(0,d.default)(t)).apply(this,arguments))}return(0,g.default)(t,e),(0,m.default)(t,[{key:"render",value:function(){var e=this.props.show,t={show:e,onBackgroundClick:this.handleCancelClick};return C.default.createElement(_.default,t,C.default.createElement("div",{className:"audio-capture-dialog-box"},C.default.createElement("div",{className:"container"},this.renderView()),C.default.createElement("div",{className:"controls"},C.default.createElement("div",{className:"left"},this.renderDuration()),C.default.createElement("div",{className:"right"},this.renderButtons()))))}},{key:"renderView",value:function(){var e=this.props,t=e.status,r=e.capturedAudio;switch(t){case"acquiring":case"denied":var n={blocked:"denied"===t,icon:"microphone"};return C.default.createElement(I.default,n);case"initiating":case"previewing":case"capturing":case"paused":return this.renderVolume();case"captured":var a={className:"preview",src:r.url,controls:!0};return C.default.createElement("audio",a)}}},{key:"renderDeviceSelector",value:function(){var e=this.props,t=e.env,r=e.devices,n=e.chosenDeviceID,a=e.onChoose,o={type:"audio",chosenDeviceID:n,devices:r,env:t,onSelect:a};return C.default.createElement(DeviceSelector,o)}},{key:"renderDuration",value:function(){var e=this.props,t=e.status,r=e.duration;if("number"!=typeof r)return null;var n={duration:r,recording:"capturing"===t};return C.default.createElement(A.default,n)}},{key:"renderVolume",value:function(){var e=this.props,t=e.status,r=e.volume,n={type:"gauge",volume:r,recording:"capturing"===t};return C.default.createElement(P.default,n)}},{key:"renderButtons",value:function(){var e=this.props,t=e.env,r=e.status,n=this.props,a=n.onCancel,o=n.onStart,s=n.onPause,u=n.onResume,i=n.onStop,d=n.onClear,l=n.onAccept,c=t.locale.t;switch(r){case"acquiring":case"denied":case"initiating":case"previewing":var f={label:c("audio-capture-cancel"),onClick:a},m={label:c("audio-capture-start"),onClick:o,disabled:"previewing"!==r,emphasized:"previewing"===r};return C.default.createElement("div",{className:"buttons"},C.default.createElement(S.default,f),C.default.createElement(S.default,m));case"capturing":var p={label:c("audio-capture-pause"),onClick:s},h={label:c("audio-capture-stop"),onClick:i,emphasized:!0};return C.default.createElement("div",{className:"buttons"},C.default.createElement(S.default,p),C.default.createElement(S.default,h));case"paused":var v={label:c("audio-capture-resume"),onClick:u,emphasized:!0},g={label:c("audio-capture-stop"),onClick:i};return C.default.createElement("div",{className:"buttons"},C.default.createElement(S.default,v),C.default.createElement(S.default,g));case"captured":var b={label:c("audio-capture-rerecord"),onClick:d},y={label:c("audio-capture-accept"),onClick:l,emphasized:!0};return C.default.createElement("div",{className:"buttons"},C.default.createElement(S.default,b),C.default.createElement(S.default,y))}}}]),t}(k.PureComponent);U.displayName="AudioCaptureDialogBoxBrowserSync",t.default=L,t.AudioCaptureDialogBoxBrowser=L,t.AudioCaptureDialogBoxBrowserSync=U},"./dialogs/audio-capture-dialog-box-browser.scss":function(e,t){},"./dialogs/audio-capture-dialog-box-cordova.jsx":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.AudioCaptureDialogBoxCordova=t.default=void 0;var a=r("../../common/node_modules/babel-runtime/regenerator/index.js"),o=n(a),s=r("../../common/node_modules/babel-runtime/helpers/slicedToArray.js"),u=n(s),i=r("../../common/node_modules/babel-runtime/helpers/asyncToGenerator.js"),d=n(i),l=r("../../common/node_modules/babel-runtime/core-js/object/get-prototype-of.js"),c=n(l),f=r("../../common/node_modules/babel-runtime/helpers/classCallCheck.js"),m=n(f),p=r("../../common/node_modules/babel-runtime/helpers/createClass.js"),h=n(p),v=r("../../common/node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),g=n(v),b=r("../../common/node_modules/babel-runtime/helpers/inherits.js"),y=n(b),D=function(){var e=(0,d.default)(o.default.mark(function e(){var t;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((t=cordova.plugins.permissions)&&"android"===cordova.platformId){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",new w.default(function(e,r){var n=function(){e()},a=function(e){r(new Error("Unable to obtain permission"))};t.requestPermissions([t.RECORD_AUDIO,t.READ_EXTERNAL_STORAGE,t.WRITE_EXTERNAL_STORAGE],n,a)}));case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),k=r("../../common/node_modules/lodash/lodash.js"),C=n(k),E=r("../../common/node_modules/bluebird/js/browser/bluebird.js"),w=n(E),x=r("../../common/node_modules/react/index.js"),j=(n(x),r("../../common/src/media/media-loader.js")),_=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(j),R=r("../../common/src/transport/cordova-file.js"),S=n(R),F=r("../../common/src/transport/payloads.js"),I=(n(F),r("../../common/src/env/environment.js")),B=(n(I),function(e){function t(){var e,r,n,a,s=this;(0,m.default)(this,t);for(var i=arguments.length,l=Array(i),f=0;f<i;f++)l[f]=arguments[f];return r=n=(0,g.default)(this,(e=t.__proto__||(0,c.default)(t)).call.apply(e,[this].concat(l))),n.handleCaptureSuccess=function(){var e=(0,d.default)(o.default.mark(function e(t){var r,a,i,d,l,c,f,m,p,h;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.props.payloads,n.triggerCloseEvent(),!(a=t[0])){e.next=20;break}return e.prev=4,n.triggerCapturePendingEvent(),e.next=8,_.getFormatData(a);case 8:i=e.sent,d=new S.default(a.fullPath),l=C.default.split(a.type,"/"),c=(0,u.default)(l,2),f=c[0],m=c[1],p=r.add("audio"),p.attachFile(d),h={type:"audio",payload_token:p.id,format:m,width:i.width,height:i.height,filename:a.name,duration:1e3*i.duration},n.triggerCaptureEvent(h),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(4),n.triggerCaptureErrorEvent(e.t0);case 20:case"end":return e.stop()}},e,s,[[4,17]])}));return function(t){return e.apply(this,arguments)}}(),n.handleCaptureFailure=function(e){n.triggerCloseEvent(),n.triggerCaptureErrorEvent(e)},a=r,(0,g.default)(n,a)}return(0,y.default)(t,e),(0,h.default)(t,[{key:"componentWillReceiveProps",value:function(e){!this.props.show&&e.show&&this.startCapture()}},{key:"render",value:function(){return null}},{key:"startCapture",value:function(){function e(){return t.apply(this,arguments)}var t=(0,d.default)(o.default.mark(function e(){var t,r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=navigator.device.capture)){e.next=6;break}return e.next=4,D();case 4:r={duration:54e3,limit:1},t.captureAudio(this.handleCaptureSuccess,this.handleCaptureFailure,r);case 6:case"end":return e.stop()}},e,this)}));return e}()},{key:"triggerCloseEvent",value:function(){var e=this.props.onClose;e&&e({type:"close",target:this})}},{key:"triggerCaptureEvent",value:function(e){var t=this.props.onCapture;t&&t({type:"capture",target:this,resource:e})}},{key:"triggerCapturePendingEvent",value:function(){var e=this.props.onCapturePending;e&&e({type:"capturepending",target:this,resourceType:"audio"})}},{key:"triggerCaptureErrorEvent",value:function(e){var t=this.props.onCaptureError;t&&t({type:"capturefailure",target:this,error:e})}}]),t}(x.PureComponent));B.displayName="AudioCaptureDialogBoxCordova",t.default=B,t.AudioCaptureDialogBoxCordova=B},"./dialogs/confirmation-dialog-box.jsx":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.ConfirmationDialogBox=t.default=void 0;var a=r("../../common/node_modules/babel-runtime/core-js/object/get-prototype-of.js"),o=n(a),s=r("../../common/node_modules/babel-runtime/helpers/classCallCheck.js"),u=n(s),i=r("../../common/node_modules/babel-runtime/helpers/createClass.js"),d=n(i),l=r("../../common/node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),c=n(l),f=r("../../common/node_modules/babel-runtime/helpers/inherits.js"),m=n(f),p=r("../../common/node_modules/react/index.js"),h=n(p),v=r("../../common/src/widgets/overlay.jsx"),g=n(v),b=r("./widgets/push-button.jsx"),y=n(b);r("./dialogs/confirmation-dialog-box.scss");var D=r("../../common/src/env/environment.js"),k=(n(D),function(e){function t(){return(0,u.default)(this,t),(0,c.default)(this,(t.__proto__||(0,o.default)(t)).apply(this,arguments))}return(0,m.default)(t,e),(0,d.default)(t,[{key:"render",value:function(){var e=this.props,t=e.show,r=e.onClose,n={show:t,onBackgroundClick:r};return h.default.createElement(g.default,n,h.default.createElement("div",{className:"confirmation-dialog-box"},this.renderMessage(),this.renderButtons()))}},{key:"renderMessage",value:function(){var e=this.props.children;return h.default.createElement("div",{className:"message"},e)}},{key:"renderButtons",value:function(){var e=this.props,t=e.env,r=e.onClose,n=e.onConfirm,a=t.locale.t,o={label:a("confirmation-cancel"),onClick:r,hidden:!r},s={label:a("confirmation-confirm"),onClick:n,hidden:!n,emphasized:!0};return h.default.createElement("div",{className:"buttons"},h.default.createElement(y.default,o),h.default.createElement(y.default,s))}}]),t}(p.PureComponent));k.displayName="ConfirmationDialogBox",t.default=k,t.ConfirmationDialogBox=k},"./dialogs/confirmation-dialog-box.scss":function(e,t){},"./dialogs/issue-dialog-box.jsx":function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.IssueDialogBox=t.default=void 0;var o=r("../../common/node_modules/babel-runtime/helpers/extends.js"),s=a(o),u=r("../../common/node_modules/babel-runtime/core-js/object/get-prototype-of.js"),i=a(u),d=r("../../common/node_modules/babel-runtime/helpers/classCallCheck.js"),l=a(d),c=r("../../common/node_modules/babel-runtime/helpers/createClass.js"),f=a(c),m=r("../../common/node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),p=a(m),h=r("../../common/node_modules/babel-runtime/helpers/inherits.js"),v=a(h),g=r("../../common/node_modules/lodash/lodash.js"),b=a(g),y=r("../../common/node_modules/bluebird/js/browser/bluebird.js"),D=(a(y),r("../../common/node_modules/react/index.js")),k=a(D),C=r("../../common/src/utils/component-refs.js"),E=a(C),w=r("../../common/src/utils/tag-scanner.js"),x=n(w),j=r("../../common/src/objects/utils/repo-utils.js"),_=n(j),R=r("../../common/src/objects/utils/user-utils.js"),S=n(R),F=r("../../common/src/widgets/overlay.jsx"),I=a(F),B=r("./widgets/push-button.jsx"),A=a(B),N=r("./widgets/text-field.jsx"),P=a(N);r("./dialogs/issue-dialog-box.scss");var T=r("../../common/src/env/environment.js"),M=(a(T),function(e){function t(e){(0,l.default)(this,t);var r=(0,p.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));return r.handleDeleteClick=function(e){var t=r.props.onConfirm;t&&t({type:"confirm",target:r,issue:null})},r.handleCancelClick=function(e){var t=r.props.onCancel;t&&t({type:"cancel",target:r})},r.handleOKClick=function(e){var t=r.props,n=(t.story,t.onConfirm),a=r.state.newIssue;a=b.default.clone(a);var o=r.getSelectedRepo();a.repo_id=o.id,a.labels=b.default.intersection(a.labels,o.details.labels),n&&n({type:"close",target:r,issue:a})},r.handleTitleChange=function(e){var t=e.target.value;r.setIssueProperty("title",t)},r.handleRepoChange=function(e){var t=parseInt(e.target.value);r.setIssueProperty("repo_id",t)},r.handleTagClick=function(e){var t=e.target.getAttribute("data-label"),n=r.getIssueProperty("labels")||[];n=b.default.includes(n,t)?b.default.difference(n,[t]):b.default.union(n,[t]),r.setIssueProperty("labels",n)},r.components=(0,E.default)({textField:P.default}),r.state={newIssue:void 0,originalIssue:void 0},r}return(0,v.default)(t,e),(0,f.default)(t,[{key:"getIssueProperty",value:function(e){var t=this.props.issue,r=this.state.newIssue;return b.default.get(r||t,e)}},{key:"setIssueProperty",value:function(e,t){var r=this.props.issue,n=this.state.newIssue,a=b.default.decoupleSet(n||r,e,t);"repo_id"===e&&(L=t,window.localStorage.last_selected_repo_id=t),this.setState({newIssue:a})}},{key:"getSelectedRepo",value:function(){var e=this.getIssueProperty("repo_id"),t=this.getAvailableRepos(),r=b.default.find(t,{id:e});return r||(r=b.default.find(t,{id:L})),r||(r=b.default.last(b.default.sortBy(t,function(e){return b.default.size(e.details.labels)}))),r||(r=b.default.first(t)),r||null}},{key:"getAvailableRepos",value:function(){var e=this.props,t=e.env,r=e.currentUser,n=e.story,a=e.repos,o=t.locale.p;return a=b.default.filter(a,function(e){return S.canAddIssue(r,n,e,"read-write")}),a=b.default.sortBy(a,function(e){return b.default.toLower(o(e.details.title)||e.name)})}},{key:"render",value:function(){var e=this.props,t=e.show,r=e.onClose,n={show:t,onBackgroundClick:r};return k.default.createElement(I.default,n,k.default.createElement("div",{className:"issue-dialog-box"},this.renderForm(),k.default.createElement("div",{className:"controls"},this.renderButtons())))}},{key:"renderForm",value:function(){return k.default.createElement("div",{className:"container"},k.default.createElement("div",{className:"top"},this.renderTitleInput(),this.renderRepoSelector()),this.renderLabelSelector())}},{key:"renderTitleInput",value:function(){var e=this.props.env,t=e.locale.t,r=this.components.setters,n={id:"title",ref:r.textField,value:this.getIssueProperty("title"),env:e,onChange:this.handleTitleChange};return k.default.createElement(P.default,n,t("issue-title"))}},{key:"renderRepoSelector",value:function(){var e=this.props.env,t=e.locale,r=t.t,n=(t.p,this.getAvailableRepos());if(n.length<=1)return null;var a=this.getSelectedRepo(),o=b.default.map(n,function(t,r){var n=_.getDisplayName(t,e);return k.default.createElement("option",{key:r,value:t.id},n)});return k.default.createElement("div",{className:"select-field"},k.default.createElement("label",null,r("issue-repo")),k.default.createElement("select",{value:a.id,onChange:this.handleRepoChange},o))}},{key:"renderLabelSelector",value:function(){var e=this,t=this.getSelectedRepo();if(!t)return null;for(var r=this.getIssueProperty("labels")||[],n=t.details.labels,a=b.default.map(n,function(n,a){var o={className:"tag",style:_.getLabelStyle(t,n),"data-label":n,onClick:e.handleTagClick};return b.default.includes(r,n)&&(o.className+=" selected"),k.default.createElement("span",(0,s.default)({key:a},o),n)}),o=1;o<a.length;o+=2)a.splice(o,0," ");return k.default.createElement("div",{className:"tags"},a)}},{key:"renderButtons",value:function(){var e=this.props,t=e.env,r=e.issue,n=e.allowDeletion,a=this.state.newIssue,o=t.locale.t,s=this.getSelectedRepo(),u=this.getIssueProperty("title"),i=!!b.default.trim(u),d=!1;r&&(i=!!a&&!b.default.isEqual(a,r),d=!0),n||(d=!1);var l={label:o("issue-delete"),emphasized:!1,hidden:!d,onClick:this.handleDeleteClick},c={label:o("issue-cancel"),emphasized:!1,onClick:this.handleCancelClick},f={label:o("issue-ok"),emphasized:!0,disabled:!i||!s,onClick:this.handleOKClick};return k.default.createElement("div",{className:"buttons"},k.default.createElement("div",{className:"left"},k.default.createElement(A.default,l)),k.default.createElement("div",{className:"right"},k.default.createElement(A.default,c),k.default.createElement(A.default,f)))}},{key:"componentDidMount",value:function(){var e=this;setTimeout(function(){var t=e.components.textField;e.getIssueProperty("title")||t&&t.focus()},50)}}],[{key:"getDerivedStateFromProps",value:function(e,t){var r=e.show,n=e.issue,a=t.originalIssue;if(!r)return{newIssue:void 0,originalIssue:void 0};if(a!==n){var o=null;if(!n){var s=e.env,u=e.story,i=e.repos,d=s.locale.p,l=u.details.text,c=d(l),f=b.default.split(b.default.trim(c),/[\r\n]+/),m=x.removeTags(f[0]),p="";m.length<100&&(p=m);var h=b.default.uniq(b.default.flatten(b.default.map(i,"details.labels"))),v=b.default.filter(h,function(e){var t="#"+b.default.replace(e,/\s+/g,"-");return b.default.includes(u.tags,t)});!p&&b.default.isEmpty(v)||(o={title:p,labels:v})}return{newIssue:o,originalIssue:n}}return null}}]),t}(D.PureComponent));M.displayName="IssueDialogBox";var L=parseInt(window.localStorage.last_selected_repo_id)||void 0;t.default=M,t.IssueDialogBox=M},"./dialogs/issue-dialog-box.scss":function(e,t){},"./dialogs/media-dialog-box.jsx":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.MediaDialogBox=t.default=void 0;var a=r("../../common/node_modules/babel-runtime/helpers/extends.js"),o=n(a),s=r("../../common/node_modules/babel-runtime/core-js/object/get-prototype-of.js"),u=n(s),i=r("../../common/node_modules/babel-runtime/helpers/classCallCheck.js"),d=n(i),l=r("../../common/node_modules/babel-runtime/helpers/createClass.js"),c=n(l),f=r("../../common/node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),m=n(f),p=r("../../common/node_modules/babel-runtime/helpers/inherits.js"),h=n(p),v=r("../../common/node_modules/lodash/lodash.js"),g=n(v),b=r("../../common/node_modules/bluebird/js/browser/bluebird.js"),y=n(b),D=r("../../common/node_modules/react/index.js"),k=n(D),C=r("../../common/node_modules/hammerjs/hammer.js"),E=n(C),w=r("../../common/src/objects/utils/resource-utils.js"),x=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(w),j=r("../../common/src/widgets/overlay.jsx"),_=n(j),R=r("./widgets/push-button.jsx"),S=n(R),F=r("../../common/src/widgets/resource-view.jsx"),I=n(F);r("./dialogs/media-dialog-box.scss");var B=r("../../common/src/env/environment.js"),A=(n(B),function(e){function t(e){(0,d.default)(this,t);var r=e.selectedIndex,n=(0,m.default)(this,(t.__proto__||(0,u.default)(t)).call(this,e));return N.call(n),n.state={selectedIndex:r},n}return(0,h.default)(t,e),(0,c.default)(t,[{key:"selectResource",value:function(e){var t=this,r=this.props.resources;return new y.default(function(n,a){e<0?e=0:e>r.length-1&&(e=r.length-1),t.setState({selectedIndex:e},function(){n(e)})})}},{key:"addListeners",value:function(){document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("mousewheel",this.handleMouseWheel),this.hammer=new E.default(document.body),this.hammer.on("swipeleft",this.handleSwipeLeft),this.hammer.on("swiperight",this.handleSwipeRight)}},{key:"removeListeners",value:function(){document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("mousewheel",this.handleMouseWheel),this.hammer&&(this.hammer.off("swipeleft",this.handleSwipeLeft),this.hammer.off("swiperight",this.handleSwipeRight),this.hammer.element.style.touchAction="",this.hammer.destroy(),this.hammer=null)}},{key:"componentWillMount",value:function(){this.props.show&&this.addListeners()}},{key:"componentWillReceiveProps",value:function(e){var t=this.props.show;if(e.show!==t)if(e.show)this.setState({selectedIndex:e.selectedIndex}),this.addListeners();else{var r=this.refs.video;r&&r.pause(),this.removeListeners()}}},{key:"render",value:function(){var e=this.props,t=e.show,r=e.onClose,n={show:t,onBackgroundClick:r};return k.default.createElement(_.default,n,k.default.createElement("div",{className:"media-dialog-box"},this.renderView(),k.default.createElement("div",{className:"controls"},this.renderThumbnails(),this.renderButtons())))}},{key:"renderView",value:function(){var e=this.props,t=e.env,r=e.resources,n=this.state.selectedIndex;n>r.length-1&&(n=r.length-1);var a=r[n];if(a){var o=t.viewportWidth,s=t.viewportHeight;t.isWiderThan("double-col")?(o-=100,s-=200):(o-=10,s-=100);var u=o/s,i=void 0,d=void 0;g.default.each(r,function(e){var r=x.getDimensions(e,{clip:null},t);i>=r.width||(i=r.width),d>=r.height||(d=r.height)});var l=i/d;u>l?d>s&&(d=s,i=Math.round(d*l)):i>o&&(i=o,d=Math.round(i/l));var c={width:i,height:d},f=void 0;switch(a.type){case"image":f=this.renderImage(a,i,d);break;case"video":f=this.renderVideo(a,i,d)}return k.default.createElement("div",{className:"container",style:c},f)}}},{key:"renderImage",value:function(e,t,r){var n=this.props.env,a=this.state.selectedIndex,o={key:a,resource:e,width:e.width,height:e.height,clip:!1,showAnimation:!0,env:n};return o.width>t&&(o.height=Math.round(t*(o.height/o.width)),o.width=t),o.height>r&&(o.width=Math.round(r*(o.width/o.height)),o.height=r),k.default.createElement(I.default,o)}},{key:"renderVideo",value:function(e){var t=this.props.env,r=x.getVideoURL(e,{},t),n=x.getDimensions(e,{clip:null},t),a=x.getImageURL(e,{width:n.width,height:n.height,clip:null,quality:60},t),o={ref:"video",src:r,controls:!0,autoPlay:!0,poster:a};return k.default.createElement("video",o)}},{key:"renderThumbnails",value:function(e){var t=this,r=this.props,n=r.env,a=r.resources,s=this.state.selectedIndex,u=g.default.map(a,function(e,r){var a={className:"thumbnail","data-index":r,onClick:t.handleThumbnailClick};r===s&&(a.className+=" selected");var u={resource:e,width:28,height:28,env:n};return k.default.createElement("div",(0,o.default)({key:r},a),k.default.createElement(I.default,u))});return k.default.createElement("div",{className:"links"},u)}},{key:"renderButtons",value:function(){var e=this.props,t=e.env,r=e.onClose,n=t.locale.t,a={label:n("media-download-original"),emphasized:!1,hidden:!t.isWiderThan("double-col"),onClick:this.handleDownloadClick},o={label:n("media-close"),emphasized:!0,onClick:r};return k.default.createElement("div",{className:"buttons"},k.default.createElement(S.default,a),k.default.createElement(S.default,o))}},{key:"componentWillUnmount",value:function(){this.removeListeners()}},{key:"changeSelection",value:function(e){var t=this.state.selectedIndex;this.selectResource(t+e)}}]),t}(D.PureComponent));A.displayName="MediaDialogBox";var N=function(){var e=this;this.handleThumbnailClick=function(t){var r=parseInt(t.currentTarget.getAttribute("data-index"));return e.selectResource(r)},this.handleDownloadClick=function(t){var r=e.props,n=r.env,a=r.resources,o=e.state.selectedIndex;o>a.length-1&&(o=a.length-1);var s=a[o];if(s){var u=document.createElement("A"),i=x.getURL(s,{original:!0},n),d=location.protocol+"//"+location.host;u.href=i,n.address===d?u.download=s.filename||"":u.target="_blank",u.click()}},this.handleKeyDown=function(t){var r=0;if(39===t.keyCode)r=1;else{if(37!=t.keyCode)return;r=-1}e.changeSelection(r),t.preventDefault()},this.handleMouseWheel=function(t){var r=0,n=void 0;if((n=Math.abs(t.deltaX)>=Math.abs(t.deltaY)?t.deltaX:t.deltaY)>0)r=1;else{if(!(n<0))return;r=-1}e.changeSelection(r),t.preventDefault()},this.handleSwipeLeft=function(t){e.changeSelection(1)},this.handleSwipeRight=function(t){e.changeSelection(-1)}};t.default=A,t.MediaDialogBox=A},"./dialogs/media-dialog-box.scss":function(e,t){},"./dialogs/photo-capture-dialog-box-browser.jsx":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.PhotoCaptureDialogBoxBrowserSync=t.PhotoCaptureDialogBoxBrowser=t.default=void 0;var a=r("../../common/node_modules/babel-runtime/regenerator/index.js"),o=n(a),s=r("../../common/node_modules/babel-runtime/helpers/asyncToGenerator.js"),u=n(s),i=r("../../common/node_modules/babel-runtime/core-js/object/get-prototype-of.js"),d=n(i),l=r("../../common/node_modules/babel-runtime/helpers/classCallCheck.js"),c=n(l),f=r("../../common/node_modules/babel-runtime/helpers/createClass.js"),m=n(f),p=r("../../common/node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),h=n(p),v=r("../../common/node_modules/babel-runtime/helpers/inherits.js"),g=n(v),b=r("../../common/node_modules/lodash/lodash.js"),y=n(b),D=r("../../common/node_modules/bluebird/js/browser/bluebird.js"),k=(n(D),r("../../common/node_modules/react/index.js")),C=n(k),E=r("../../common/node_modules/relaks/index.js"),w=r("../../common/node_modules/relaks-media-capture/index.js"),x=n(w),j=r("../../common/src/widgets/overlay.jsx"),_=n(j),R=r("./widgets/push-button.jsx"),S=n(R),F=r("../../common/src/widgets/live-video.jsx"),I=n(F),B=r("./widgets/device-selector.jsx"),A=n(B),N=r("./widgets/device-placeholder.jsx"),P=n(N);r("./dialogs/photo-capture-dialog-box-browser.scss");var T=r("../../common/src/transport/payloads.js"),M=(n(T),r("../../common/src/env/environment.js")),L=(n(M),function(e){function t(e){(0,c.default)(this,t);var r=(0,h.default)(this,(t.__proto__||(0,d.default)(t)).call(this,e));r.handleSnap=function(e){r.capture.snap()},r.handleClear=function(e){r.capture.clear()},r.handleChoose=function(e){r.capture.choose(e.id)},r.handleCancel=function(e){var t=r.props.onClose;t&&t({type:"cancel",target:r})},r.handleAccept=function(e){var t=r.props,n=t.payloads,a=t.onCapture;if(a){var o=r.capture.capturedImage,s=n.add("image");s.attachFile(o.blob);var u={type:"image",payload_token:s.id,width:o.width,height:o.height,format:y.default.last(y.default.split(r.capture.options.imageMIMEType,"/"))};a({type:"capture",target:r,resource:u})}r.capture.deactivate(),r.handleCancel()};var n={video:!0,audio:!1,preferredDevice:"front",watchVolume:!1,captureImageOnly:!0};return r.capture=new x.default(n),r}return(0,g.default)(t,e),(0,m.default)(t,[{key:"renderAsync",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,u.default)(o.default.mark(function e(t){var r,n,a,s;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.props,n=r.env,a=r.show,t.delay(50,50),s={env:n,show:a,onSnap:this.handleSnap,onClear:this.handleClear,onChoose:this.handleChoose,onAccept:this.handleAccept,onCancel:this.handleCancel},!a){e.next=14;break}this.capture.activate();case 5:return s.status=this.capture.status,s.devices=this.capture.devices,s.chosenDeviceID=this.capture.chosenDeviceID,s.liveVideo=this.capture.liveVideo,s.capturedImage=this.capture.capturedImage,t.show(C.default.createElement(U,s)),e.next=13,this.capture.change();case 13:if(this.capture.active){e.next=5;break}case 14:return e.abrupt("return",C.default.createElement(U,s));case 15:case"end":return e.stop()}},e,this)}));return e}()},{key:"componentDidUpdate",value:function(e,t){var r=this;e.show&&setTimeout(function(){r.props.show||(r.capture.deactivate(),r.capture.clear())},500)}},{key:"componentWillUnmount",value:function(){this.capture.deactivate()}}]),t}(E.AsyncComponent)),U=function(e){function t(){return(0,c.default)(this,t),(0,h.default)(this,(t.__proto__||(0,d.default)(t)).apply(this,arguments))}return(0,g.default)(t,e),(0,m.default)(t,[{key:"render",value:function(){var e=this.props,t=e.show,r=e.onCancel,n={show:t,onBackgroundClick:r};return C.default.createElement(_.default,n,C.default.createElement("div",{className:"photo-capture-dialog-box"},C.default.createElement("div",{className:"container"},this.renderView()),C.default.createElement("div",{className:"controls"},C.default.createElement("div",{className:"left"},this.renderDeviceSelector()),C.default.createElement("div",{className:"right"},this.renderButtons()))))}},{key:"renderView",value:function(){var e=this.props,t=e.status,r=e.liveVideo,n=e.capturedImage;switch(t){case"acquiring":case"denied":var a={blocked:"denied"===t,icon:"camera"};return C.default.createElement(P.default,a);case"initiating":return C.default.createElement(I.default,{muted:!0});case"previewing":var o={srcObject:r.stream,width:r.width,height:r.height,muted:!0};return C.default.createElement(I.default,o);case"captured":var s={className:"preview",src:n.url,width:n.width,height:n.height};return C.default.createElement("img",s)}}},{key:"renderDeviceSelector",value:function(){var e=this.props,t=e.env,r=e.devices,n=e.chosenDeviceID,a=e.onChoose,o={type:"video",chosenDeviceID:n,devices:r,env:t,onSelect:a};return C.default.createElement(A.default,o)}},{key:"renderButtons",value:function(){var e=this.props,t=e.env,r=e.status,n=this.props,a=n.onCancel,o=n.onSnap,s=n.onClear,u=n.onAccept,i=t.locale.t;switch(r){case"acquiring":case"denied":case"initiating":case"previewing":var d={label:i("photo-capture-cancel"),onClick:a},l={label:i("photo-capture-snap"),onClick:o,disabled:"previewing"!==r,emphasized:"previewing"===r};return C.default.createElement("div",{className:"buttons"},C.default.createElement(S.default,d),C.default.createElement(S.default,l));case"captured":var c={label:i("photo-capture-retake"),onClick:s},f={label:i("photo-capture-accept"),onClick:u,emphasized:!0};return C.default.createElement("div",{className:"buttons"},C.default.createElement(S.default,c),C.default.createElement(S.default,f))}}}]),t}(k.PureComponent);U.displayName="PhotoCaptureDialogBoxBrowserSync",t.default=L,t.PhotoCaptureDialogBoxBrowser=L,t.PhotoCaptureDialogBoxBrowserSync=U},"./dialogs/photo-capture-dialog-box-browser.scss":function(e,t){},"./dialogs/photo-capture-dialog-box-cordova.jsx":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.PhotoCaptureDialogBoxCordova=t.default=void 0;var a=r("../../common/node_modules/babel-runtime/regenerator/index.js"),o=n(a),s=r("../../common/node_modules/babel-runtime/helpers/asyncToGenerator.js"),u=n(s),i=r("../../common/node_modules/babel-runtime/core-js/object/get-prototype-of.js"),d=n(i),l=r("../../common/node_modules/babel-runtime/helpers/classCallCheck.js"),c=n(l),f=r("../../common/node_modules/babel-runtime/helpers/createClass.js"),m=n(f),p=r("../../common/node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),h=n(p),v=r("../../common/node_modules/babel-runtime/helpers/inherits.js"),g=n(v),b=r("../../common/node_modules/lodash/lodash.js"),y=(n(b),r("../../common/node_modules/bluebird/js/browser/bluebird.js")),D=(n(y),r("../../common/node_modules/react/index.js")),k=(n(D),r("../../common/src/media/media-loader.js")),C=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(k),E=r("../../common/src/transport/cordova-file.js"),w=n(E),x=r("../../common/src/transport/payloads.js"),j=(n(x),r("../../common/src/env/environment.js")),_=(n(j),function(e){function t(){var e,r,n,a,s=this;(0,c.default)(this,t);for(var i=arguments.length,l=Array(i),f=0;f<i;f++)l[f]=arguments[f];return r=n=(0,h.default)(this,(e=t.__proto__||(0,d.default)(t)).call.apply(e,[this].concat(l))),n.handleCaptureSuccess=function(){var e=(0,u.default)(o.default.mark(function e(t){var r,a,u,i,d;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.props.payloads,a=new w.default(t),n.triggerCloseEvent(),n.triggerCapturePendingEvent(),e.prev=4,e.next=7,a.obtainMetadata();case 7:return e.next=9,C.getImageMetadata(a);case 9:u=e.sent,i=r.add("image").attachFile(a),d={type:"image",payload_token:i.id,format:u.format,width:u.width,height:u.height},n.triggerCaptureEvent(d),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(4),n.triggerCaptureErrorEvent(e.t0);case 18:case"end":return e.stop()}},e,s,[[4,15]])}));return function(t){return e.apply(this,arguments)}}(),n.handleCaptureFailure=function(e){n.triggerCloseEvent()},a=r,(0,h.default)(n,a)}return(0,g.default)(t,e),(0,m.default)(t,[{key:"componentWillReceiveProps",value:function(e){var t=this.props.show;e.show&&!t&&this.startCapture(e)}},{key:"render",value:function(){return null}},{key:"startCapture",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,u.default)(o.default.mark(function e(t){var r,n,a;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=navigator.camera,r&&(n=void 0,"front"===t.cameraDirection?n=Camera.Direction.FRONT:"back"===t.cameraDirection&&(n=Camera.Direction.BACK),a={quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.CAMERA,encodingType:Camera.EncodingType.JPEG,mediaType:Camera.MediaType.PICTURE,cameraDirection:n,allowEdit:!1},r.getPicture(this.handleCaptureSuccess,this.handleCaptureFailure,a));case 2:case"end":return e.stop()}},e,this)}));return e}()},{key:"triggerCloseEvent",value:function(){var e=this.props.onClose;e&&e({type:"close",target:this})}},{key:"triggerCaptureEvent",value:function(e){var t=this.props.onCapture;t&&t({type:"capture",target:this,resource:e})}},{key:"triggerCapturePendingEvent",value:function(){var e=this.props.onCapturePending;e&&e({type:"capturepending",target:this,resourceType:"image"})}},{key:"triggerCaptureErrorEvent",value:function(e){var t=this.props.onCaptureError;t&&t({type:"capturefailure",target:this,error:e})}}]),t}(D.PureComponent));_.displayName="PhotoCaptureDialogBoxCordova",t.default=_,t.PhotoCaptureDialogBoxCordova=_},"./dialogs/video-capture-dialog-box-browser.jsx":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.VideoCaptureDialogBoxBrowserSync=t.VideoCaptureDialogBoxBrowser=t.default=void 0;var a=r("../../common/node_modules/babel-runtime/regenerator/index.js"),o=n(a),s=r("../../common/node_modules/babel-runtime/helpers/asyncToGenerator.js"),u=n(s),i=r("../../common/node_modules/babel-runtime/core-js/object/get-prototype-of.js"),d=n(i),l=r("../../common/node_modules/babel-runtime/helpers/classCallCheck.js"),c=n(l),f=r("../../common/node_modules/babel-runtime/helpers/createClass.js"),m=n(f),p=r("../../common/node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),h=n(p),v=r("../../common/node_modules/babel-runtime/helpers/inherits.js"),g=n(v),b=r("../../common/node_modules/lodash/lodash.js"),y=n(b),D=r("../../common/node_modules/bluebird/js/browser/bluebird.js"),k=(n(D),r("../../common/node_modules/react/index.js")),C=n(k),E=r("../../common/node_modules/relaks/index.js"),w=r("../../common/node_modules/relaks-media-capture/index.js"),x=n(w),j=r("../../common/src/widgets/overlay.jsx"),_=n(j),R=r("./widgets/push-button.jsx"),S=n(R),F=r("../../common/src/widgets/live-video.jsx"),I=n(F),B=r("./widgets/device-selector.jsx"),A=n(B),N=r("./widgets/device-placeholder.jsx"),P=n(N),T=r("./widgets/duration-indicator.jsx"),M=n(T),L=r("./widgets/volume-indicator.jsx"),U=n(L);r("./dialogs/video-capture-dialog-box-browser.scss");var O=r("../../common/src/transport/payloads.js"),V=(n(O),r("../../common/src/env/environment.js")),z=(n(V),function(e){function t(e){(0,c.default)(this,t);var r=(0,h.default)(this,(t.__proto__||(0,d.default)(t)).call(this,e));r.handleStart=function(e){var t=r.props.payloads;r.stream=t.stream(),r.stream.start(),r.capture.start(),r.capture.snap()},r.handleStop=function(e){r.capture.stop()},r.handlePause=function(e){r.capture.pause()},r.handleResume=function(e){r.capture.resume()},r.handleClear=function(e){r.capture.clear(),r.stream&&(r.stream.cancel(),r.stream=null)},r.handleChoose=function(e){r.capture.choose(e.id)},r.handleCancel=function(e){var t=r.props.onClose;t&&t({type:"cancel",target:r})},r.handleAccept=function(e){var t=r.props,n=t.payloads,a=t.onCapture;if(a){var o=r.capture,s=o.capturedVideo,u=o.capturedImage,i=n.add("video");i.attachStream(r.stream),i.attachFile(u.blob,"poster");var d={type:"video",payload_token:i.id,width:s.width,height:s.height,duration:s.duration,format:y.default.last(y.default.split(r.capture.options.videoMIMEType,"/")),bitrates:{audio:r.capture.options.audioBitsPerSecond,video:r.capture.options.videoBitsPerSecond}};a({type:"capture",target:r,resource:d})}r.capture.deactivate(),r.handleCancel()},r.handleCaptureChunk=function(e){r.stream&&r.stream.push(e.blob)},r.handleCaptureEnd=function(e){r.stream&&r.stream.close()};var n={video:!0,audio:!0,preferredDevice:"front",watchVolume:!0,segmentDuration:2e3};return r.capture=new x.default(n),r.capture.addEventListener("chunk",r.handleCaptureChunk),r.capture.addEventListener("end",r.handleCaptureEnd),r.stream=null,r}return(0,g.default)(t,e),(0,m.default)(t,[{key:"renderAsync",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,u.default)(o.default.mark(function e(t){var r,n,a,s;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.props,n=r.env,a=r.show,t.delay(50,50),s={env:n,show:a,onStart:this.handleStart,onStop:this.handleStop,onPause:this.handlePause,onResume:this.handleResume,onClear:this.handleClear,onChoose:this.handleChoose,onAccept:this.handleAccept,onCancel:this.handleCancel},!a){e.next=17;break}this.capture.activate();case 5:return s.status=this.capture.status,s.devices=this.capture.devices,s.chosenDeviceID=this.capture.chosenDeviceID,s.liveVideo=this.capture.liveVideo,s.duration=this.capture.duration,s.volume=this.capture.volume<5?0:this.capture.volume,s.capturedImage=this.capture.capturedImage,s.capturedVideo=this.capture.capturedVideo,t.show(C.default.createElement(W,s)),e.next=16,this.capture.change();case 16:if(this.capture.active){e.next=5;break}case 17:return e.abrupt("return",C.default.createElement(W,s));case 18:case"end":return e.stop()}},e,this)}));return e}()},{key:"componentDidUpdate",value:function(e,t){var r=this;e.show&&setTimeout(function(){r.props.show||(r.capture.deactivate(),r.capture.clear())},500)}},{key:"componentWillUnmount",value:function(){this.capture.deactivate()}}]),t}(E.AsyncComponent)),W=function(e){function t(){return(0,c.default)(this,t),(0,h.default)(this,(t.__proto__||(0,d.default)(t)).apply(this,arguments))}return(0,g.default)(t,e),(0,m.default)(t,[{key:"render",value:function(){var e=this.props,t=e.show,r=e.onCancel,n={show:t,onBackgroundClick:r};return C.default.createElement(_.default,n,C.default.createElement("div",{className:"video-capture-dialog-box"},C.default.createElement("div",{className:"container"},this.renderView()),C.default.createElement("div",{className:"controls"},C.default.createElement("div",{className:"left"},this.renderDuration()||this.renderDeviceSelector()),C.default.createElement("div",{className:"center"},this.renderVolume()),C.default.createElement("div",{className:"right"},this.renderButtons()))))}},{key:"renderView",value:function(){var e=this.props,t=e.status,r=e.liveVideo,n=e.capturedVideo,a=e.capturedImage;switch(t){case"acquiring":case"denied":var o={blocked:"denied"===t,icon:"video-camera"};return C.default.createElement(P.default,o);case"initiating":return C.default.createElement(I.default,{muted:!0});case"previewing":case"capturing":case"paused":var s={srcObject:r.stream,width:r.width,height:r.height,muted:!0};return C.default.createElement(I.default,s);case"captured":var u={className:"preview",src:n.url,poster:a.url,width:n.width,height:n.height,controls:!0};return C.default.createElement("video",u)}}},{key:"renderDeviceSelector",value:function(){var e=this.props,t=e.env,r=e.devices,n=e.chosenDeviceID,a=e.onChoose,o={type:"video",chosenDeviceID:n,devices:r,env:t,onSelect:a};return C.default.createElement(A.default,o)}},{key:"renderDuration",value:function(){var e=this.props,t=e.status,r=e.duration;if("number"!=typeof r)return null;var n={duration:r,recording:"capturing"===t};return C.default.createElement(M.default,n)}},{key:"renderVolume",value:function(){var e=this.props,t=e.status,r=e.volume;if("number"!=typeof r||"captured"===t)return null;var n={volume:r,recording:"capturing"===t};return C.default.createElement(U.default,n)}},{key:"renderButtons",value:function(){var e=this.props,t=e.env,r=e.status,n=this.props,a=n.onCancel,o=n.onStart,s=n.onPause,u=n.onResume,i=n.onStop,d=n.onClear,l=n.onAccept,c=t.locale.t;switch(r){case"acquiring":case"denied":case"initiating":case"previewing":var f={label:c("video-capture-cancel"),onClick:a},m={label:c("video-capture-start"),onClick:o,disabled:"previewing"!==r,emphasized:"previewing"===r};return C.default.createElement("div",{className:"buttons"},C.default.createElement(S.default,f),C.default.createElement(S.default,m));case"capturing":var p={label:c("video-capture-pause"),onClick:s},h={label:c("video-capture-stop"),onClick:i,emphasized:!0};return C.default.createElement("div",{className:"buttons"},C.default.createElement(S.default,p),C.default.createElement(S.default,h));case"paused":var v={label:c("video-capture-resume"),onClick:u,emphasized:!0},g={label:c("video-capture-stop"),onClick:i};return C.default.createElement("div",{className:"buttons"},C.default.createElement(S.default,v),C.default.createElement(S.default,g));case"captured":var b={label:c("video-capture-retake"),onClick:d},y={label:c("video-capture-accept"),onClick:l,emphasized:!0};return C.default.createElement("div",{className:"buttons"},C.default.createElement(S.default,b),C.default.createElement(S.default,y))}}}]),t}(k.PureComponent);W.displayName="VideoCaptureDialogBoxBrowserSync",t.default=z,t.VideoCaptureDialogBoxBrowser=z,t.VideoCaptureDialogBoxBrowserSync=W},"./dialogs/video-capture-dialog-box-browser.scss":function(e,t){},"./dialogs/video-capture-dialog-box-cordova.jsx":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){return new E.default(function(t,r){var n=function(e){if("windows"===cordova.platformId){var r=k.default.lastIndexOf(e,"\\");if(-1!==r){var n=e.substr(r+1);e=cordova.file.dataDirectory+n}}t(e)},a=function(e){r(new Error(e))},o={fileUri:e.fullPath,outputFileName:e.name,quality:70};"windows"===cordova.platformId&&(o.outputFileName+=".jpg"),VideoEditor.createThumbnail(n,a,o)})}Object.defineProperty(t,"__esModule",{value:!0}),t.VideoCaptureDialogBoxCordova=t.default=void 0;var o=r("../../common/node_modules/babel-runtime/regenerator/index.js"),s=n(o),u=r("../../common/node_modules/babel-runtime/helpers/asyncToGenerator.js"),i=n(u),d=r("../../common/node_modules/babel-runtime/core-js/object/get-prototype-of.js"),l=n(d),c=r("../../common/node_modules/babel-runtime/helpers/classCallCheck.js"),f=n(c),m=r("../../common/node_modules/babel-runtime/helpers/createClass.js"),p=n(m),h=r("../../common/node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),v=n(h),g=r("../../common/node_modules/babel-runtime/helpers/inherits.js"),b=n(g),y=function(){var e=(0,i.default)(s.default.mark(function e(){var t;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((t=cordova.plugins.permissions)&&"android"===cordova.platformId){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",new E.default(function(e,r){var n=function(){e()},a=function(e){r(new Error("Unable to obtain permission"))};t.requestPermissions([t.RECORD_AUDIO,t.RECORD_VIDEO,t.READ_EXTERNAL_STORAGE,t.WRITE_EXTERNAL_STORAGE],n,a)}));case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),D=r("../../common/node_modules/lodash/lodash.js"),k=n(D),C=r("../../common/node_modules/bluebird/js/browser/bluebird.js"),E=n(C),w=r("../../common/node_modules/react/index.js"),x=(n(w),r("../../common/src/media/media-loader.js")),j=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(x),_=r("../../common/src/transport/cordova-file.js"),R=n(_),S=r("../../common/src/transport/payloads.js"),F=(n(S),r("../../common/src/env/environment.js")),I=(n(F),function(e){function t(){var e,r,n,o,u=this;(0,f.default)(this,t);for(var d=arguments.length,c=Array(d),m=0;m<d;m++)c[m]=arguments[m];return r=n=(0,v.default)(this,(e=t.__proto__||(0,l.default)(t)).call.apply(e,[this].concat(c))),n.handleCaptureSuccess=function(){var e=(0,i.default)(s.default.mark(function e(t){var r,o,i,d,l,c,f,m,p,h;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.props.payloads,n.triggerCloseEvent(),!(o=t[0])){e.next=37;break}return n.triggerCapturePendingEvent(),e.prev=5,e.next=8,j.getFormatData(o);case 8:return i=e.sent,d=void 0,d="windows"===cordova.platformId?o.localURL:o.fullPath,l=new R.default(d,o.type,o.size),c=r.add("video"),c.attachFile(l),f={type:"video",payload_token:c.id,format:j.extractFileFormat(o.type),filename:o.name,duration:1e3*i.duration},e.prev=15,e.next=18,a(l);case 18:return m=e.sent,p=new R.default(m),e.next=22,j.getImageMetadata(p);case 22:h=e.sent,c.attachFile(p,"poster"),f.width=h.width,f.height=h.height,e.next=31;break;case 28:e.prev=28,e.t0=e.catch(15),c.attachStep("main","poster");case 31:n.triggerCaptureEvent(f),e.next=37;break;case 34:e.prev=34,e.t1=e.catch(5),n.triggerCaptureErrorEvent(e.t1);case 37:case"end":return e.stop()}},e,u,[[5,34],[15,28]])}));return function(t){return e.apply(this,arguments)}}(),n.handleCaptureFailure=function(e){n.triggerCloseEvent(),n.triggerCaptureErrorEvent(e)},o=r,(0,v.default)(n,o)}return(0,b.default)(t,e),(0,p.default)(t,[{key:"componentWillReceiveProps",value:function(e){var t=this.props.show;e.show&&!t&&this.startCapture()}},{key:"render",value:function(){return null}},{key:"startCapture",value:function(){function e(){return t.apply(this,arguments)}var t=(0,i.default)(s.default.mark(function e(){var t,r;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=navigator.device.capture)){e.next=6;break}return e.next=4,y();case 4:r={duration:18e3,limit:1},t.captureVideo(this.handleCaptureSuccess,this.handleCaptureFailure,r);case 6:case"end":return e.stop()}},e,this)}));return e}()},{key:"triggerCloseEvent",value:function(){var e=this.props.onClose;e&&e({type:"close",target:this})}},{key:"triggerCaptureEvent",value:function(e){var t=this.props.onCapture;t&&t({type:"capture",target:this,resource:e})}},{key:"triggerCapturePendingEvent",value:function(){var e=this.props.onCapturePending;e&&e({type:"capturepending",target:this,resourceType:"video"})}},{key:"triggerCaptureErrorEvent",value:function(e){var t=this.props.onCaptureError;t&&t({type:"capturefailure",target:this,error:e})}}]),t}(w.PureComponent));I.displayName="VideoCaptureDialogBoxCordova",t.default=I,t.VideoCaptureDialogBoxCordova=I},"./editors/audio-editor.jsx":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=e.resource,r=e.duration;return t.width&&t.height?s.default.createElement(i.default,e,s.default.createElement("div",{className:"audio-duration"},l.default.format(r))):s.default.createElement("div",{className:"audio-editor"},s.default.createElement("div",{className:"graphic"},s.default.createElement("div",{className:"icon"},s.default.createElement("i",{className:"fa fa-microphone"})),s.default.createElement("div",{className:"duration"},l.default.format(r))))}Object.defineProperty(t,"__esModule",{value:!0}),t.AudioEditor=t.default=void 0;var o=r("../../common/node_modules/react/index.js"),s=n(o),u=r("./editors/image-editor.jsx"),i=n(u),d=r("./widgets/duration-indicator.jsx"),l=n(d);r("./editors/audio-editor.scss"),t.default=a,t.AudioEditor=a},"./editors/audio-editor.scss":function(e,t){},"./editors/image-editor.jsx":function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.ImageEditor=t.default=void 0;var o=r("../../common/node_modules/babel-runtime/regenerator/index.js"),s=a(o),u=r("../../common/node_modules/babel-runtime/helpers/asyncToGenerator.js"),i=a(u),d=r("../../common/node_modules/babel-runtime/core-js/object/get-prototype-of.js"),l=a(d),c=r("../../common/node_modules/babel-runtime/helpers/classCallCheck.js"),f=a(c),m=r("../../common/node_modules/babel-runtime/helpers/createClass.js"),p=a(m),h=r("../../common/node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),v=a(h),g=r("../../common/node_modules/babel-runtime/helpers/inherits.js"),b=a(g),y=r("../../common/node_modules/lodash/lodash.js"),D=a(y),k=r("../../common/node_modules/bluebird/js/browser/bluebird.js"),C=(a(k),r("../../common/node_modules/react/index.js")),E=a(C),w=r("../../common/src/transport/blob-manager.js"),x=n(w),j=r("../../common/src/transport/payload.js"),_=(a(j),r("../../common/src/media/image-cropping.js")),R=(n(_),r("../../common/src/utils/focus-manager.js")),S=n(R),F=r("../../common/src/objects/utils/resource-utils.js"),I=n(F),B=r("../../common/src/utils/component-refs.js"),A=a(B),N=r("../../common/src/widgets/image-cropper.jsx"),P=a(N);r("./editors/image-editor.scss");var T=r("../../common/src/env/environment.js"),M=(a(T),function(e){function t(e){(0,f.default)(this,t);var r=(0,v.default)(this,(t.__proto__||(0,l.default)(t)).call(this,e));return r.handleClipRectChange=function(e){var t=r.props.resource;r.components.imageCropper;t=D.default.clone(t),t.clip=e.rect,r.triggerChangeEvent(t)},r.handleFullImageLoad=function(e){var t=(r.props.resource,r.components.imageCropper,e.target.props.url);r.setState({loadedImageURL:t})},r.components=(0,A.default)({imageCropper:P.default}),r.state={loadingFullImage:"",fullImageLoaded:""},r}return(0,b.default)(t,e),(0,p.default)(t,[{key:"render",value:function(){var e=this.props.children;return E.default.createElement("div",{className:"image-editor"},this.renderImage(),this.renderSpinner(),e)}},{key:"renderImage",value:function(){var e=this.getLocalImageURL(),t=this.getPreviewImageURL();return e?this.renderImageCropper():t?this.renderPreviewImage():this.renderPlaceholder()}},{key:"renderPreviewImage",value:function(){var e=this.props,t=e.previewWidth,r=e.previewHeight,n=e.disabled,a=this.getPreviewImageURL(),o="preview";n&&(o+=" disabled");var s={src:a,width:t,height:r};return E.default.createElement("div",{className:o},E.default.createElement("img",s))}},{key:"renderSpinner",value:function(){if(this.props.disabled)return null;var e=this.getLocalImageURL(),t=this.getPreviewImageURL();return e||!t?null:E.default.createElement("div",{className:"spinner"},E.default.createElement("i",{className:"fa fa-refresh fa-spin fa-fw"}))}},{key:"renderImageCropper",value:function(){var e=this.props,t=e.resource,r=e.disabled,n=this.components.setters,a=this.getLocalImageURL(),o=I.getClippingRect(t,{}),s={ref:n.imageCropper,url:a,clippingRect:o,vector:"svg"===t.format,disabled:r,onChange:this.handleClipRectChange,onLoad:this.handleFullImageLoad};return E.default.createElement(P.default,s)}},{key:"renderPlaceholder",value:function(){var e=this.props,t=e.env,r=e.resource,n=t.locale.t,a=void 0,o=void 0;return r.width&&r.height?(a=n("image-editor-upload-in-progress"),o="cloud-upload"):r.pending||("video"===r.type?(a=n("image-editor-poster-extraction-in-progress"),o="film"):"website"===r.type?(a=n("image-editor-page-rendering-in-progress"),o="file-image-o"):"image"===r.type&&(a=n("image-editor-image-transfer-in-progress"),o="file-image-o")),E.default.createElement("div",{className:"placeholder"},E.default.createElement("div",{className:"icon"},E.default.createElement("i",{className:"fa fa-"+o})),E.default.createElement("div",{className:"message"},a))}},{key:"componentDidMount",value:function(){S.register(this,{type:"ImageEditor"}),this.componentDidUpdate()}},{key:"componentDidUpdate",value:function(){function e(e,r){return t.apply(this,arguments)}var t=(0,i.default)(s.default.mark(function e(t,r){var n,a,o;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.state.loadingFullImage,a=this.getLocalImageURL(),o=this.getRemoteImageURL(),a||!o){e.next=9;break}if(n===o){e.next=9;break}return this.setState({loadingFullImage:o}),e.next=8,x.fetch(o);case 8:this.setState({fullImageLoaded:o});case 9:case"end":return e.stop()}},e,this)}));return e}()},{key:"componentWillUnmount",value:function(){S.unregister(this)}},{key:"getRemoteImageURL",value:function(){var e=this.props,t=e.env,r=e.resource,n={remote:!0,original:!0};return I.getImageURL(r,n,t)}},{key:"getLocalImageURL",value:function(){var e=this.props,t=e.env,r=e.resource,n={local:!0,original:!0};return I.getImageURL(r,n,t)}},{key:"getPreviewImageURL",value:function(){var e=this.props,t=e.env,r=e.resource,n=e.previewWidth,a=e.previewHeight,o={remote:!0,width:n,height:a};return I.getImageURL(r,o,t)}},{key:"focus",value:function(){var e=this.components.imageCropper;e&&e.focus()}},{key:"triggerChangeEvent",value:function(e){var t=this.props.onChange;t&&t({type:"change",target:this,resource:e})}}]),t}(C.PureComponent));M.displayName="ImageEditor",M.defaultProps={previewWidth:512,previewHeight:512,disabled:!1},t.default=M,t.ImageEditor=M},"./editors/image-editor.scss":function(e,t){},"./editors/media-editor.jsx":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.MediaEditor=t.default=void 0;var a=r("../../common/node_modules/babel-runtime/core-js/object/get-prototype-of.js"),o=n(a),s=r("../../common/node_modules/babel-runtime/helpers/classCallCheck.js"),u=n(s),i=r("../../common/node_modules/babel-runtime/helpers/createClass.js"),d=n(i),l=r("../../common/node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),c=n(l),f=r("../../common/node_modules/babel-runtime/helpers/inherits.js"),m=n(f),p=r("../../common/node_modules/lodash/lodash.js"),h=n(p),v=r("../../common/node_modules/bluebird/js/browser/bluebird.js"),g=(n(v),r("../../common/node_modules/react/index.js")),b=n(g),y=r("./widgets/media-button.jsx"),D=n(y),k=r("./editors/image-editor.jsx"),C=n(k),E=r("./editors/video-editor.jsx"),w=n(E),x=r("./editors/audio-editor.jsx"),j=n(x);r("./editors/media-editor.scss");var _=r("../../common/src/env/environment.js"),R=(n(_),r("../../common/src/transport/payloads.js")),S=(n(R),function(e){function t(){var e,r,n,a;(0,u.default)(this,t);for(var s=arguments.length,i=Array(s),d=0;d<s;d++)i[d]=arguments[d];return r=n=(0,c.default)(this,(e=t.__proto__||(0,o.default)(t)).call.apply(e,[this].concat(i))),n.handleShiftClick=function(e){var t=n.props,r=t.resources,a=t.resourceIndex;if(!(a<1)){var o=r[a];r=h.default.slice(r),r.splice(a,1),r.splice(a-1,0,o),n.triggerChangeEvent(r,a-1)}},n.handleRemoveClick=function(e){var t=n.props,r=t.payloads,a=t.resources,o=t.resourceIndex,s=a[o];a=h.default.slice(a),a.splice(o,1);var u=o;o>=a.length&&(u=a.length-1),n.triggerChangeEvent(a,u),s&&s.payload_token&&r.cancel(s.payload_token)},n.handleEmbedClick=function(e){var t=n.props,r=t.resources,a=t.resourceIndex,o=r[a];n.triggerEmbedEvent(o)},n.handleBackwardClick=function(e){var t=n.props,r=t.resources,a=t.resourceIndex;a<=0||n.triggerChangeEvent(r,a-1)},n.handleForwardClick=function(e){var t=n.props,r=t.resources,a=t.resourceIndex;a>=h.default.size(r)-1||n.triggerChangeEvent(r,a+1)},n.handleResourceChange=function(e){var t=n.props,r=t.resources,a=t.resourceIndex;r=h.default.slice(r),r[a]=e.resource,n.triggerChangeEvent(r,a)},a=r,(0,c.default)(n,a)}return(0,m.default)(t,e),(0,d.default)(t,[{key:"render",value:function(){var e=this.props,t=e.env,r=e.resources,n=e.resourceIndex,a=e.children,o=h.default.get(r,n);if(o)return b.default.createElement("div",{key:n,className:"media-editor"},b.default.createElement("div",{className:"resource"},this.renderResource(o),this.renderNavigation()));var s=void 0;return t.isWiderThan("double-col")&&(s=a),b.default.createElement("div",{className:"media-editor empty"},s)}},{key:"renderResource",value:function(e){var t=this.props,r=t.payloads,n=t.env,a={resource:e,payloads:r,env:n,onChange:this.handleResourceChange};switch(e.type){case"image":case"website":return b.default.createElement(C.default,a);case"video":return b.default.createElement(w.default,a);case"audio":return b.default.createElement(j.default,a)}}},{key:"renderNavigation",value:function(){var e=this.props,t=e.env,r=e.resources,n=e.resourceIndex,a=e.allowEmbedding,o=e.allowShifting,s=t.locale.t,u=h.default.size(r);if(0===u)return null;var i={label:s("media-editor-remove"),icon:"remove",onClick:this.handleRemoveClick},d={label:s("media-editor-embed"),icon:"code",hidden:!a,onClick:this.handleEmbedClick},l={label:s("media-editor-shift"),icon:"chevron-left",hidden:!(o&&u>1),disabled:!(n>0),onClick:this.handleShiftClick},c={index:n,count:u,hidden:!(u>1),onBackwardClick:this.handleBackwardClick,onForwardClick:this.handleForwardClick};return b.default.createElement("div",{className:"navigation"},b.default.createElement("div",{className:"left"},b.default.createElement(D.default,i),b.default.createElement(D.default,d),b.default.createElement(D.default,l)),b.default.createElement("div",{className:"right"},b.default.createElement(D.default.Direction,c)))}},{key:"triggerChangeEvent",value:function(e,t){var r=this.props.onChange;if(r)return r({type:"change",target:this,resources:e,selection:t})}},{key:"triggerEmbedEvent",value:function(e){var t=this.props.onEmbed;t&&t({type:"embed",target:this,resource:e})}}]),t}(g.PureComponent));S.displayName="MediaEditor",t.default=S,t.MediaEditor=S},"./editors/media-editor.scss":function(e,t){},"./editors/media-importer.jsx":function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e){return j.default.toUpper((0,F.default)().format("YYYY-MMM-DD-hhA"))+e}Object.defineProperty(t,"__esModule",{value:!0}),t.MediaImporter=t.default=void 0;var s=r("../../common/node_modules/babel-runtime/regenerator/index.js"),u=a(s),i=r("../../common/node_modules/babel-runtime/core-js/get-iterator.js"),d=a(i),l=r("../../common/node_modules/babel-runtime/helpers/slicedToArray.js"),c=a(l),f=r("../../common/node_modules/babel-runtime/helpers/asyncToGenerator.js"),m=a(f),p=r("../../common/node_modules/babel-runtime/core-js/object/get-prototype-of.js"),h=a(p),v=r("../../common/node_modules/babel-runtime/helpers/classCallCheck.js"),g=a(v),b=r("../../common/node_modules/babel-runtime/helpers/createClass.js"),y=a(b),D=r("../../common/node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),k=a(D),C=r("../../common/node_modules/babel-runtime/helpers/inherits.js"),E=a(C),w=function(){var e=(0,m.default)(u.default.mark(function e(t){var r,n;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r={},n=j.default.map(t,function(e){if("string"===e.kind&&/^text\/(html|uri-list)/.test(e.type))return new R.default(function(t,n){e.getAsString(function(n){r[e.type]=n,t()})})}),e.next=4,R.default.all(n);case 4:return e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),x=r("../../common/node_modules/lodash/lodash.js"),j=a(x),_=r("../../common/node_modules/bluebird/js/browser/bluebird.js"),R=a(_),S=r("../../common/node_modules/moment/moment.js"),F=a(S),I=r("../../common/node_modules/react/index.js"),B=a(I),A=r("../../common/src/media/media-loader.js"),N=n(A),P=r("../../common/src/media/media-tag-reader.js"),T=n(P),M=r("../../common/src/media/quick-start.js"),L=n(M),U=r("../../common/src/transport/blob-reader.js"),O=(n(U),r("../../common/src/objects/types/resource-types.js")),V=a(O),z=r("./dialogs/photo-capture-dialog-box-browser.jsx"),W=a(z),H=r("./dialogs/photo-capture-dialog-box-cordova.jsx"),q=a(H),$=r("./dialogs/audio-capture-dialog-box-browser.jsx"),G=a($),Y=r("./dialogs/audio-capture-dialog-box-cordova.jsx"),K=a(Y),X=r("./dialogs/video-capture-dialog-box-browser.jsx"),J=a(X),Z=r("./dialogs/video-capture-dialog-box-cordova.jsx"),Q=a(Z);r("./editors/media-editor.scss");var ee=r("../../common/src/env/environment.js"),te=(a(ee),r("../../common/src/transport/payloads.js")),re=(a(te),function(e){function t(e){(0,g.default)(this,t);var r=(0,k.default)(this,(t.__proto__||(0,h.default)(t)).call(this,e));return r.handleClose=function(e){r.setState({capturing:null}),r.triggerCaptureEndEvent()},r.handleCapturePending=function(e){r.resourcePlaceholder={type:e.resourceType,pending:"capture-"+ ++ae},r.addResources([r.resourcePlaceholder])},r.handleCaptureError=function(e){r.resourcePlaceholder&&r.removeResource(r.resourcePlaceholder)},r.handleCapture=function(e){var t=j.default.clone(e.resource),n="jpeg"===t.format?"jpg":t.format;t.filename=o("."+n),r.resourcePlaceholder?r.updateResource(r.resourcePlaceholder,t):r.addResources([t])},r.state={capturing:null},r}return(0,E.default)(t,e),(0,y.default)(t,[{key:"isAcceptable",value:function(e){var t=this.props.types;return j.default.includes(t,e)}},{key:"getResourceType",value:function(e){var t=N.extractFileCategory(e);if(this.isAcceptable(t))return t}},{key:"capture",value:function(e){this.setState({capturing:e}),this.triggerCaptureStartEvent()}},{key:"importFiles",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,m.default)(u.default.mark(function e(t){var r,n,a,o,s,i,l,f,m,p,h,v,g=this;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=j.default.filter(t,function(e){return!!g.getResourceType(e.type)}),r=j.default.map(t,function(e){return g.getResourceType(e.type)}),n=this.addResourcePlaceholders(r),a=!0,o=!1,s=void 0,e.prev=6,i=(0,d.default)(j.default.entries(t));case 8:if(a=(l=i.next()).done){e.next=26;break}return f=l.value,m=(0,c.default)(f,2),p=m[0],h=m[1],e.prev=13,e.next=16,this.importFile(h);case 16:v=e.sent,this.updateResource(n[p],v),e.next=23;break;case 20:e.prev=20,e.t0=e.catch(13),this.removeResource(n[p]);case 23:a=!0,e.next=8;break;case 26:e.next=32;break;case 28:e.prev=28,e.t1=e.catch(6),o=!0,s=e.t1;case 32:e.prev=32,e.prev=33,!a&&i.return&&i.return();case 35:if(e.prev=35,!o){e.next=38;break}throw s;case 38:return e.finish(35);case 39:return e.finish(32);case 40:case"end":return e.stop()}},e,this,[[6,28,32,40],[13,20],[33,,35,39]])}));return e}()},{key:"importFile",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,m.default)(u.default.mark(function e(t){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=this.getResourceType(t.type),e.next="image"===e.t0?3:"video"===e.t0?4:"audio"===e.t0?5:6;break;case 3:return e.abrupt("return",this.importImageFile(t));case 4:return e.abrupt("return",this.importVideoFile(t));case 5:return e.abrupt("return",this.importAudioFile(t));case 6:case"end":return e.stop()}},e,this)}));return e}()},{key:"importImageFile",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,m.default)(u.default.mark(function e(t){var r,n,a;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.props.payloads,n=r.add("image").attachFile(t),e.prev=2,e.next=5,N.getImageMetadata(t);case 5:return a=e.sent,e.abrupt("return",{type:"image",payload_token:n.id,width:a.width,height:a.height,format:a.format,filename:t.name,imported:!0});case 9:return e.prev=9,e.t0=e.catch(2),e.abrupt("return",{type:"image",payload_token:n.id,format:N.extractFileFormat(t.type),filename:t.name,imported:!0});case 12:case"end":return e.stop()}},e,this,[[2,9]])}));return e}()},{key:"importVideoFile",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,m.default)(u.default.mark(function e(t){var r,n,a,o,s;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.props.payloads,e.next=3,L.process(t);case 3:return n=e.sent,n||(n=t),a=r.add("video"),o=r.stream().pipe(n),a.attachStream(o),e.prev=7,e.next=10,N.getVideoMetadata(n);case 10:return s=e.sent,a.attachFile(s.poster,"poster"),e.abrupt("return",{type:"video",payload_token:a.id,width:s.width,height:s.height,format:s.format,duration:s.duration,filename:t.name,imported:!0});case 15:return e.prev=15,e.t0=e.catch(7),a.attachStep("main","poster"),e.abrupt("return",{type:"video",payload_token:a.id,format:N.extractFileFormat(t.type),filename:t.name,imported:!0});case 19:case"end":return e.stop()}},e,this,[[7,15]])}));return e}()},{key:"importAudioFile",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,m.default)(u.default.mark(function e(t){var r,n,a,o,s,i,d;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.props.payloads,n=r.add("audio"),a=r.stream().pipe(t),n.attachStream(a),e.prev=3,e.next=6,N.getAudioMetadata(t);case 6:return o=e.sent,s={type:"audio",payload_token:n.id,format:o.format,duration:o.duration,filename:t.name,imported:!0},e.next=10,T.extractAlbumArt(t);case 10:if(!(i=e.sent)){e.next=17;break}return e.next=14,N.getImageMetadata(i);case 14:d=e.sent,s.width=d.width,s.height=d.height;case 17:return n.attachFile(i,"poster"),e.abrupt("return",s);case 21:return e.prev=21,e.t0=e.catch(3),e.abrupt("return",{type:"audio",payload_token:n.id,format:N.extractFileFormat(t.type),filename:t.name,imported:!0});case 24:case"end":return e.stop()}},e,this,[[3,21]])}));return e}()},{key:"importDataItems",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,m.default)(u.default.mark(function e(t){var r,n,a,o,s,i,d,l;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.props.payloads,e.next=3,w(t);case 3:n=e.sent,a=n["text/html"],/<img\b/i.test(a)&&this.isAcceptable("image")&&(o=/<img\b.*?\bsrc="(.*?)"/.exec(a))&&(s=j.default.unescape(o[1]),i=s.replace(/.*\/([^\?#]*).*/,"$1")||void 0,d=r.add("image").attachURL(s),l={type:"image",payload_token:d.id,filename:i},this.addResources([l]));case 6:case"end":return e.stop()}},e,this)}));return e}()},{key:"render",value:function(){return B.default.createElement("div",null,this.renderPhotoDialog(),this.renderAudioDialog(),this.renderVideoDialog())}},{key:"renderPhotoDialog",value:function(){var e=this.props,t=e.payloads,r=e.env,n=e.cameraDirection,a=this.state.capturing,o={show:"image"===a,cameraDirection:n,payloads:t,env:r,onLoadStart:this.handleLoadStart,onClose:this.handleClose,onCapturePending:this.handleCapturePending,onCaptureError:this.handleCaptureError,onCapture:this.handleCapture};return"browser"===r.platform?B.default.createElement(W.default,o):"cordova"===r.platform?B.default.createElement(q.default,o):void 0}},{key:"renderVideoDialog",value:function(){var e=this.props,t=e.payloads,r=e.env,n=e.cameraDirection,a=this.state.capturing,o={show:"video"===a,cameraDirection:n,payloads:t,env:r,onLoadStart:this.handleLoadStart,onClose:this.handleClose,onCapturePending:this.handleCapturePending,onCaptureError:this.handleCaptureError,onCapture:this.handleCapture};return"browser"===r.platform?B.default.createElement(J.default,o):"cordova"===r.platform?B.default.createElement(Q.default,o):void 0}},{key:"renderAudioDialog",value:function(){var e=this.props,t=e.payloads,r=e.env,n=(e.cameraDirection,this.state.capturing),a={show:"audio"===n,payloads:t,env:r,onClose:this.handleClose,onCapturePending:this.handleCapturePending,onCaptureError:this.handleCaptureError,onCapture:this.handleCapture};return"browser"===r.platform?B.default.createElement(G.default,a):"cordova"===r.platform?B.default.createElement(K.default,a):void 0}},{key:"componentWillUnmount",value:function(){this.state.capturing&&this.triggerCaptureEndEvent()}},{key:"addResourcePlaceholders",value:function(e){var t=j.default.map(e,function(e){return{type:e,pending:"import-"+ ++ne,imported:!0}});return this.addResources(t),t}},{key:"addResources",value:function(e){var t=this.props,r=t.resources,n=t.limit;if(!j.default.isEmpty(e)){var a=r.length;if(1===n){var o=j.default.first(e),s=j.default.findIndex(r,{type:o.type});r=j.default.concat(r,o),-1!==s&&(r.splice(s,1),a--)}else r=j.default.concat(r,e);this.triggerChangeEvent(r,a)}}},{key:"updateResource",value:function(e,t){var r=this.props.resources,n=j.default.findIndex(r,e);return-1!==n&&(r=j.default.slice(r),r[n]=t,this.triggerChangeEvent(r)),null}},{key:"removeResource",value:function(e,t){var r=this.props.resources,n=j.default.findIndex(r,e);-1!==n&&(r=j.default.slice(r),r.splice(n,1),this.triggerChangeEvent(r))}},{key:"triggerChangeEvent",value:function(e,t){var r=this.props.onChange;r&&r({type:"change",target:this,resources:e,selection:t})}},{key:"triggerCaptureStartEvent",value:function(){var e=this.props.onCaptureStart,t=this.state.capturing;e&&e({type:"capturestart",target:this,mediaType:t})}},{key:"triggerCaptureEndEvent",value:function(e){var t=this.props.onCaptureEnd,r=this.state.capturing;t&&t({type:"captureend",target:this,mediaType:r,resource:e})}}]),t}(I.PureComponent));re.displayName="MediaImporter";var ne=0,ae=0;re.defaultProps={types:V.default,limit:1/0},t.default=re,t.MediaImporter=re},"./editors/reaction-editor.jsx":function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e){return k.default.some(e,function(e){if(!e.url&&!e.payload_id)return!0})}Object.defineProperty(t,"__esModule",{value:!0}),t.ReactionEditor=t.default=void 0;var s=r("../../common/node_modules/babel-runtime/regenerator/index.js"),u=a(s),i=r("../../common/node_modules/babel-runtime/helpers/asyncToGenerator.js"),d=a(i),l=r("../../common/node_modules/babel-runtime/core-js/object/get-prototype-of.js"),c=a(l),f=r("../../common/node_modules/babel-runtime/helpers/classCallCheck.js"),m=a(f),p=r("../../common/node_modules/babel-runtime/helpers/createClass.js"),h=a(p),v=r("../../common/node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),g=a(v),b=r("../../common/node_modules/babel-runtime/helpers/inherits.js"),y=a(b),D=r("../../common/node_modules/lodash/lodash.js"),k=a(D),C=r("../../common/node_modules/bluebird/js/browser/bluebird.js"),E=a(C),w=r("../../common/node_modules/react/index.js"),x=a(w),j=r("../../common/src/utils/memoize.js"),_=r("../../common/src/utils/component-refs.js"),R=a(_),S=r("../../common/src/utils/tag-scanner.js"),F=n(S),I=r("../../common/src/utils/markdown.js"),B=n(I),A=r("../../common/src/utils/focus-manager.js"),N=n(A),P=r("../../common/src/objects/utils/reaction-utils.js"),T=n(P),M=r("../../common/src/objects/utils/resource-utils.js"),L=n(M),U=r("../../common/src/widgets/autosize-text-area.jsx"),O=a(U),V=r("./widgets/push-button.jsx"),z=a(V),W=r("./widgets/header-button.jsx"),H=(a(W),r("./widgets/profile-image.jsx")),q=a(H),$=r("./widgets/drop-zone.jsx"),G=(a($),r("./widgets/reaction-media-toolbar.jsx")),Y=a(G),K=r("./editors/media-editor.jsx"),X=a(K),J=r("./editors/media-importer.jsx"),Z=a(J);r("./editors/reaction-editor.scss");var Q=r("../../common/src/data/database.js"),ee=(a(Q),r("../../common/src/transport/payloads.js")),te=(a(ee),r("../../common/src/routing/route.js")),re=(a(te),r("../../common/src/env/environment.js")),ne=(a(re),function(e){function t(e){var r=this;(0,m.default)(this,t);var n=(0,g.default)(this,(t.__proto__||(0,c.default)(t)).call(this,e));return n.handleTextChange=function(e){var t=n.props.env,r=n.state.draft,a=t.locale.languageCode,o=e.currentTarget.value,s="details.text."+a;return r=k.default.decoupleSet(r,s,o),void 0===r.details.markdown&&B.detect(o,n.handleReference)&&(r.details.markdown=!0),r.tags=F.findTags(r.details.text),n.saveDraft(r)},n.handleKeyPress=function(e){var t=n.props.env,r=e.target;13==e.charCode&&(t.isWiderThan("double-col")||(e.preventDefault(),n.handlePublishClick(e),r.blur()))},n.handlePaste=function(e){n.components.mediaImport;mediaImporter.importFiles(e.clipboardData.files),mediaImporter.importDataItems(e.clipboardData.items)},n.handlePublishClick=function(){var e=(0,d.default)(u.default.mark(function e(t){var a,o,s;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.props.env,o=n.state.draft,n.triggerFinishEvent(),o=k.default.clone(o),o.published=!0,s=o.details.resources,e.next=8,L.attachMosaic(s,a);case 8:return e.next=10,n.saveDraft(o,!0);case 10:case"end":return e.stop()}},e,r)}));return function(t){return e.apply(this,arguments)}}(),n.handleCancelClick=function(){var e=(0,d.default)(u.default.mark(function e(t){var a;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.props.reaction,n.triggerFinishEvent(),!a){e.next=12;break}if(!a.ptime){e.next=10;break}return a=k.default.clone(a),a.published=!0,e.next=8,n.saveReaction(a);case 8:e.next=12;break;case 10:return e.next=12,n.removeReaction(a);case 12:case"end":return e.stop()}},e,r)}));return function(t){return e.apply(this,arguments)}}(),n.handleResourcesChange=function(){var e=(0,d.default)(u.default.mark(function e(t){var a,s,i,d,l;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.state.draft,s=k.default.get(a,"details.resources"),i=t.resources,d=t.selection,s===i){e.next=11;break}return l=o(i),a=k.default.decoupleSet(a,"details.resources",i),e.next=9,n.saveDraft(a,l,d);case 9:e.next=12;break;case 11:n.setState({selectedResourceIndex:d});case 12:case"end":return e.stop()}},e,r)}));return function(t){return e.apply(this,arguments)}}(),n.handleCaptureStart=function(e){n.setState({capturing:e.mediaType})},n.handleCaptureEnd=function(e){n.setState({capturing:null})},n.handleReference=function(e){var t=n.props.env,r=n.state.draft,a=r.details.resources,o=B.findReferencedResource(a,e.name);if(o){return{href:L.getMarkdownIconURL(o,e.forImage,t),title:void 0}}},n.handleAction=function(e){var t=n.state.draft,r=n.components.mediaImporter;switch(e.action){case"markdown-set":t=k.default.decoupleSet(t,"details.markdown",e.value),n.saveDraft(t);break;case"photo-capture":r.capture("image");break;case"video-capture":r.capture("video");break;case"audio-capture":r.capture("audio");break;case"file-import":r.importFiles(e.files)}},n.components=(0,R.default)({mediaImporter:Z.default,textArea:O.default}),n.state={draft:null,original:null,selectedResourceIndex:0},n.updateDraft(n.state,e),n.updateResourceIndex(n.state,e),n}return(0,y.default)(t,e),(0,h.default)(t,[{key:"componentWillReceiveProps",value:function(e){var t=this.props.reaction,r=k.default.clone(this.state);e.reaction!==t&&(this.updateDraft(r,e),this.updateResourceIndex(r,e));var n=k.default.shallowDiff(r,this.state);k.default.isEmpty(n)||this.setState(n)}},{key:"updateDraft",value:function(e,t){t.reaction?(e.draft=t.reaction,t.reaction.uncommitted||(e.original=t.reaction)):(e.draft=ae(t.story,t.currentUser),e.original=null)}},{key:"updateResourceIndex",value:function(e,t){var r=k.default.get(e.draft,"details.resources"),n=k.default.size(r);e.selectedResourceIndex>=n?e.selectedResourceIndex=n-1:e.selectedResourceIndex<0&&n>0&&(e.selectedResourceIndex=0)}},{key:"render",value:function(){return x.default.createElement("div",{className:"reaction-editor"},x.default.createElement("div",{className:"profile-image-column"},this.renderProfileImage()),x.default.createElement("div",{className:"editor-column"},x.default.createElement("div",{className:"controls"},x.default.createElement("div",{className:"textarea"},this.renderTextArea()),x.default.createElement("div",{className:"buttons"},this.renderMediaToolbar(),this.renderActionButtons())),x.default.createElement("div",{className:"media"},this.renderMediaEditor(),this.renderMediaImporter())))}},{key:"renderProfileImage",value:function(){var e=this.props,t=e.env,r=e.currentUser,n={user:r,env:t,size:"small"};return x.default.createElement(q.default,n)}},{key:"renderTextArea",value:function(){var e=this.props.env,t=this.state.draft,r=this.components.setters,n=e.locale,a=n.languageCode,o=n.localeCode,s=k.default.get(t,["details","text",a],""),u={ref:r.textArea,value:s,lang:o,onChange:this.handleTextChange,onKeyPress:this.handleKeyPress,onPaste:this.handlePaste};return x.default.createElement(O.default,u)}},{key:"renderMediaToolbar",value:function(){var e=this.props.env,t=this.state,r=t.draft,n=t.capturing,a={reaction:r,capturing:n,env:e,onAction:this.handleAction};return x.default.createElement(Y.default,a)}},{key:"renderActionButtons",value:function(){var e=this.props.env,t=this.state.draft,r=e.locale.t,n=k.default.isEmpty(k.default.get(t,"details.text")),a=k.default.isEmpty(k.default.get(t,"details.resources")),o=k.default.get(t,"published",!1),s={label:r("story-cancel"),onClick:this.handleCancelClick,disabled:o},u={label:r("story-post"),onClick:this.handlePublishClick,emphasized:!0,disabled:n&&a||o};return x.default.createElement("div",{className:"action-buttons"},x.default.createElement(z.default,s),x.default.createElement(z.default,u))}},{key:"renderMediaEditor",value:function(){var e=this.props,t=e.env,r=e.payloads,n=this.state,a=n.draft,o=n.selectedResourceIndex,s=(t.locale.t,{allowShifting:t.isWiderThan("double-col"),resources:k.default.get(a,"details.resources"),resourceIndex:o,payloads:r,env:t,onChange:this.handleResourcesChange});return x.default.createElement(X.default,s)}},{key:"renderMediaImporter",value:function(){var e=this.props,t=e.env,r=e.payloads,n=this.state.draft,a=this.components.setters,o=(t.locale.t,{ref:a.mediaImporter,resources:k.default.get(n,"details.resources",[]),payloads:r,env:t,cameraDirection:"back",onCaptureStart:this.handleCaptureStart,onCaptureEnd:this.handleCaptureEnd,onChange:this.handleResourcesChange});return x.default.createElement(Z.default,o)}},{key:"componentDidMount",value:function(){var e=this.props,t=e.story,r=e.currentUser;N.register(this,{type:"ReactionEditor",story_id:t.id,user_id:r.id})}},{key:"componentWillUnmount",value:function(){N.unregister(this)}},{key:"changeDraft",value:function(e,t){var r=this;return new E.default(function(n,a){var o={draft:e};void 0!==t&&(o.selectedResourceIndex=t),r.setState(o,function(){n(e)})})}},{key:"saveDraft",value:function(){function e(e,r,n){return t.apply(this,arguments)}var t=(0,d.default)(u.default.mark(function e(t,r,n){var a;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.changeDraft(t,n);case 2:return a=e.sent,this.saveReaction(a,r),e.abrupt("return",a);case 5:case"end":return e.stop()}},e,this)}));return e}()},{key:"saveReaction",value:function(){function e(e,r){return t.apply(this,arguments)}var t=(0,d.default)(u.default.mark(function e(t,r){var n,a,o,s,i,d,l,c;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.props,a=n.database,o=n.payloads,s=this.state.original,i={delay:r?void 0:2e3,onConflict:function(e){T.mergeRemoteChanges(e.local,e.remote,s)&&e.preventDefault()}},d=a.use({by:this}),e.next=6,d.start();case 6:return l=e.sent,e.next=9,d.saveOne({table:"reaction"},t,i);case 9:return c=e.sent,o.dispatch(c),e.abrupt("return",c);case 12:case"end":return e.stop()}},e,this)}));return e}()},{key:"removeReaction",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,d.default)(u.default.mark(function e(t){var r,n,a;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.props.database,n=r.use({by:this}),e.next=4,n.start();case 4:return a=e.sent,e.abrupt("return",n.removeOne({table:"reaction"},t));case 6:case"end":return e.stop()}},e,this)}));return e}()},{key:"triggerFinishEvent",value:function(){var e=this.props.onFinish;e&&e({type:"finish",target:this})}},{key:"focus",value:function(){var e=this.components.textArea;e&&e.focus()}}]),t}(w.PureComponent));ne.displayName="ReactionEditor";var ae=(0,j.memoizeWeak)(null,function(e,t){return{type:"comment",story_id:e.id,user_id:t?t.id:null,details:{}}});t.default=ne,t.ReactionEditor=ne},"./editors/reaction-editor.scss":function(e,t){},"./editors/story-editor-options.jsx":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.StoryEditorOptions=t.default=void 0;var a=r("../../common/node_modules/babel-runtime/core-js/object/get-prototype-of.js"),o=n(a),s=r("../../common/node_modules/babel-runtime/helpers/classCallCheck.js"),u=n(s),i=r("../../common/node_modules/babel-runtime/helpers/createClass.js"),d=n(i),l=r("../../common/node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),c=n(l),f=r("../../common/node_modules/babel-runtime/helpers/inherits.js"),m=n(f),p=r("../../common/node_modules/lodash/lodash.js"),h=n(p),v=r("../../common/node_modules/react/index.js"),g=n(v),b=r("../../common/src/objects/utils/user-utils.js"),y=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(b),D=r("./widgets/header-button.jsx"),k=(n(D),r("./widgets/option-button.jsx")),C=n(k),E=r("./dialogs/user-selection-dialog-box.jsx"),w=n(E),x=r("./dialogs/issue-dialog-box.jsx"),j=n(x);r("./editors/story-editor-options.scss");var _=r("../../common/src/data/database.js"),R=(n(_),r("../../common/src/routing/route.js")),S=(n(R),r("../../common/src/env/environment.js")),F=(n(S),function(e){function t(e){(0,u.default)(this,t);var r=(0,c.default)(this,(t.__proto__||(0,o.default)(t)).call(this,e));return r.handleBookmarkClick=function(e){var t=r.props,n=t.options,a=t.currentUser;n=h.default.clone(n);var o=a.id;h.default.includes(n.bookmarkRecipients,o)?n.bookmarkRecipients=h.default.difference(n.bookmarkRecipients,[o]):n.bookmarkRecipients=h.default.union(n.bookmarkRecipients,[o]),r.triggerChangeEvent(n),r.triggerCompleteEvent()},r.handleSendBookmarkClick=function(e){r.openSelectionDialogBox(e)},r.handleAddIssueClick=function(e){r.openIssueDialogBox(e)},r.handleHidePostClick=function(e){var t=r.props.options;t=h.default.clone(t),t.hidePost=!t.hidePost,r.triggerChangeEvent(t),r.triggerCompleteEvent()},r.handleRecipientsSelect=function(e){var t=r.props.options;t=h.default.clone(t),t.bookmarkRecipients=e.selection,r.triggerChangeEvent(t),r.triggerCompleteEvent(),r.closeSelectionDialogBox()},r.handleRecipientsCancel=function(e){r.triggerCompleteEvent(),r.closeSelectionDialogBox()},r.handleIssueConfirm=function(e){var t=r.props.options;t=h.default.clone(t),t.issueDetails=e.issue,r.triggerChangeEvent(t),r.triggerCompleteEvent(),r.closeIssueDialogBox()},r.handleIssueCancel=function(e){r.triggerCompleteEvent(),r.closeIssueDialogBox()},r.handleShowMediaPreviewClick=function(e){var t=r.props.options;t=h.default.clone(t),t.preview="media",r.triggerChangeEvent(t),r.triggerCompleteEvent()},r.handleShowTextPreviewClick=function(e){var t=r.props.options;t=h.default.clone(t),t.preview="text",r.triggerChangeEvent(t),r.triggerCompleteEvent()},r.state={selectingRecipients:!1,enteringIssueDetails:!1},r}return(0,m.default)(t,e),(0,d.default)(t,[{key:"render",value:function(){var e=this.props.section;return"both"===e?g.default.createElement("div",{className:"story-editor-options"},this.renderButtons("main"),g.default.createElement("div",{className:"border"}),this.renderButtons("preview")):g.default.createElement("div",{className:"story-editor-options"},this.renderButtons(e))}},{key:"renderButtons",value:function(e){var t=this.props,r=t.env,n=t.options,a=t.currentUser,o=t.story,s=t.repos,u=r.locale.t;if("main"===e){var i=!!a&&h.default.includes(n.bookmarkRecipients,a.id),d=a?h.default.without(n.bookmarkRecipients,a.id):[],l={label:u("option-add-bookmark"),selected:i,onClick:this.handleBookmarkClick},c={label:h.default.isEmpty(d)?u("option-send-bookmarks"):u("option-send-bookmarks-to-$count-users",h.default.size(d)),hidden:!y.canSendBookmarks(a,o,"read-write"),selected:!h.default.isEmpty(d),onClick:this.handleSendBookmarkClick},f={label:u("option-add-issue"),selected:!!n.issueDetails,hidden:!y.canAddIssue(a,o,s,"read-write"),onClick:this.handleAddIssueClick},m={label:u("option-hide-story"),selected:n.hidePost,hidden:!y.canHideStory(a,o,"read-write"),onClick:this.handleHidePostClick};return g.default.createElement("div",{className:e},g.default.createElement(C.default,l),g.default.createElement(C.default,c),g.default.createElement(C.default,f),g.default.createElement(C.default,m),this.renderRecipientDialogBox(),this.renderIssueDialogBox())}if("preview"===e){var p={label:u("option-show-media-preview"),selected:"media"===n.preview||!n.preview,onClick:this.handleShowMediaPreviewClick},v={label:u("option-show-text-preview"),selected:"text"===n.preview,onClick:this.handleShowTextPreviewClick};return g.default.createElement("div",{className:e},g.default.createElement(C.default,p),g.default.createElement(C.default,v))}}},{key:"renderRecipientDialogBox",value:function(){var e=this.props,t=e.database,r=e.route,n=e.env,a=e.options,o=this.state.selectingRecipients,s={show:o,selection:a.bookmarkRecipients,database:t,route:r,env:n,onSelect:this.handleRecipientsSelect,onCancel:this.handleRecipientsCancel};return g.default.createElement(w.default,s)}},{key:"renderIssueDialogBox",value:function(){var e=this.props,t=e.env,r=e.options,n=e.currentUser,a=e.story,o=e.repos,s=this.state.enteringIssueDetails,u={show:s,allowDeletion:!0,currentUser:n,story:a,issue:r.issueDetails,repos:o,env:t,onConfirm:this.handleIssueConfirm,onCancel:this.handleIssueCancel};return g.default.createElement(j.default,u)}},{key:"triggerChangeEvent",value:function(e){var t=this.props.onChange;t&&t({type:"change",target:this,options:e})}},{key:"triggerCompleteEvent",value:function(){var e=this.props.onComplete;e&&e({type:"complete",target:this})}},{key:"openSelectionDialogBox",value:function(e){this.state.selectingRecipients||this.setState({selectingRecipients:!0})}},{key:"closeSelectionDialogBox",value:function(){this.state.selectingRecipients&&this.setState({selectingRecipients:!1})}},{key:"openIssueDialogBox",value:function(e){this.state.enteringIssueDetails||this.setState({enteringIssueDetails:!0})}},{key:"closeIssueDialogBox",value:function(){this.state.enteringIssueDetails&&this.setState({enteringIssueDetails:!1})}}]),t}(v.PureComponent));F.displayName="StoryEditorOptions",F.defaultProps={section:"both"},t.default=F,t.StoryEditorOptions=F},"./editors/story-editor-options.scss":function(e,t){},"./editors/story-editor.jsx":function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e){return{id:Y.allocate(),user_ids:[e.id],details:{},public:!0,published:!1}}function s(e){return x.default.some(e,function(e){if(e.pending)return!0})}function u(e){return x.default.some(e,function(e){if(!e.url&&!e.payload_id)return!0})}Object.defineProperty(t,"__esModule",{value:!0}),t.StoryEditor=t.default=void 0;var i=r("../../common/node_modules/babel-runtime/helpers/extends.js"),d=a(i),l=r("../../common/node_modules/babel-runtime/regenerator/index.js"),c=a(l),f=r("../../common/node_modules/babel-runtime/helpers/asyncToGenerator.js"),m=a(f),p=r("../../common/node_modules/babel-runtime/core-js/object/get-prototype-of.js"),h=a(p),v=r("../../common/node_modules/babel-runtime/helpers/classCallCheck.js"),g=a(v),b=r("../../common/node_modules/babel-runtime/helpers/createClass.js"),y=a(b),D=r("../../common/node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),k=a(D),C=r("../../common/node_modules/babel-runtime/helpers/inherits.js"),E=a(C),w=r("../../common/node_modules/lodash/lodash.js"),x=a(w),j=r("../../common/node_modules/bluebird/js/browser/bluebird.js"),_=a(j),R=r("../../common/node_modules/react/index.js"),S=a(R),F=r("../../common/src/utils/list-parser.js"),I=n(F),B=r("../../common/src/utils/markdown.js"),A=n(B),N=r("../../common/src/utils/plain-text.js"),P=n(N),T=r("../../common/src/utils/tag-scanner.js"),M=n(T),L=r("../../common/src/utils/focus-manager.js"),U=(n(L),r("../../common/src/utils/component-refs.js")),O=a(U),V=r("../../common/src/objects/utils/story-utils.js"),z=n(V),W=r("../../common/src/objects/utils/issue-utils.js"),H=n(W),q=r("../../common/src/objects/utils/resource-utils.js"),$=n(q),G=r("../../common/src/data/remote-data-source/temporary-id.js"),Y=n(G),K=r("../../common/src/utils/random-token.js"),X=n(K),J=r("./widgets/author-names.jsx"),Z=a(J),Q=r("./widgets/profile-image.jsx"),ee=a(Q),te=r("./widgets/coauthoring-button.jsx"),re=a(te),ne=r("./widgets/push-button.jsx"),ae=a(ne),oe=r("../../common/src/widgets/autosize-text-area.jsx"),se=a(oe),ue=r("./widgets/media-toolbar.jsx"),ie=a(ue),de=r("./widgets/text-toolbar.jsx"),le=a(de),ce=r("./widgets/header-button.jsx"),fe=a(ce),me=r("./widgets/drop-zone.jsx"),pe=a(me),he=r("./editors/media-editor.jsx"),ve=a(he),ge=r("./editors/media-importer.jsx"),be=a(ge),ye=r("./widgets/media-placeholder.jsx"),De=a(ye),ke=r("./editors/story-editor-options.jsx"),Ce=a(ke),Ee=r("./widgets/corner-pop-up.jsx"),we=a(Ee),xe=r("./dialogs/confirmation-dialog-box.jsx"),je=a(xe);r("./editors/story-editor.scss");var _e=r("../../common/src/data/database.js"),Re=(a(_e),r("../../common/src/transport/payloads.js")),Se=(a(Re),r("../../common/src/routing/route.js")),Fe=(a(Se),r("../../common/src/env/environment.js")),Ie=(a(Fe),function(e){function t(e){var r=this;(0,g.default)(this,t);var n=(0,k.default)(this,(t.__proto__||(0,h.default)(t)).call(this,e));return n.handlePublishClick=function(e){n.publishStory()},n.handleTextChange=function(e){var t=n.props.env,r=n.state,a=r.draft,o=r.options,s=e.currentTarget.value,u=o.localeCode.substr(0,2);u||(u=t.locale.languageCode);var i="details.text."+u;if(a=x.default.decoupleSet(a,i,s),a.details.text=x.default.pickBy(a.details.text,"length"),x.default.isEmpty(a.details.text)&&(a.details=x.default.omit(a.details,"text")),a.type||I.detect(a.details.text)&&(a.type="task-list",void 0===a.details.markdown&&(a.details.markdown=!1)),"task-list"===a.type){var d=[];x.default.each(a.details.text,function(e){var t=I.extract(e),r=I.count(t,!1);d.push(r)}),a.unfinished_tasks=x.default.max(d)}void 0===a.details.markdown&&A.detect(s)&&(a.details.markdown=!0),a.tags=M.findTags(a.details.text),n.saveDraft(a)},n.handleKeyDown=function(e){n.lastInput=null},n.handleBeforeInput=function(e){var t=n.props.env,r=n.state.draft,a=e.target;if("\n"===e.data&&"survey"!==r.type&&"task-list"!==r.type&&!t.isWiderThan("double-col"))return e.preventDefault(),n.handlePublishClick(e),void a.blur();n.lastInput=e.data},n.handleKeyUp=function(e){var t=(n.props.env,n.state.draft),r=e.target;if("\n"===n.lastInput){if("survey"===t.type||"task-list"===t.type){var a=r.value,o=r.selectionStart,s=a.substr(0,o),u=x.default.lastIndexOf(s.substr(0,s.length-1),"\n"),i=s.substr(u+1),d=I.extract(i),l=x.default.get(d,[0,0]);l instanceof Object&&(l.label?document.execCommand("insertText",!1,"* [ ] "):(r.selectionStart=u+1,document.execCommand("insertText",!1,"\n")))}}else if("]"===n.lastInput){var c=r.value,f=r.selectionStart,m=c.substr(0,f),p=x.default.lastIndexOf(m,"\n"),h=m.substr(p+1);/^\s*\*\[\]/.test(h)&&(r.selectionStart=f-3,document.execCommand("insertText",!1,"* [ ]"))}},n.handlePaste=function(e){var t=n.components.mediaImporter;t.importFiles(e.clipboardData.files),t.importDataItems(e.clipboardData.items),e.clipboardData.files.length>0&&e.preventDefault()},n.handleCancelClick=function(e){var t=n.props.isStationary,r=void 0;r=n.isCoauthoring()?"remove-self":t?"delete-post":"cancel-edit",n.setState({confirming:!0,action:r})},n.handleOptionChange=function(e){return n.changeOptions(e.options)},n.handleOptionComplete=function(e){var t=e.target.props.section,r=n.components[t+"PopUp"];r&&r.close()},n.handleDialogClose=function(e){n.setState({confirming:!1})},n.handleCancelConfirm=function(){var e=(0,m.default)(c.default.mark(function e(t){var a,s,u,i,d;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.props,s=a.currentUser,u=a.isStationary,i=n.state.draft,n.setState({confirming:!1}),!u){e.next=7;break}return d=o(s),e.next=7,n.changeDraft(d);case 7:if(!i.id){e.next=10;break}return e.next=10,n.removeStory(i);case 10:case"end":return e.stop()}},e,r)}));return function(t){return e.apply(this,arguments)}}(),n.handleReference=function(e){var t=n.props.env,r=n.state.draft,a=r.details.resources,o=A.findReferencedResource(a,e.name);if(o){return{href:$.getMarkdownIconURL(o,e.forImage,t),title:e.name}}},n.handleTextClick=function(e){"INPUT"!==e.target.tagName&&e.preventDefault();var t=n.state,r=t.draft,a=t.options,o=e.target;o.viewportElement&&(o=o.viewportElement);var s=void 0;if("svg"===o.tagName){var u=o.getElementsByTagName("title")[0];u&&(s=u.textContent)}else s=e.target.title;if(s){var i=r.details.resources,d=A.findReferencedResource(i,s);if(d){var l=x.default.indexOf(i,d);a=x.default.decoupleSet(a,"preview","media"),n.setState({selectedResourceIndex:l,options:a})}}else if("A"===o.tagName)window.open(o.href,"_blank");else if("IMG"===o.tagName){var c=(o.getAttribute("src"),o.getBoundingClientRect()),f=o.naturalWidth+50,m=o.naturalHeight+50,p=c.left+window.screenLeft,h=c.top+window.screenTop;window.open(o.src,"_blank","width="+f+",height="+m+",left="+p+",top="+h+"status=no,menubar=no")}},n.handleItemChange=function(e){var t=n.state.draft,r=e.currentTarget,a=parseInt(r.name),o=parseInt(r.value),s=r.checked;if(t=x.default.decouple(t,"details"),"task-list"===t.type){var u=[];t.details.text=x.default.mapValues(t.details.text,function(e){var t=I.extract(e);I.set(t,a,o,s);var r=I.count(t,!1);return u.push(r),I.join(t)}),t.unfinished_tasks=x.default.max(u)}else"survey"===t.type&&(t.details.text=x.default.mapValues(t.details.text,function(e){var t=I.extract(e);return I.set(t,a,o,s,!0),I.join(t)}));n.saveDraft(t)},n.handleRemoveConfirm=function(e){n.setState({confirming:!1}),n.removeSelf()},n.handleCoauthorSelect=function(e){var t=n.state.draft;t=x.default.decoupleSet(t,"user_ids",e.selection),n.saveDraft(t,!0)},n.handleResourcesChange=function(e){var t=n.state,r=t.draft,a=t.selectedResourceIndex,o=r.resources,i=e.resources;if(void 0!==e.selection&&(a=e.selection),o!==i){r=x.default.decoupleSet(r,"details.resources",i);var d=!1;s(i)&&u(i)&&(d=!0),n.saveDraft(r,d,a)}else n.setState({selectedResourceIndex:a})},n.handleResourceEmbed=function(){var e=(0,m.default)(c.default.mark(function e(t){var a,o,s,u,i,d,l,f;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.state,o=a.draft,s=a.options,u=n.components.textArea,i=t.resource,o=x.default.decouple(o,"details"),d=o.details.resources,l=x.default.filter(d,{type:i.type}),-1===(f=x.default.indexOf(l,i))){e.next=18;break}return s=x.default.clone(s),s.preview="media",e.next=12,n.changeOptions(s);case 12:return x.default.set(o,"details.markdown",!0),e.next=15,n.changeDraft(o);case 15:u=u.getElement(),u.focus(),setTimeout(function(){var e="!["+i.type+"-"+(f+1)+"]";document.execCommand("insertText",!1,e)},10);case 18:case"end":return e.stop()}},e,r)}));return function(t){return e.apply(this,arguments)}}(),n.handleDrop=function(e){var t=n.components.mediaImporter;t.importFiles(e.files),t.importDataItems(e.items)},n.handleCaptureStart=function(e){n.setState({capturing:e.mediaType})},n.handleCaptureEnd=function(e){n.setState({capturing:null})},n.handleAction=function(e){var t=n.state.draft,r=n.components,a=r.textArea,o=r.mediaImporter;switch(e.action){case"markdown-set":t=x.default.decoupleSet(t,"details.markdown",e.value),n.saveDraft(t);break;case"story-type-set":t=x.default.decoupleSet(t,"type",e.value),"task-list"!==t.type&&"survey"!==t.type||(a=a.getElement(),a.focus(),I.detect(a.value)||setTimeout(function(){var e=a.value,t="* [ ] ",r=a.selectionStart;/[^\n]$/.test(e.substr(0,r))&&(t="\n"+t),document.execCommand("insertText",!1,t)},10)),n.saveDraft(t);break;case"photo-capture":o.capture("image");break;case"video-capture":o.capture("video");break;case"audio-capture":o.capture("audio");break;case"file-import":o.importFiles(e.files)}},n.components=(0,O.default)({mediaImporter:be.default,textArea:se.default,mainPopUp:we.default,previewPopUp:we.default}),n.state={options:Be,selectedResourceIndex:0,original:null,draft:null,confirming:!1,capturing:null,publishing:!1,action:null},n.updateDraft(n.state,e),n.updateOptions(n.state,e),n.updateLocaleCode(n.state,e),n.updateLeadAuthor(n.state,e),n.updateBookmarkRecipients(n.state,e),n.updateResourceIndex(n.state,e),n}return(0,E.default)(t,e),(0,y.default)(t,[{key:"getClassName",value:function(){var e=this.props.highlighting,t="story-editor";return e&&(t+=" highlighting"),t}},{key:"isCoauthoring",value:function(){var e=this.props,t=e.story,r=e.currentUser,n=x.default.get(t,"user_ids"),a=x.default.get(r,"id");return x.default.indexOf(n,a)>0}},{key:"componentWillReceiveProps",value:function(e){var t=this.props,r=t.env,n=t.story,a=t.currentUser,o=t.repos,s=t.recommendations,u=x.default.clone(this.state);e.story!==n&&(this.updateDraft(u,e),this.updateOptions(u,e),this.updateLocaleCode(u,e),this.updateResourceIndex(u,e)),e.currentUser!==a&&this.updateLeadAuthor(u,e),e.env.locale!==r.locale&&this.updateLocaleCode(u,e),e.recommendations!==s&&this.updateBookmarkRecipients(u,e),e.repos!==o&&(this.updateOptions(u,e),this.updateLocaleCode(u,e));var i=x.default.shallowDiff(u,this.state);x.default.isEmpty(i)||this.setState(i)}},{key:"updateDraft",value:function(e,t){this.state.publishing;t.story?(e.draft=t.story,t.story.uncommitted||(e.original=t.story)):(e.draft=o(t.currentUser),e.original=null)}},{key:"updateLeadAuthor",value:function(e,t){if(!e.story){var r=x.default.get(t.currentUser,"id");e.draft.user_ids||(e.draft=x.default.decouple(e.draft,"user_ids",[]),e.draft.user_ids[0]=r)}}},{key:"updateOptions",value:function(e,t){t.story?(e.options=x.default.clone(e.options),e.options.hidePost=!e.draft.public,e.options.issueDetails=H.extractIssueDetails(e.draft,t.repos),e.options.preview||(e.options.preview=this.choosePreview(e.draft))):e.options=Be}},{key:"updateBookmarkRecipients",value:function(e,t){if(t.story){var r=x.default.map(t.recommendations,"target_user_id");e.options=x.default.clone(e.options),e.options.bookmarkRecipients=x.default.union(e.options.bookmarkRecipients,r)}}},{key:"updateLocaleCode",value:function(e,t){e.options=x.default.clone(e.options),e.options.localeCode=this.chooseLocale(e.draft,t.env)}},{key:"updateResourceIndex",value:function(e,t){if(t.story){var r=x.default.get(e.draft,"details.resources"),n=x.default.size(r);e.selectedResourceIndex>=n?e.selectedResourceIndex=n-1:e.selectedResourceIndex<0&&n>0&&(e.selectedResourceIndex=0)}}},{key:"choosePreview",value:function(e){return"survey"===e.type||"task-list"===e.type?"text":x.default.get(e,"details.markdown",!1)?"text":""}},{key:"chooseLocale",value:function(e,t){var r=void 0,n=x.default.get(e,"details.text");if(x.default.isEmpty(n))r=t.locale.localeCode;else{var a=x.default.first(x.default.keys(n));if(a===t.locale.languageCode)r=t.locale.localeCode;else{var o=x.default.find(t.locale.directory,{code:a});if(o){r=a+"-"+o.defaultCountry}else r=a}}return r}},{key:"render",value:function(){var e=this.props.env;return e.isWiderThan("triple-col")?this.renderTripleColumn():e.isWiderThan("double-col")?this.renderDoubleColumn():this.renderSingleColumn()}},{key:"renderSingleColumn",value:function(){return S.default.createElement("div",{className:this.getClassName()},S.default.createElement("div",{className:"header"},S.default.createElement("div",{className:"column-1 padded"},this.renderProfileImage(),this.renderAuthorNames(),this.renderPopUpMenu("main"))),S.default.createElement("div",{className:"body"},S.default.createElement("div",{className:"column-1 padded"},this.renderCoauthoringButton(),this.renderTextArea(),this.renderButtons())),S.default.createElement("div",{className:"header"},S.default.createElement("div",{className:"column-2 padded"},this.renderToolbar(),this.renderPopUpMenu("preview"))),S.default.createElement("div",{className:"body"},S.default.createElement("div",{className:"column-2"},this.renderPreview())),this.renderMediaImporter(),this.renderConfirmationDialogBox())}},{key:"renderDoubleColumn",value:function(){return S.default.createElement("div",{className:this.getClassName()},S.default.createElement("div",{className:"header"},S.default.createElement("div",{className:"column-1 padded"},this.renderProfileImage(),this.renderAuthorNames(),this.renderPopUpMenu("main")),S.default.createElement("div",{className:"column-2 padded"},this.renderToolbar(),this.renderPopUpMenu("preview"))),S.default.createElement("div",{className:"body"},S.default.createElement("div",{className:"column-1 padded"},this.renderCoauthoringButton(),this.renderTextArea(),this.renderButtons()),S.default.createElement("div",{className:"column-2"},this.renderPreview())),this.renderMediaImporter(),this.renderConfirmationDialogBox())}},{key:"renderTripleColumn",value:function(){var e=this.props.env,t=e.locale.t;return S.default.createElement("div",{className:this.getClassName()},S.default.createElement("div",{className:"header"},S.default.createElement("div",{className:"column-1 padded"},this.renderProfileImage(),this.renderAuthorNames()),S.default.createElement("div",{className:"column-2 padded"},this.renderToolbar()),S.default.createElement("div",{className:"column-3 padded"},S.default.createElement(fe.default,{icon:"chevron-circle-right",label:t("story-options"),disabled:!0}))),S.default.createElement("div",{className:"body"},S.default.createElement("div",{className:"column-1 padded"},this.renderCoauthoringButton(),this.renderTextArea(),this.renderButtons()),S.default.createElement("div",{className:"column-2"},this.renderPreview()),S.default.createElement("div",{className:"column-3 padded"},this.renderOptions())),this.renderMediaImporter(),this.renderConfirmationDialogBox())}},{key:"renderProfileImage",value:function(){var e=this.props,t=e.env,r=e.authors,n={user:x.default.get(r,0),env:t,size:"medium"};return S.default.createElement(ee.default,n)}},{key:"renderAuthorNames",value:function(){var e=this.props,t=e.env,r=e.authors,n={authors:r,env:t};return S.default.createElement(Z.default,n)}},{key:"renderCoauthoringButton",value:function(){var e=this.props,t=e.database,r=e.route,n=e.env,a=this.state.draft,o={coauthoring:this.isCoauthoring(),story:a,database:t,route:r,env:n,onSelect:this.handleCoauthorSelect,onRemove:this.handleCancelClick};return S.default.createElement(re.default,o)}},{key:"renderTextArea",value:function(){var e=this.state,t=e.draft,r=e.options,n=this.components.setters,a=r.localeCode.substr(0,2),o=x.default.get(t,"details.text."+a,""),s={value:o,lang:r.localeCode,onChange:this.handleTextChange,onBeforeInput:this.handleBeforeInput,onKeyDown:this.handleKeyDown,onKeyUp:this.handleKeyUp,onPaste:this.handlePaste};return S.default.createElement(se.default,(0,d.default)({ref:n.textArea},s))}},{key:"renderButtons",value:function(){var e=this.props.env,t=this.state,r=t.draft,n=t.publishing,a=e.locale.t,o=x.default.get(r,"details.text"),u=x.default.get(r,"details.resources"),i=x.default.isEmpty(x.default.pickBy(o)),d=x.default.isEmpty(u),l=s(u),c={label:a("story-cancel"),onClick:this.handleCancelClick,disabled:i&&d||n},f={label:a("story-post"),onClick:this.handlePublishClick,emphasized:!0,disabled:i&&d||l||n};return S.default.createElement("div",{className:"buttons"},S.default.createElement(ae.default,c),S.default.createElement(ae.default,f))}},{key:"renderToolbar",value:function(){return"text"===this.state.options.preview?this.renderTextToolbar():this.renderMediaToolbar()}},{key:"renderTextToolbar",value:function(){var e=this.props.env,t=this.state.draft,r={story:t,env:e,onAction:this.handleAction};return S.default.createElement(le.default,r)}},{key:"renderMediaToolbar",value:function(){var e=this.props.env,t=this.state,r=t.draft,n=t.capturing,a={story:r,capturing:n,env:e,onAction:this.handleAction};return S.default.createElement(ie.default,a)}},{key:"renderPreview",value:function(){return"text"===this.state.options.preview?this.renderTextPreview():this.renderMediaPreview()}},{key:"renderTextPreview",value:function(){var e=this.state.draft,t=void 0;switch(e.type){case void 0:case"":case"post":t=this.renderRegularPost();break;case"task-list":t=this.renderTaskListText();break;case"survey":t=this.renderSurveyText()}return S.default.createElement("div",{className:"story-contents"},t)}},{key:"renderRegularPost",value:function(){var e=this.props.env,t=this.state.draft,r=e.locale.p,n="text story",a=r(t.details.text);return t.details.markdown?(a=A.render(a,this.handleReference),n+=" markdown"):(a=S.default.createElement("p",null,P.renderEmoji(a)),n+=" plain-text"),S.default.createElement("div",{className:n,onClick:this.handleTextClick},a)}},{key:"renderTaskListText",value:function(){var e=this.props.env,t=this.state.draft,r=e.locale.p,n="text task-list",a=r(t.details.text),o=void 0;return t.details.markdown?(o=A.renderTaskList(a,null,this.handleItemChange,this.handleReference),n+=" markdown"):(o=P.renderTaskList(a,null,this.handleItemChange),o=S.default.createElement("p",null,o),n+=" plain-text"),S.default.createElement("div",{className:n,onClick:this.handleTextClick},o)}},{key:"renderSurveyText",value:function(){var e=this.props.env,t=this.state.draft,r=e.locale.p,n="text survey",a=r(t.details.text),o=void 0;return t.details.markdown?(o=A.renderSurvey(a,null,this.handleItemChange,this.handleReference),n+=" markdown"):(o=P.renderSurvey(a,null,this.handleItemChange),o=S.default.createElement("p",null,o),n+=" plain-text"),S.default.createElement("div",{className:n,onClick:this.handleTextClick},o)}},{key:"renderMediaPreview",value:function(){var e=this.props,t=e.payloads,r=e.env,n=e.isStationary,a=this.state,o=a.draft,s=a.selectedResourceIndex,u={allowEmbedding:!0,allowShifting:r.isWiderThan("double-col"),resources:x.default.get(o,"details.resources"),resourceIndex:s,payloads:t,env:r,onChange:this.handleResourcesChange,onEmbed:this.handleResourceEmbed},i={showHints:n,env:r};return S.default.createElement(pe.default,{onDrop:this.handleDrop},S.default.createElement(ve.default,u,S.default.createElement(De.default,i)))}},{key:"renderMediaImporter",value:function(){var e=this.props,t=e.payloads,r=e.env,n=this.state.draft,a=this.components.setters,o={ref:a.mediaImporter,resources:x.default.get(n,"details.resources",[]),cameraDirection:"back",payloads:t,env:r,onCaptureStart:this.handleCaptureStart,onCaptureEnd:this.handleCaptureEnd,onChange:this.handleResourcesChange};return S.default.createElement(be.default,o)}},{key:"renderPopUpMenu",value:function(e){var t=this.components.setters,r=t[e+"PopUp"];return S.default.createElement(we.default,{ref:r},this.renderOptions(e))}},{key:"renderOptions",value:function(e){var t=this.props,r=t.database,n=t.route,a=t.env,o=t.currentUser,s=t.repos,u=this.state,i=u.draft,d=u.options,l={section:e,story:i,options:d,currentUser:o,repos:s,database:r,route:n,env:a,onChange:this.handleOptionChange,onComplete:this.handleOptionComplete};return S.default.createElement(Ce.default,l)}},{key:"renderConfirmationDialogBox",value:function(){var e=this.props.env,t=this.state,r=t.action,n=t.confirming,a=e.locale.t,o={show:n,env:e,onClose:this.handleDialogClose},s=void 0;switch(r){case"delete-post":s=a("story-cancel-are-you-sure"),o.onConfirm=this.handleCancelConfirm;break;case"cancel-edit":s=a("story-cancel-edit-are-you-sure"),o.onConfirm=this.handleCancelConfirm;break;case"remove-self":s=a("story-remove-yourself-are-you-sure"),o.onConfirm=this.handleRemoveConfirm}return S.default.createElement(je.default,o,s)}},{key:"componentDidUpdate",value:function(e,t){if(this.repositionCursor){var r=this.repositionCursor.target;r.selectionStart=r.selectionEnd=this.repositionCursor.position,this.repositionCursor=null}}},{key:"changeDraft",value:function(e,t){var r=this,n=this.state.options;return new _.default(function(a,o){if(!n.preview){var s=r.choosePreview(e);s&&(n=x.default.decoupleSet(n,"preview",s))}var u={draft:e,options:n};void 0!==t&&(u.selectedResourceIndex=t),r.setState(u,function(){a(e)})})}},{key:"changeOptions",value:function(e){var t=this;return new _.default(function(r,n){t.setState({options:e},function(){r(e)})})}},{key:"saveDraft",value:function(){function e(e,r,n){return t.apply(this,arguments)}var t=(0,m.default)(c.default.mark(function e(t,r,n){var a,o;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.state.options,t.public=!a.hidePost,e.next=4,this.changeDraft(t,n);case 4:return o=e.sent,s(o.details.resources)||this.saveStory(o,r),e.abrupt("return",o);case 7:case"end":return e.stop()}},e,this)}));return e}()},{key:"saveStory",value:function(){function e(e,r){return t.apply(this,arguments)}var t=(0,m.default)(c.default.mark(function e(t,r){var n,a,o,s,u,i,d,l,f;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.props,a=n.database,o=n.payloads,s=this.state.original,u=t.details.resources||[],i={delay:r?void 0:2e3,onConflict:function(e){z.mergeRemoteChanges(e.local,e.remote,s)&&e.preventDefault()}},d=a.use({by:this}),e.next=7,d.start();case 7:return l=e.sent,e.next=10,d.saveOne({table:"story"},t,i);case 10:return f=e.sent,o.dispatch(f),e.abrupt("return",f);case 13:case"end":return e.stop()}},e,this)}));return e}()},{key:"removeStory",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,m.default)(c.default.mark(function e(t){var r,n,a,o;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.props,n=r.database,a=r.payloads,o=n.use({by:this}),e.next=4,o.removeOne({table:"story"},t);case 4:return e.next=6,a.abandon(t);case 6:case"end":return e.stop()}},e,this)}));return e}()},{key:"removeSelf",value:function(){function e(){return t.apply(this,arguments)}var t=(0,m.default)(c.default.mark(function e(){var t,r,n,a,o,s,u,i;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props,r=t.database,n=t.story,a=t.currentUser,o=x.default.without(n.user_ids,a.id),s={id:n.id,user_ids:o},u=r.use({by:this}),e.next=6,u.start();case 6:return i=e.sent,e.abrupt("return",u.saveOne({table:"story"},s));case 8:case"end":return e.stop()}},e,this)}));return e}()},{key:"saveBookmarks",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,m.default)(c.default.mark(function e(t){var r,n,a;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.props.database,!x.default.isEmpty(t)){e.next=3;break}return e.abrupt("return",[]);case 3:return n=r.use({by:this}),e.next=6,n.start();case 6:return a=e.sent,e.abrupt("return",n.save({table:"bookmark"},t));case 8:case"end":return e.stop()}},e,this)}));return e}()},{key:"removeBookmarks",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,m.default)(c.default.mark(function e(t){var r,n,a;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.props.database,!x.default.isEmpty(t)){e.next=3;break}return e.abrupt("return",[]);case 3:return n=r.use({by:this}),e.next=6,n.start();case 6:return a=e.sent,e.abrupt("return",n.remove({table:"bookmark"},t));case 8:case"end":return e.stop()}},e,this)}));return e}()},{key:"sendBookmarks",value:function(){function e(e,r){return t.apply(this,arguments)}var t=(0,m.default)(c.default.mark(function e(t,r){var n,a,o,s,u,i,d;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.props,a=n.bookmarks,o=n.currentUser,s=[],x.default.each(r,function(e){if(!x.default.some(a,{target_user_id:e})){var r={story_id:t.published_version_id||t.id,user_ids:[o.id],target_user_id:e};s.push(r)}}),u=[],x.default.each(a,function(e){x.default.includes(r,e.target_user_id)||u.push(e)}),e.next=7,this.saveBookmarks(s);case 7:return i=e.sent,e.next=10,this.removeBookmarks(u);case 10:return d=e.sent,e.abrupt("return",x.default.concat(i,d));case 12:case"end":return e.stop()}},e,this)}));return e}()},{key:"sendTask",value:function(){function e(e,r){return t.apply(this,arguments)}var t=(0,m.default)(c.default.mark(function e(t,r){var n,a,o,s,u,i;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.props,a=n.database,o=n.currentUser,s={action:t,options:r,user_id:o.id,token:X.generate()},u=a.use({by:this}),e.next=5,u.start();case 5:return i=e.sent,e.abrupt("return",u.saveOne({table:"task"},s));case 7:case"end":return e.stop()}},e,this)}));return e}()},{key:"publishStory",value:function(){function e(){return t.apply(this,arguments)}var t=(0,m.default)(c.default.mark(function e(){var t,r,n,a,o,s,u,i,d,l,f,m,p,h,v,g;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.props,r=t.env,n=t.authors,a=t.repos,o=t.isStationary,s=t.currentUser,u=this.state,i=u.draft,d=u.options,l=u.publishing,!l){e.next=4;break}return e.abrupt("return");case 4:return this.setState({publishing:!0}),e.prev=5,i=x.default.clone(i),i.type||(i.type="post"),f=x.default.map(n,"role_ids"),i.role_ids=x.default.uniq(x.default.flatten(f)),i.published=!0,m=i.details.resources,e.next=14,$.attachMosaic(m,r);case 14:return e.next=16,this.saveStory(i,!0);case 16:return p=e.sent,e.next=19,this.sendBookmarks(p,d.bookmarkRecipients);case 19:if(h=H.extractIssueDetails(i,a),v=d.issueDetails,x.default.isEqual(v,h)){e.next=27;break}if(!v){e.next=27;break}return g=x.default.clone(v),g.story_id=p.id,e.next=27,this.sendTask("export-issue",g);case 27:return e.prev=27,this.setState({publishing:!1}),e.finish(27);case 30:case"end":return e.stop()}},e,this,[[5,,27,30]])}));return e}()}]),t}(R.PureComponent));Ie.displayName="StoryEditor";var Be={localeCode:"",issueDetails:null,hidePost:!1,bookmarkRecipients:[],preview:""};Ie.defaultProps={isStationary:!1},t.default=Ie,t.StoryEditor=Ie},"./editors/story-editor.scss":function(e,t){},"./editors/video-editor.jsx":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=e.duration;return s.default.createElement(i.default,e,s.default.createElement("div",{className:"video-duration"},l.default.format(t)))}Object.defineProperty(t,"__esModule",{value:!0}),t.VideoEditor=t.default=void 0;var o=r("../../common/node_modules/react/index.js"),s=n(o),u=r("./editors/image-editor.jsx"),i=n(u),d=r("./widgets/duration-indicator.jsx"),l=n(d);r("./editors/video-editor.scss"),t.default=a,t.VideoEditor=a},"./editors/video-editor.scss":function(e,t){},"./lists/bookmark-list.jsx":function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.BookmarkListSync=t.BookmarkList=t.default=void 0;var o=r("../../common/node_modules/babel-runtime/regenerator/index.js"),s=a(o),u=r("../../common/node_modules/babel-runtime/helpers/asyncToGenerator.js"),i=a(u),d=r("../../common/node_modules/babel-runtime/core-js/object/get-prototype-of.js"),l=a(d),c=r("../../common/node_modules/babel-runtime/helpers/classCallCheck.js"),f=a(c),m=r("../../common/node_modules/babel-runtime/helpers/createClass.js"),p=a(m),h=r("../../common/node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),v=a(h),g=r("../../common/node_modules/babel-runtime/helpers/inherits.js"),b=a(g),y=r("../../common/node_modules/lodash/lodash.js"),D=a(y),k=r("../../common/node_modules/bluebird/js/browser/bluebird.js"),C=(a(k),r("../../common/node_modules/react/index.js")),E=a(C),w=r("../../common/node_modules/relaks/index.js"),x=r("../../common/src/utils/memoize.js"),j=r("../../common/src/data/merger.js"),_=(a(j),r("../../common/src/objects/finders/user-finder.js")),R=n(_),S=r("../../common/src/objects/finders/story-finder.js"),F=n(S),I=r("../../common/src/objects/finders/repo-finder.js"),B=n(I),A=r("../../common/src/objects/finders/bookmark-finder.js"),N=n(A),P=r("../../common/src/objects/finders/reaction-finder.js"),T=n(P),M=r("../../common/src/widgets/smart-list.jsx"),L=a(M),U=r("./views/bookmark-view.jsx"),O=a(U),V=r("./views/story-view.jsx"),z=a(V),W=r("./editors/story-editor.jsx"),H=a(W),q=r("./widgets/new-items-alert.jsx"),$=a(q),G=r("../../common/src/widgets/error-boundary.jsx"),Y=a(G);r("./lists/bookmark-list.scss");var K=r("../../common/src/data/database.js"),X=(a(K),r("../../common/src/transport/payloads.js")),J=(a(X),r("../../common/src/routing/route.js")),Z=(a(J),r("../../common/src/env/environment.js")),Q=(a(Z),function(e){function t(){return(0,f.default)(this,t),(0,v.default)(this,(t.__proto__||(0,l.default)(t)).apply(this,arguments))}return(0,b.default)(t,e),(0,p.default)(t,[{key:"renderAsync",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,i.default)(s.default.mark(function e(t){var r,n,a,o,u,i,d,l,c,f,m,p,h,v,g,b,y;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.props,n=r.database,a=r.route,o=r.payloads,u=r.env,i=this.props,d=i.access,l=i.bookmarks,c=i.currentUser,f=i.project,m=this.props,p=m.highlightStoryID,h=m.scrollToStoryID,v=n.use({by:this}),g={access:d,bookmarks:l,currentUser:c,project:f,highlightStoryID:p,scrollToStoryID:h,database:n,route:a,payloads:o,env:u},t.show(E.default.createElement(ee,g)),e.next=8,v.start();case 8:return b=e.sent,e.next=11,B.findProjectRepos(v,g.project);case 11:return g.repos=e.sent,e.next=14,F.findStoriesOfBookmarks(v,g.bookmarks,g.currentUser);case 14:return g.stories=e.sent,t.show(E.default.createElement(ee,g)),e.next=18,F.findDraftStories(v,g.currentUser);case 18:return g.draftStories=e.sent,t.show(E.default.createElement(ee,g)),y=D.default.filter(D.default.concat(g.draftStories,g.stories)),e.next=23,R.findStoryAuthors(v,y);case 23:return g.authors=e.sent,t.show(E.default.createElement(ee,g)),e.next=27,R.findBookmarkSenders(v,g.bookmarks);case 27:return g.senders=e.sent,t.show(E.default.createElement(ee,g)),e.next=31,T.findReactionsToStories(v,g.stories,g.currentUser);case 31:return g.reactions=e.sent,t.show(E.default.createElement(ee,g)),e.next=35,R.findReactionAuthors(v,g.reactions);case 35:return g.respondents=e.sent,t.show(E.default.createElement(ee,g)),e.next=39,N.findBookmarksByUser(v,g.currentUser);case 39:return g.recommendations=e.sent,t.show(E.default.createElement(ee,g)),e.next=43,R.findBookmarkRecipients(v,g.recommendations);case 43:return g.recipients=e.sent,e.abrupt("return",E.default.createElement(ee,g));case 45:case"end":return e.stop()}},e,this)}));return e}()}]),t}(w.AsyncComponent));Q.displayName="BookmarkList";var ee=function(e){function t(e){(0,f.default)(this,t);var r=(0,v.default)(this,(t.__proto__||(0,l.default)(t)).call(this,e));return r.handleBookmarkIdentity=function(e){return"story-"+e.item.story_id},r.handleBookmarkRender=function(e){var t=r.props,n=t.database,a=t.route,o=t.env,s=t.payloads,u=r.props,i=u.stories,d=u.draftStories,l=u.reactions,c=u.recommendations,f=r.props,m=f.currentUser,p=f.authors,h=f.senders,v=f.recipients,g=f.respondents,b=r.props,y=b.repos,k=b.access,C=b.highlightStoryID,w=e.item,x=ne(i,w),j=!1,_=!1;if(x){if("read-write"===k)if(x.published){var R=D.default.find(d,{published_version_id:x.id});R&&(x=R,j=!0)}else j=!0;_=x.id===C}var S=void 0;if(j||e.needed){S={highlighting:_,bookmark:w,senders:se(h,w),currentUser:m,database:n,route:a,env:o}}if(j){var F=oe(p,x),I=ie(c,x),B=de(v,c);x||(p=te(m));var A={story:x,authors:F,recommendations:I,recipients:B,currentUser:m,database:n,payloads:s,route:a,env:o};return E.default.createElement(Y.default,{env:o},E.default.createElement(O.default,S,E.default.createElement(H.default,A)))}if(e.needed){var N=ae(l,x),P=oe(p,x),T=ue(g,N),M=ie(c,x),L=de(v,c),U={access:k,story:x,bookmark:w,reactions:N,authors:P,respondents:T,recommendations:M,recipients:L,repos:y,currentUser:m,database:n,payloads:s,route:a,env:o,onEdit:r.handleStoryEdit};return E.default.createElement(Y.default,{env:o},E.default.createElement(O.default,S,E.default.createElement(z.default,U)))}var V=e.previousHeight||e.estimatedHeight||100;return E.default.createElement("div",{className:"bookmark-view",style:{height:V}})},r.handleBookmarkAnchorChange=function(e){r.reanchorAtStory(e.item?e.item.story_id:void 0)},r.handleBookmarkBeforeAnchor=function(e){var t=D.default.map(e.items,"story_id");r.setState({hiddenStoryIDs:t})},r.handleNewBookmarkAlertClick=function(e){r.setState({hiddenStoryIDs:[]})},r.handleStoryEdit=function(e){var t=r.props.highlightStoryID;e.target.props.story.id===t&&r.reanchorAtStory(t)},r.state={hiddenStoryIDs:[]},r}return(0,b.default)(t,e),(0,p.default)(t,[{key:"render",value:function(){var e=this.props,t=e.bookmarks,r=e.stories,n=e.highlightStoryID,a=e.scrollToStoryID,o=n||a;t=re(t,r);var s={items:t,behind:4,ahead:8,anchor:o?"story-"+o:void 0,offset:20,onIdentity:this.handleBookmarkIdentity,onRender:this.handleBookmarkRender,onAnchorChange:this.handleBookmarkAnchorChange,onBeforeAnchor:this.handleBookmarkBeforeAnchor};return E.default.createElement("div",{className:"bookmark-list"},E.default.createElement(L.default,s),this.renderNewStoryAlert())}},{key:"renderNewStoryAlert",value:function(){var e=this.props,t=e.route,r=e.env,n=this.state.hiddenStoryIDs,a=r.locale.t,o=D.default.size(n),s=void 0;D.default.isEmpty(n)||(s=t.find(t.name,{highlightingStory:D.default.first(n)}));var u={url:s,onClick:this.handleNewBookmarkAlertClick};return E.default.createElement($.default,u,a("alert-$count-new-bookmarks",o))}},{key:"reanchorAtStory",value:function(e){var t=this.props.route,r={scrollToStoryID:e,highlightStoryID:void 0};t.reanchor(r)}}]),t}(C.PureComponent);ee.displayName="BookmarkListSync";var te=(0,x.memoizeWeak)([],function(e){return[e]}),re=(0,x.memoizeWeak)(null,function(e,t){return e=D.default.filter(e,function(e){return D.default.find(t,{id:e.story_id})}),D.default.orderBy(e,["id"],["desc"])}),ne=(0,x.memoizeWeak)(null,function(e,t){if(t)return D.default.find(e,{id:t.story_id})}),ae=(0,x.memoizeWeak)(null,function(e,t){if(t)return D.default.filter(e,{story_id:t.id})}),oe=(0,x.memoizeWeak)(null,function(e,t){if(t)return D.default.filter(D.default.map(t.user_ids,function(t){return D.default.find(e,{id:t})}))}),se=oe,ue=(0,x.memoizeWeak)(null,function(e,t){var r=D.default.uniq(D.default.map(t,"user_id"));return D.default.filter(D.default.map(r,function(t){return D.default.find(e,{id:t})}))}),ie=(0,x.memoizeWeak)(null,function(e,t){if(t){var r=t.published_version_id||t.id;return D.default.filter(e,{story_id:r})}}),de=(0,x.memoizeWeak)(null,function(e,t){return D.default.filter(e,function(e){return D.default.some(t,{target_user_id:e.id})})});t.default=Q,t.BookmarkList=Q,t.BookmarkListSync=ee},"./lists/bookmark-list.scss":function(e,t){},"./lists/reaction-list.jsx":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.ReactionList=t.default=void 0;var a=r("../../common/node_modules/babel-runtime/helpers/extends.js"),o=n(a),s=r("../../common/node_modules/babel-runtime/core-js/object/get-prototype-of.js"),u=n(s),i=r("../../common/node_modules/babel-runtime/helpers/classCallCheck.js"),d=n(i),l=r("../../common/node_modules/babel-runtime/helpers/createClass.js"),c=n(l),f=r("../../common/node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),m=n(f),p=r("../../common/node_modules/babel-runtime/helpers/inherits.js"),h=n(p),v=r("../../common/node_modules/lodash/lodash.js"),g=n(v),b=r("../../common/node_modules/react/index.js"),y=n(b),D=r("../../common/src/utils/memoize.js"),k=r("../../common/src/data/merger.js"),C=(n(k),r("./views/reaction-view.jsx")),E=n(C),w=r("./editors/reaction-editor.jsx"),x=n(w),j=r("../../common/src/widgets/smart-list.jsx"),_=n(j),R=r("../../common/src/widgets/error-boundary.jsx"),S=n(R);r("./lists/reaction-list.scss");var F=r("../../common/src/data/database.js"),I=(n(F),r("../../common/src/transport/payloads.js")),B=(n(I),r("../../common/src/routing/route.js")),A=(n(B),r("../../common/src/env/environment.js")),N=(n(A),function(e){function t(e){(0,d.default)(this,t);var r=(0,m.default)(this,(t.__proto__||(0,u.default)(t)).call(this,e));return P.call(r),r.state={hiddenReactionIDs:[]},r}return(0,h.default)(t,e),(0,c.default)(t,[{key:"render",value:function(){var e=this.props,t=e.reactions,r=e.currentUser,n=this.props,a=n.highlightReactionID,o=n.scrollToReactionID,s=o||a,u={items:T(t,r),behind:5,ahead:10,anchor:s?"reaction-"+s:void 0,offset:4,inverted:!0,fresh:!1,noReset:!0,onIdentity:this.handleReactionIdentity,onTransition:this.handleReactionTransition,onRender:this.handleReactionRender,onBeforeAnchor:this.handleReactionBeforeAnchor};return y.default.createElement("div",{className:"reaction-list"},y.default.createElement(_.default,u))}}]),t}(b.PureComponent));N.displayName="ReactionList";var P=function(){var e=this;this.handleReactionIdentity=function(t){if(!t.alternative)return"reaction-"+t.item.id;var r=e.props.database,n={table:"reaction"},a=r.findTemporaryID(n,t.item.id);return a?"reaction-"+a:void 0},this.handleReactionTransition=function(e){return!(e.item.id<1)},this.handleReactionRender=function(t){var r=e.props,n=r.database,a=r.route,s=r.payloads,u=r.env,i=e.props,d=i.currentUser,l=i.story,c=i.respondents,f=i.repo,m=e.props,p=m.access,h=m.highlightReactionID,v=e.props.onFinish,g=t.item,b=!1,D=!1,k=!1;if(g?(g.published||g.user_id===d.id&&(b=!0,g.ptime||(D=!0)),g.id===h&&(k=!0)):(b=!0,D=!0),b){var C=D?0:g.id,w={reaction:g,story:l,currentUser:d,database:n,payloads:s,route:a,env:u,onFinish:v};return y.default.createElement(S.default,{env:u},y.default.createElement(x.default,(0,o.default)({key:C},w)))}var j=M(c,g),_={access:p,highlighting:k,reaction:g,respondent:j,story:l,repo:f,currentUser:d,database:n,route:a,env:u};return y.default.createElement(S.default,{env:u},y.default.createElement(E.default,(0,o.default)({key:g.id},_)))},this.handleReactionBeforeAnchor=function(t){var r=g.default.map(t.items,"id");e.setState({hiddenReactionIDs:r})}},T=(0,D.memoizeWeak)(null,function(e,t){var r=g.default.orderBy(e,["ptime","id"],["desc","desc"]),n=g.default.remove(r,{user_id:t,ptime:null});return g.default.each(n,function(e){r.unshift(e)}),r}),M=(0,D.memoizeWeak)(null,function(e,t){if(t)return g.default.find(e,{id:t.user_id})});t.default=N,t.ReactionList=N},"./lists/reaction-list.scss":function(e,t){},"./pages/bookmarks-page.jsx":function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.BookmarksPageSync=t.BookmarksPage=t.default=void 0;var o=r("../../common/node_modules/babel-runtime/regenerator/index.js"),s=a(o),u=r("../../common/node_modules/babel-runtime/helpers/asyncToGenerator.js"),i=a(u),d=r("../../common/node_modules/babel-runtime/core-js/object/get-prototype-of.js"),l=a(d),c=r("../../common/node_modules/babel-runtime/helpers/classCallCheck.js"),f=a(c),m=r("../../common/node_modules/babel-runtime/helpers/createClass.js"),p=a(m),h=r("../../common/node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),v=a(h),g=r("../../common/node_modules/babel-runtime/helpers/inherits.js"),b=a(g),y=r("../../common/node_modules/lodash/lodash.js"),D=a(y),k=r("../../common/node_modules/react/index.js"),C=a(k),E=r("../../common/node_modules/relaks/index.js"),w=r("../../common/src/objects/finders/user-finder.js"),x=n(w),j=r("../../common/src/objects/finders/bookmark-finder.js"),_=n(j),R=r("../../common/src/objects/finders/project-finder.js"),S=n(R),F=r("../../common/src/objects/utils/project-utils.js"),I=n(F),B=r("./widgets/page-container.jsx"),A=a(B),N=r("./lists/bookmark-list.jsx"),P=a(N),T=r("./widgets/loading-animation.jsx"),M=a(T),L=r("./widgets/empty-message.jsx"),U=a(L);r("./pages/bookmarks-page.scss");var O=r("../../common/src/data/database.js"),V=(a(O),r("../../common/src/transport/payloads.js")),z=(a(V),r("../../common/src/routing/route.js")),W=(a(z),r("../../common/src/env/environment.js")),H=(a(W),function(e){function t(){return(0,f.default)(this,t),(0,v.default)(this,(t.__proto__||(0,l.default)(t)).apply(this,arguments))}return(0,b.default)(t,e),(0,p.default)(t,[{key:"renderAsync",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,i.default)(s.default.mark(function e(t){var r,n,a,o,u,i,d,l,c,f;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.props,n=r.database,a=r.route,o=r.env,u=r.payloads,i=r.highlightStoryID,d=r.scrollToStoryID,l=n.use({by:this}),c={highlightStoryID:i,scrollToStoryID:d,database:n,route:a,payloads:u,env:o},t.show(C.default.createElement(q,c)),e.next=6,l.start();case 6:return f=e.sent,e.next=9,x.findUser(l,f);case 9:return c.currentUser=e.sent,e.next=12,S.findCurrentProject(l);case 12:return c.project=e.sent,e.next=15,_.findBookmarksForUser(l,c.currentUser);case 15:return c.bookmarks=e.sent,e.abrupt("return",C.default.createElement(q,c));case 17:case"end":return e.stop()}},e,this)}));return e}()}]),t}(E.AsyncComponent));H.displayName="BookmarksPage";var q=function(e){function t(){return(0,f.default)(this,t),(0,v.default)(this,(t.__proto__||(0,l.default)(t)).apply(this,arguments))}return(0,b.default)(t,e),(0,p.default)(t,[{key:"getAccessLevel",value:function(){var e=this.props,t=e.project,r=e.currentUser;return I.getUserAccessLevel(t,r)||"read-only"}},{key:"render",value:function(){return C.default.createElement(A.default,{className:"bookmarks-page"},this.renderList(),this.renderEmptyMessage())}},{key:"renderList",value:function(){var e=this.props,t=e.database,r=e.route,n=e.env,a=e.payloads,o=e.bookmarks,s=e.currentUser,u=e.project,i=e.highlightStoryID,d=e.scrollToStoryID,l={access:this.getAccessLevel(),bookmarks:o,currentUser:s,project:u,highlightStoryID:i,scrollToStoryID:d,database:t,payloads:a,route:r,env:n};return C.default.createElement(P.default,l)}},{key:"renderEmptyMessage",value:function(){var e=this.props,t=e.env,r=e.bookmarks;if(!D.default.isEmpty(r))return null;if(r){var n={phrase:"bookmarks-no-bookmarks",env:t};return C.default.createElement(U.default,n)}return C.default.createElement(M.default,null)}}]),t}(k.PureComponent);q.displayName="BookmarksPageSync",t.default=H,t.BookmarksPage=H,t.BookmarksPageSync=q},"./pages/bookmarks-page.scss":function(e,t){},"./views/app-component.jsx":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.AppComponent=t.default=void 0;var a=r("../../common/node_modules/babel-runtime/core-js/object/get-prototype-of.js"),o=n(a),s=r("../../common/node_modules/babel-runtime/helpers/classCallCheck.js"),u=n(s),i=r("../../common/node_modules/babel-runtime/helpers/createClass.js"),d=n(i),l=r("../../common/node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),c=n(l),f=r("../../common/node_modules/babel-runtime/helpers/inherits.js"),m=n(f),p=r("../../common/node_modules/lodash/lodash.js"),h=(n(p),r("../../common/node_modules/react/index.js")),v=n(h),g=r("../../common/node_modules/mark-gor/react.js"),b=n(g),y=r("../../common/src/widgets/resource-view.jsx"),D=n(y);r("./views/app-component.scss");var k=r("../../common/src/env/environment.js"),C=(n(k),function(e){function t(){var e,r,n,a;(0,u.default)(this,t);for(var s=arguments.length,i=Array(s),d=0;d<s;d++)i[d]=arguments[d];return r=n=(0,c.default)(this,(e=t.__proto__||(0,o.default)(t)).call.apply(e,[this].concat(i))),n.handleClick=function(e){var t=n.props,r=t.component,a=t.onSelect;a&&a({type:"select",target:n,component:r})},a=r,(0,c.default)(n,a)}return(0,m.default)(t,e),(0,d.default)(t,[{key:"render",value:function(){return v.default.createElement("div",{className:"app-component",onClick:this.handleClick},this.renderPicture(),this.renderText())}},{key:"renderPicture",value:function(){var e=this.props,t=e.env,r=e.component;if(r.image)return v.default.createElement("div",{className:"picture"},v.default.createElement(D.default,{resource:r.image,height:64,env:t}));var n=r.icon||{},a=n.class||"fa-cubes",o={color:n.color,backgroundColor:n.backgroundColor};return v.default.createElement("div",{className:"picture"},v.default.createElement("div",{className:"icon",style:o},v.default.createElement("i",{className:"fa fa-fw "+a})))}},{key:"renderText",value:function(){var e=this.props,t=e.env,r=e.component,n=r.text,a=t.locale.p,o=b.default.parse(a(n));return v.default.createElement("div",{className:"description"},v.default.createElement("div",{className:"description-contents"},o,v.default.createElement("div",{className:"ellipsis"},v.default.createElement("i",{className:"fa fa-ellipsis-h"}))))}}]),t}(h.PureComponent));C.displayName="AppComponent",t.default=C,t.AppComponent=C},"./views/app-component.scss":function(e,t){},"./views/bookmark-view.jsx":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.BookmarkView=t.default=void 0;var a=r("../../common/node_modules/babel-runtime/helpers/extends.js"),o=n(a),s=r("../../common/node_modules/babel-runtime/core-js/object/get-prototype-of.js"),u=n(s),i=r("../../common/node_modules/babel-runtime/helpers/classCallCheck.js"),d=n(i),l=r("../../common/node_modules/babel-runtime/helpers/createClass.js"),c=n(l),f=r("../../common/node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),m=n(f),p=r("../../common/node_modules/babel-runtime/helpers/inherits.js"),h=n(p),v=r("../../common/node_modules/lodash/lodash.js"),g=n(v),b=r("../../common/node_modules/react/index.js"),y=n(b),D=r("../../common/src/objects/utils/user-utils.js"),k=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(D),C=r("./widgets/multiple-user-names.jsx"),E=n(C);r("./views/bookmark-view.scss");var w=r("../../common/src/data/database.js"),x=(n(w),r("../../common/src/routing/route.js")),j=(n(x),r("../../common/src/env/environment.js")),_=(n(j),function(e){function t(){return(0,d.default)(this,t),(0,m.default)(this,(t.__proto__||(0,u.default)(t)).apply(this,arguments))}return(0,h.default)(t,e),(0,c.default)(t,[{key:"render",value:function(){var e=this.props,t=e.highlighting,r=e.children,n="bookmark-view";return t&&(n+=" highlighting"),y.default.createElement("div",{className:n},y.default.createElement("div",{className:"title"},this.renderSenderNames()),y.default.createElement("div",{className:"story"},r))}},{key:"renderSenderNames",value:function(){var e=this.props,t=e.env,r=e.senders,n=e.currentUser,a=t.locale,s=a.t,u=a.g,i=g.default.some(r,{id:n.id}),d=g.default.filter(r,function(e){return e.id!==n.id}),l=void 0;if(i){var c=k.getDisplayName(n,t);if(u(c,n.details.gender),0===d.length)l=s("bookmark-$you-bookmarked-it",c);else if(1===d.length){var f=d[0],m=k.getDisplayName(f,t);u(m,f.details.gender),l=s("bookmark-$you-bookmarked-it-and-$name-recommends-it",c,m)}else{var p={users:d,label:s("bookmark-$count-users",d.length),title:s("bookmark-recommendations"),env:t},h=y.default.createElement(E.default,(0,o.default)({key:1},p));l=s("bookmark-$you-bookmarked-it-and-$others-recommends-it",c,h,d.length)}}else if(0===d.length)l="";else if(1===d.length){var v=k.getDisplayName(d[0],t);u(v,d[0].details.gender),l=s("bookmark-$name-recommends-this",v)}else if(2===d.length){var b=k.getDisplayName(d[0],t),D=k.getDisplayName(d[1],t);u(b,d[0].details.gender),u(D,d[1].details.gender),l=s("bookmark-$name1-and-$name2-recommend-this",b,D)}else{var C=k.getDisplayName(d[0],t),w=g.default.slice(d,1),x={users:w,label:s("bookmark-$count-other-users",w.length),title:s("bookmark-recommendations"),env:t},j=y.default.createElement(E.default,(0,o.default)({key:1},x));u(C,d[0].details.gender),l=s("bookmark-$name1-and-$name2-recommend-this",C,j)}return y.default.createElement("span",{className:"name"},l)}}]),t}(b.PureComponent));_.displayName="BookmarkView",t.default=_,t.BookmarkView=_},"./views/bookmark-view.scss":function(e,t){},"./views/media-view.jsx":function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e){return y.default.first(y.default.keys(e.versions))||null}Object.defineProperty(t,"__esModule",{value:!0}),t.MediaView=t.default=void 0;var s=r("../../common/node_modules/babel-runtime/core-js/promise.js"),u=a(s),i=r("../../common/node_modules/babel-runtime/core-js/object/get-prototype-of.js"),d=a(i),l=r("../../common/node_modules/babel-runtime/helpers/classCallCheck.js"),c=a(l),f=r("../../common/node_modules/babel-runtime/helpers/createClass.js"),m=a(f),p=r("../../common/node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),h=a(p),v=r("../../common/node_modules/babel-runtime/helpers/inherits.js"),g=a(v),b=r("../../common/node_modules/lodash/lodash.js"),y=a(b),D=r("../../common/node_modules/react/index.js"),k=a(D),C=r("../../common/src/transport/http-request.js"),E=(a(C),r("../../common/src/utils/memoize.js")),w=r("../../common/src/utils/component-refs.js"),x=a(w),j=r("../../common/src/transport/payload.js"),_=(a(j),r("../../common/src/objects/utils/resource-utils.js")),R=n(_),S=r("../../common/src/media/image-cropping.js"),F=(n(S),r("../../common/src/widgets/overlay.jsx")),I=(a(F),r("./widgets/media-button.jsx")),B=a(I),A=r("./dialogs/media-dialog-box.jsx"),N=a(A),P=r("../../common/src/widgets/resource-view.jsx"),T=a(P),M=r("./widgets/duration-indicator.jsx"),L=a(M);r("./views/media-view.scss");var U=r("../../common/src/env/environment.js"),O=(a(U),function(e){function t(e){(0,c.default)(this,t);var r=(0,h.default)(this,(t.__proto__||(0,d.default)(t)).call(this,e));return r.handleBackwardClick=function(e){var t=r.state.selectedIndex;return r.selectResource(t-1)},r.handleForwardClick=function(e){var t=r.state.selectedIndex;return r.selectResource(t+1)},r.handleImageClick=function(e){r.setState({showingDialogBox:!0})},r.handleVideoClick=function(e){r.pauseAudio(),r.setState({showingDialogBox:!0})},r.handleAudioClick=function(e){var t=r.props,n=t.env,a=t.resources,s=r.state,u=s.selectedIndex;if(s.audioURL)r.setState({audioURL:null});else{u>a.length-1&&(u=a.length-1);var i=a[u],d=o(i),l=R.getAudioURL(i,{version:d},n);r.setState({audioURL:l})}},r.handleAudioEnded=function(e){r.setState({audioURL:null})},r.handleDialogClose=function(e){r.setState({showingDialogBox:!1})},r.components=(0,x.default)({audioPlayer:HTMLAudioElement}),r.state={selectedIndex:0,showingDialogBox:!1,audioURL:null},r}return(0,g.default)(t,e),(0,m.default)(t,[{key:"selectResource",value:function(e){var t=this,r=this.props.resources;return new u.default(function(n,a){e<0?e=0:e>r.length-1&&(e=r.length-1),t.setState({selectedIndex:e},function(){n(e)})})}},{key:"render",value:function(){return k.default.createElement("div",{className:"media-view"},k.default.createElement("div",{className:"container"},this.renderResource(),this.renderNavigation(),this.renderAudioPlayer(),this.renderDialogBox()))}},{key:"renderNavigation",value:function(){var e=this.props.resources,t=this.state.selectedIndex;if(e.length<=1)return null;t>e.length-1&&(t=e.length-1);var r={index:t,count:e.length,onBackwardClick:this.handleBackwardClick,onForwardClick:this.handleForwardClick};return k.default.createElement("div",{className:"navigation"},k.default.createElement("div",{className:"right"},k.default.createElement(B.default.Direction,r)))}},{key:"renderAudioPlayer",value:function(){var e=this.components.setters,t=this.state.audioURL;if(!t)return null;var r={ref:e.audioPlayer,src:t,autoPlay:!0,controls:!0,onEnded:this.handleAudioEnded};return k.default.createElement("audio",r)}},{key:"renderDialogBox",value:function(){var e=this.props,t=e.env,r=e.resources,n=this.state,a=n.showingDialogBox,o=n.selectedIndex;o>r.length-1&&(o=r.length-1);var s=r[o];if(!s)return null;var u=V(r),i=y.default.indexOf(u,s),d={show:a,resources:u,selectedIndex:i,env:t,onClose:this.handleDialogClose};return k.default.createElement(N.default,d)}},{key:"renderResource",value:function(){var e=this.props.resources,t=this.state.selectedIndex;t>e.length-1&&(t=e.length-1);var r=e[t];if(!r)return null;switch(r.type){case"image":return this.renderImage(r,t);case"video":return this.renderVideo(r,t);case"audio":return this.renderAudio(r,t);case"website":return this.renderWebsite(r,t)}}},{key:"renderImage",value:function(e,t){return k.default.createElement("div",{key:t,className:"image",onClick:this.handleImageClick},this.renderImageElement(e))}},{key:"renderVideo",value:function(e,t){var r="video",n=this.renderImageElement(e);return n||(r+=" posterless"),k.default.createElement("div",{key:t,className:r,onClick:this.handleVideoClick},n,k.default.createElement("div",{className:"overlay"},k.default.createElement("div",{className:"icon"},k.default.createElement("i",{className:"fa fa-play-circle-o"})),k.default.createElement("div",{className:"duration"},L.default.format(e.duration))))}},{key:"renderAudio",value:function(e,t){var r=this.state.audioURL,n="audio",a=this.renderImageElement(e);a||(n+=" posterless");var o=r?"stop":"play";return k.default.createElement("div",{key:t,className:n,onClick:this.handleAudioClick},a,k.default.createElement("div",{className:"overlay"},k.default.createElement("div",{className:"icon"},k.default.createElement("i",{className:"fa fa-"+o+"-circle"})),k.default.createElement("div",{className:"duration"},L.default.format(e.duration))))}},{key:"renderWebsite",value:function(e,t){return k.default.createElement("div",{key:t,className:"website"},k.default.createElement("a",{href:e.url,target:"_blank"},this.renderImageElement(e),k.default.createElement("div",{className:"overlay hidden"},k.default.createElement("div",{className:"icon"},k.default.createElement("i",{className:"fa fa-external-link"})))))}},{key:"renderImageElement",value:function(e){var t=this.props,r=t.env,n=t.width;if(!R.getImageURL(e,{original:!0},r))return null;var a={resource:e,width:n,height:n,showMosaic:!0,env:r};return k.default.createElement(T.default,a)}},{key:"pauseAudio",value:function(){var e=this.components.audioPlayer;e&&e.pause()}}]),t}(D.PureComponent));O.displayName="MediaView";var V=(0,E.memoizeWeak)(null,function(e){return y.default.filter(e,function(e){switch(e.type){case"image":case"video":return!0}})});t.default=O,t.MediaView=O},"./views/media-view.scss":function(e,t){},"./views/reaction-view-options.jsx":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.ReactionViewOptions=t.default=void 0;var a=r("../../common/node_modules/babel-runtime/core-js/object/get-prototype-of.js"),o=n(a),s=r("../../common/node_modules/babel-runtime/helpers/classCallCheck.js"),u=n(s),i=r("../../common/node_modules/babel-runtime/helpers/createClass.js"),d=n(i),l=r("../../common/node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),c=n(l),f=r("../../common/node_modules/babel-runtime/helpers/inherits.js"),m=n(f),p=r("../../common/node_modules/lodash/lodash.js"),h=n(p),v=r("../../common/node_modules/moment/moment.js"),g=(n(v),r("../../common/node_modules/react/index.js")),b=n(g),y=r("../../common/src/utils/component-refs.js"),D=n(y),k=r("../../common/src/objects/utils/user-utils.js"),C=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(k),E=r("./widgets/pop-up-menu.jsx"),w=n(E),x=r("./widgets/option-button.jsx"),j=n(x);r("./views/reaction-view-options.scss");var _=r("../../common/src/env/environment.js"),R=(n(_),function(e){function t(e){(0,u.default)(this,t);var r=(0,c.default)(this,(t.__proto__||(0,o.default)(t)).call(this,e));return r.handleOpen=function(e){r.setState({open:!0})},r.handleClose=function(e){r.setState({open:!1})},r.handleHideClick=function(e){var t=r.props.options;t=h.default.clone(t),t.hideReaction=!t.hideReaction,r.triggerChangeEvent(t)},r.handleEditClick=function(e){var t=r.props.options;t=h.default.clone(t),t.editReaction=!0,r.triggerChangeEvent(t)},r.handleRemoveClick=function(e){var t=r.props.options;t=h.default.clone(t),t.removeReaction=!0,r.triggerChangeEvent(t)},r.components=(0,D.default)({popUpMenu:w.default}),r.state={open:!1},r}return(0,m.default)(t,e),(0,d.default)(t,[{key:"close",value:function(){var e=this.components.popUpMenu;this.setState({open:!1}),e.close()}},{key:"render",value:function(){var e=this.props,t=e.reaction,r=e.story,n=e.currentUser,a=e.access,o=this.components.setters,s=!1;C.canHideReaction(n,r,t,a)&&(s=!0),C.canEditReaction(n,r,t,a)&&(s=!0),C.canRemoveReaction(n,r,t,a)&&(s=!0);var u={ref:o.popUpMenu,className:"reaction-view-options",disabled:!s,popOut:!0,onOpen:this.handleOpen,onClose:this.handleClose};return b.default.createElement(w.default,u,b.default.createElement("button",null,b.default.createElement("i",{className:"fa fa-ellipsis-v"})),b.default.createElement("menu",null,this.renderOptions()))}},{key:"renderOptions",value:function(){var e=this.props,t=e.env,r=e.options,n=e.reaction,a=e.story,o=e.currentUser,s=e.access,u=this.state.open,i=t.locale.t;if(!u)return null;var d={label:i("option-hide-comment"),hidden:!C.canHideReaction(o,a,n,s),selected:r.hideReaction,onClick:this.handleHideClick},l={label:i("option-edit-comment"),hidden:!C.canEditReaction(o,a,n,s),selected:r.editReaction,onClick:this.handleEditClick},c={label:i("option-remove-comment"),hidden:!C.canRemoveReaction(o,a,n,s),selected:r.removeReaction,onClick:this.handleRemoveClick};return b.default.createElement("div",{className:"view-options in-menu"},b.default.createElement(j.default,d),b.default.createElement(j.default,l),b.default.createElement(j.default,c))}},{key:"triggerChangeEvent",value:function(e){var t=this.props.onChange;t&&t({type:"change",target:this,options:e})}}]),t}(g.PureComponent));R.displayName="ReactionViewOptions",t.default=R,t.ReactionViewOptions=R},"./views/reaction-view-options.scss":function(e,t){},"./views/reaction-view.jsx":function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e){return k.default.first(k.default.keys(e.versions))||null}Object.defineProperty(t,"__esModule",{value:!0}),t.ReactionView=t.default=void 0;var s=r("../../common/node_modules/babel-runtime/regenerator/index.js"),u=a(s),i=r("../../common/node_modules/babel-runtime/helpers/asyncToGenerator.js"),d=a(i),l=r("../../common/node_modules/babel-runtime/core-js/object/get-prototype-of.js"),c=a(l),f=r("../../common/node_modules/babel-runtime/helpers/classCallCheck.js"),m=a(f),p=r("../../common/node_modules/babel-runtime/helpers/createClass.js"),h=a(p),v=r("../../common/node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),g=a(v),b=r("../../common/node_modules/babel-runtime/helpers/inherits.js"),y=a(b),D=r("../../common/node_modules/lodash/lodash.js"),k=a(D),C=r("../../common/node_modules/react/index.js"),E=a(C),w=r("../../common/src/utils/markdown.js"),x=n(w),j=r("../../common/src/utils/plain-text.js"),_=n(j),R=r("../../common/src/utils/memoize.js"),S=r("../../common/src/utils/component-refs.js"),F=a(S),I=r("../../common/src/objects/utils/external-data-utils.js"),B=(n(I),r("../../common/src/objects/utils/user-utils.js")),A=n(B),N=r("../../common/src/objects/utils/repo-utils.js"),P=n(N),T=r("../../common/src/objects/utils/resource-utils.js"),M=n(T),L=r("./widgets/profile-image.jsx"),U=a(L),O=r("./views/media-view.jsx"),V=a(O),z=r("./dialogs/media-dialog-box.jsx"),W=a(z),H=r("./widgets/reaction-progress.jsx"),q=a(H),$=r("./widgets/time.jsx"),G=(a($),r("./views/reaction-view-options.jsx")),Y=a(G);r("./views/reaction-view.scss");var K=r("../../common/src/data/database.js"),X=(a(K),r("../../common/src/routing/route.js")),J=(a(X),r("../../common/src/env/environment.js")),Z=(a(J),function(e){function t(e){(0,m.default)(this,t);var r=(0,g.default)(this,(t.__proto__||(0,c.default)(t)).call(this,e));return r.handleReference=function(e){var t=r.props,n=t.env,a=t.reaction,o=k.default.get(a,"details.resources"),s=x.findReferencedResource(o,e.name);if(s){k.default.includes(r.resourcesReferenced,s)||r.resourcesReferenced.push(s);return{href:M.getMarkdownIconURL(s,e.forImage,n),title:e.name}}},r.handleMarkdownClick=function(e){e.preventDefault();var t=r.props,n=t.env,a=t.reaction,s=r.state.audioURL,u=k.default.get(a,"details.resources"),i=e.target;i.viewportElement&&(i=i.viewportElement);var d=void 0;if("svg"===i.tagName){var l=i.getElementsByTagName("title")[0];l&&(d=l.textContent)}else d=e.target.title;if(d){var c=x.findReferencedResource(u,d);if(c)if("image"===c.type||"video"===c.type)r.setState({selectedResourceName:d,showingReferencedMedia:!0});else if("website"===c.type)window.open(c.url,"_blank");else if("audio"===c.type){var f=o(c),m=M.getAudioURL(c,{version:f},n);s=m===s?null:m,r.setState({audioURL:s})}}else if("A"===i.tagName)window.open(i.href,"_blank");else if("IMG"===i.tagName){var p=(i.getAttribute("src"),i.getBoundingClientRect()),h=i.naturalWidth+50,v=i.naturalHeight+50,g=p.left+window.screenLeft,b=p.top+window.screenTop;window.open(i.src,"_blank","width="+h+",height="+v+",left="+g+",top="+b+"status=no,menubar=no")}},r.handleReferencedMediaDialogClose=function(e){r.setState({showingReferencedMedia:!1})},r.handleOptionsChange=function(e){var t=r.components.optionsButton;r.setOptions(e.options),t.close()},r.handleAudioEnded=function(e){r.setState({audioURL:null})},r.components=(0,F.default)({optionsButton:Y.default,audioPlayer:HTMLAudioElement}),r.state={options:Q,selectedResourceName:null,showingReferencedMedia:!1,audioURL:null},r.updateOptions(r.state,r.props),r}return(0,y.default)(t,e),(0,h.default)(t,[{key:"getClassName",value:function(){var e=this.props.highlighting,t="reaction-view";return e&&(t+=" highlighting"),t}},{key:"componentWillReceiveProps",value:function(e){var t=this.props.reaction,r=k.default.clone(this.state);e.reaction!==t&&this.updateOptions(r,e);var n=k.default.shallowDiff(r,this.state);k.default.isEmpty(n)||this.setState(n)}},{key:"updateOptions",value:function(e,t){(e.options=k.default.clone(e.options)).hideReaction=!t.reaction.public}},{key:"render",value:function(){return E.default.createElement("div",{className:this.getClassName()},E.default.createElement("div",{className:"profile-image-column"},this.renderProfileImage()),E.default.createElement("div",{className:"contents-column"},E.default.createElement("div",{className:"text"},this.renderOptionButton(),this.renderProgress(),this.renderText(),this.renderReferencedMediaDialog()),this.renderAudioPlayer(),this.renderMedia()))}},{key:"renderProfileImage",value:function(){var e=this.props,t=e.env,r=e.route,n=e.respondent,a={user:n,size:"small",env:t};return n&&(a.href=r.find("person-page",{selectedUserID:n.id})),E.default.createElement(U.default,a)}},{key:"renderText",value:function(){var e=this.props,t=e.env,r=e.reaction,n=e.respondent,a=e.story,o=e.currentUser,s=e.repo,u=t.locale,i=u.t,d=u.p,l=u.g,c=r.details,f=c.text,m=c.markdown,p=A.getDisplayName(n,t);if(l(p,A.getGender(n)),this.resourcesReferenced=[],!r.published||!1===r.ready){var h=void 0;return h=r.published?"reaction-$name-is-sending":r.ptime?"reaction-$name-is-editing":"reaction-$name-is-writing",E.default.createElement("span",{className:"in-progress"},i(h,p))}var v=void 0,g=void 0;switch(r.type){case"like":return E.default.createElement("span",{className:"like"},i("reaction-$name-likes-this",p));case"comment":var b=d(f);if(m){var y=x.render(b,this.handleReference);return y[0]&&"p"===y[0].type&&(y[0]=E.default.createElement("span",{key:0},y[0].props.children)),E.default.createElement("span",{className:"comment markdown",onClick:this.handleMarkdownClick},p,": ",y)}return E.default.createElement("span",{className:"comment"},p,": ",_.renderEmoji(b));case"vote":return E.default.createElement("span",{className:"vote"},i("reaction-$name-cast-a-vote",p));case"task-completion":return E.default.createElement("span",{className:"task-completion"},i("reaction-$name-completed-a-task",p));case"note":if(A.canAccessRepo(o,s)){switch(a.type){case"push":case"merge":v=P.getCommitNoteURL(s,r);break;case"issue":v=P.getIssueNoteURL(s,r);break;case"merge-request":v=P.getMergeRequestNoteURL(s,r)}g=s.type}return E.default.createElement("a",{className:"note",href:v,target:g},i("reaction-$name-commented-on-"+a.type,p));case"assignment":if("issue"===a.type||"post"===a.type)return A.canAccessRepo(o,s)&&(v=P.getIssueNoteURL(s,r),g=s.type),E.default.createElement("a",{className:"issue-assignment",href:v,target:g},i("reaction-$name-is-assigned-to-issue",p));if("merge-request"===a.type)return A.canAccessRepo(o,s)&&(v=P.getMergeRequestNoteURL(s,r),g=s.type),E.default.createElement("a",{className:"issue-assignment",href:v,target:g},i("reaction-$name-is-assigned-to-merge-request",p));case"tracking":return A.canAccessRepo(o,s)&&(v=P.getIssueNoteURL(s,r),g=s.type),E.default.createElement("a",{className:"issue-tracking",href:v,target:g},i("reaction-$name-added-story-to-issue-tracker",p))}}},{key:"renderOptionButton",value:function(){var e=this.props,t=e.env,r=e.reaction,n=e.story,a=e.currentUser,o=e.access,s=this.state.options,u=this.components.setters;if(!r.published)return null;var i={ref:u.optionsButton,access:o,currentUser:a,reaction:r,story:n,env:t,options:s,onChange:this.handleOptionsChange};return E.default.createElement(Y.default,i)}},{key:"renderProgress",value:function(){var e=this.props,t=e.env,r=e.reaction;if(!r.published)return null;var n={reaction:r,env:t};return E.default.createElement(q.default,n)}},{key:"renderAudioPlayer",value:function(){var e=this.state.audioURL,t=this.components.setters;if(!e)return null;var r={ref:t.audioPlayer,src:e,autoPlay:!0,controls:!0,onEnded:this.handleAudioEnded};return E.default.createElement("audio",r)}},{key:"renderMedia",value:function(){var e=this.props,t=e.env,r=e.reaction,n=k.default.get(r,"details.resources");if(k.default.isEmpty(this.resourcesReferenced)||(n=k.default.difference(n,this.resourcesReferenced)),k.default.isEmpty(n))return null;var a={resources:n,width:t.isWiderThan("double-col")?300:220,env:t};return E.default.createElement("div",{className:"media"},E.default.createElement(V.default,a))}},{key:"renderReferencedMediaDialog",value:function(){var e=this.props,t=e.env,r=e.reaction,n=this.state,a=n.showingReferencedMedia,o=n.selectedResourceName,s=k.default.get(r,"details.resources"),u=x.findReferencedResource(s,o);if(!u)return null;var i=ee(this.resourcesReferenced),d=k.default.indexOf(i,u);if(-1===d)return null;var l={show:a,resources:i,selectedIndex:d,env:t,onClose:this.handleReferencedMediaDialogClose};return E.default.createElement(W.default,l)}},{key:"saveReaction",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,d.default)(u.default.mark(function e(t){var r,n,a;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.props.database,n=r.use({by:this}),e.next=4,n.start();case 4:return a=e.sent,e.abrupt("return",n.saveOne({table:"reaction"},t));case 6:case"end":return e.stop()}},e,this)}));return e}()},{key:"removeReaction",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,d.default)(u.default.mark(function e(t){var r,n,a;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.props.database,n=r.use({by:this}),e.next=4,n.start();case 4:return a=e.sent,e.abrupt("return",n.removeOne({table:"reaction"},t));case 6:case"end":return e.stop()}},e,this)}));return e}()},{key:"setOptions",value:function(e){var t=this,r=this.props.reaction,n=this.state.options;this.setState({options:e},function(){e.editReaction&&!n.editReaction&&(r=k.default.clone(r),r.published=!1,t.saveReaction(r)),e.removeReaction&&!n.removeReaction&&t.removeReaction(r),e.hideReaction!==n.hideReaction&&(r=k.default.clone(r),r.public=!e.hideReaction,t.saveReaction(r))})}}]),t}(C.PureComponent));Z.displayName="ReactionView";var Q={hideReaction:!1,editReaction:!1,removeReaction:!1},ee=(0,R.memoizeWeak)(null,function(e){return k.default.filter(e,function(e){switch(e.type){case"image":case"video":return!0}})});t.default=Z,t.ReactionView=Z},"./views/reaction-view.scss":function(e,t){},"./views/story-contents.jsx":function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e){return y.default.first(y.default.keys(e.versions))||null}Object.defineProperty(t,"__esModule",{value:!0}),t.StoryContents=t.default=void 0;var s=r("../../common/node_modules/babel-runtime/helpers/extends.js"),u=a(s),i=r("../../common/node_modules/babel-runtime/core-js/object/get-prototype-of.js"),d=a(i),l=r("../../common/node_modules/babel-runtime/helpers/classCallCheck.js"),c=a(l),f=r("../../common/node_modules/babel-runtime/helpers/createClass.js"),m=a(f),p=r("../../common/node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),h=a(p),v=r("../../common/node_modules/babel-runtime/helpers/inherits.js"),g=a(v),b=r("../../common/node_modules/lodash/lodash.js"),y=a(b),D=r("../../common/node_modules/moment/moment.js"),k=(a(D),r("../../common/node_modules/react/index.js")),C=a(k),E=r("../../common/src/utils/memoize.js"),w=r("../../common/src/utils/list-parser.js"),x=n(w),j=r("../../common/src/utils/markdown.js"),_=n(j),R=r("../../common/src/utils/plain-text.js"),S=n(R),F=r("../../common/src/utils/component-refs.js"),I=a(F),B=r("../../common/src/objects/utils/external-data-utils.js"),A=(n(B),r("../../common/src/objects/utils/user-utils.js")),N=n(A),P=r("../../common/src/objects/utils/repo-utils.js"),T=n(P),M=r("../../common/src/objects/utils/resource-utils.js"),L=n(M),U=r("../../common/src/transport/payload.js"),O=(a(U),r("./views/media-view.jsx")),V=a(O),z=r("./dialogs/media-dialog-box.jsx"),W=a(z),H=r("./views/app-component.jsx"),q=a(H),$=r("./dialogs/app-component-dialog-box.jsx"),G=a($),Y=r("./widgets/scrollable.jsx"),K=a(Y),X=r("./widgets/push-button.jsx"),J=a(X);r("./views/story-contents.scss");var Z=r("../../common/src/env/environment.js"),Q=(a(Z),function(e){function t(e){(0,c.default)(this,t);var r=(0,h.default)(this,(t.__proto__||(0,d.default)(t)).call(this,e));return r.handleReference=function(e){var t=r.props,n=t.env,a=t.story,o=y.default.get(a,"details.resources"),s=_.findReferencedResource(o,e.name);if(s){y.default.includes(r.resourcesReferenced,s)||r.resourcesReferenced.push(s);return{href:L.getMarkdownIconURL(s,e.forImage,n),title:e.name}}},r.handleMarkdownClick=function(e){"INPUT"!==e.target.tagName&&e.preventDefault();var t=r.props,n=t.env,a=t.story,s=r.state.audioURL,u=y.default.get(a,"details.resources"),i=e.target;i.viewportElement&&(i=i.viewportElement);var d=void 0;if("svg"===i.tagName){var l=i.getElementsByTagName("title")[0];l&&(d=l.textContent)}else d=e.target.title;if(d){var c=_.findReferencedResource(u,d);if(c)if("image"===c.type||"video"===c.type)r.setState({selectedResourceName:d,showingReferencedMedia:!0});else if("website"===c.type)window.open(c.url,"_blank");else if("audio"===c.type){var f=o(c),m=L.getAudioURL(c,{version:f},n);s=m===s?null:m,r.setState({audioURL:s})}}else if("A"===i.tagName)window.open(i.href,"_blank");else if("IMG"===i.tagName){var p=(i.getAttribute("src"),i.getBoundingClientRect()),h=i.naturalWidth+50,v=i.naturalHeight+50,g=p.left+window.screenLeft,b=p.top+window.screenTop;window.open(i.src,"_blank","width="+h+",height="+v+",left="+g+",top="+b+"status=no,menubar=no")}},r.handleTaskListItemChange=function(e){var t=r.props,n=t.story,a=t.reactions,o=t.currentUser,s=r.state.userAnswers,u=e.currentTarget,i=parseInt(u.name),d=parseInt(u.value),l=u.checked;s=y.default.decoupleSet(s,[i,d],l),r.setState({userAnswers:s}),n=y.default.cloneDeep(n);var c=[];n.details.text=y.default.mapValues(n.details.text,function(e){var t=x.extract(e);x.set(t,i,d,l);var r=x.count(t,!1);return c.push(r),x.join(t)}),n.unfinished_tasks=y.default.max(c),r.triggerChangeEvent(n);var f={list:i,item:d};if(l){var m={type:"task-completion",story_id:n.id,user_id:o.id,published:!0,public:!0,details:{task:f}};r.triggerReactionEvent(m)}else{var p=y.default.find(a,function(e){if("task-completion"===e.type&&e.user_id===o.id)return y.default.isEqual(e.details.task,f)});p&&(p=y.default.clone(p),p.deleted=!0,r.triggerReactionEvent(p))}},r.handleSurveyItemChange=function(e){var t=r.state.userAnswers,n=e.currentTarget,a=n.name,o=n.value;t=y.default.decoupleSet(t,[a],o),r.setState({userAnswers:t})},r.handleVoteSubmitClick=function(e){var t=r.props,n=t.story,a=t.currentUser,o=r.state.userAnswers,s={type:"vote",story_id:n.id,user_id:a.id,published:!0,public:!0,details:{answers:o}};r.triggerReactionEvent(s),r.setState({voteSubmitted:!0})},r.handleComponentSelect=function(e){r.setState({showingComponent:!0,selectedComponent:e.component})},r.handleComponentDialogClose=function(e){r.setState({showingComponent:!1})},r.handleReferencedMediaDialogClose=function(e){r.setState({showingReferencedMedia:!1})},r.handleAudioEnded=function(e){r.setState({audioURL:null})},r.components=(0,I.default)({audioPlayer:HTMLAudioElement}),r.state={voteSubmitted:!1,selectedComponent:null,showingComponent:!1,selectedResourceName:null,showingReferencedMedia:!1,audioURL:null},r.updateUserAnswers(r.state,e),r}return(0,g.default)(t,e),(0,m.default)(t,[{key:"componentWillReceiveProps",value:function(e){var t=this.props.story,r=y.default.clone(this.state);e.story!==t&&this.updateUserAnswers(r,e);var n=y.default.shallowDiff(r,this.state);y.default.isEmpty(n)||this.setState(n)}},{key:"updateUserAnswers",value:function(e,t){var r=t.env,n=t.story,a=r.locale.p;if(n)if("survey"===n.type){var o=a(n.details.text),s=x.extract(o),u=e.userAnswers;y.default.each(s,function(e,t){y.default.each(e,function(e,t){e.checked&&(u&&void 0!==u[e.list]||(u=y.default.decoupleSet(u,[e.list],e.key)))})}),e.userAnswers=u}else"task-list"===n.type&&(e.userAnswers=null)}},{key:"hasUserVoted",value:function(){var e=this.props,t=e.reactions,r=e.currentUser;if(void 0!==t){return!!te(t,r)}}},{key:"canUserVote",value:function(){return"read-write"===this.props.access}},{key:"componentDidUpdate",value:function(e){var t=this.props,r=t.reactions,n=t.currentUser,a=this.state.voteSubmitted;if(e.reactions!==r&&a){te(r,n)&&this.setState({voteSubmitted:!1})}}},{key:"render",value:function(){return C.default.createElement("div",{className:"story-contents"},this.renderText(),this.renderAudioPlayer(),this.renderMedia(),this.renderReferencedMediaDialog(),this.renderAppComponents(),this.renderButtons())}},{key:"renderText",value:function(){var e=this.props.story,t=e.details.exported;switch(this.resourcesReferenced=[],e.type){case"post":return this.renderStoryText();case"task-list":return this.renderTaskListText();case"survey":return this.renderSurveyText();case"repo":return this.renderRepoText();case"member":return this.renderMemberText();case"push":case"merge":return this.renderPushText();case"branch":case"tag":return this.renderBranchText();case"issue":return t?this.renderStoryText():this.renderIssueText();case"merge-request":return this.renderMergeRequestText();case"milestone":return this.renderMilestoneText();case"wiki":return this.renderWikiText()}}},{key:"renderStoryText",value:function(){var e=this.props,t=e.env,r=e.story,n=t.locale.p,a=r.details,o=a.text,s=a.markdown,u=a.labels,i=y.default.trimEnd(n(o)),d=void 0;if(u&&(d=this.renderLabels()),!i&&!d)return null;if(s)return C.default.createElement("div",{className:"text story markdown",onClick:this.handleMarkdownClick},_.render(i,this.handleReference),d);var l="text story plain-text",c=S.findEmoji(i),f=y.default.replace(i,/\s+/g,"");return c&&y.default.join(c,"")===f&&(l+=" emoji-"+c.length),C.default.createElement("div",{className:l},C.default.createElement("p",null,S.renderEmoji(i)),d)}},{key:"renderTaskListText",value:function(){var e=this.props,t=e.env,r=e.story,n=e.currentUser,a=this.state.userAnswers,o=t.locale.p,s=r.details,u=s.text,i=s.markdown,d=y.default.trimEnd(o(u));if(!d)return null;var l=y.default.includes(r.user_ids,n.id)?this.handleTaskListItemChange:null,c=this.handleReference;if(i){var f=_.renderTaskList(d,a,l,c);return C.default.createElement("div",{className:"text task-list markdown",onClick:this.handleMarkdownClick},f)}var m=S.renderTaskList(d,a,l);return C.default.createElement("div",{className:"text task-list plain-text"},C.default.createElement("p",null,m))}},{key:"renderSurveyText",value:function(){var e=this.props,t=e.env,r=e.story,n=e.reactions,a=this.state.userAnswers,o=t.locale.p,s=r.details,u=s.text,i=s.markdown,d=y.default.trimEnd(o(u));if(!d)return null;var l=this.handleSurveyItemChange,c=this.handleReference;if(this.canUserVote()&&!this.hasUserVoted()){if(i){var f=_.renderSurvey(d,a,l,c);return C.default.createElement("div",{className:"text survey markdown",onClick:this.handleMarkdownClick},f)}var m=S.renderSurvey(d,a,l);return C.default.createElement("div",{className:"text survey plain-text"},C.default.createElement("p",null,m))}var p=ee(n)||{};if(i){var h=_.renderSurveyResults(d,p,c);return C.default.createElement("div",{className:"text survey markdown",onClick:this.handleMarkdownClick},h)}var v=S.renderSurveyResults(d,p);return C.default.createElement("div",{className:"text survey plain-text"},C.default.createElement("p",null,v))}},{key:"renderRepoText",value:function(){var e=this.props,t=e.env,r=e.story,n=e.authors,a=e.currentUser,o=e.repo,s=t.locale,u=s.t,i=(s.p,s.g),d=r.details.action,l=N.getDisplayName(n?n[0]:null,t);i(l,N.getGender(n?n[0]:null));var c=T.getDisplayName(o,t),f=void 0,m=void 0;return N.canAccessRepo(a,o)&&(f=T.getURL(o),m=o.type),C.default.createElement("div",{className:"text repo"},C.default.createElement("p",null,C.default.createElement("a",{href:f,target:m},u("story-$name-"+d+"-$repo",l,c))))}},{key:"renderMemberText",value:function(){var e=this.props,t=e.env,r=e.story,n=e.authors,a=e.currentUser,o=e.repo,s=t.locale,u=s.t,i=(s.p,s.g),d=r.details.action,l=N.getDisplayName(n?n[0]:null,t);i(l,N.getGender(n?n[0]:null));var c=T.getDisplayName(o,t),f=void 0,m=void 0;return N.canAccessRepo(a,o)&&(f=T.getMembershipPageURL(o),m=o.type),C.default.createElement("div",{className:"text member"},C.default.createElement("p",null,C.default.createElement("a",{href:f,target:m},u("story-$name-"+d+"-$repo",l,c))))}},{key:"renderIssueText",value:function(){var e=this.props,t=e.env,r=e.story,n=e.authors,a=e.currentUser,o=e.repo,s=t.locale,u=s.t,i=s.p,d=s.g,l=r.details.title,c=N.getDisplayName(n?n[0]:null,t);d(c,N.getGender(n?n[0]:null));var f=T.getIssueNumber(o,r),m=void 0,p=void 0;return N.canAccessRepo(a,o)&&(m=T.getIssueURL(o,r),p=o.type),C.default.createElement("div",{className:"text issue"},C.default.createElement("p",null,C.default.createElement("a",{href:m,target:p},u("story-$name-opened-issue-$number-$title",c,f,i(l)))),this.renderStatus(),this.renderLabels())}},{key:"renderMilestoneText",value:function(){var e=this.props,t=e.env,r=e.story,n=e.authors,a=e.repo,o=e.currentUser,s=t.locale,u=s.t,i=s.p,d=s.g,l=r.details.title,c=N.getDisplayName(n?n[0]:null,t);d(c,N.getGender(n?n[0]:null));var f=void 0,m=void 0;return N.canAccessRepo(o,a)&&(f=T.getMilestoneURL(a,r),m=a.type),C.default.createElement("div",{className:"text milestone"},C.default.createElement("p",null,C.default.createElement("a",{href:f,target:m},u("story-$name-created-$milestone",c,i(l)))))}},{key:"renderMergeRequestText",value:function(){var e=this.props,t=e.env,r=e.story,n=e.authors,a=e.repo,o=e.currentUser,s=t.locale,u=s.t,i=(s.p,s.g),d=r.details,l=d.source_branch,c=d.branch,f=N.getDisplayName(n?n[0]:null,t);i(f,N.getGender(n?n[0]:null));var m=void 0,p=void 0;return N.canAccessRepo(o,a)&&(m=T.getMergeRequestURL(a,r),p=a.type),C.default.createElement("div",{className:"text merge-request"},C.default.createElement("p",null,C.default.createElement("a",{href:m,target:p},u("story-$name-requested-merge-$branch1-into-$branch2",f,l,c))),this.renderStatus(),this.renderLabels())}},{key:"renderWikiText",value:function(){var e=this.props,t=e.env,r=e.story,n=e.authors,a=e.currentUser,o=e.repo,s=t.locale,u=s.t,i=(s.p,s.g),d=r.details,l=d.action,c=d.title,f=N.getDisplayName(n?n[0]:null,t);i(f,N.getGender(n?n[0]:null)),c=y.default.capitalize(c);var m=void 0,p=void 0;return N.canAccessRepo(a,o)&&"delete"!==l&&(m=r.details.url,p=o.type),C.default.createElement("div",{className:"text wiki"},C.default.createElement("p",null,C.default.createElement("a",{href:m,target:p},u("story-$name-"+l+"d-$page",f,c))))}},{key:"renderPushText",value:function(){var e=this.props,t=e.env,r=e.story,n=e.authors,a=e.currentUser,o=e.repo,s=t.locale,u=s.t,i=s.g,d=r.details,l=d.comment_ids,c=d.branch,f=d.from_branches,m=N.getDisplayName(n?n[0]:null,t);i(m,N.getGender(n?n[0]:null));var p=(y.default.size(l),T.getDisplayName(o,t)),h=void 0,v=void 0;N.canAccessRepo(a,o)&&(h=T.getPushURL(o,r),v=o.type);var g=void 0;return"push"===r.type?g=u("story-$name-pushed-to-$branch-of-$repo",m,c,p):"merge"===r.type&&(g=u("story-$name-merged-$branches-into-$branch-of-$repo",m,f,c,p)),C.default.createElement("div",{className:"text push"},C.default.createElement("p",null,C.default.createElement("a",{href:h,target:v},g)),this.renderChanges())}},{key:"renderBranchText",value:function(){var e=this.props,t=e.env,r=e.story,n=e.authors,a=e.currentUser,o=e.repo,s=t.locale,u=s.t,i=s.g,d=r.details.branch,l=N.getDisplayName(n?n[0]:null,t);i(l,N.getGender(n?n[0]:null));var c=T.getDisplayName(o,t),f=void 0,m=void 0;N.canAccessRepo(a,o)&&(f=T.getBranchURL(o,r),m=o.type);var p=void 0;return"branch"===r.type?p=u("story-$name-created-$branch-in-$repo",l,d,c):"tag"===r.type&&(p=u("story-$name-created-$tag-in-$repo",l,d,c)),C.default.createElement("div",{className:"text push"},C.default.createElement("p",null,C.default.createElement("a",{href:f,target:m},p)),this.renderChanges())}},{key:"renderChanges",value:function(){var e=this.props,t=e.env,r=e.story,n=t.locale.t,a=y.default.get(r,"details.files");if(y.default.isEmpty(a))return null;var o=["added","deleted","modified","renamed"],s=y.default.transform(o,function(e,t,r){var o=a[t];o>0&&e.push(C.default.createElement("li",{key:r,className:t},n("story-push-"+t+"-$count-files",o)))},[]),u=y.default.get(r,"details.lines"),i=["added","deleted","modified"],d=y.default.transform(i,function(e,t,r){var a=u[t];a>0&&e.push(C.default.createElement("li",{key:r,className:t},n("story-push-"+t+"-$count-lines",a)))},[]);return C.default.createElement("div",null,C.default.createElement("ul",{className:"files"},s),C.default.createElement("ul",{className:"lines"},d))}},{key:"renderStatus",value:function(){var e=this.props,t=e.env,r=e.story,n=t.locale.t,a=r.details.state;return a?C.default.createElement("p",{className:"status-"+a},C.default.createElement("span",null,n("story-issue-current-status"))," ",C.default.createElement("span",null,n("story-issue-status-"+a))):null}},{key:"renderLabels",value:function(){var e=this.props,t=e.story,r=e.repo,n=t.details.labels;if(y.default.isEmpty(n))return null;for(var a=y.default.map(n,function(e,t){var n=T.getLabelStyle(r,e);return C.default.createElement("span",{key:t,className:"tag",style:n},e)}),o=1;o<a.length;o+=2)a.splice(o,0," ");return C.default.createElement("p",{className:"tags"},a)}},{key:"renderButtons",value:function(){var e=this.props,t=e.env,r=e.story,n=this.state,a=n.voteSubmitted,o=n.userAnswers,s=t.locale.t;if("survey"!==r.type)return null;if(!this.canUserVote())return null;if(!1!==this.hasUserVoted())return null;var u={label:s("story-vote-submit"),emphasized:!y.default.isEmpty(o),disabled:a||y.default.isEmpty(o),onClick:this.handleVoteSubmitClick};return C.default.createElement("div",{className:"buttons"},C.default.createElement(J.default,u))}},{key:"renderAudioPlayer",value:function(){var e=this.state.audioURL,t=this.components.setters;if(!e)return null;var r={ref:t.audioPlayer,src:e,autoPlay:!0,controls:!0,onEnded:this.handleAudioEnded};return C.default.createElement("audio",r)}},{key:"renderMedia",value:function(){var e=this.props,t=e.env,r=e.story,n=y.default.get(r,"details.resources");if(y.default.isEmpty(this.resourcesReferenced)||(n=y.default.difference(n,this.resourcesReferenced)),y.default.isEmpty(n))return null;var a={resources:n,width:Math.min(512,t.viewportWidth),env:t};return C.default.createElement(V.default,a)}},{key:"renderReferencedMediaDialog",value:function(){var e=this.props,t=e.env,r=e.story,n=this.state,a=n.showingReferencedMedia,o=n.selectedResourceName,s=y.default.get(r,"details.resources"),u=_.findReferencedResource(s,o);if(!u)return null;var i=re(this.resourcesReferenced),d=y.default.indexOf(i,u);if(-1===d)return null;var l={show:a,resources:i,selectedIndex:d,env:t,onClose:this.handleReferencedMediaDialogClose};return C.default.createElement(W.default,l)}},{key:"renderAppComponents",value:function(){var e=this,t=this.props,r=t.env,n=t.story,a=r.locale.t,o=y.default.get(n,"details.components");return y.default.isEmpty(o)?null:(o=ne(o,r),C.default.createElement("div",{className:"impact"},C.default.createElement("p",{className:"message"},a("story-push-components-changed")),C.default.createElement(K.default,null,y.default.map(o,function(t,r){return e.renderAppComponent(t,r)})),this.renderAppComponentDialog()))}},{key:"renderAppComponent",value:function(e,t){var r=this.props.env,n={component:e,env:r,onSelect:this.handleComponentSelect};return C.default.createElement(q.default,(0,u.default)({key:t},n))}},{key:"renderAppComponentDialog",value:function(){var e=this.props.env,t=this.state,r=t.showingComponent,n=t.selectedComponent,a={show:r,component:n,env:e,onClose:this.handleComponentDialogClose};return C.default.createElement(G.default,a)}},{key:"triggerChangeEvent",value:function(e){var t=this.props.onChange;t&&t({type:"change",target:this,story:e})}},{key:"triggerReactionEvent",value:function(e){var t=this.props.onReaction;t&&t({type:"reaction",target:this,reaction:e})}}]),t}(k.PureComponent));Q.displayName="StoryContents";var ee=(0,E.memoizeWeak)(null,function(e){var t={};return y.default.each(e,function(e){"vote"===e.type&&y.default.forIn(e.details.answers,function(e,r){var n=[r,"total"],a=y.default.get(t,n,0)+1;y.default.set(t,n,a);var o=[r,"answers",e],s=y.default.get(t,o,0)+1;y.default.set(t,o,s)})}),t}),te=(0,E.memoizeWeak)(null,function(e,t){if(t)return y.default.find(e,{type:"vote",user_id:t.id})}),re=(0,E.memoizeWeak)(null,function(e){return y.default.filter(e,function(e){switch(e.type){case"image":case"video":return!0}})}),ne=(0,E.memoizeWeak)(null,function(e,t){var r=t.locale.p;return y.default.sortBy(e,function(e){return y.default.toLower(r(e.text))})});t.default=Q,t.StoryContents=Q},"./views/story-contents.scss":function(e,t){},"./views/story-view-options.jsx":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.StoryViewOptions=t.default=void 0;var a=r("../../common/node_modules/babel-runtime/core-js/object/get-prototype-of.js"),o=n(a),s=r("../../common/node_modules/babel-runtime/helpers/classCallCheck.js"),u=n(s),i=r("../../common/node_modules/babel-runtime/helpers/createClass.js"),d=n(i),l=r("../../common/node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),c=n(l),f=r("../../common/node_modules/babel-runtime/helpers/inherits.js"),m=n(f),p=r("../../common/node_modules/lodash/lodash.js"),h=n(p),v=r("../../common/node_modules/react/index.js"),g=n(v),b=r("../../common/src/objects/utils/user-utils.js"),y=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(b),D=r("./widgets/option-button.jsx"),k=n(D),C=r("./dialogs/user-selection-dialog-box.jsx"),E=n(C),w=r("./dialogs/issue-dialog-box.jsx"),x=n(w);r("./views/story-view-options.scss");var j=r("../../common/src/data/database.js"),_=(n(j),r("../../common/src/routing/route.js")),R=(n(_),r("../../common/src/env/environment.js")),S=(n(R),function(e){function t(e){(0,u.default)(this,t);var r=(0,c.default)(this,(t.__proto__||(0,o.default)(t)).call(this,e));return r.handleAddBookmarkClick=function(e){var t=r.props,n=t.options,a=t.currentUser;n=h.default.clone(n),h.default.includes(n.bookmarkRecipients,a.id)?n.bookmarkRecipients=h.default.without(n.bookmarkRecipients,a.id):n.bookmarkRecipients=h.default.concat(n.bookmarkRecipients||[],a.id),r.triggerChangeEvent(n),r.triggerCompleteEvent()},r.handleKeepBookmarkClick=function(e){var t=r.props.options;t=h.default.clone(t),t.keepBookmark=!1,r.triggerChangeEvent(t),r.triggerCompleteEvent()},r.handleSendBookmarkClick=function(e){r.openSelectionDialogBox(e)},r.handleAddIssueClick=function(e){r.openIssueDialogBox(e)},r.handleHideClick=function(e){var t=r.props.options;t=h.default.clone(t),t.hideStory=!t.hideStory,r.triggerChangeEvent(t),r.triggerCompleteEvent()},r.handleEditClick=function(e){var t=r.props.options;t=h.default.clone(t),t.editStory=!0,r.triggerChangeEvent(t),r.triggerCompleteEvent()},r.handleRemoveClick=function(e){var t=r.props.options;t=h.default.clone(t),t.removeStory=!0,r.triggerChangeEvent(t),r.triggerCompleteEvent()},r.handleBumpClick=function(e){var t=r.props.options;t=h.default.clone(t),t.bumpStory=!0,r.triggerChangeEvent(t),r.triggerCompleteEvent()},r.handleRecipientsSelect=function(e){var t=r.props.options;t=h.default.clone(t),t.bookmarkRecipients=e.selection,r.triggerChangeEvent(t),r.triggerCompleteEvent(),r.closeSelectionDialogBox()},r.handleRecipientsCancel=function(e){r.triggerCompleteEvent(),r.closeSelectionDialogBox()},r.handleIssueConfirm=function(e){var t=r.props.options;t=h.default.clone(t),t.issueDetails=e.issue,r.triggerChangeEvent(t),r.triggerCompleteEvent(),r.closeIssueDialogBox()},r.handleIssueCancel=function(e){r.triggerCompleteEvent(),r.closeIssueDialogBox()},r.state={selectingRecipients:!1,enteringIssueDetails:!1},r}return(0,m.default)(t,e),(0,d.default)(t,[{key:"render",value:function(){var e=this.props.env;e.locale.t;return g.default.createElement("div",{className:"story-view-options"},this.renderButtons("main"))}},{key:"renderButtons",value:function(e){var t=this.props,r=t.env,n=t.story,a=t.currentUser,o=t.repos,s=t.options,u=t.access,i=this.state,d=i.selectingRecipients,l=i.enteringIssueDetails,c=r.locale.t;if("main"===e){var f=void 0;f=void 0===s.keepBookmark?{label:c("option-add-bookmark"),selected:!!a&&h.default.includes(s.bookmarkRecipients,a.id),hidden:!y.canCreateBookmark(a,n,u),onClick:this.handleAddBookmarkClick}:{label:c("option-keep-bookmark"),selected:s.keepBookmark,onClick:this.handleKeepBookmarkClick};var m=a?h.default.without(s.bookmarkRecipients,a.id):[],p={label:h.default.isEmpty(m)?c("option-send-bookmarks"):c("option-send-bookmarks-to-$count-users",h.default.size(m)),hidden:!y.canSendBookmarks(a,n,u),selected:!h.default.isEmpty(m)||d,onClick:this.handleSendBookmarkClick},v={label:c("option-add-issue"),hidden:!y.canAddIssue(a,n,o,u),selected:!!s.issueDetails||l,onClick:this.handleAddIssueClick},b={label:c("option-hide-story"),hidden:!y.canHideStory(a,n,u),selected:s.hideStory,onClick:this.handleHideClick},D={label:c("option-edit-post"),hidden:!y.canEditStory(a,n,u),selected:s.editStory,onClick:this.handleEditClick},C={label:c("option-remove-story"),hidden:!y.canRemoveStory(a,n,u),selected:s.removeStory,onClick:this.handleRemoveClick},E={label:c("option-bump-story"),hidden:!y.canBumpStory(a,n,u),selected:s.bumpStory,onClick:this.handleBumpClick};return g.default.createElement("div",{className:e},g.default.createElement(k.default,f),g.default.createElement(k.default,p),g.default.createElement(k.default,v),g.default.createElement(k.default,b),g.default.createElement(k.default,D),g.default.createElement(k.default,C),g.default.createElement(k.default,E),this.renderRecipientDialogBox(),this.renderIssueDialogBox())}}},{key:"renderRecipientDialogBox",value:function(){var e=this.props,t=e.database,r=e.route,n=e.env,a=e.options,o=this.state.selectingRecipients,s={show:o,selection:a.bookmarkRecipients,database:t,route:r,env:n,onSelect:this.handleRecipientsSelect,onCancel:this.handleRecipientsCancel};return g.default.createElement(E.default,s)}},{key:"renderIssueDialogBox",value:function(){var e=this.props,t=e.env,r=e.currentUser,n=e.story,a=e.reactions,o=e.repos,s=e.options,u=this.state.enteringIssueDetails,i={show:u,allowDeletion:!h.default.some(a,{type:"assignment "}),currentUser:r,story:n,issue:s.issueDetails,repos:o,env:t,onConfirm:this.handleIssueConfirm,onCancel:this.handleIssueCancel};return g.default.createElement(x.default,i)}},{key:"triggerChangeEvent",value:function(e){var t=this.props.onChange;t&&t({type:"change",target:this,options:e})}},{key:"triggerCompleteEvent",value:function(){var e=this.props.onComplete;e&&e({type:"complete",target:this})}},{key:"openSelectionDialogBox",value:function(e){this.setState({selectingRecipients:!0})}},{key:"closeSelectionDialogBox",value:function(){this.setState({selectingRecipients:!1})}},{key:"openIssueDialogBox",value:function(e){this.setState({enteringIssueDetails:!0})}},{key:"closeIssueDialogBox",value:function(){this.setState({enteringIssueDetails:!1})}}]),t}(v.PureComponent));S.displayName="StoryViewOptions",S.defaultProps={section:"both"},t.default=S,t.StoryViewOptions=S},"./views/story-view-options.scss":function(e,t){},"./views/story-view.jsx":function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.StoryView=t.default=void 0;var o=r("../../common/node_modules/babel-runtime/core-js/get-iterator.js"),s=a(o),u=r("../../common/node_modules/babel-runtime/regenerator/index.js"),i=a(u),d=r("../../common/node_modules/babel-runtime/helpers/asyncToGenerator.js"),l=a(d),c=r("../../common/node_modules/babel-runtime/helpers/extends.js"),f=a(c),m=r("../../common/node_modules/babel-runtime/core-js/object/get-prototype-of.js"),p=a(m),h=r("../../common/node_modules/babel-runtime/helpers/classCallCheck.js"),v=a(h),g=r("../../common/node_modules/babel-runtime/helpers/createClass.js"),b=a(g),y=r("../../common/node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),D=a(y),k=r("../../common/node_modules/babel-runtime/helpers/inherits.js"),C=a(k),E=r("../../common/node_modules/lodash/lodash.js"),w=a(E),x=r("../../common/node_modules/moment/moment.js"),j=a(x),_=r("../../common/node_modules/react/index.js"),R=a(_),S=r("../../common/src/utils/memoize.js"),F=r("../../common/src/utils/component-refs.js"),I=a(F),B=r("../../common/src/utils/focus-manager.js"),A=n(B),N=r("../../common/src/objects/utils/external-data-utils.js"),P=n(N),T=r("../../common/src/objects/utils/issue-utils.js"),M=n(T),L=r("../../common/src/objects/utils/story-utils.js"),U=n(L),O=r("../../common/src/utils/random-token.js"),V=n(O),z=r("./widgets/profile-image.jsx"),W=a(z),H=r("./widgets/author-names.jsx"),q=a(H),$=r("./widgets/story-progress.jsx"),G=a($),Y=r("./widgets/story-emblem.jsx"),K=a(Y),X=r("./widgets/scrollable.jsx"),J=(a(X),r("./widgets/reaction-toolbar.jsx")),Z=a(J),Q=r("./lists/reaction-list.jsx"),ee=a(Q),te=r("./widgets/header-button.jsx"),re=a(te),ne=r("./views/story-contents.jsx"),ae=a(ne),oe=r("./views/story-view-options.jsx"),se=a(oe),ue=r("./widgets/corner-pop-up.jsx"),ie=a(ue);r("./views/story-view.scss");var de=r("../../common/src/data/database.js"),le=(a(de),r("../../common/src/transport/payloads.js")),ce=(a(le),r("../../common/src/routing/route.js")),fe=(a(ce),r("../../common/src/env/environment.js")),me=(a(fe),function(e){function t(e){(0,v.default)(this,t);var r=(0,D.default)(this,(t.__proto__||(0,p.default)(t)).call(this,e));return r.handleStoryChange=function(e){r.saveStory(e.story)},r.handleStoryReaction=function(e){e.reaction.deleted?r.removeReaction(e.reaction):r.saveReaction(e.reaction)},r.handleExpansionClick=function(e){r.setState({commentsExpanded:!0})},r.handleOptionsChange=function(e){r.setOptions(e.options);var t=e.target.props.section,n=r.components[t+"PopUp"];n&&n.close()},r.handleOptionsComplete=function(e){var t=e.target.props.section,n=r.components[t+"PopUp"];n&&n.close()},r.handleAction=function(e){var t=r.props,n=t.story,a=t.reactions,o=t.currentUser,s=r.state.commentsExpanded;switch(e.action){case"like-add":var u={type:"like",story_id:n.id,user_id:o.id,details:{},published:!0,public:!0};r.saveReaction(u);break;case"like-remove":r.removeReaction(e.like);break;case"reaction-add":s||r.setState({commentsExpanded:!0});if(!w.default.some(a,{user_id:o.id,published:!1})){var i={type:"comment",story_id:n.id,user_id:o.id,details:{},published:!1,public:!0};r.saveReaction(i)}A.focus({type:"ReactionEditor",story_id:n.id,user_id:o.id});break;case"reaction-expand":r.setState({commentsExpanded:!0})}},r.components=(0,I.default)({reactionContainer:HTMLDivElement,reactionList:ee.default,mainPopUp:ie.default}),r.state={options:he,commentsExpanded:r.shouldExpandComments(e),isTall:!1},r.updateOptions(r.state,e),r}return(0,C.default)(t,e),(0,b.default)(t,[{key:"getClassName",value:function(){var e=this.props.highlighting,t="story-view";return e&&(t+=" highlighting"),t}},{key:"hasUserDraft",value:function(){var e=this.props,t=e.reactions,r=e.currentUser;return w.default.some(t,function(e){if(!e.published&&e.user_id===r.id)return!0})}},{key:"shouldExpandComments",value:function(e){var t=e.reactions,r=e.respondents,n=e.story,a=e.currentUser,o=e.selectedReactionID;if(t&&r)return!!w.default.includes(n.user_ids,a.id)||(!!w.default.some(t,{user_id:a.id})||!(!o||!w.default.some(e.reactions,{id:o})))}},{key:"componentWillReceiveProps",value:function(e){var t=this.props,r=t.story,n=t.recommendations,a=t.reactions,o=t.respondents,s=w.default.clone(this.state);e.story===r&&e.recommendations===n||this.updateOptions(s,e),e.reactions===a&&e.respondents===o||!0!==s.commentsExpanded&&this.shouldExpandComments(e)&&(s.commentsExpanded=!0);var u=w.default.shallowDiff(s,this.state);w.default.isEmpty(u)||this.setState(u)}},{key:"updateOptions",value:function(e,t){var r=e.options=w.default.clone(e.options);r.hideStory=!t.story.public,r.bookmarkRecipients=w.default.map(t.recommendations,"target_user_id"),r.issueDetails=M.extractIssueDetails(t.story,t.repos),r.keepBookmark=!!t.bookmark||void 0}},{key:"render",value:function(){var e=this.props.env;return e.isWiderThan("triple-col")?this.renderTripleColumn():e.isWiderThan("double-col")?this.renderDoubleColumn():this.renderSingleColumn()}},{key:"renderSingleColumn",value:function(){var e=this.renderReactionToolbar(),t=this.renderReactionLink(),r=!1;return(e||t)&&(r=!0,e||(e="")),R.default.createElement("div",{className:this.getClassName()},R.default.createElement("div",{className:"header"},R.default.createElement("div",{className:"column-1 padded"},this.renderProfileImage(),this.renderAuthorNames(),this.renderPopUpMenu("main"))),R.default.createElement("div",{className:"body"},R.default.createElement("div",{className:"column-1 padded"},this.renderProgress(),this.renderEmblem(),this.renderContents())),R.default.createElement("div",{className:"header"},R.default.createElement("div",{className:"column-2"+(r?" padded":"")},e,t)),R.default.createElement("div",{className:"body"},R.default.createElement("div",{className:"column-2"},this.renderReactions())))}},{key:"renderDoubleColumn",value:function(){return R.default.createElement("div",{className:this.getClassName()},R.default.createElement("div",{className:"header"},R.default.createElement("div",{className:"column-1 padded"},this.renderProfileImage(),this.renderAuthorNames(),this.renderPopUpMenu("main")),R.default.createElement("div",{className:"column-2 padded"},this.renderReactionToolbar())),R.default.createElement("div",{className:"body"},R.default.createElement("div",{className:"column-1 padded"},this.renderProgress(),this.renderEmblem(),this.renderContents()),R.default.createElement("div",{className:"column-2"},this.renderReactions())))}},{key:"renderTripleColumn",value:function(){var e=this.props.env,t=e.locale.t;return R.default.createElement("div",{className:this.getClassName()},R.default.createElement("div",{className:"header"},R.default.createElement("div",{className:"column-1 padded"},this.renderProfileImage(),this.renderAuthorNames()),R.default.createElement("div",{className:"column-2 padded"},this.renderReactionToolbar()),R.default.createElement("div",{className:"column-3 padded"},R.default.createElement(re.default,{icon:"chevron-circle-right",label:t("story-options"),disabled:!0}))),R.default.createElement("div",{className:"body"},R.default.createElement("div",{className:"column-1 padded"},this.renderProgress(),this.renderEmblem(),this.renderContents()),R.default.createElement("div",{className:"column-2"},this.renderReactions()),R.default.createElement("div",{className:"column-3 padded"},this.renderOptions())))}},{key:"renderProfileImage",value:function(){var e=this.props,t=e.route,r=e.env,n=e.authors,a=w.default.get(n,0),o={user:a,size:"medium",env:r};return a&&(o.href=t.find("person-page",{selectedUserID:a.id})),R.default.createElement(W.default,o)}},{key:"renderAuthorNames",value:function(){var e=this.props,t=e.env,r=e.authors,n={authors:r,env:t};return R.default.createElement(q.default,n)}},{key:"renderReactionToolbar",value:function(){var e=this.props,t=e.env,r=e.story,n=e.reactions,a=e.respondents,o=e.currentUser,s=e.access;if("read-comment"!==s&&"read-write"!==s)return null;var u={access:s,currentUser:o,reactions:n,respondents:a,env:t,disabled:!U.isSaved(r),onAction:this.handleAction};return R.default.createElement(Z.default,u)}},{key:"renderReactionLink",value:function(){var e=this.props,t=e.env,r=e.reactions,n=this.state.commentsExpanded,a=t.locale.t,o=w.default.size(r);return 0===o?null:n?"":R.default.createElement("span",{className:"reaction-link",onClick:this.handleExpansionClick},a("story-$count-reactions",o))}},{key:"renderProgress",value:function(){var e=this.props,t=e.payloads,r=e.env,n=e.story,a=e.pending,o=void 0;!1===n.ready&&(o=t.inquire(n));var s={status:o,story:n,pending:a,env:r};return R.default.createElement(G.default,s)}},{key:"renderEmblem",value:function(){var e=this.props.story,t={story:e};return R.default.createElement(K.default,t)}},{key:"renderContents",value:function(){var e=this.props,t=e.env,r=e.story,n=e.authors,a=e.reactions,o=e.currentUser,s=e.repos,u=e.access,i={access:u,story:r,authors:n,currentUser:o,reactions:a,repo:ve(s,r),env:t,onChange:this.handleStoryChange,onReaction:this.handleStoryReaction};return R.default.createElement(ae.default,i)}},{key:"renderReactions",value:function(){var e=this.props,t=e.database,r=e.route,n=e.payloads,a=e.env,o=e.story,s=(e.authors,e.reactions),u=e.respondents,i=e.currentUser,d=e.repos,l=e.access,c=e.highlightReactionID,m=e.scrollToReactionID,p=this.state,h=p.commentsExpanded,v=p.isTall,g=this.components.setters;if(w.default.isEmpty(s))return null;if(!a.isWiderThan("double-col")&&!h)return null;var b={access:l,story:o,reactions:s,respondents:u,repo:ve(d,o),currentUser:i,database:t,payloads:n,route:r,env:a,highlightReactionID:c,scrollToReactionID:m},y="scrollable";return v&&a.isWiderThan("double-col")&&(y+=" abs"),R.default.createElement("div",{ref:g.reactionContainer,className:y},R.default.createElement(ee.default,(0,f.default)({ref:g.reactionList},b)))}},{key:"adjustReactionContainer",value:function(){if(this.props.env.isWiderThan("double-col")){var e=this.state.isTall,t=this.components.reactionContainer;if(t){var r=t.parentNode;if(!pe){var n=getComputedStyle(t);pe=parseInt(n.maxHeight)}var a=r.offsetHeight>pe;e!==a&&this.setState({isTall:a})}}}},{key:"renderPopUpMenu",value:function(e){var t=this.components.setters,r=t[e+"PopUp"];return R.default.createElement(ie.default,{ref:r},this.renderOptions(e))}},{key:"renderOptions",value:function(e){var t=this.props,r=t.database,n=t.route,a=t.env,o=t.story,s=t.reactions,u=t.repos,i=t.currentUser,d=t.access,l=this.state.options,c={section:e,access:d,story:o,reactions:s,repos:u,currentUser:i,options:l,database:r,route:n,env:a,onChange:this.handleOptionsChange,onComplete:this.handleOptionsComplete};return R.default.createElement(se.default,c)}},{key:"componentDidMount",value:function(){this.adjustReactionContainer()}},{key:"componentDidUpdate",value:function(e,t){this.adjustReactionContainer()}},{key:"saveStory",value:function(){function e(e,r){return t.apply(this,arguments)}var t=(0,l.default)(i.default.mark(function e(t,r){var n,a,o,s,u,d,l,c,f;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.props.database,a=this.state.options,o={delay:r?void 0:2e3,onConflict:function(e){U.mergeRemoteChanges(e.local,e.remote,original)&&e.preventDefault()}},s=n.use({by:this}),e.next=6,s.start();case 6:return u=e.sent,d=!U.isSaved(t),l=a.bookmarkRecipients,e.next=11,s.saveOne({table:"story"},t,o);case 11:if(c=e.sent,!d||w.default.isEmpty(l)){e.next=16;break}return e.next=15,this.sendBookmarks(c,l);case 15:f=e.sent;case 16:return e.abrupt("return",c);case 17:case"end":return e.stop()}},e,this)}));return e}()},{key:"removeStory",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,l.default)(i.default.mark(function e(t){var r,n,a,o;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.props,n=r.database,a=r.payloads,o=n.use({by:this}),e.next=4,o.removeOne({table:"story"},t);case 4:return e.next=6,a.abandon(t);case 6:case"end":return e.stop()}},e,this)}));return e}()},{key:"saveReaction",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,l.default)(i.default.mark(function e(t){var r,n,a;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.props.database,n=r.use({by:this}),e.next=4,n.start();case 4:return a=e.sent,e.abrupt("return",n.saveOne({table:"reaction"},t));case 6:case"end":return e.stop()}},e,this)}));return e}()},{key:"removeReaction",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,l.default)(i.default.mark(function e(t){var r,n,a;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.props.database,n=r.use({by:this}),e.next=4,n.start();case 4:return a=e.sent,e.abrupt("return",n.removeOne({table:"reaction"},t));case 6:case"end":return e.stop()}},e,this)}));return e}()},{key:"saveBookmarks",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,l.default)(i.default.mark(function e(t){var r,n,a;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.props.database,!w.default.isEmpty(t)){e.next=3;break}return e.abrupt("return",[]);case 3:return n=r.use({by:this}),e.next=6,n.start();case 6:return a=e.sent,e.abrupt("return",n.save({table:"bookmark"},t));case 8:case"end":return e.stop()}},e,this)}));return e}()},{key:"removeBookmarks",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,l.default)(i.default.mark(function e(t){var r,n,a;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.props.database,!w.default.isEmpty(t)){e.next=3;break}return e.abrupt("return",[]);case 3:return n=r.use({by:this}),e.next=6,n.start();case 6:return a=e.sent,e.abrupt("return",n.remove({table:"bookmark"},t));case 8:case"end":return e.stop()}},e,this)}));return e}()},{key:"hideBookmark",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,l.default)(i.default.mark(function e(t){var r,n,a,o;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.props.database,n=r.use({by:this}),a=w.default.clone(t),a.hidden=!0,e.next=6,n.start();case 6:return o=e.sent,e.abrupt("return",n.saveOne({table:"bookmark"},a));case 8:case"end":return e.stop()}},e,this)}));return e}()},{key:"sendBookmarks",value:function(){function e(e,r){return t.apply(this,arguments)}var t=(0,l.default)(i.default.mark(function e(t,r){var n,a,o,u,d,l,c,f,m,p,h,v,g,b,y,D,k,C,E,x,j;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(n=this.props,a=n.database,o=n.recommendations,u=n.currentUser,d=[],l=!0,c=!1,f=void 0,e.prev=5,m=(0,s.default)(r);!(l=(p=m.next()).done);l=!0)h=p.value,w.default.some(o,{target_user_id:h})||(v={story_id:t.published_version_id||t.id,user_ids:[u.id],target_user_id:h},d.push(v));e.next=13;break;case 9:e.prev=9,e.t0=e.catch(5),c=!0,f=e.t0;case 13:e.prev=13,e.prev=14,!l&&m.return&&m.return();case 16:if(e.prev=16,!c){e.next=19;break}throw f;case 19:return e.finish(16);case 20:return e.finish(13);case 21:for(g=[],b=!0,y=!1,D=void 0,e.prev=25,k=(0,s.default)(o);!(b=(C=k.next()).done);b=!0)E=C.value,w.default.includes(r,E.target_user_id)||g.push(E);e.next=33;break;case 29:e.prev=29,e.t1=e.catch(25),y=!0,D=e.t1;case 33:e.prev=33,e.prev=34,!b&&k.return&&k.return();case 36:if(e.prev=36,!y){e.next=39;break}throw D;case 39:return e.finish(36);case 40:return e.finish(33);case 41:return e.next=43,this.saveBookmarks(d);case 43:return x=e.sent,e.next=46,this.removeBookmarks(g);case 46:return j=e.sent,e.abrupt("return",w.default.concat(d,g));case 48:case"end":return e.stop()}},e,this,[[5,9,13,21],[14,,16,20],[25,29,33,41],[34,,36,40]])}));return e}()},{key:"sendTask",value:function(){function e(e,r){return t.apply(this,arguments)}var t=(0,l.default)(i.default.mark(function e(t,r){var n,a,o,s,u,d;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.props,a=n.database,o=n.currentUser,s={action:t,options:r,user_id:o.id,token:V.generate()},u=a.use({by:this}),e.next=5,u.start();case 5:return d=e.sent,e.abrupt("return",u.saveOne({table:"task"},s));case 7:case"end":return e.stop()}},e,this)}));return e}()},{key:"setOptions",value:function(e){var t=this,r=this.props,n=r.story,a=r.bookmark,o=r.onBump,s=r.onEdit,u=this.state.options;this.setState({options:e},function(){if(e.editStory&&!u.editStory)if(s&&s({type:"bump",target:t}),n.id>1){var r=w.default.omit(n,"id","published","ptime");r.published_version_id=n.id,t.saveStory(r)}else{var i=w.default.clone(n);i.published=!1,t.saveStory(i)}if(e.removeStory&&!u.removeStory&&t.removeStory(n),e.bumpStory&&!u.bumpStory){var d=w.default.clone(n);d.bump=!0,d.btime=(0,j.default)().toISOString(),t.saveStory(d),o&&o({type:"bump",target:t})}if(e.hideStory!==u.hideStory){var l=w.default.clone(n);l.public=!e.hideStory,t.saveStory(l)}if(e.keepBookmark!==u.keepBookmark&&a&&!e.keepBookmark&&t.hideBookmark(a),!w.default.isEqual(e.issueDetails,u.issueDetails)){var c=w.default.clone(e.issueDetails)||{};c.story_id=n.id,t.sendTask("export-issue",c)}w.default.isEqual(e.bookmarkRecipients,u.bookmarkRecipients)||(U.isSaved(n)?t.sendBookmarks(n,e.bookmarkRecipients):t.saveStory(n))})}}]),t}(_.PureComponent));me.displayName="StoryView";var pe=void 0,he={issueDetails:null,hideStory:!1,editStory:!1,removeStory:!1,bumpStory:!1,bookmarkRecipients:[],keepBookmark:void 0},ve=(0,S.memoizeWeak)(null,function(e,t){return w.default.find(e,function(e){return!!P.findLinkByRelative(t,e,"project")})});(0,S.memoizeWeak)(null,function(e){var t=w.default.map(e,"user_id");return w.default.size(w.default.uniq(t))});t.default=me,t.StoryView=me},"./views/story-view.scss":function(e,t){}});