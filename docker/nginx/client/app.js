webpackJsonp(["app"],{"../../common/node_modules/async-do-while/index.js":function(e,t,n){function r(){var e=this;return o.resolve().then(function(){return e.begin()}).then(function(){return e.loop()}).catch(function(e){if(e!==d)throw e}).then(function(){return e.return()})}function s(){}var o=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),i=null,a=null,c=null,l=null,u="";t.begin=function(e){if(a||c)throw new Error("Cannot call begin() after while() or do()");if(!(e instanceof Function))throw new Error("Argument must be a function");i=e},t.while=function(e){if(c)throw new Error("Cannot call while() consecutively");if(!(e instanceof Function))throw new Error("Argument must be a function");a&&(u="do-while"),c=e},t.do=function(e){if(a)throw new Error("Cannot call do() consecutively");if(!(e instanceof Function))throw new Error("Argument must be a function");c&&(u="while-do"),a=e},t.return=function(e){if(!a||!c)throw new Error("Cannot call return() without calling while() and do() beforehand");if(!(e instanceof Function))throw new Error("Argument must be a function");l=e},t.end=function(){if(!a||!c)throw new Error("Cannot call end() without calling while() and do() beforehand");var e;"while-do"===u?e=function(){var e=this;return o.resolve(e.while()).then(function(t){if(t)return o.resolve(e.do()).then(function(){return e.loop()})})}:"do-while"===u&&(e=function(){var e=this;return o.resolve(e.do()).then(function(){return o.resolve(e.while()).then(function(t){if(t)return e.loop()})})});var t={begin:i||s,do:a,while:c,return:l||s,loop:e};return i=null,a=null,c=null,l=null,u="",r.call(t)};var d=new Error;t.break=function(){throw d}},"../../common/node_modules/b64-to-blob/b64toBlob.js":function(e,t,n){var r,s,o;!function(n,i,a){s=[],r=a,void 0!==(o="function"==typeof r?r.apply(t,s):r)&&(e.exports=o)}(0,0,function(){"use strict";return function(e,t,n){t=t||"",n=n||512;for(var r=atob(e),s=[],o=0;o<r.length;o+=n){for(var i=r.slice(o,o+n),a=new Array(i.length),c=0;c<i.length;c++)a[c]=i.charCodeAt(c);var l=new Uint8Array(a);s.push(l)}return new Blob(s,{type:t})}})},"../../common/node_modules/d/auto-bind.js":function(e,t,n){"use strict";var r,s=n("../../common/node_modules/es5-ext/object/copy.js"),o=n("../../common/node_modules/es5-ext/object/normalize-options.js"),i=n("../../common/node_modules/es5-ext/object/valid-callable.js"),a=n("../../common/node_modules/es5-ext/object/map.js"),c=n("../../common/node_modules/es5-ext/object/valid-callable.js"),l=n("../../common/node_modules/es5-ext/object/valid-value.js"),u=Function.prototype.bind,d=Object.defineProperty,p=Object.prototype.hasOwnProperty;r=function(e,t,n){var r,o=l(t)&&c(t.value);return r=s(t),delete r.writable,delete r.value,r.get=function(){return!n.overwriteDefinition&&p.call(this,e)?o:(t.value=u.call(o,n.resolveContext?n.resolveContext(this):this),d(this,e,t),this[e])},r},e.exports=function(e){var t=o(arguments[1]);return null!=t.resolveContext&&i(t.resolveContext),a(e,function(e,n){return r(n,e,t)})}},"../../common/node_modules/d/index.js":function(e,t,n){"use strict";var r,s=n("../../common/node_modules/es5-ext/object/assign/index.js"),o=n("../../common/node_modules/es5-ext/object/normalize-options.js"),i=n("../../common/node_modules/es5-ext/object/is-callable.js"),a=n("../../common/node_modules/es5-ext/string/#/contains/index.js");r=e.exports=function(e,t){var n,r,i,c,l;return arguments.length<2||"string"!=typeof e?(c=t,t=e,e=null):c=arguments[2],null==e?(n=i=!0,r=!1):(n=a.call(e,"c"),r=a.call(e,"e"),i=a.call(e,"w")),l={value:t,configurable:n,enumerable:r,writable:i},c?s(o(c),l):l},r.gs=function(e,t,n){var r,c,l,u;return"string"!=typeof e?(l=n,n=t,t=e,e=null):l=arguments[3],null==t?t=void 0:i(t)?null==n?n=void 0:i(n)||(l=n,n=void 0):(l=t,t=n=void 0),null==e?(r=!0,c=!1):(r=a.call(e,"c"),c=a.call(e,"e")),u={get:t,set:n,configurable:r,enumerable:c},l?s(o(l),u):u}},"../../common/node_modules/es5-ext/array/#/clear.js":function(e,t,n){"use strict";var r=n("../../common/node_modules/es5-ext/object/valid-value.js");e.exports=function(){return r(this).length=0,this}},"../../common/node_modules/es5-ext/array/#/e-index-of.js":function(e,t,n){"use strict";var r=n("../../common/node_modules/es5-ext/number/is-nan/index.js"),s=n("../../common/node_modules/es5-ext/number/to-pos-integer.js"),o=n("../../common/node_modules/es5-ext/object/valid-value.js"),i=Array.prototype.indexOf,a=Object.prototype.hasOwnProperty,c=Math.abs,l=Math.floor;e.exports=function(e){var t,n,u,d;if(!r(e))return i.apply(this,arguments);for(n=s(o(this).length),u=arguments[1],u=isNaN(u)?0:u>=0?l(u):s(this.length)-l(c(u)),t=u;t<n;++t)if(a.call(this,t)&&(d=this[t],r(d)))return t;return-1}},"../../common/node_modules/es5-ext/array/from/index.js":function(e,t,n){"use strict";e.exports=n("../../common/node_modules/es5-ext/array/from/is-implemented.js")()?Array.from:n("../../common/node_modules/es5-ext/array/from/shim.js")},"../../common/node_modules/es5-ext/array/from/is-implemented.js":function(e,t,n){"use strict";e.exports=function(){var e,t,n=Array.from;return"function"==typeof n&&(e=["raz","dwa"],t=n(e),Boolean(t&&t!==e&&"dwa"===t[1]))}},"../../common/node_modules/es5-ext/array/from/shim.js":function(e,t,n){"use strict";var r=n("../../common/node_modules/es6-symbol/index.js").iterator,s=n("../../common/node_modules/es5-ext/function/is-arguments.js"),o=n("../../common/node_modules/es5-ext/function/is-function.js"),i=n("../../common/node_modules/es5-ext/number/to-pos-integer.js"),a=n("../../common/node_modules/es5-ext/object/valid-callable.js"),c=n("../../common/node_modules/es5-ext/object/valid-value.js"),l=n("../../common/node_modules/es5-ext/object/is-value.js"),u=n("../../common/node_modules/es5-ext/string/is-string.js"),d=Array.isArray,p=Function.prototype.call,h={configurable:!0,enumerable:!0,writable:!0,value:null},m=Object.defineProperty;e.exports=function(e){var t,n,f,g,v,b,y,j,w,x,k=arguments[1],E=arguments[2];if(e=Object(c(e)),l(k)&&a(k),this&&this!==Array&&o(this))t=this;else{if(!k){if(s(e))return 1!==(v=e.length)?Array.apply(null,e):(g=new Array(1),g[0]=e[0],g);if(d(e)){for(g=new Array(v=e.length),n=0;n<v;++n)g[n]=e[n];return g}}g=[]}if(!d(e))if(void 0!==(w=e[r])){for(y=a(w).call(e),t&&(g=new t),j=y.next(),n=0;!j.done;)x=k?p.call(k,E,j.value,n):j.value,t?(h.value=x,m(g,n,h)):g[n]=x,j=y.next(),++n;v=n}else if(u(e)){for(v=e.length,t&&(g=new t),n=0,f=0;n<v;++n)x=e[n],n+1<v&&(b=x.charCodeAt(0))>=55296&&b<=56319&&(x+=e[++n]),x=k?p.call(k,E,x,f):x,t?(h.value=x,m(g,f,h)):g[f]=x,++f;v=f}if(void 0===v)for(v=i(e.length),t&&(g=new t(v)),n=0;n<v;++n)x=k?p.call(k,E,e[n],n):e[n],t?(h.value=x,m(g,n,h)):g[n]=x;return t&&(h.value=null,g.length=v),g}},"../../common/node_modules/es5-ext/array/to-array.js":function(e,t,n){"use strict";var r=n("../../common/node_modules/es5-ext/array/from/index.js"),s=Array.isArray;e.exports=function(e){return s(e)?e:r(e)}},"../../common/node_modules/es5-ext/error/custom.js":function(e,t,n){"use strict";var r=n("../../common/node_modules/es5-ext/object/assign/index.js"),s=n("../../common/node_modules/es5-ext/object/is-object.js"),o=n("../../common/node_modules/es5-ext/object/is-value.js"),i=Error.captureStackTrace;t=e.exports=function(e){var n=new Error(e),a=arguments[1],c=arguments[2];return o(c)||s(a)&&(c=a,a=null),o(c)&&r(n,c),o(a)&&(n.code=a),i&&i(n,t),n}},"../../common/node_modules/es5-ext/function/#/partial.js":function(e,t,n){"use strict";var r=n("../../common/node_modules/es5-ext/object/valid-callable.js"),s=n("../../common/node_modules/es5-ext/array/from/index.js"),o=n("../../common/node_modules/es5-ext/function/_define-length.js"),i=Function.prototype.apply;e.exports=function(){var e=r(this),t=s(arguments);return o(function(){return i.call(e,this,t.concat(s(arguments)))},e.length-t.length)}},"../../common/node_modules/es5-ext/function/_define-length.js":function(e,t,n){"use strict";var r,s,o,i,a=n("../../common/node_modules/es5-ext/number/to-pos-integer.js"),c=function(e,t){return t};try{Object.defineProperty(c,"length",{configurable:!0,writable:!1,enumerable:!1,value:1})}catch(e){}1===c.length?(r={configurable:!0,writable:!1,enumerable:!1},s=Object.defineProperty,e.exports=function(e,t){return t=a(t),e.length===t?e:(r.value=t,s(e,"length",r))}):(i=n("../../common/node_modules/es5-ext/object/mixin.js"),o=function(){var e=[];return function(t){var n,r=0;if(e[t])return e[t];for(n=[];t--;)n.push("a"+(++r).toString(36));return new Function("fn","return function ("+n.join(", ")+") { return fn.apply(this, arguments); };")}}(),e.exports=function(e,t){var n;if(t=a(t),e.length===t)return e;n=o(t)(e);try{i(n,e)}catch(e){}return n})},"../../common/node_modules/es5-ext/function/is-arguments.js":function(e,t,n){"use strict";var r=Object.prototype.toString,s=r.call(function(){return arguments}());e.exports=function(e){return r.call(e)===s}},"../../common/node_modules/es5-ext/function/is-function.js":function(e,t,n){"use strict";var r=Object.prototype.toString,s=r.call(n("../../common/node_modules/es5-ext/function/noop.js"));e.exports=function(e){return"function"==typeof e&&r.call(e)===s}},"../../common/node_modules/es5-ext/function/noop.js":function(e,t,n){"use strict";e.exports=function(){}},"../../common/node_modules/es5-ext/math/sign/index.js":function(e,t,n){"use strict";e.exports=n("../../common/node_modules/es5-ext/math/sign/is-implemented.js")()?Math.sign:n("../../common/node_modules/es5-ext/math/sign/shim.js")},"../../common/node_modules/es5-ext/math/sign/is-implemented.js":function(e,t,n){"use strict";e.exports=function(){var e=Math.sign;return"function"==typeof e&&(1===e(10)&&-1===e(-20))}},"../../common/node_modules/es5-ext/math/sign/shim.js":function(e,t,n){"use strict";e.exports=function(e){return e=Number(e),isNaN(e)||0===e?e:e>0?1:-1}},"../../common/node_modules/es5-ext/number/is-nan/index.js":function(e,t,n){"use strict";e.exports=n("../../common/node_modules/es5-ext/number/is-nan/is-implemented.js")()?Number.isNaN:n("../../common/node_modules/es5-ext/number/is-nan/shim.js")},"../../common/node_modules/es5-ext/number/is-nan/is-implemented.js":function(e,t,n){"use strict";e.exports=function(){var e=Number.isNaN;return"function"==typeof e&&(!e({})&&e(NaN)&&!e(34))}},"../../common/node_modules/es5-ext/number/is-nan/shim.js":function(e,t,n){"use strict";e.exports=function(e){return e!==e}},"../../common/node_modules/es5-ext/number/to-integer.js":function(e,t,n){"use strict";var r=n("../../common/node_modules/es5-ext/math/sign/index.js"),s=Math.abs,o=Math.floor;e.exports=function(e){return isNaN(e)?0:(e=Number(e),0!==e&&isFinite(e)?r(e)*o(s(e)):e)}},"../../common/node_modules/es5-ext/number/to-pos-integer.js":function(e,t,n){"use strict";var r=n("../../common/node_modules/es5-ext/number/to-integer.js"),s=Math.max;e.exports=function(e){return s(0,r(e))}},"../../common/node_modules/es5-ext/object/_iterate.js":function(e,t,n){"use strict";var r=n("../../common/node_modules/es5-ext/object/valid-callable.js"),s=n("../../common/node_modules/es5-ext/object/valid-value.js"),o=Function.prototype.bind,i=Function.prototype.call,a=Object.keys,c=Object.prototype.propertyIsEnumerable;e.exports=function(e,t){return function(n,l){var u,d=arguments[2],p=arguments[3];return n=Object(s(n)),r(l),u=a(n),p&&u.sort("function"==typeof p?o.call(p,n):void 0),"function"!=typeof e&&(e=u[e]),i.call(e,u,function(e,r){return c.call(n,e)?i.call(l,d,n[e],e,n,r):t})}}},"../../common/node_modules/es5-ext/object/assign/index.js":function(e,t,n){"use strict";e.exports=n("../../common/node_modules/es5-ext/object/assign/is-implemented.js")()?Object.assign:n("../../common/node_modules/es5-ext/object/assign/shim.js")},"../../common/node_modules/es5-ext/object/assign/is-implemented.js":function(e,t,n){"use strict";e.exports=function(){var e,t=Object.assign;return"function"==typeof t&&(e={foo:"raz"},t(e,{bar:"dwa"},{trzy:"trzy"}),e.foo+e.bar+e.trzy==="razdwatrzy")}},"../../common/node_modules/es5-ext/object/assign/shim.js":function(e,t,n){"use strict";var r=n("../../common/node_modules/es5-ext/object/keys/index.js"),s=n("../../common/node_modules/es5-ext/object/valid-value.js"),o=Math.max;e.exports=function(e,t){var n,i,a,c=o(arguments.length,2);for(e=Object(s(e)),a=function(r){try{e[r]=t[r]}catch(e){n||(n=e)}},i=1;i<c;++i)t=arguments[i],r(t).forEach(a);if(void 0!==n)throw n;return e}},"../../common/node_modules/es5-ext/object/copy.js":function(e,t,n){"use strict";var r=n("../../common/node_modules/es5-ext/array/from/index.js"),s=n("../../common/node_modules/es5-ext/object/assign/index.js"),o=n("../../common/node_modules/es5-ext/object/valid-value.js");e.exports=function(e){var t=Object(o(e)),n=arguments[1],i=Object(arguments[2]);if(t!==e&&!n)return t;var a={};return n?r(n,function(t){(i.ensure||t in e)&&(a[t]=e[t])}):s(a,e),a}},"../../common/node_modules/es5-ext/object/create.js":function(e,t,n){"use strict";var r,s=Object.create;n("../../common/node_modules/es5-ext/object/set-prototype-of/is-implemented.js")()||(r=n("../../common/node_modules/es5-ext/object/set-prototype-of/shim.js")),e.exports=function(){var e,t,n;return r?1!==r.level?s:(e={},t={},n={configurable:!1,enumerable:!1,writable:!0,value:void 0},Object.getOwnPropertyNames(Object.prototype).forEach(function(e){if("__proto__"===e)return void(t[e]={configurable:!0,enumerable:!1,writable:!0,value:void 0});t[e]=n}),Object.defineProperties(e,t),Object.defineProperty(r,"nullPolyfill",{configurable:!1,enumerable:!1,writable:!1,value:e}),function(t,n){return s(null===t?e:t,n)}):s}()},"../../common/node_modules/es5-ext/object/for-each.js":function(e,t,n){"use strict";e.exports=n("../../common/node_modules/es5-ext/object/_iterate.js")("forEach")},"../../common/node_modules/es5-ext/object/is-callable.js":function(e,t,n){"use strict";e.exports=function(e){return"function"==typeof e}},"../../common/node_modules/es5-ext/object/is-object.js":function(e,t,n){"use strict";var r=n("../../common/node_modules/es5-ext/object/is-value.js"),s={function:!0,object:!0};e.exports=function(e){return r(e)&&s[typeof e]||!1}},"../../common/node_modules/es5-ext/object/is-value.js":function(e,t,n){"use strict";var r=n("../../common/node_modules/es5-ext/function/noop.js")();e.exports=function(e){return e!==r&&null!==e}},"../../common/node_modules/es5-ext/object/keys/index.js":function(e,t,n){"use strict";e.exports=n("../../common/node_modules/es5-ext/object/keys/is-implemented.js")()?Object.keys:n("../../common/node_modules/es5-ext/object/keys/shim.js")},"../../common/node_modules/es5-ext/object/keys/is-implemented.js":function(e,t,n){"use strict";e.exports=function(){try{return Object.keys("primitive"),!0}catch(e){return!1}}},"../../common/node_modules/es5-ext/object/keys/shim.js":function(e,t,n){"use strict";var r=n("../../common/node_modules/es5-ext/object/is-value.js"),s=Object.keys;e.exports=function(e){return s(r(e)?Object(e):e)}},"../../common/node_modules/es5-ext/object/map.js":function(e,t,n){"use strict";var r=n("../../common/node_modules/es5-ext/object/valid-callable.js"),s=n("../../common/node_modules/es5-ext/object/for-each.js"),o=Function.prototype.call;e.exports=function(e,t){var n={},i=arguments[2];return r(t),s(e,function(e,r,s,a){n[r]=o.call(t,i,e,r,s,a)}),n}},"../../common/node_modules/es5-ext/object/mixin.js":function(e,t,n){"use strict";var r=n("../../common/node_modules/es5-ext/object/valid-value.js"),s=Object.defineProperty,o=Object.getOwnPropertyDescriptor,i=Object.getOwnPropertyNames,a=Object.getOwnPropertySymbols;e.exports=function(e,t){var n,c=Object(r(t));if(e=Object(r(e)),i(c).forEach(function(r){try{s(e,r,o(t,r))}catch(e){n=e}}),"function"==typeof a&&a(c).forEach(function(r){try{s(e,r,o(t,r))}catch(e){n=e}}),void 0!==n)throw n;return e}},"../../common/node_modules/es5-ext/object/normalize-options.js":function(e,t,n){"use strict";var r=n("../../common/node_modules/es5-ext/object/is-value.js"),s=Array.prototype.forEach,o=Object.create,i=function(e,t){var n;for(n in e)t[n]=e[n]};e.exports=function(e){var t=o(null);return s.call(arguments,function(e){r(e)&&i(Object(e),t)}),t}},"../../common/node_modules/es5-ext/object/primitive-set.js":function(e,t,n){"use strict";var r=Array.prototype.forEach,s=Object.create;e.exports=function(e){var t=s(null);return r.call(arguments,function(e){t[e]=!0}),t}},"../../common/node_modules/es5-ext/object/set-prototype-of/index.js":function(e,t,n){"use strict";e.exports=n("../../common/node_modules/es5-ext/object/set-prototype-of/is-implemented.js")()?Object.setPrototypeOf:n("../../common/node_modules/es5-ext/object/set-prototype-of/shim.js")},"../../common/node_modules/es5-ext/object/set-prototype-of/is-implemented.js":function(e,t,n){"use strict";var r=Object.create,s=Object.getPrototypeOf,o={};e.exports=function(){var e=Object.setPrototypeOf,t=arguments[0]||r;return"function"==typeof e&&s(e(t(null),o))===o}},"../../common/node_modules/es5-ext/object/set-prototype-of/shim.js":function(e,t,n){"use strict";var r,s=n("../../common/node_modules/es5-ext/object/is-object.js"),o=n("../../common/node_modules/es5-ext/object/valid-value.js"),i=Object.prototype.isPrototypeOf,a=Object.defineProperty,c={configurable:!0,enumerable:!1,writable:!0,value:void 0};r=function(e,t){if(o(e),null===t||s(t))return e;throw new TypeError("Prototype must be null or an object")},e.exports=function(e){var t,n;return e?(2===e.level?e.set?(n=e.set,t=function(e,t){return n.call(r(e,t),t),e}):t=function(e,t){return r(e,t).__proto__=t,e}:t=function e(t,n){var s;return r(t,n),s=i.call(e.nullPolyfill,t),s&&delete e.nullPolyfill.__proto__,null===n&&(n=e.nullPolyfill),t.__proto__=n,s&&a(e.nullPolyfill,"__proto__",c),t},Object.defineProperty(t,"level",{configurable:!1,enumerable:!1,writable:!1,value:e.level})):null}(function(){var e,t=Object.create(null),n={},r=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__");if(r){try{e=r.set,e.call(t,n)}catch(e){}if(Object.getPrototypeOf(t)===n)return{set:e,level:2}}return t.__proto__=n,Object.getPrototypeOf(t)===n?{level:2}:(t={},t.__proto__=n,Object.getPrototypeOf(t)===n&&{level:1})}()),n("../../common/node_modules/es5-ext/object/create.js")},"../../common/node_modules/es5-ext/object/valid-callable.js":function(e,t,n){"use strict";e.exports=function(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return e}},"../../common/node_modules/es5-ext/object/valid-object.js":function(e,t,n){"use strict";var r=n("../../common/node_modules/es5-ext/object/is-object.js");e.exports=function(e){if(!r(e))throw new TypeError(e+" is not an Object");return e}},"../../common/node_modules/es5-ext/object/valid-value.js":function(e,t,n){"use strict";var r=n("../../common/node_modules/es5-ext/object/is-value.js");e.exports=function(e){if(!r(e))throw new TypeError("Cannot use null or undefined");return e}},"../../common/node_modules/es5-ext/object/validate-stringifiable-value.js":function(e,t,n){"use strict";var r=n("../../common/node_modules/es5-ext/object/valid-value.js"),s=n("../../common/node_modules/es5-ext/object/validate-stringifiable.js");e.exports=function(e){return s(r(e))}},"../../common/node_modules/es5-ext/object/validate-stringifiable.js":function(e,t,n){"use strict";var r=n("../../common/node_modules/es5-ext/object/is-callable.js");e.exports=function(e){try{return e&&r(e.toString)?e.toString():String(e)}catch(e){throw new TypeError("Passed argument cannot be stringifed")}}},"../../common/node_modules/es5-ext/safe-to-string.js":function(e,t,n){"use strict";var r=n("../../common/node_modules/es5-ext/object/is-callable.js");e.exports=function(e){try{return e&&r(e.toString)?e.toString():String(e)}catch(e){return"<Non-coercible to string value>"}}},"../../common/node_modules/es5-ext/string/#/contains/index.js":function(e,t,n){"use strict";e.exports=n("../../common/node_modules/es5-ext/string/#/contains/is-implemented.js")()?String.prototype.contains:n("../../common/node_modules/es5-ext/string/#/contains/shim.js")},"../../common/node_modules/es5-ext/string/#/contains/is-implemented.js":function(e,t,n){"use strict";var r="razdwatrzy";e.exports=function(){return"function"==typeof r.contains&&(!0===r.contains("dwa")&&!1===r.contains("foo"))}},"../../common/node_modules/es5-ext/string/#/contains/shim.js":function(e,t,n){"use strict";var r=String.prototype.indexOf;e.exports=function(e){return r.call(this,e,arguments[1])>-1}},"../../common/node_modules/es5-ext/string/is-string.js":function(e,t,n){"use strict";var r=Object.prototype.toString,s=r.call("");e.exports=function(e){return"string"==typeof e||e&&"object"==typeof e&&(e instanceof String||r.call(e)===s)||!1}},"../../common/node_modules/es5-ext/string/random-uniq.js":function(e,t,n){"use strict";var r=Object.create(null),s=Math.random;e.exports=function(){var e;do{e=s().toString(36).slice(2)}while(r[e]);return e}},"../../common/node_modules/es5-ext/to-short-string-representation.js":function(e,t,n){"use strict";var r=n("../../common/node_modules/es5-ext/safe-to-string.js"),s=/[\n\r\u2028\u2029]/g;e.exports=function(e){var t=r(e);return t.length>100&&(t=t.slice(0,99)+"â€¦"),t=t.replace(s,function(e){return JSON.stringify(e).slice(1,-1)})}},"../../common/node_modules/es6-iterator/array.js":function(e,t,n){"use strict";var r,s=n("../../common/node_modules/es5-ext/object/set-prototype-of/index.js"),o=n("../../common/node_modules/es5-ext/string/#/contains/index.js"),i=n("../../common/node_modules/d/index.js"),a=n("../../common/node_modules/es6-symbol/index.js"),c=n("../../common/node_modules/es6-iterator/index.js"),l=Object.defineProperty;r=e.exports=function(e,t){if(!(this instanceof r))throw new TypeError("Constructor requires 'new'");c.call(this,e),t=t?o.call(t,"key+value")?"key+value":o.call(t,"key")?"key":"value":"value",l(this,"__kind__",i("",t))},s&&s(r,c),delete r.prototype.constructor,r.prototype=Object.create(c.prototype,{_resolve:i(function(e){return"value"===this.__kind__?this.__list__[e]:"key+value"===this.__kind__?[e,this.__list__[e]]:e})}),l(r.prototype,a.toStringTag,i("c","Array Iterator"))},"../../common/node_modules/es6-iterator/for-of.js":function(e,t,n){"use strict";var r=n("../../common/node_modules/es5-ext/function/is-arguments.js"),s=n("../../common/node_modules/es5-ext/object/valid-callable.js"),o=n("../../common/node_modules/es5-ext/string/is-string.js"),i=n("../../common/node_modules/es6-iterator/get.js"),a=Array.isArray,c=Function.prototype.call,l=Array.prototype.some;e.exports=function(e,t){var n,u,d,p,h,m,f,g,v=arguments[2];if(a(e)||r(e)?n="array":o(e)?n="string":e=i(e),s(t),d=function(){p=!0},"array"===n)return void l.call(e,function(e){return c.call(t,v,e,d),p});if("string"!==n)for(u=e.next();!u.done;){if(c.call(t,v,u.value,d),p)return;u=e.next()}else for(m=e.length,h=0;h<m&&(f=e[h],h+1<m&&(g=f.charCodeAt(0))>=55296&&g<=56319&&(f+=e[++h]),c.call(t,v,f,d),!p);++h);}},"../../common/node_modules/es6-iterator/get.js":function(e,t,n){"use strict";var r=n("../../common/node_modules/es5-ext/function/is-arguments.js"),s=n("../../common/node_modules/es5-ext/string/is-string.js"),o=n("../../common/node_modules/es6-iterator/array.js"),i=n("../../common/node_modules/es6-iterator/string.js"),a=n("../../common/node_modules/es6-iterator/valid-iterable.js"),c=n("../../common/node_modules/es6-symbol/index.js").iterator;e.exports=function(e){return"function"==typeof a(e)[c]?e[c]():r(e)?new o(e):s(e)?new i(e):new o(e)}},"../../common/node_modules/es6-iterator/index.js":function(e,t,n){"use strict";var r,s=n("../../common/node_modules/es5-ext/array/#/clear.js"),o=n("../../common/node_modules/es5-ext/object/assign/index.js"),i=n("../../common/node_modules/es5-ext/object/valid-callable.js"),a=n("../../common/node_modules/es5-ext/object/valid-value.js"),c=n("../../common/node_modules/d/index.js"),l=n("../../common/node_modules/d/auto-bind.js"),u=n("../../common/node_modules/es6-symbol/index.js"),d=Object.defineProperty,p=Object.defineProperties;e.exports=r=function(e,t){if(!(this instanceof r))throw new TypeError("Constructor requires 'new'");p(this,{__list__:c("w",a(e)),__context__:c("w",t),__nextIndex__:c("w",0)}),t&&(i(t.on),t.on("_add",this._onAdd),t.on("_delete",this._onDelete),t.on("_clear",this._onClear))},delete r.prototype.constructor,p(r.prototype,o({_next:c(function(){var e;if(this.__list__)return this.__redo__&&void 0!==(e=this.__redo__.shift())?e:this.__nextIndex__<this.__list__.length?this.__nextIndex__++:void this._unBind()}),next:c(function(){return this._createResult(this._next())}),_createResult:c(function(e){return void 0===e?{done:!0,value:void 0}:{done:!1,value:this._resolve(e)}}),_resolve:c(function(e){return this.__list__[e]}),_unBind:c(function(){this.__list__=null,delete this.__redo__,this.__context__&&(this.__context__.off("_add",this._onAdd),this.__context__.off("_delete",this._onDelete),this.__context__.off("_clear",this._onClear),this.__context__=null)}),toString:c(function(){return"[object "+(this[u.toStringTag]||"Object")+"]"})},l({_onAdd:c(function(e){if(!(e>=this.__nextIndex__)){if(++this.__nextIndex__,!this.__redo__)return void d(this,"__redo__",c("c",[e]));this.__redo__.forEach(function(t,n){t>=e&&(this.__redo__[n]=++t)},this),this.__redo__.push(e)}}),_onDelete:c(function(e){var t;e>=this.__nextIndex__||(--this.__nextIndex__,this.__redo__&&(t=this.__redo__.indexOf(e),-1!==t&&this.__redo__.splice(t,1),this.__redo__.forEach(function(t,n){t>e&&(this.__redo__[n]=--t)},this)))}),_onClear:c(function(){this.__redo__&&s.call(this.__redo__),this.__nextIndex__=0})}))),d(r.prototype,u.iterator,c(function(){return this}))},"../../common/node_modules/es6-iterator/is-iterable.js":function(e,t,n){"use strict";var r=n("../../common/node_modules/es5-ext/function/is-arguments.js"),s=n("../../common/node_modules/es5-ext/object/is-value.js"),o=n("../../common/node_modules/es5-ext/string/is-string.js"),i=n("../../common/node_modules/es6-symbol/index.js").iterator,a=Array.isArray;e.exports=function(e){return!!s(e)&&(!!a(e)||(!!o(e)||(!!r(e)||"function"==typeof e[i])))}},"../../common/node_modules/es6-iterator/string.js":function(e,t,n){"use strict";var r,s=n("../../common/node_modules/es5-ext/object/set-prototype-of/index.js"),o=n("../../common/node_modules/d/index.js"),i=n("../../common/node_modules/es6-symbol/index.js"),a=n("../../common/node_modules/es6-iterator/index.js"),c=Object.defineProperty;r=e.exports=function(e){if(!(this instanceof r))throw new TypeError("Constructor requires 'new'");e=String(e),a.call(this,e),c(this,"__length__",o("",e.length))},s&&s(r,a),delete r.prototype.constructor,r.prototype=Object.create(a.prototype,{_next:o(function(){if(this.__list__)return this.__nextIndex__<this.__length__?this.__nextIndex__++:void this._unBind()}),_resolve:o(function(e){var t,n=this.__list__[e];return this.__nextIndex__===this.__length__?n:(t=n.charCodeAt(0),t>=55296&&t<=56319?n+this.__list__[this.__nextIndex__++]:n)})}),c(r.prototype,i.toStringTag,o("c","String Iterator"))},"../../common/node_modules/es6-iterator/valid-iterable.js":function(e,t,n){"use strict";var r=n("../../common/node_modules/es6-iterator/is-iterable.js");e.exports=function(e){if(!r(e))throw new TypeError(e+" is not iterable");return e}},"../../common/node_modules/es6-symbol/index.js":function(e,t,n){"use strict";e.exports=n("../../common/node_modules/es6-symbol/is-implemented.js")()?Symbol:n("../../common/node_modules/es6-symbol/polyfill.js")},"../../common/node_modules/es6-symbol/is-implemented.js":function(e,t,n){"use strict";var r={object:!0,symbol:!0};e.exports=function(){var e;if("function"!=typeof Symbol)return!1;e=Symbol("test symbol");try{String(e)}catch(e){return!1}return!!r[typeof Symbol.iterator]&&(!!r[typeof Symbol.toPrimitive]&&!!r[typeof Symbol.toStringTag])}},"../../common/node_modules/es6-symbol/is-symbol.js":function(e,t,n){"use strict";e.exports=function(e){return!!e&&("symbol"==typeof e||!!e.constructor&&("Symbol"===e.constructor.name&&"Symbol"===e[e.constructor.toStringTag]))}},"../../common/node_modules/es6-symbol/polyfill.js":function(e,t,n){"use strict";var r,s,o,i,a=n("../../common/node_modules/d/index.js"),c=n("../../common/node_modules/es6-symbol/validate-symbol.js"),l=Object.create,u=Object.defineProperties,d=Object.defineProperty,p=Object.prototype,h=l(null);if("function"==typeof Symbol){r=Symbol;try{String(r()),i=!0}catch(e){}}var m=function(){var e=l(null);return function(t){for(var n,r,s=0;e[t+(s||"")];)++s;return t+=s||"",e[t]=!0,n="@@"+t,d(p,n,a.gs(null,function(e){r||(r=!0,d(this,n,a(e)),r=!1)})),n}}();o=function(e){if(this instanceof o)throw new TypeError("Symbol is not a constructor");return s(e)},e.exports=s=function e(t){var n;if(this instanceof e)throw new TypeError("Symbol is not a constructor");return i?r(t):(n=l(o.prototype),t=void 0===t?"":String(t),u(n,{__description__:a("",t),__name__:a("",m(t))}))},u(s,{for:a(function(e){return h[e]?h[e]:h[e]=s(String(e))}),keyFor:a(function(e){var t;c(e);for(t in h)if(h[t]===e)return t}),hasInstance:a("",r&&r.hasInstance||s("hasInstance")),isConcatSpreadable:a("",r&&r.isConcatSpreadable||s("isConcatSpreadable")),iterator:a("",r&&r.iterator||s("iterator")),match:a("",r&&r.match||s("match")),replace:a("",r&&r.replace||s("replace")),search:a("",r&&r.search||s("search")),species:a("",r&&r.species||s("species")),split:a("",r&&r.split||s("split")),toPrimitive:a("",r&&r.toPrimitive||s("toPrimitive")),toStringTag:a("",r&&r.toStringTag||s("toStringTag")),unscopables:a("",r&&r.unscopables||s("unscopables"))}),u(o.prototype,{constructor:a(s),toString:a("",function(){return this.__name__})}),u(s.prototype,{toString:a(function(){return"Symbol ("+c(this).__description__+")"}),valueOf:a(function(){return c(this)})}),d(s.prototype,s.toPrimitive,a("",function(){var e=c(this);return"symbol"==typeof e?e:e.toString()})),d(s.prototype,s.toStringTag,a("c","Symbol")),d(o.prototype,s.toStringTag,a("c",s.prototype[s.toStringTag])),d(o.prototype,s.toPrimitive,a("c",s.prototype[s.toPrimitive]))},"../../common/node_modules/es6-symbol/validate-symbol.js":function(e,t,n){"use strict";var r=n("../../common/node_modules/es6-symbol/is-symbol.js");e.exports=function(e){if(!r(e))throw new TypeError(e+" is not a symbol");return e}},"../../common/node_modules/es6-weak-map/index.js":function(e,t,n){"use strict";e.exports=n("../../common/node_modules/es6-weak-map/is-implemented.js")()?WeakMap:n("../../common/node_modules/es6-weak-map/polyfill.js")},"../../common/node_modules/es6-weak-map/is-implemented.js":function(e,t,n){"use strict";e.exports=function(){var e,t;if("function"!=typeof WeakMap)return!1;try{e=new WeakMap([[t={},"one"],[{},"two"],[{},"three"]])}catch(e){return!1}return"[object WeakMap]"===String(e)&&("function"==typeof e.set&&(e.set({},1)===e&&("function"==typeof e.delete&&("function"==typeof e.has&&"one"===e.get(t)))))}},"../../common/node_modules/es6-weak-map/is-native-implemented.js":function(e,t,n){"use strict";e.exports=function(){return"function"==typeof WeakMap&&"[object WeakMap]"===Object.prototype.toString.call(new WeakMap)}()},"../../common/node_modules/es6-weak-map/polyfill.js":function(e,t,n){"use strict";var r,s=n("../../common/node_modules/es5-ext/object/set-prototype-of/index.js"),o=n("../../common/node_modules/es5-ext/object/valid-object.js"),i=n("../../common/node_modules/es5-ext/object/valid-value.js"),a=n("../../common/node_modules/es5-ext/string/random-uniq.js"),c=n("../../common/node_modules/d/index.js"),l=n("../../common/node_modules/es6-iterator/get.js"),u=n("../../common/node_modules/es6-iterator/for-of.js"),d=n("../../common/node_modules/es6-symbol/index.js").toStringTag,p=n("../../common/node_modules/es6-weak-map/is-native-implemented.js"),h=Array.isArray,m=Object.defineProperty,f=Object.prototype.hasOwnProperty,g=Object.getPrototypeOf;e.exports=r=function(){var e,t=arguments[0];if(!(this instanceof r))throw new TypeError("Constructor requires 'new'");return e=p&&s&&WeakMap!==r?s(new WeakMap,g(this)):this,null!=t&&(h(t)||(t=l(t))),m(e,"__weakMapData__",c("c","$weakMap$"+a())),t?(u(t,function(t){i(t),e.set(t[0],t[1])}),e):e},p&&(s&&s(r,WeakMap),r.prototype=Object.create(WeakMap.prototype,{constructor:c(r)})),Object.defineProperties(r.prototype,{delete:c(function(e){return!!f.call(o(e),this.__weakMapData__)&&(delete e[this.__weakMapData__],!0)}),get:c(function(e){if(f.call(o(e),this.__weakMapData__))return e[this.__weakMapData__]}),has:c(function(e){return f.call(o(e),this.__weakMapData__)}),set:c(function(e,t){return m(o(e),this.__weakMapData__,c("c",t)),this}),toString:c(function(){return"[object WeakMap]"})}),m(r.prototype,d,c("c","WeakMap"))},"../../common/node_modules/event-emitter/index.js":function(e,t,n){"use strict";var r,s,o,i,a,c,l,u=n("../../common/node_modules/d/index.js"),d=n("../../common/node_modules/es5-ext/object/valid-callable.js"),p=Function.prototype.apply,h=Function.prototype.call,m=Object.create,f=Object.defineProperty,g=Object.defineProperties,v=Object.prototype.hasOwnProperty,b={configurable:!0,enumerable:!1,writable:!0};r=function(e,t){var n;return d(t),v.call(this,"__ee__")?n=this.__ee__:(n=b.value=m(null),f(this,"__ee__",b),b.value=null),n[e]?"object"==typeof n[e]?n[e].push(t):n[e]=[n[e],t]:n[e]=t,this},s=function(e,t){var n,s;return d(t),s=this,r.call(this,e,n=function(){o.call(s,e,n),p.call(t,this,arguments)}),n.__eeOnceListener__=t,this},o=function(e,t){var n,r,s,o;if(d(t),!v.call(this,"__ee__"))return this;if(n=this.__ee__,!n[e])return this;if("object"==typeof(r=n[e]))for(o=0;s=r[o];++o)s!==t&&s.__eeOnceListener__!==t||(2===r.length?n[e]=r[o?0:1]:r.splice(o,1));else r!==t&&r.__eeOnceListener__!==t||delete n[e];return this},i=function(e){var t,n,r,s,o;if(v.call(this,"__ee__")&&(s=this.__ee__[e]))if("object"==typeof s){for(n=arguments.length,o=new Array(n-1),t=1;t<n;++t)o[t-1]=arguments[t];for(s=s.slice(),t=0;r=s[t];++t)p.call(r,this,o)}else switch(arguments.length){case 1:h.call(s,this);break;case 2:h.call(s,this,arguments[1]);break;case 3:h.call(s,this,arguments[1],arguments[2]);break;default:for(n=arguments.length,o=new Array(n-1),t=1;t<n;++t)o[t-1]=arguments[t];p.call(s,this,o)}},a={on:r,once:s,off:o,emit:i},c={on:u(r),once:u(s),off:u(o),emit:u(i)},l=g({},c),e.exports=t=function(e){return null==e?m(l):g(Object(e),c)},t.methods=a},"../../common/node_modules/invariant/browser.js":function(e,t,n){"use strict";var r=function(e,t,n,r,s,o,i,a){if(!e){var c;if(void 0===t)c=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var l=[n,r,s,o,i,a],u=0;c=new Error(t.replace(/%s/g,function(){return l[u++]})),c.name="Invariant Violation"}throw c.framesToPop=1,c}};e.exports=r},"../../common/node_modules/lodash.assign/index.js":function(e,t){function n(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function r(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}function s(e,t){var n=D(e)||h(e)?r(e.length,String):[],s=n.length,o=!!s;for(var i in e)!t&&!S.call(e,i)||o&&("length"==i||l(i,s))||n.push(i);return n}function o(e,t,n){var r=e[t];S.call(e,t)&&p(r,n)&&(void 0!==n||t in e)||(e[t]=n)}function i(e){if(!d(e))return O(e);var t=[];for(var n in Object(e))S.call(e,n)&&"constructor"!=n&&t.push(n);return t}function a(e,t){return t=P(void 0===t?e.length-1:t,0),function(){for(var r=arguments,s=-1,o=P(r.length-t,0),i=Array(o);++s<o;)i[s]=r[t+s];s=-1;for(var a=Array(t+1);++s<t;)a[s]=r[s];return a[t]=i,n(e,this,a)}}function c(e,t,n,r){n||(n={});for(var s=-1,i=t.length;++s<i;){var a=t[s],c=r?r(n[a],e[a],a,n,e):void 0;o(n,a,void 0===c?e[a]:c)}return n}function l(e,t){return!!(t=null==t?w:t)&&("number"==typeof e||C.test(e))&&e>-1&&e%1==0&&e<t}function u(e,t,n){if(!b(n))return!1;var r=typeof t;return!!("number"==r?m(n)&&l(t,n.length):"string"==r&&t in n)&&p(n[t],e)}function d(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||_)}function p(e,t){return e===t||e!==e&&t!==t}function h(e){return f(e)&&S.call(e,"callee")&&(!N.call(e,"callee")||R.call(e)==x)}function m(e){return null!=e&&v(e.length)&&!g(e)}function f(e){return y(e)&&m(e)}function g(e){var t=b(e)?R.call(e):"";return t==k||t==E}function v(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=w}function b(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function y(e){return!!e&&"object"==typeof e}function j(e){return m(e)?s(e):i(e)}var w=9007199254740991,x="[object Arguments]",k="[object Function]",E="[object GeneratorFunction]",C=/^(?:0|[1-9]\d*)$/,_=Object.prototype,S=_.hasOwnProperty,R=_.toString,N=_.propertyIsEnumerable,O=function(e,t){return function(n){return e(t(n))}}(Object.keys,Object),P=Math.max,T=!N.call({valueOf:1},"valueOf"),D=Array.isArray,A=function(e){return a(function(t,n){var r=-1,s=n.length,o=s>1?n[s-1]:void 0,i=s>2?n[2]:void 0;for(o=e.length>3&&"function"==typeof o?(s--,o):void 0,i&&u(n[0],n[1],i)&&(o=s<3?void 0:o,s=1),t=Object(t);++r<s;){var a=n[r];a&&e(t,a,r,o)}return t})}(function(e,t){if(T||d(t)||m(t))return void c(t,j(t),e);for(var n in t)S.call(t,n)&&o(e,n,t[n])});e.exports=A},"../../common/node_modules/lodash.flatten/index.js":function(e,t,n){(function(t){function n(e,t){for(var n=-1,r=t.length,s=e.length;++n<r;)e[s+n]=t[n];return e}function r(e,t,o,i,a){var c=-1,l=e.length;for(o||(o=s),a||(a=[]);++c<l;){var u=e[c];t>0&&o(u)?t>1?r(u,t-1,o,i,a):n(a,u):i||(a[a.length]=u)}return a}function s(e){return _(e)||i(e)||!!(C&&e&&e[C])}function o(e){return(e?e.length:0)?r(e,1):[]}function i(e){return c(e)&&w.call(e,"callee")&&(!E.call(e,"callee")||x.call(e)==m)}function a(e){return null!=e&&u(e.length)&&!l(e)}function c(e){return p(e)&&a(e)}function l(e){var t=d(e)?x.call(e):"";return t==f||t==g}function u(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=h}function d(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function p(e){return!!e&&"object"==typeof e}var h=9007199254740991,m="[object Arguments]",f="[object Function]",g="[object GeneratorFunction]",v="object"==typeof t&&t&&t.Object===Object&&t,b="object"==typeof self&&self&&self.Object===Object&&self,y=v||b||Function("return this")(),j=Object.prototype,w=j.hasOwnProperty,x=j.toString,k=y.Symbol,E=j.propertyIsEnumerable,C=k?k.isConcatSpreadable:void 0,_=Array.isArray;e.exports=o}).call(t,n("../node_modules/webpack/buildin/global.js"))},"../../common/node_modules/lodash.isstring/index.js":function(e,t){function n(e){return!!e&&"object"==typeof e}function r(e){return"string"==typeof e||!a(e)&&n(e)&&i.call(e)==s}var s="[object String]",o=Object.prototype,i=o.toString,a=Array.isArray;e.exports=r},"../../common/node_modules/mark-gor/lib/react-renderer.js":function(e,t,n){function r(){for(var e=0;e<arguments.length;e++)for(var t=arguments[e],n=Object.keys(t),s=0;s<n.length;s++){var o=n[s];this[o]=t[o]}this.options||(this.options=r.defaults)}var s=n("../../common/node_modules/react/react.js");r.defaults={sanitize:!1,langPrefix:"lang-",headerPrefix:""},r.prototype.render=function(e){return this.renderTokens(e)},r.prototype.renderChildren=function(e){return e.children?this.renderTokens(e.children):null},r.prototype.renderTokens=function(e,t){for(var n=[],r=0;r<e.length;r++){var s=this.renderToken(e[r],r);if(s instanceof Array)for(var o=0,i=s;o<i.length;o++)n.push(i[o]);else s&&n.push(s)}return n},r.prototype.renderToken=function(e,t){switch(e.type){case"code":return this.renderCode(e,t);case"blockquote":return this.renderBlockquote(e,t);case"html":return this.renderHtml(e,t);case"heading":return this.renderHeading(e,t);case"hr":return this.renderHorizontalLine(e,t);case"list":return this.renderList(e,t);case"list_item":return this.renderListItem(e,t);case"loose_item":return this.renderLooseItem(e,t);case"paragraph":return this.renderParagraph(e,t);case"table":return this.renderTable(e,t);case"table_header":return this.renderTableHeader(e,t);case"table_row":return this.renderTableRow(e,t);case"table_header_cell":return this.renderTableHeaderCell(e,t);case"table_row_cell":return this.renderTableRowCell(e,t);case"strong":return this.renderStrong(e,t);case"em":return this.renderEmphasized(e,t);case"codespan":return this.renderCodeSpan(e,t);case"del":return this.renderDeleted(e,t);case"br":return this.renderLineBreak(e,t);case"link":return this.renderLink(e,t);case"autolink":return this.renderAutolink(e,t);case"url":return this.renderUrl(e,t);case"image":return this.renderImage(e,t);case"text":return this.renderText(e,t);case"text_block":return this.renderTextBlock(e,t);case"html_block":return this.renderHtmlBlock(e,t);case"space":return this.renderSpace(e,t);case"def":return this.renderRefDefinition(e,t);default:throw new Error("Unrecognized token: "+e.type)}},r.prototype.renderCode=function(e,t){var n,r=e.text,o=e.lang;return o&&(n=this.options.langPrefix+o),s.createElement("pre",{key:t},s.createElement("code",{className:n},r,"\n"))},r.prototype.renderBlockquote=function(e,t){return s.createElement("blockquote",{key:t},this.renderChildren(e))},r.prototype.renderHtml=function(e,t){return null},r.prototype.renderHeading=function(e,t){var n=this.options.headerPrefix+e.name;return s.createElement("h"+e.depth,{id:n,key:t},this.renderChildren(e))},r.prototype.renderHorizontalLine=function(e,t){return s.createElement("hr",{key:t})},r.prototype.renderList=function(e,t){return e.ordered?s.createElement("ol",{key:t},this.renderChildren(e)):s.createElement("ul",{key:t},this.renderChildren(e))},r.prototype.renderLooseItem=r.prototype.renderListItem=function(e,t){return s.createElement("li",{key:t},this.renderChildren(e))},r.prototype.renderParagraph=function(e,t){return s.createElement("p",{key:t},this.renderChildren(e))},r.prototype.renderTable=function(e,t){var n=e.children,r=s.createElement("thead",null,this.renderTableHeader(n[0])),o=s.createElement("tbody",null,this.renderTokens(n.slice(1)));return s.createElement("table",{key:t},r,o)},r.prototype.renderTableHeader=r.prototype.renderTableRow=function(e,t){return s.createElement("tr",{key:t},this.renderChildren(e))},r.prototype.renderTableHeaderCell=function(e,t){return s.createElement("th",{key:t,style:{textALign:e.align}},this.renderChildren(e))},r.prototype.renderTableRowCell=function(e,t){return s.createElement("td",{key:t,style:{textALign:e.align}},this.renderChildren(e))},r.prototype.renderStrong=function(e,t){return s.createElement("strong",{key:t},this.renderChildren(e))},r.prototype.renderEmphasized=function(e,t){return s.createElement("em",{key:t},this.renderChildren(e))},r.prototype.renderCodeSpan=function(e,t){var n=e.text;return s.createElement("code",{key:t},n)},r.prototype.renderLineBreak=function(e,t){return s.createElement("br",{key:t})},r.prototype.renderDeleted=function(e,t){return s.createElement("del",{key:t},this.renderChildren(e))},r.prototype.renderUrl=r.prototype.renderAutolink=function(e,t){if(!this.sanitizeUrl(e.href))return"";var n=e.href,r=e.text;return s.createElement("a",{key:t,href:n},r)},r.prototype.renderLink=function(e,t){if(!this.sanitizeUrl(e.href))return null;var n=e.href,r=e.title;return s.createElement("a",{key:t,href:n,title:r},this.renderChildren(e))},r.prototype.sanitizeUrl=function(e){if(this.options.sanitize){try{var t=decodeURIComponent(e).replace(/[^\w:]/g,"").toLowerCase()}catch(e){return!1}if(0===t.indexOf("javascript:")||0===t.indexOf("vbscript:")||0===t.indexOf("data:"))return!1}return!0},r.prototype.renderImage=function(e,t){var n=e.href,r=e.title,o=e.text;return s.createElement("img",{key:t,src:n,alt:o,title:r})},r.prototype.renderText=function(e,t){return e.text},r.prototype.renderHtmlBlock=r.prototype.renderTextBlock=function(e,t){return e.paragraph?this.renderParagraph(e,t):this.renderChildren(e)},r.prototype.renderRefDefinition=r.prototype.renderSpace=function(e,t){return null},e.exports=r},"../../common/node_modules/mark-gor/react.js":function(e,t,n){function r(e,t){var n=new s({options:u(t,s.defaults)}),r=new a({options:u(t,a.defaults)}),o=n.parse(e);return r.render(o)}var s=n("../../common/node_modules/mark-gor/lib/parser.js"),o=n("../../common/node_modules/mark-gor/lib/block-lexer.js"),i=n("../../common/node_modules/mark-gor/lib/inline-lexer.js"),a=n("../../common/node_modules/mark-gor/lib/react-renderer.js"),c=n("../../common/node_modules/mark-gor/lib/helpers.js"),l=c.merge,u=c.pick;t.parse=r,t.defaults=l({},s.defaults,a.defaults),t.BlockLexer=o,t.InlineLexer=i,t.Parser=s,t.Renderer=a},"../../common/node_modules/next-tick/index.js":function(e,t,n){"use strict";(function(t,n){var r,s;r=function(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return e},s=function(e){var t,n,s=document.createTextNode(""),o=0;return new e(function(){var e;if(t)n&&(t=n.concat(t));else{if(!n)return;t=n}if(n=t,t=null,"function"==typeof n)return e=n,n=null,void e();for(s.data=o=++o%2;n;)e=n.shift(),n.length||(n=null),e()}).observe(s,{characterData:!0}),function(e){if(r(e),t)return void("function"==typeof t?t=[t,e]:t.push(e));t=e,s.data=o=++o%2}},e.exports=function(){if("object"==typeof t&&t&&"function"==typeof t.nextTick)return t.nextTick;if("object"==typeof document&&document){if("function"==typeof MutationObserver)return s(MutationObserver);if("function"==typeof WebKitMutationObserver)return s(WebKitMutationObserver)}return"function"==typeof n?function(e){n(r(e))}:"function"==typeof setTimeout||"object"==typeof setTimeout?function(e){setTimeout(r(e),0)}:null}()}).call(t,n("../node_modules/process/browser.js"),n("../node_modules/timers-browserify/main.js").setImmediate)},"../../common/node_modules/react-easy-emoji/index.js":function(e,t,n){var r=n("../../common/node_modules/react-easy-emoji/lib/replaceEmoji.js"),s=n("../../common/node_modules/react-easy-emoji/lib/makeTwemojiRenderer.js");e.exports=function(e,t){var n="function"==typeof t?t:s(t);return r(e,n)}},"../../common/node_modules/react-easy-emoji/lib/makeTwemojiRenderer.js":function(e,t,n){function r(e){return e&&e.length>0&&":"!==e.charAt(e.length-1)?e+":":e}var s=n("../../common/node_modules/react/react.js"),o=n("../../common/node_modules/lodash.assign/index.js"),i="undefined"==typeof location?"":"https:"===location.protocol?"https:":"http:",a={height:"1em",width:"1em",margin:"0 .05em 0 .1em",verticalAlign:"-0.1em"};e.exports=function(e){return e=o({},{protocol:i,baseUrl:"//twemoji.maxcdn.com/2/",size:"72x72",ext:".png",props:null},e),function(t,n,i){var c=r(e.protocol)+e.baseUrl+e.size+"/"+t+e.ext;return s.createElement("img",o({key:i,alt:n,draggable:!1,src:c,style:a},e.props))}}},"../../common/node_modules/react-easy-emoji/lib/replaceEmoji.js":function(e,t,n){function r(e,t){for(var n=[],r=0,s=0,o=0;o<e.length;)r=e.charCodeAt(o++),s?(n.push((65536+(s-55296<<10)+(r-56320)).toString(16)),s=0):55296<=r&&r<=56319?s=r:n.push(r.toString(16));return n.join(t||"-")}function s(e){return r(e.indexOf(c)<0?e.replace(a,""):e)}var o=n("../../common/node_modules/string-replace-to-array/string-replace-to-array.js"),i=/\ud83d[\udc68-\udc69](?:\ud83c[\udffb-\udfff])?\u200d(?:\u2695\ufe0f|\u2696\ufe0f|\u2708\ufe0f|\ud83c[\udf3e\udf73\udf93\udfa4\udfa8\udfeb\udfed]|\ud83d[\udcbb\udcbc\udd27\udd2c\ude80\ude92])|(?:\ud83c[\udfcb\udfcc]|\ud83d\udd75|\u26f9)(?:\ufe0f|\ud83c[\udffb-\udfff])\u200d[\u2640\u2642]\ufe0f|(?:\ud83c[\udfc3\udfc4\udfca]|\ud83d[\udc6e\udc71\udc73\udc77\udc81\udc82\udc86\udc87\ude45-\ude47\ude4b\ude4d\ude4e\udea3\udeb4-\udeb6]|\ud83e[\udd26\udd37-\udd39\udd3d\udd3e\uddd6-\udddd])(?:\ud83c[\udffb-\udfff])?\u200d[\u2640\u2642]\ufe0f|\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d[\udc68\udc69]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc68|\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d[\udc68\udc69]|\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83c\udff3\ufe0f\u200d\ud83c\udf08|\ud83c\udff4\u200d\u2620\ufe0f|\ud83d\udc41\u200d\ud83d\udde8|\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc6f\u200d\u2640\ufe0f|\ud83d\udc6f\u200d\u2642\ufe0f|\ud83e\udd3c\u200d\u2640\ufe0f|\ud83e\udd3c\u200d\u2642\ufe0f|\ud83e\uddde\u200d\u2640\ufe0f|\ud83e\uddde\u200d\u2642\ufe0f|\ud83e\udddf\u200d\u2640\ufe0f|\ud83e\udddf\u200d\u2642\ufe0f|(?:[\u0023\u002a\u0030-\u0039])\ufe0f?\u20e3|(?:(?:\ud83c[\udfcb\udfcc]|\ud83d[\udd74\udd75\udd90]|[\u261d\u26f7\u26f9\u270c\u270d])(?:\ufe0f|(?!\ufe0e))|\ud83c[\udf85\udfc2-\udfc4\udfc7\udfca]|\ud83d[\udc42\udc43\udc46-\udc50\udc66-\udc69\udc6e\udc70-\udc78\udc7c\udc81-\udc83\udc85-\udc87\udcaa\udd7a\udd95\udd96\ude45-\ude47\ude4b-\ude4f\udea3\udeb4-\udeb6\udec0\udecc]|\ud83e[\udd18-\udd1c\udd1e\udd1f\udd26\udd30-\udd39\udd3d\udd3e\uddd1-\udddd]|[\u270a\u270b])(?:\ud83c[\udffb-\udfff]|)|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc65\udb40\udc6e\udb40\udc67\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc73\udb40\udc63\udb40\udc74\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc77\udb40\udc6c\udb40\udc73\udb40\udc7f|\ud83c\udde6\ud83c[\udde8-\uddec\uddee\uddf1\uddf2\uddf4\uddf6-\uddfa\uddfc\uddfd\uddff]|\ud83c\udde7\ud83c[\udde6\udde7\udde9-\uddef\uddf1-\uddf4\uddf6-\uddf9\uddfb\uddfc\uddfe\uddff]|\ud83c\udde8\ud83c[\udde6\udde8\udde9\uddeb-\uddee\uddf0-\uddf5\uddf7\uddfa-\uddff]|\ud83c\udde9\ud83c[\uddea\uddec\uddef\uddf0\uddf2\uddf4\uddff]|\ud83c\uddea\ud83c[\udde6\udde8\uddea\uddec\udded\uddf7-\uddfa]|\ud83c\uddeb\ud83c[\uddee-\uddf0\uddf2\uddf4\uddf7]|\ud83c\uddec\ud83c[\udde6\udde7\udde9-\uddee\uddf1-\uddf3\uddf5-\uddfa\uddfc\uddfe]|\ud83c\udded\ud83c[\uddf0\uddf2\uddf3\uddf7\uddf9\uddfa]|\ud83c\uddee\ud83c[\udde8-\uddea\uddf1-\uddf4\uddf6-\uddf9]|\ud83c\uddef\ud83c[\uddea\uddf2\uddf4\uddf5]|\ud83c\uddf0\ud83c[\uddea\uddec-\uddee\uddf2\uddf3\uddf5\uddf7\uddfc\uddfe\uddff]|\ud83c\uddf1\ud83c[\udde6-\udde8\uddee\uddf0\uddf7-\uddfb\uddfe]|\ud83c\uddf2\ud83c[\udde6\udde8-\udded\uddf0-\uddff]|\ud83c\uddf3\ud83c[\udde6\udde8\uddea-\uddec\uddee\uddf1\uddf4\uddf5\uddf7\uddfa\uddff]|\ud83c\uddf4\ud83c\uddf2|\ud83c\uddf5\ud83c[\udde6\uddea-\udded\uddf0-\uddf3\uddf7-\uddf9\uddfc\uddfe]|\ud83c\uddf6\ud83c\udde6|\ud83c\uddf7\ud83c[\uddea\uddf4\uddf8\uddfa\uddfc]|\ud83c\uddf8\ud83c[\udde6-\uddea\uddec-\uddf4\uddf7-\uddf9\uddfb\uddfd-\uddff]|\ud83c\uddf9\ud83c[\udde6\udde8\udde9\uddeb-\udded\uddef-\uddf4\uddf7\uddf9\uddfb\uddfc\uddff]|\ud83c\uddfa\ud83c[\udde6\uddec\uddf2\uddf3\uddf8\uddfe\uddff]|\ud83c\uddfb\ud83c[\udde6\udde8\uddea\uddec\uddee\uddf3\uddfa]|\ud83c\uddfc\ud83c[\uddeb\uddf8]|\ud83c\uddfd\ud83c\uddf0|\ud83c\uddfe\ud83c[\uddea\uddf9]|\ud83c\uddff\ud83c[\udde6\uddf2\uddfc]|\ud800\udc00|\ud83c[\udccf\udd8e\udd91-\udd9a\udde6-\uddff\ude01\ude32-\ude36\ude38-\ude3a\ude50\ude51\udf00-\udf20\udf2d-\udf35\udf37-\udf7c\udf7e-\udf84\udf86-\udf93\udfa0-\udfc1\udfc5\udfc6\udfc8\udfc9\udfcf-\udfd3\udfe0-\udff0\udff4\udff8-\udfff]|\ud83d[\udc00-\udc3e\udc40\udc44\udc45\udc51-\udc65\udc6a-\udc6d\udc6f\udc79-\udc7b\udc7d-\udc80\udc84\udc88-\udca9\udcab-\udcfc\udcff-\udd3d\udd4b-\udd4e\udd50-\udd67\udda4\uddfb-\ude44\ude48-\ude4a\ude80-\udea2\udea4-\udeb3\udeb7-\udebf\udec1-\udec5\uded0-\uded2\udeeb\udeec\udef4-\udef8]|\ud83e[\udd10-\udd17\udd1d\udd20-\udd25\udd27-\udd2f\udd3a\udd3c\udd40-\udd45\udd47-\udd4c\udd50-\udd6b\udd80-\udd97\uddc0\uddd0\uddde-\udde6]|[\u23e9-\u23ec\u23f0\u23f3\u2640\u2642\u2695\u26ce\u2705\u2728\u274c\u274e\u2753-\u2755\u2795-\u2797\u27b0\u27bf\ue50a]|(?:\ud83c[\udc04\udd70\udd71\udd7e\udd7f\ude02\ude1a\ude2f\ude37\udf21\udf24-\udf2c\udf36\udf7d\udf96\udf97\udf99-\udf9b\udf9e\udf9f\udfcd\udfce\udfd4-\udfdf\udff3\udff5\udff7]|\ud83d[\udc3f\udc41\udcfd\udd49\udd4a\udd6f\udd70\udd73\udd76-\udd79\udd87\udd8a-\udd8d\udda5\udda8\uddb1\uddb2\uddbc\uddc2-\uddc4\uddd1-\uddd3\udddc-\uddde\udde1\udde3\udde8\uddef\uddf3\uddfa\udecb\udecd-\udecf\udee0-\udee5\udee9\udef0\udef3]|[\u00a9\u00ae\u203c\u2049\u2122\u2139\u2194-\u2199\u21a9\u21aa\u231a\u231b\u2328\u23cf\u23ed-\u23ef\u23f1\u23f2\u23f8-\u23fa\u24c2\u25aa\u25ab\u25b6\u25c0\u25fb-\u25fe\u2600-\u2604\u260e\u2611\u2614\u2615\u2618\u2620\u2622\u2623\u2626\u262a\u262e\u262f\u2638-\u263a\u2648-\u2653\u2660\u2663\u2665\u2666\u2668\u267b\u267f\u2692-\u2694\u2696\u2697\u2699\u269b\u269c\u26a0\u26a1\u26aa\u26ab\u26b0\u26b1\u26bd\u26be\u26c4\u26c5\u26c8\u26cf\u26d1\u26d3\u26d4\u26e9\u26ea\u26f0-\u26f5\u26f8\u26fa\u26fd\u2702\u2708\u2709\u270f\u2712\u2714\u2716\u271d\u2721\u2733\u2734\u2744\u2747\u2757\u2763\u2764\u27a1\u2934\u2935\u2b05-\u2b07\u2b1b\u2b1c\u2b50\u2b55\u3030\u303d\u3297\u3299])(?:\ufe0f|(?!\ufe0e))/g,a=/\uFE0F/g,c=String.fromCharCode(8205);e.exports=function(e,t){return o(e,i,function(e,n){var r=s(e);return t(r,e,n)})}},"../../common/node_modules/string-replace-to-array/string-replace-to-array.js":function(e,t,n){function r(e,t,n){return i("string"==typeof e,"First param must be a string"),i("string"==typeof t||t instanceof RegExp,"Second param must be a string pattern or a regular expression"),("string"==typeof t?s:o)(e,t,n)}function s(e,t,n){var r=e.indexOf(t);if(r>=0){var s=[],o=r+t.length;return r>0&&s.push(e.substring(0,r)),s.push("function"==typeof n?n(e.substring(r,o),r,e):n),o<e.length&&s.push(e.substring(o)),s}return[e]}function o(e,t,n){var r=[],s="function"==typeof n,o=t.lastIndex;t.lastIndex=0;for(var i,a=0;i=t.exec(e);){var c=i.index;""===i[0]&&t.lastIndex++,c!==a&&r.push(e.substring(a,c));a=c+i[0].length;var l=s?n.apply(this,i.concat(c,i.input)):n;if(r.push(l),!t.global)break}return a<e.length&&r.push(e.substring(a)),t.lastIndex=o,r}var i=n("../../common/node_modules/invariant/browser.js"),a=n("../../common/node_modules/lodash.isstring/index.js"),c=n("../../common/node_modules/lodash.flatten/index.js");e.exports=function(e,t,n){if(a(e))return r(e,t,n);if(Array.isArray(e)&&e[0])return c(e.map(function(e){return a(e)?r(e,t,n):e}));throw new TypeError("First argument must be an array or non-empty string")}},"../../common/src/data/database.js":function(e,t,n){"use strict";function r(e,t,n){this.context=t||{},this.remoteDataSource=e,this.online=n}function s(e,t){return o.assign({},e,t)}var o=n("../../common/node_modules/lodash/lodash.js");n("../../common/node_modules/bluebird/js/browser/bluebird.js"),n("../../common/src/errors/http-error.js");e.exports=r,r.prototype.find=function(e){return e=s(this.context,e),this.remoteDataSource.find(e)},r.prototype.findOne=function(e){return e=o.extend({expected:1},e),this.find(e).then(function(e){return e[0]||null})},r.prototype.save=function(e,t,n){return e=s(this.context,e),this.remoteDataSource.save(e,t,n)},r.prototype.saveOne=function(e,t,n){return this.save(e,[t],n).then(function(e){return e.length>0?e[0]:null})},r.prototype.remove=function(e,t){return e=s(this.context,e),this.remoteDataSource.remove(e,t)},r.prototype.removeOne=function(e,t){return this.remove(e,[t]).then(function(e){return e.length>0?e[0]:null})},r.prototype.await=function(e,t,n){return e=s(this.context,e),this.remoteDataSource.await(e,t,n)},r.prototype.refresh=function(e,t){return e=s(this.context,e),this.remoteDataSource.refresh(e,t)},r.prototype.use=function(){var e={};o.assign(e,this.context);for(var t=arguments.length,n=Array(t),s=0;s<t;s++)n[s]=arguments[s];return o.each(n,function(t){o.assign(e,t)}),new r(this.remoteDataSource,e)},r.prototype.start=function(e){return e=s(this.context,e),this.remoteDataSource.start(e)},r.prototype.beginSession=function(e){return this.remoteDataSource.beginSession(this.context,e)},r.prototype.checkSession=function(){return this.remoteDataSource.checkSession(this.context)},r.prototype.hasAuthorization=function(){return this.remoteDataSource.hasAuthorization(this.context)},r.prototype.restoreSession=function(e){this.remoteDataSource.restoreSession(e)},r.prototype.submitPassword=function(e,t){return this.remoteDataSource.submitPassword(this.context,e,t)},r.prototype.endSession=function(){return this.remoteDataSource.endSession(this.context)},r.prototype.beginMobileSession=function(e){return this.remoteDataSource.beginMobileSession(this.context,e)},r.prototype.acquireMobileSession=function(e){return this.remoteDataSource.acquireMobileSession(this.context,e)},r.prototype.releaseMobileSession=function(){return this.remoteDataSource.releaseMobileSession(this.context)},r.prototype.endMobileSession=function(e){return this.remoteDataSource.endMobileSession(this.context,e)},r.prototype.getOAuthURL=function(e,t){return this.remoteDataSource.getOAuthURL(this.context,e,t)},r.prototype.findTemporaryID=function(e,t){return e=s(this.context,e),this.remoteDataSource.findTemporaryID(e,t)},r.prototype.findPermanentID=function(e,t){return e=s(this.context,e),this.remoteDataSource.findPermanentID(e,t)}},"../../common/src/data/empty.js":function(e,t,n){"use strict";e.exports={array:[],object:{},string:"",func:function(){}}},"../../common/src/data/indexed-db-cache.jsx":function(e,t,n){"use strict";var r=function(){function e(e,t){var n=[],r=!0,s=!1,o=void 0;try{for(var i,a=e[Symbol.iterator]();!(r=(i=a.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){s=!0,o=e}finally{try{!r&&a.return&&a.return()}finally{if(s)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),s=n("../../common/node_modules/lodash/lodash.js"),o=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),i=n("../../common/node_modules/react/react.js"),a=i.PropTypes,c=n("../../common/src/data/local-search.js"),l=n("../../common/src/mixins/update-check.js"),u=n("../../common/src/widgets/diagnostics.jsx"),d=n("../../common/src/widgets/diagnostics-section.jsx");e.exports=i.createClass({displayName:"IndexedDBCache",mixins:[l],propTypes:{databaseName:a.string.isRequired},statics:{isAvailable:function(){return!!window.indexedDB}},getInitialState:function(){return this.tables={},{database:null,recordCounts:{},writeCount:0,readCount:0,deleteCount:0}},find:function(e){var t=this,n=e.address||"",r=e.schema,o=e.table,i=e.criteria;return this.fetchTable(n,r,o).then(function(e){var n=t.getObjectKeyName(r),a=[];if(s.isEqual(s.keys(i),[n])){var l=i[n];return l=l instanceof Array?s.sortBy(s.slice(l)):[l],s.each(l,function(t){var r={};r[n]=t;var o=s.sortedIndexBy(e,r,n),i=e[o];i&&i[n]===t&&a.push(i)}),a}return s.each(e,function(e){c.match(o,e,i)&&a.push(e)}),a}).then(function(n){c.limit(o,n,e.criteria);var r=t.state.readCount;return r+=n.length,t.setState({readCount:r}),n})},save:function(e,t){var n=this,r=e.address||"",i=e.schema,a=e.table;return this.open().then(function(e){return new o(function(o,c){var l=n.getTablePath(r,i,a),u=n.getPrimaryKeyGenerator(r,i,a),d=n.getObjectStoreName(i),p=e.transaction(d,"readwrite"),h=p.objectStore(d);p.oncomplete=function(e){o(t)},p.onerror=function(e){c(new Error(e.message))},s.each(t,function(e){var t=u(e),n={address:r,location:l,data:e};h.put(n,t)})})}).then(function(e){var t=n.state.writeCount;return t+=e.length,n.setState({writeCount:t}),n.updateTableEntry(r,i,a,e,!1),n.updateRecordCount(i,500),e})},remove:function(e,t){var n=this,r=e.address||"",i=e.schema,a=e.table;return this.open().then(function(e){return new o(function(o,c){var l=n.getPrimaryKeyGenerator(r,i,a),u=(n.getTablePath(r,i,a),n.getObjectStoreName(i)),d=e.transaction(u,"readwrite"),p=d.objectStore(u);d.oncomplete=function(e){o(t)},d.onerror=function(e){c(new Error(e.message))},s.each(t,function(e){var t=l(e);p.delete(t)})})}).then(function(e){var t=n.state.deleteCount;return t+=e.length,n.setState({deleteCount:t}),n.updateTableEntry(r,i,a,e,!0),n.updateRecordCount(i,500),e})},clean:function(e){var t=this;return this.open().then(function(n){return new o(function(r,o){var i=t.getObjectStoreName("remote"),a=n.transaction(i,"readwrite"),c=a.objectStore(i);if(void 0!=e.address){var l=null;e.schema&&"*"!==e.schema&&(l=e.address+"/"+e.schema+"/");var u=c.index("address"),d=u.openCursor(e.address),p=[],h=[];d.onsuccess=function(e){var t=!0,n=e.target.result;if(n){var o=n.value,i=n.primaryKey;l&&!s.startsWith(o.location,l)||(p.push(o),h.push(i)),n.continue(),t=!1}t&&(s.each(h,function(e){c.delete(e)}),r(p))}}else if(void 0!=e.count){var u=c.index("rtime"),d=u.openCursor(),p=[],h=[];d.onsuccess=function(t){var n=!0,o=t.target.result;if(o){var i=o.value,a=o.primaryKey;p.push(i),h.push(a),p.length<e.count&&(o.continue(),n=!1)}n&&(s.each(h,function(e){c.delete(e)}),r(p))}}else{if(void 0==e.before)return[];var u=c.index("rtime"),d=u.openCursor(),p=[],h=[];d.onsuccess=function(t){var n=!0,o=t.target.result;if(o){var i=o.value,a=o.primaryKey;i.data.rtime<e.before&&(p.push(i),h.push(a),o.continue(),n=!1)}n&&(s.each(h,function(e){c.delete(e)}),r(p))}}})}).then(function(e){var n=e.length;if(n>0){var o=t.state.deleteCount;o+=e.length,t.setState({deleteCount:o}),t.updateRecordCount("remote",500);var i=[];s.each(e,function(e){var t=e.address||"",n=e.location.substr(t.length+1).split("/"),o=r(n,2),a=o[0],c=o[1],l=s.find(i,{address:t,schema:a,table:c});l||(l={address:t,schema:a,table:c,objects:[]},i.push(l)),l.objects.push(e.data)}),s.each(i,function(e){t.updateTableEntry(e.address,e.schema,e.table,e.objects,!0)})}return n}).catch(function(e){return t.destroy()})},open:function(){var e=this;return this.databasePromise||(this.databasePromise=new o(function(t,n){var r=window.indexedDB.open(e.props.databaseName,1);r.onsuccess=function(n){var r=n.target.result;t(r),e.setState({database:r})},r.onerror=function(e){n(new Error(e.message))},r.onupgradeneeded=function(e){var t=e.target.result;t.onerror=function(e){n(new Error(e.message))},t.createObjectStore("local-data").createIndex("location","location",{unique:!1});var r=t.createObjectStore("remote-data");r.createIndex("location","location",{unique:!1}),r.createIndex("address","address",{unique:!1}),r.createIndex("rtime","data.rtime",{unique:!1})}})),this.databasePromise},destroy:function(){var e=this;return new o(function(t,n){var r=window.indexedDB.deleteDatabase(e.props.databaseName);r.onsuccess=function(e){t(!0)},r.onerror=function(e){t(!1)}})},reset:function(e,t){var n="local"===t?["local"]:s.filter(["remote",e,t]);s.unset(this.tables,n)},getObjectStoreName:function(e){return"local"===e?"local-data":"remote-data"},getObjectKeyName:function(e){return"local"===e?"key":"id"},getTablePath:function(e,t,n){return"local"===t?n:e+"/"+t+"/"+n},getPrimaryKeyGenerator:function(e,t,n){var r=this.getTablePath(e,t,n);return"local"===t?function(e){return r+"/"+e.key}:function(e){var t=("0000000000"+e.id).slice(-10);return r+"/"+t}},getTableEntry:function(e,t,n){var r="local"===t?["local",n]:["remote",e,t,n],o=s.get(this.tables,r);return o||(o={promise:null,objects:null},s.set(this.tables,r,o)),o},updateTableEntry:function(e,t,n,r,o){var i=this.getTableEntry(e,t,n);if(i.objects){var a=this.getObjectKeyName(t);s.each(r,function(e){var t=s.sortedIndexBy(i.objects,e,a),n=i.objects[t];n&&n[a]===e[a]?o?i.objects.splice(t,1):i.objects[t]=e:o||i.objects.splice(t,0,e)})}},fetchTable:function(e,t,n){var r=this.getTableEntry(e,t,n);return r.promise||(r.promise=this.loadTable(e,t,n).then(function(e){return r.objects=e,r.objects})),r.promise},loadTable:function(e,t,n){var r=this;return this.open().then(function(i){return new o(function(o,a){var c=r.getObjectStoreName(t),l=r.getObjectKeyName(t),u=i.transaction(c,"readonly"),d=u.objectStore(c),p=d.index("location"),h=r.getTablePath(e,t,n),m=p.openCursor(h),f=[];m.onsuccess=function(e){var t=e.target.result;if(t){var n=t.value,r=n.data,i=s.sortedIndexBy(f,r,l);f.splice(i,0,r),t.continue()}else o(f)}})})},updateRecordCount:function(e,t){var n=this,r=this.getObjectStoreName(e),o="updateRecordCountTimeouts."+r,i=s.get(this,o);i&&clearTimeout(i),i=setTimeout(function(){n.open().then(function(e){e.transaction(r,"readonly").objectStore(r).count().onsuccess=function(e){var t=s.clone(n.state.recordCounts);t[r]=e.target.result,n.setState({recordCounts:t})}}).catch(function(e){}),s.set(n,o,0)},t||0),s.set(this,o,i)},componentDidMount:function(){this.updateRecordCount("remote"),this.updateRecordCount("local")},render:function(){var e=this.state.database,t=s.get(this.state.recordCounts,"local-data"),n=s.get(this.state.recordCounts,"remote-data");return i.createElement(u,{type:"indexed-db-cache"},i.createElement(d,{label:"Database details"},i.createElement("div",null,"Name: ",e?e.name:""),i.createElement("div",null,"Version: ",e?e.version:"")),i.createElement(d,{label:"Usage"},i.createElement("div",null,"Local objects: ",t),i.createElement("div",null,"Remote objects: ",n),i.createElement("div",null,"Objects read: ",this.state.readCount),i.createElement("div",null,"Objects written: ",this.state.writeCount),i.createElement("div",null,"Objects deleted: ",this.state.deleteCount)))}})},"../../common/src/data/local-search.js":function(e,t,n){"use strict";function r(e,t,n){var r=!0;for(var s in n){var a=n[s];if(void 0!==a){if(t.hasOwnProperty(s)){var c=t[s];if(a instanceof Array)if(c instanceof Array)0===i.intersection(a,c).length&&(r=!1);else{var l;l=c instanceof Object?i.some(a,function(e){return i.isEqual(e,c)}):i.includes(a,c),l||(r=!1)}else if(c!==a){"object"===(void 0===c?"undefined":o(c))&&"object"===(void 0===a?"undefined":o(a))?i.isEqual(c,a)||(r=!1):r=!1;break}}else switch(s){case"time_range":if(a){var u=a.substr(1,a.length-2).split(","),d=u[0],p=u[1];d<=t.ptime&&t.ptime<p||(r=!1)}break;case"exclude":a instanceof Array?i.includes(a,t.id)&&(r=!1):a===t.id&&(r=!1);break;case"newer_than":!t.ptime||t.ptime>a||(r=!1);break;case"older_than":!t.ptime||t.ptime<a||(r=!1);break;case"search":r=!1}if(!r)break}}return r}function s(e,t,n){if(n&&(n.limit&&t.length>n.limit&&t.splice(0,t.length-n.limit),n.per_user_limit)){var r=n.per_user_limit,s={},o=[];i.eachRight(t,function(e){var t=!1;if(e.hasOwnProperty("user_id")){var n=e.user_id,a=s[n]||0;a<r&&(s[n]=a+1,t=!0)}else e.hasOwnProperty("user_ids")&&i.each(e.user_ids,function(e){var n=s[e]||0;n<r&&(s[e]=n+1,t=!0)});t||o.push(e)}),i.pullAll(t,o)}}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=n("../../common/node_modules/lodash/lodash.js");e.exports={match:r,limit:s}},"../../common/src/data/local-storage-cache.jsx":function(e,t,n){"use strict";function r(e){try{return JSON.parse(e)}catch(e){return null}}function s(e,t,n){var r={};r[n]=t;var s=a.sortedIndexBy(e,r,n),o=e[s];if(o&&o[n]===t)return o}function o(e,t,n){var r=a.sortedIndexBy(e,t,n),s=e[r];s&&s[n]===t[n]?e[r]=t:e.splice(r,0,t)}function i(e,t,n){var r=a.sortedIndexBy(e,t,n),s=e[r];s&&s[n]===t[n]&&e.splice(r,1)}var a=n("../../common/node_modules/lodash/lodash.js"),c=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),l=n("../../common/node_modules/react/react.js"),u=l.PropTypes,d=n("../../common/src/data/local-search.js");e.exports=l.createClass({displayName:"LocalStorageCache",propTypes:{databaseName:u.string.isRequired},statics:{isAvailable:function(){return!!window.localStorage}},getInitialState:function(){var e=localStorage.getItem(this.props.databaseName);return this.localData=r(e)||{},this.remoteData={},{}},getRows:function(e,t,n){var r="local"===t?this.localData:this.remoteData,s=a.filter([e,t,n]),o=a.get(r,s);return o||(o=[],a.set(r,s,o)),o},getKeyName:function(e){return"local"===e?"key":"id"},saveRows:function(e,t,n){if("local"===t){var r=JSON.stringify(this.localData);localStorage.setItem(this.props.databaseName,r)}},find:function(e){var t,n=e.server||"",r=e.schema,o=e.table,i=e.criteria,l=this.getRows(n,r,o),u=this.getKeyName(r);if(i&&void 0!==i.id&&1===a.size(i)){var p=i.id;p instanceof Array||(p=[p]),t=a.filter(a.map(p,function(e){return s(l,e,u)}))}else t=a.filter(l,function(e){return d.match(o,e,i)});return d.limit(o,t,i),c.resolve(t)},save:function(e,t){var n=e.server||"",r=e.schema,s=e.table,i=this.getRows(n,r,s),l=this.getKeyName(r);return a.each(t,function(e){o(i,a.cloneDeep(e),l)}),this.saveRows(n,r,s),c.resolve(t)},remove:function(e,t){var n=e.server||"",r=e.schema,s=e.table,o=this.getRows(n,r,s),l=this.getKeyName(r);return a.each(t,function(e){i(o,e,l)}),this.saveRows(n,r,s),c.resolve(t)},clean:function(e){var t=this.remoteData,n=0;if(void 0!==e.server){var r=e.server,s=a.get(t,r);a.each(s,function(e){a.each(e,function(e){n+=e.length})}),a.set(t,r,void 0)}else if(void 0!==e.count){var o=[];a.each(t,function(e){a.each(e,function(e){a.each(e,function(e){for(var t=0;t<e.length;t++)o.push(e[t])})})}),o.sort(function(e,t){return e.rtime<t.rtime?-1:e.rtime>t.rtime?1:0}),o.splice(e.count),a.each(t,function(e){a.each(e,function(e){a.each(e,function(e){for(var t=e.length-1;t>=0;t--){var r=e[t];-1!==o.indexOf(r)&&(e.splice(t,1),n++)}})})})}else void 0!==e.before&&a.each(t,function(t){a.each(t,function(t){a.each(t,function(t){for(var r=t.length-1;r>=0;r--){t[r].rtime<e.before&&(t.splice(r,1),n++)}})})});return c.resolve(n)},reset:function(e,t){if("local"!==t){var n=a.filter([e,t]);a.unset(this.remoteData,n)}},render:function(){return l.createElement("div",null)}})},"../../common/src/data/merger.js":function(e,t,n){"use strict";function r(e,t,n,o){var i={},c=l.union(l.keys(e),l.keys(t));return l.each(c,function(c){var u,d=e?e[c]:void 0,p=t?t[c]:void 0,h=n?n[c]:void 0;if(l.isEqual(d,p))u=l.cloneDeep(d);else if(l.isEqual(d,h))u=l.cloneDeep(p);else if(l.isEqual(p,h))u=l.cloneDeep(d);else{var m=o?o[c]:void 0;u=a(d)&&a(p)?r(d,p,h,m):"string"==typeof d||"string"==typeof p?s(d,p,h):"function"==typeof m?m(d,p,h):p}void 0!==u&&(i[c]=u)}),i}function s(e,t,n){"string"!=typeof e&&(e=""),"string"!=typeof t&&(t=""),"string"!=typeof n&&(n="");for(var r=u.diffSentences(e,t),s=o(n,t),a=[],c=0;c<r.length;c++){var l=r[c];if(l.removed){var e=l.value,t="";r[c+1]&&r[c+1].added&&(t=r[c+1].value,c++),a.push({a:e,b:t})}else if(l.added){var e="",t=l.value;a.push({a:e,b:t})}else a.push(l.value)}for(var d=0,p=0,h=[],c=0;c<a.length;c++){var m=a[c];"string"==typeof m?(h.push(m),d+=m.length,p+=m.length):(i(p,m.b.length,s)?h.push(m.a):h.push(m.b),d+=m.a.length,p+=m.b.length)}return h.join("")}function o(e,t){for(var n=[],r=u.diffSentences(e,t),s=0,o=0,i=0;i<r.length;i++){var a=r[i],c=a.value.length;a.removed?o+=c:a.added?s+=c:(n.push({index:s,length:c}),o+=c,s+=c)}return n}function i(e,t,n){for(var r=0;r<n.length;r++){var s=n[r];if(s.index<=e&&e+t<=s.index+s.length)return!0}return!1}function a(e){return"object"===(void 0===e?"undefined":c(e))&&e.constructor===Object}var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=n("../../common/node_modules/lodash/lodash.js"),u=n("../../common/node_modules/diff/dist/diff.js");e.exports={mergeObjects:r,mergeStrings:s}},"../../common/src/data/remote-data-source/change.js":function(e,t,n){"use strict";function r(e,t,n){var r=this;this.location=e,this.objects=s.map(t,function(e){return e.uncommitted||(e=s.clone(e),e.id||(e.id=c.allocate()),e.uncommitted=!0),e}),this.removed=s.map(t,function(e){return!1}),this.dispatched=!1,this.delayed=!1,this.dispatching=!1,this.committed=!1,this.canceled=!1,this.timeout=0,this.promise=new o(function(e,t){r.resolvePromise=e,r.rejectPromise=t}),this.dependentPromises=[],this.delivered=null,this.received=null,this.error=null,this.time=null,n&&(n.delay&&(this.delayed=!0,this.timeout=setTimeout(function(){r.delayed=!1,r.dispatching&&(r.dispatching=!1,r.dispatch())},n.delay)),this.onConflict=n.onConflict),this.onDispatch=null}var s=n("../../common/node_modules/lodash/lodash.js"),o=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),i=n("../../common/node_modules/async-do-while/index.js"),a=n("../../common/src/data/local-search.js"),c=n("../../common/src/data/remote-data-source/temporary-id.js");e.exports=r,r.prototype.dispatch=function(){var e=this;if(!this.dispatched&&!this.canceled)return this.delayed?void(this.dispatching=!0):void o.all(this.dependentPromises).then(function(){var t=1,n=1e3;return i.while(function(){return!e.committed&&!e.canceled&&!e.dispatched}),i.do(function(){return e.dispatched=!0,e.onDispatch(e).then(function(t){e.committed=!0,e.received=t,e.time=new Date,e.canceled?e.resolvePromise([]):e.resolvePromise(t)}).catch(function(r){if(!(r.statusCode>=400&&r.statusCode<=499))return e.dispatched=!1,n=Math.min(2*n,1e4),o.delay(n).then(function(){e.canceled?e.resolvePromise([]):t++});e.error=r,e.rejectPromise(r),e.canceled=!0})}),i.end()})},r.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.dispatched||(this.timeout&&clearTimeout(this.timeout),this.resolvePromise([])))},r.prototype.merge=function(e){var t=this;if(s.isEqual(e.location,this.location)){var n=!1;if(s.each(this.objects,function(t,r){var o=s.findIndex(e.objects,{id:t.id});if(-1!==o&&!e.removed[o])if(!e.dispatched||t.id>=1){var i=e.objects[o];s.forIn(i,function(e,n){void 0===t[n]&&(t[n]=e)}),e.removed[o]=!0}else n=!0}),n){var r=e.promise.then(function(){s.each(t.objects,function(t){if(t.id<1){var n=e.findPermanentID(t.id);n&&(t.id=n)}})}).catch(function(e){});this.dependentPromises.push(r)}else s.every(e.removed)&&e.cancel()}},r.prototype.findPermanentID=function(e){var t=s.findIndex(this.delivered,{id:e});if(-1!==t&&this.received){var n=this.received[t];if(n)return n.id}},r.prototype.apply=function(e,t){var n=this;this.canceled||s.isMatch(e,this.location)&&s.each(this.objects,function(r,o){if(!n.removed[o]){var i=s.findIndex(e.results,{id:r.id});if(-1!==i)if(r.deleted&&!t)e.results.splice(i,1);else{var c=a.match(e.table,r,e.criteria);if(c){var l,u=e.results[i],d=s.some(u,function(e,t){if(!r.hasOwnProperty(t))return!0});l=d?s.extend({},u,r):r,e.results[i]=l}else e.results.splice(i,1)}else if(!r.deleted||t){var c=a.match(e.table,r,e.criteria);c&&e.results.push(r)}}})},r.prototype.deliverables=function(){var e=this;return this.delivered=s.filter(this.objects,function(t,n){return!e.removed[n]}),s.map(this.delivered,function(e){return e.id<1?s.omit(e,"id","uncommitted"):s.omit(e,"uncommitted")})},r.prototype.noop=function(){return this.objects=s.filter(this.objects,function(e){return!(e.deleted&&e.id<1)}),s.isEmpty(this.objects)},r.prototype.matchLocation=function(e){return this.location.address===e.address&&(this.location.schema===e.schema&&this.location.table===e.table)}},"../../common/src/data/remote-data-source/index.jsx":function(e,t,n){"use strict";function r(e,t){return c.isEmpty(t)?e:(e=c.slice(e),c.each(t,function(t){var n=c.sortedIndexBy(e,{id:t},"id"),r=e?e[n]:null;r&&r.id===t&&e.splice(n,1)}),e)}function s(e,t){return e=c.slice(e),c.each(t,function(t){var n=c.sortedIndexBy(e,t,"id"),r=e[n];r&&r.id===t.id?e[n]=t:e.splice(n,0,t)}),e}function o(e,t){t||(t="primary");var n=c.find(C,{address:e,type:t});return n||(n={address:e,type:t},C.push(n)),n}function i(e){return c.filter(C,e)}function a(e){c.pull(C,e)}var c=n("../../common/node_modules/lodash/lodash.js"),l=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),u=n("../../common/node_modules/react/react.js"),d=u.PropTypes,p=n("../../common/node_modules/moment/moment.js"),h=n("../../common/src/transport/http-request.js"),m=n("../../common/src/errors/http-error.js"),f=n("../../common/src/data/local-search.js"),g=n("../../common/src/data/remote-data-source/search.js"),v=n("../../common/src/data/remote-data-source/change.js"),b=n("../../common/src/data/remote-data-source/storage.js"),y=n("../../common/src/data/remote-data-source/removal.js"),j=n("../../common/src/mixins/update-check.js"),w=n("../../common/src/widgets/diagnostics.jsx"),x=n("../../common/src/widgets/diagnostics-section.jsx"),k=n("../../common/src/data/remote-data-source/recent-search-table.jsx"),E=n("../../common/src/data/remote-data-source/recent-storage-table.jsx");e.exports=u.createClass({displayName:"RemoteDataSource",mixins:[j],propTypes:{basePath:d.string,discoveryFlags:d.object,retrievalFlags:d.object,online:d.bool,connected:d.bool,inForeground:d.bool,prefetching:d.bool,cache:d.object,cacheValidation:d.bool,refreshInterval:d.number,sessionRetryInterval:d.number,onChange:d.func,onSearch:d.func,onAuthorization:d.func,onExpiration:d.func,onViolation:d.func,onStupefaction:d.func},getDefaultProps:function(){return{basePath:"/srv/data",discoveryFlags:{},retrievalFlags:{},online:!0,connected:!1,inForeground:!0,prefetching:!0,cacheValidation:!0,refreshInterval:900,sessionRetryInterval:5e3}},getInitialState:function(){this.searching=!1,this.disconnected=!1,this.idMappings={},this.cacheValidation={},this.cacheClearing={},this.changeMonitors=[];var e={recentSearchResults:[],recentStorageResults:[],recentRemovalResults:[],changeQueue:[]};return c.assign(this,e),e},updateList:function(e,t){var n=this[e],r=t(n);this[e]=r;var s={};s[e]=r,this.setState(s)},isOnline:function(){return this.props.online},isReceivingNotification:function(){return this.props.connected},beginSession:function(e,t){var n=this,r=e.address,s=o(r);if(!s.promise){var i=r+"/srv/session/",a={responseType:"json",contentType:"json"};s.promise=h.fetch("POST",i,{area:t},a).then(function(e){if(c.assign(s,e.session),s.handle)return{system:e.system,servers:e.servers};throw new m(s.error)}).catch(function(e){throw s.promise=null,setTimeout(n.triggerChangeEvent,n.props.sessionRetryInterval),e})}return s.promise},checkSession:function(e){var t=this,n=e.address,r=o(n),s=r.handle;if(!s)return l.resolve(!1);var i=n+"/srv/session/",a={responseType:"json"};return h.fetch("GET",i,{handle:s},a).then(function(e){if(e&&e.session&&c.assign(r,e.session),r.token)return t.triggerAuthorizationEvent(r),!0;if(r.error)throw new m(r.error);return!1}).catch(function(e){throw r.promise=null,t.triggerChangeEvent(),e})},submitPassword:function(e,t,n){var r=this,s=e.address,i=o(s),a=i.handle;if(!a)return l.resolve(!1);var u=s+"/srv/session/htpasswd/",d={handle:a,username:t,password:n},p={responseType:"json",contentType:"json"};return h.fetch("POST",u,d,p).then(function(e){return c.assign(i,e.session),r.triggerAuthorizationEvent(i),null}).catch(function(e){throw 401!==e.statusCode&&(i.promise=null,r.triggerChangeEvent()),e})},endSession:function(e){var t=this,n=e.address,r=o(n),s=r.handle;return s?l.resolve(r.promise).then(function(){var e=n+"/srv/session/",o={responseType:"json",contentType:"json"};return h.fetch("DELETE",e,{handle:s},o).catch(function(e){console.error(e)}).then(function(){return a(r),t.clearRecentOperations(n),t.clearCachedSchemas(n),t.triggerExpirationEvent(r),null})}):l.resolve(null)},beginMobileSession:function(e,t){var n=e.address,r=o(n,"mobile");if(!r.promise){var s=o(n),i=s.handle,a=n+"/srv/session/",l={responseType:"json",contentType:"json"};r.promise=h.fetch("POST",a,{area:t,handle:i},l).then(function(e){if(c.assign(r,e.session),r.handle)return r.handle;throw m(r.error)}).catch(function(e){throw r.promise=null,e})}return r.promise},acquireMobileSession:function(e,t){var n=this,r=e.address,s=o(r);if(s.handle!==t&&(s.promise=null,s.handle=t),!s.promise){var i=r+"/srv/session/",a={responseType:"json",contentType:"json"};s.promise=h.fetch("GET",i,{handle:t},a).then(function(e){if(c.assign(s,e.session),s.token)return n.triggerAuthorizationEvent(s),s.user_id;throw new m(s.error)}).catch(function(e){throw setTimeout(function(){s.promise=null,s.handle=null},5e3),e})}return s.promise},releaseMobileSession:function(e){var t=e.address,n=o(t,"mobile");return n.promise?n.promise.then(function(){a(n)}):l.resolve()},endMobileSession:function(e,t){var n=e.address,r=n+"/srv/session/",s={responseType:"json",contentType:"json"};return h.fetch("DELETE",r,{handle:t},s).then(function(){return null})},getOAuthURL:function(e,t,n){var r=e.address,s=o(r),i=s.handle;if(!i)return"";var a="sid="+t.id+"&handle="+i;return"activation"===n?a+="&activation=1":"test"===n&&(a+="&test=1"),r+"/srv/session/"+t.type+"/?"+a},hasAuthorization:function(e){return!!o(e.address).token},restoreSession:function(e){if(p(e.etime)>p()&&e.handle&&e.token){var t=o(e.address);c.assign(t,e)}},start:function(e){return l.resolve().then(function(){if("local"===e.schema)return 0;var t=e.address,n=o(t);if(n.token)return n.user_id;throw new m(401)})},find:function(e){var t=this,n=new g(e);if(n.isLocal())return this.searchLocalCache(n).then(function(){return n.results});var r,s=c.get(e,"by.constructor.displayName"),o=e.required,i=e.committed;r=!0===e.blocking?"insufficient":!1===e.blocking?"never":void 0==e.blocking?"insufficient":e.blocking,o&&"never"===r&&(r="incomplete");var a,l=this.findExistingSearch(n);if(l&&l.promise.isRejected()&&(l=null),l){s&&(c.includes(l.by,s)||l.by.push(s));if("expired"===(l.promise.isFulfilled()?l.isFresh(this.props.refreshInterval)?"complete":l.updating?"updating":"expired":"running")){var u=this.searchRemoteDatabase(l).then(function(e){return e&&t.triggerChangeEvent(),l.results}),d=!0;"expired"!==r&&(d=!1),d&&(l.promise=u)}a=l}else n=this.addSearch(n),n.promise=this.searchLocalCache(n).then(function(){var e;if("complete"===(e=n.isMeetingExpectation()?n.isSufficientlyRecent(t.props.refreshInterval)?"complete":"stale":n.isSufficientlyCached()?"incomplete":"insufficient"))return n.results;var s=t.searchRemoteDatabase(n).then(function(e){return e&&t.triggerChangeEvent(),a.results}),o=!0;return"never"===r?o=!1:"stale"===e?"incomplete"!==r&&"insufficient"!==r||(o=!1):"incomplete"===e&&"insufficient"===r&&(o=!1),o?s:n.results}),a=n;return a.promise.then(function(r){if(c.get(t.props.discoveryFlags,"include_uncommitted")&&!0!==i&&(a=t.applyUncommittedChanges(a)),o&&!a.isMeetingExpectation())throw t.triggerStupefactionEvent(e,n.results),new m(404);return a.results})},save:function(e,t,n){var r=this,s=this.addStorage(new b(e,t,n));return s.isLocal()?this.updateLocalDatabase(s).then(function(){return r.triggerChangeEvent(),s.results}):this.updateRemoteDatabase(s).then(function(){return s.cancelled?[]:(r.updateLocalCache(s),r.updateRecentSearchResults(s),r.triggerChangeEvent(),s.results)})},remove:function(e,t){var n=this,r=this.addRemoval(new y(e,t));return r.isLocal()?this.updateLocalDatabase(r).then(function(){return n.triggerChangeEvent(),r.results}):this.updateRemoteDatabase(r).then(function(){return n.updateLocalCache(r),n.updateRecentSearchResults(r),n.triggerChangeEvent(),r.results})},await:function(e,t,n){var r=this,s={location:c.pick(e,"address","schema","table"),id:t.id,promise:null,resolve:null},o=new l(function(e){s.resolve=e});return s.promise=o.timeout(n).then(function(){return!0}).catch(function(e){return!1}).finally(function(){c.pull(r.changeMonitors,s)}),this.changeMonitors.push(s),s.promise},refresh:function(e,t){var n=this.getRelevantRecentSearches(e);c.each(n,function(e){var n=e.results,r=!1,s=c.sortedIndexBy(n,t,"id"),o=n[s];o&&o.id===t.id&&(r=!0),r&&(e.dirty=!0)})},abandon:function(e,t){this.updateList("recentSearchResults",function(n){var r=c.slice(n);return c.each(r,function(n){n.isLocal()||n.address===e&&(t&&n.schema!==t||(n.dirty=!0))}),r}),this.props.cache&&this.props.cache.reset(e,t)},invalidate:function(e){var t=this;if(!e||(e=this.omitOwnChanges(e),!c.isEmpty(e)))return this.reconcileChanges(e).then(function(){var n=[];return t.updateList("recentSearchResults",function(t){var r=c.slice(t);return c.each(r,function(t){if(!t.dirty){var r;r=!e||c.some(e,function(e){if(t.matchLocation(e)){if(!t.isMeetingExpectation())return!0;var n=c.sortedIndexBy(t.results,{id:e.id},"id"),r=t.results[n];if(r&&r.id===e.id)return!0}}),r&&(t.dirty=!0,n.push(t))}}),r}),!c.isEmpty(n)&&(t.props.online&&t.props.connected&&(t.triggerChangeEvent(),t.props.prefetching&&t.schedulePrefetch(n)),!0)})},revalidate:function(e){this.cacheValidation=c.mapValues(this.cacheValidation,function(t,n){return c.omitBy(t,function(t,r){return!e||(e.address===n&&("*"===e.schema||e.schema===r)||void 0)})})},triggerChangeMonitors:function(e,t){c.each(this.changeMonitors,function(n){c.isEqual(e,n.location)&&c.includes(t,n.id)&&n.resolve()})},omitOwnChanges:function(e){var t=this;return e?c.filter(e,function(e){var n=c.filter(t.changeQueue,function(t){if(t.dispatched&&!t.failed&&t.matchLocation(e))return!0});return!c.some(n,function(t){return t.committed?c.some(t.received,function(t){if(t.id===e.id&&t.gn>=e.gn)return!0}):c.some(t.delivered,function(t){if(t.id===e.id)return!0})})}):null},reconcileChanges:function(e){var t=this;return l.each(this.state.changeQueue,function(n){if(!1!==n.onConflict&&!n.dispatched){var r=c.filter(e,function(e){return n.matchLocation(e)}),s=c.filter(n.objects,function(t,s){if(!n.removed[s])return!e&&t.id>=1||c.some(r,function(e){if(e.id===t.id)return!0})});if(c.isEmpty(s))return null;var o=c.map(s,"id");return t.retrieveRemoteObjects(n.location,o,!0).then(function(e){return c.each(s,function(r){var s=c.find(e,{id:r.id});if(s&&s.gn>r.gn){var o=!1;if(n.onConflict&&n.onConflict({type:"conflict",target:t,local:r,remote:s,preventDefault:function(){o=!0}}),!o){var i=c.indexOf(n.objects,r);n.removed[i]=!0}}}),c.every(n.removed)&&n.cancel(),null})}})},triggerChangeEvent:function(){this.props.onChange&&this.props.onChange({type:"change",target:this})},triggerAuthorizationEvent:function(e){this.props.onAuthorization&&this.props.onAuthorization({type:"authorization",target:this,session:e})},triggerExpirationEvent:function(e){this.props.onExpiration&&this.props.onExpiration({type:"expiration",target:this,session:e})},triggerViolationEvent:function(e,t){this.props.onViolation&&this.props.onViolation({type:"violation",target:this,address:e,schema:t})},triggerStupefactionEvent:function(e,t){this.props.onStupefaction&&this.props.onStupefaction({type:"stupefaction",target:this,query:e,results:t})},triggerSearchEvent:function(e){this.props.onSearch&&this.props.onSearch({type:"search",target:this,searching:e})},findExistingSearch:function(e){var t=c.findIndex(this.recentSearchResults,function(t){return e.match(t)});if(-1!==t){var n=this.recentSearchResults[t];return this.updateList("recentSearchResults",function(e){var r=c.slice(e);return r.splice(t,1),r.unshift(n),r}),n}return null},addSearch:function(e){return this.updateList("recentSearchResults",function(t){var n=c.slice(t);for(n.unshift(e);n.length>1024;)n.pop();return n}),e},addStorage:function(e){return this.updateList("recentStorageResults",function(t){var n=c.slice(t);for(n.unshift(e),c.remove(n,{canceled:!0});n.length>32;)n.pop();return n}),e},addRemoval:function(e){return this.updateList("recentRemovalResults",function(t){var n=c.clone(t);for(n.unshift(e);n.length>32;)n.pop();return n}),e},searchRemoteDatabase:function(e){var t=this;if(e.isLocal())return l.resolve(!1);if(!this.props.online)return l.resolve(!1);if(e.updating)return l.resolve(!1);e.updating=!0,e.scheduled=!1,this.searching||(this.searching=!0,this.triggerSearchEvent(!0));var n=e.getLocation(),o=e.criteria;return e.start(),this.discoverRemoteObjects(n,o).then(function(n){return t.searchLocalCache(e,n).return(n)}).then(function(o){var i=o.ids,a=o.gns,u=e.getUpdateList(i,a),d=e.getRemovalList(i);if(c.isEmpty(u)){if(c.isEmpty(d))return null;return r(e.results,d)}return t.retrieveRemoteObjects(n,u).then(function(o){var i=o,a=s(e.results,i);if(a=r(a,d),c.get(t.props.discoveryFlags,"include_uncommitted")){var u=c.filter(t.changeQueue,function(e){if(e.dispatched&&!e.committed&&e.matchLocation(n))return!0});if(!c.isEmpty(u)){var p=c.map(u,"promise");return l.all(p).reflect().then(function(){return a})}}return a})}).then(function(n){return e.finish(n),t.updateList("recentSearchResults",function(e){return c.slice(e)}),t.updateLocalCache(e),!!n}).finally(function(){e.updating=!1,t.searchingEndTimeout&&clearTimeout(t.searchingEndTimeout),t.searchingEndTimeout=setTimeout(function(){var e=c.find(t.recentSearchResults,{scheduled:!0});e?t.searchRemoteDatabase(e):t.searching&&(t.searching=!1,t.triggerSearchEvent(!1)),t.searchingEndTimeout=0},250)})},discoverRemoteObjects:function(e,t){return this.performRemoteAction(e,"discovery",t)},retrieveRemoteObjects:function(e,t){return this.performRemoteAction(e,"retrieval",{ids:t})},updateRemoteDatabase:function(e){var t=this,n=new v(e.getLocation(),e.objects,e.options);return c.each(this.changeQueue,function(e){e.committed||e.canceled||n.merge(e)}),n.noop()?(e.finish(e.objects),l.resolve()):(n.onDispatch=function(n){var r=n.deliverables(),s=n.location;return e.start(),t.performRemoteAction(s,"storage",{objects:r}).then(function(e){return t.saveIDMapping(s,n.objects,e),e})},this.queueChange(n),this.props.online&&n.dispatch(),this.triggerChangeEvent(),n.promise.then(function(t){n.canceled?e.cancel():e.finish(t)}).catch(function(e){throw t.triggerChangeEvent(),e}))},queueChange:function(e){this.updateList("changeQueue",function(t){var n=p().subtract(1,"minute").toISOString(),r=c.reject(t,function(e){if(e.committed){if(e.time<n)return!0}else if(e.dispatched){if(e.error)return!0}else if(e.canceled)return!0});return r.push(e),r})},saveIDMapping:function(e,t,n){if(t.length===n.length){var r=[e.address,e.schema,e.table],s=c.get(this.idMappings,r);s||(s=[],c.set(this.idMappings,r,s)),c.each(t,function(e,t){if(e.id<1){var r=n[t];c.remove(s,{permanent:r.id}),s.push({temporary:e.id,permanent:r.id})}})}},findTemporaryID:function(e,t){var n=[e.address,e.schema,e.table],r=c.get(this.idMappings,n),s=c.find(r,{permanent:t});if(s)return s.temporary},findPermanentID:function(e,t){var n=[e.address,e.schema,e.table],r=c.get(this.idMappings,n),s=c.find(r,{temporary:t});if(s)return s.permanent},applyUncommittedChanges:function(e){var t=c.filter(this.changeQueue,{committed:!1,canceled:!1,error:null});if(!c.isEmpty(t)){var n=c.get(this.props.discoveryFlags,"include_deleted");e=c.clone(e),e.results=c.slice(e.results),c.each(t,function(t){t.apply(e,n)})}return e},performRemoteAction:function(e,t,n){var r=this,s=e.address,i=this.props.basePath,u=e.schema,d=e.table;if(!u)return l.reject(new Error("No schema specified"));if(!d)return l.reject(new Error("No table specified"));var p;"retrieval"===t||"storage"===t?p=this.props.retrievalFlags:"discovery"===t&&(p=c.omit(this.props.discoveryFlags,"include_uncommitted"));var m=""+s+i+"/"+t+"/"+u+"/"+d+"/",f=o(s),g=c.assign({},n,p,{auth_token:f.token}),v={contentType:"json",responseType:"json"};return h.fetch("POST",m,g,v).then(function(e){return e}).catch(function(e){throw 401!==e.statusCode&&403!=e.statusCode||(r.clearRecentOperations(s),r.clearCachedSchemas(s),401===e.statusCode?(a(f),r.triggerExpirationEvent(f)):403==e.statusCode&&r.triggerViolationEvent(s,u),r.triggerChangeEvent()),e})},updateLocalDatabase:function(e){var t=this;return l.try(function(){var n=t.props.cache,r=e.getLocation();return e.start(),e.promise=e instanceof y?n.remove(r,e.objects):n.save(r,e.objects),e.promise.then(function(t){e.finish(t)})})},searchLocalCache:function(e,t){var n=this;return this.validateCache(e.address,e.schema).then(function(r){e.validateResults(r);var o=n.props.cache;if(t){if(!e.remote)return!1;var i=e.getFetchList(t.ids);if(c.isEmpty(i))return!1;var a=c.assign({criteria:{id:i}},e.getLocation());return o.find(a).then(function(t){return e.results=s(e.results,t),!0})}if(e.remote)return!1;var a=e.getQuery();return o.find(a).then(function(t){return e.results=t,!0})}).catch(function(e){return console.error(e),!1})},validateCache:function(e,t){var n=this;if("local"===t||!this.props.cacheValidation)return l.resolve("none");var r=(this.props.cache,[e,t]),s=c.get(this.cacheValidation,r);return s||(s=this.getRemoteSignature(e,t).then(function(r){return n.getCacheSignature(e,t).then(function(s){return r?s?s===r?r:n.clearCachedObjects(e,t).then(function(){return n.setCacheSignature(e,t,r),r}):n.waitForCacheClearing(e,t).then(function(){return n.setCacheSignature(e,t,r),r}):s||"none"})}).catch(function(e){console.error(e),c.unset(n.cacheValidation,r)}),c.set(this.cacheValidation,r,s)),s},clearCachedSchemas:function(e){var t=this;return c.unset(this.cacheValidation,[e]),this.clearCachedObjects(e,"*").then(function(){var n=t.props.cache,r={schema:"local",table:"remote_schema"},s=e+"/";return n.find(r).filter(function(e){return c.startsWith(e.key,s)}).then(function(e){return n.remove(r,e)})})},getRemoteSignature:function(e,t){if(!this.props.online)return l.resolve("");var n=""+e+this.props.basePath+"/signature/"+t,r=o(e),s={responseType:"json",contentType:"json"},i={auth_token:r.token};return h.fetch("POST",n,i,s).then(function(e){return c.get(e,"signature")})},getCacheSignature:function(e,t){var n=this.props.cache,r={schema:"local",table:"remote_schema",criteria:{key:e+"/"+t}};return n.find(r).get(0).then(function(e){return c.get(e,"signature")})},setCacheSignature:function(e,t,n){var r=this.props.cache,s={schema:"local",table:"remote_schema"},o={key:e+"/"+t,signature:n};return r.save(s,[o])},updateLocalCache:function(e){var t=this;return l.try(function(){var n=t.props.cache,r=e.getLocation();return e instanceof g?n.save(r,e.results).then(function(){return n.remove(r,e.missingResults)}):e instanceof y?n.remove(r,e.results):e instanceof b?n.save(r,e.results):void 0}).then(function(){return!0}).catch(function(e){return console.error(e),!1})},clearCachedObjects:function(e,t){var n=this;return l.try(function(){var r=n.props.cache,s=c.get(n.cacheClearing,[e,"*"]);if(s)return s;var o=[e,t],i=c.get(n.cacheClearing,o);return i||(i=r.clean({address:e,schema:t}).then(function(e){return c.unset(n.cacheClearing,o),e}),c.set(n.cacheClearing,o,i)),i})},waitForCacheClearing:function(e,t){var n=c.get(this.cacheClearing,[e,"*"]);if(n)return n;var r=c.get(this.cacheClearing,[e,t]);return r||l.resolve(0)},updateRecentSearchResults:function(e){var t=this.getRelevantRecentSearches(e.getLocation());c.each(t,function(t){var n=t.results,r=n;c.each(e.results,function(s){var o=c.sortedIndexBy(r,s,"id"),i=r[o],a=i&&i.id===s.id;if(e instanceof y)a&&(r===n&&(r=c.slice(r)),r.splice(o,1));else if(e instanceof b){var l=f.match(t.table,s,t.criteria);(l||a)&&(r===n&&(r=c.slice(r)),l&&a?r[o]=s:l&&!a?(r.splice(o,0,s),f.limit(t.table,r,t.criteria)):!l&&a&&r.splice(o,1))}}),r!==n&&(t.results=r,t.promise=l.resolve(r))})},getRelevantRecentSearches:function(e){return c.filter(this.recentSearchResults,function(t){if(t.matchLocation(e))return!0})},clearRecentOperations:function(e){var t=this,n=["recentSearchResults","recentStorageResults","recentRemovalResults"];c.each(n,function(n){t.updateList(n,function(t){return c.filter(t,function(t){return t.address!==e})})})},componentWillMount:function(){var e=this;this.sessionCheckTimeout=setInterval(function(){var t=p().add(5,"minute").toISOString(),n=i(function(e){if(e.etime<t)return!0});c.isEmpty(n)||(c.each(n,function(e){e.token||a(e)}),e.triggerChangeEvent())},6e4)},componentDidMount:function(){this.triggerChangeEvent()},componentWillReceiveProps:function(e){var t=this,n=!this.props.online&&e.online,r=!this.props.connected&&e.connected;if(n||r)this.disconnected&&(this.invalidate().then(function(){c.each(t.changeQueue,function(e){e.dispatch()})}),this.disconnected=!1);else{var s=this.props.online&&!e.online,o=this.props.connected&&!e.connected;(s||o)&&(this.disconnected=!0)}},componentWillUnmount:function(){clearInterval(this.sessionExpirationCheckInterval)},schedulePrefetch:function(e){var t=this,n=[];c.each(e,function(e){if(e.prefetch){var t=e.getCriteriaShape();return!(!c.some(n,function(n){if(c.includes(e.by,n.component)&&c.isEqual(t,n.shape))return!0})&&(n.push(e),e.updating||(e.scheduled=!0),n.length>16))&&void 0}}),setTimeout(function(){if(!t.searching){var e=c.find(t.recentSearchResults,{scheduled:!0,updating:!1});e&&t.searchRemoteDatabase(e)}},50)},render:function(){var e=this.state.recentSearchResults,t=this.state.recentStorageResults,n=this.state.recentRemovalResults;return u.createElement(w,{type:"remote-data-source"},u.createElement(x,{label:"Recent searches"},u.createElement(k,{searches:e})),u.createElement(x,{label:"Recent storage",hidden:c.isEmpty(t)},u.createElement(E,{stores:t})),u.createElement(x,{label:"Recent removal",hidden:c.isEmpty(n)},u.createElement(E,{stores:n})))}});var C=[]},"../../common/src/data/remote-data-source/operation.js":function(e,t,n){"use strict";function r(e){var t=s.get(e,"by.constructor.displayName");"local"!==e.schema&&(this.address=e.address),this.schema=e.schema,this.table=e.table,this.startTime=null,this.finishTime=null,this.results=[],this.promise=null,this.by=t?[t]:[]}var s=n("../../common/node_modules/lodash/lodash.js");e.exports=r,r.prototype.getLocation=function(){return this.isLocal()?s.pick(this,"schema","table"):s.pick(this,"address","schema","table")},r.prototype.matchLocation=function(e){return this.address===e.address&&(this.schema===e.schema&&this.table===e.table)},r.prototype.isLocal=function(){return"local"===this.schema},r.prototype.start=function(){var e=new Date;this.startTime=e.toISOString()},r.prototype.finish=function(e){var t=new Date(this.startTime),n=new Date;e&&(this.results=e),this.finishTime=n.toISOString(),this.duration=n-t},r.prototype.cancel=function(){this.canceled=!0},r.prototype.getTimeElapsed=function(){var e=new Date(this.finishTime);return.001*(new Date-e)}},"../../common/src/data/remote-data-source/recent-search-table.jsx":function(e,t,n){"use strict";function r(e){var t=o.filter(e.searches,function(e){return"local"!==e.schema}),n=function(e,t){var n;e.updating?n="updating":e.dirty&&(n="dirty");var r=e.duration?e.duration+"ms":"",a=JSON.stringify(e.criteria,void 0,4),c=JSON.stringify(e.criteria);return i.createElement("tr",{key:t,className:n},i.createElement("td",{className:"time"},r),i.createElement("td",{className:"schema"},e.schema),i.createElement("td",{className:"table"},e.table),i.createElement("td",{className:"criteria",title:s(a)},c),i.createElement("td",{className:"objects"},o.size(e.results)," (",e.lastRetrieved,")"),i.createElement("td",{className:"by"},o.join(e.by,", ")))};return i.createElement("table",{className:"recent-search-table"},i.createElement("thead",null,i.createElement("tr",null,i.createElement("th",{className:"time"},"Time"),i.createElement("th",{className:"schema"},"Schema"),i.createElement("th",{className:"table"},"Table"),i.createElement("th",{className:"criteria"},"Criteria"),i.createElement("th",{className:"objects"},"Objects (fresh)"),i.createElement("th",{className:"by"},"By"))),i.createElement("tbody",null,o.map(t,n)))}function s(e){return e.replace(/\[([^\]]{1,50},\s*)[^\]]{50,}?(\s*)\]/g,"[$1...$2]")}var o=n("../../common/node_modules/lodash/lodash.js"),i=n("../../common/node_modules/react/react.js");i.PropTypes;e.exports=r},"../../common/src/data/remote-data-source/recent-storage-table.jsx":function(e,t,n){"use strict";function r(e){var t=s.filter(e.stores,function(e){return"local"!==e.schema}),n=function(e,t){var n=e.duration?e.duration+"ms":"",r=JSON.stringify(e.results,void 0,4),s=JSON.stringify(e.results);return o.createElement("tr",{key:t},o.createElement("td",{className:"time"},n),o.createElement("td",{className:"schema"},e.schema),o.createElement("td",{className:"table"},e.table),o.createElement("td",{className:"objects",title:r},s),o.createElement("td",{className:"by"},e.by))};return o.createElement("table",{className:"recent-storage-table"},o.createElement("thead",null,o.createElement("tr",null,o.createElement("th",{className:"time"},"Time"),o.createElement("th",{className:"schema"},"Schema"),o.createElement("th",{className:"table"},"Table"),o.createElement("th",{className:"objects"},"Objects"),o.createElement("th",{className:"by"},"By"))),o.createElement("tbody",null,s.map(t,n)))}var s=n("../../common/node_modules/lodash/lodash.js"),o=n("../../common/node_modules/react/react.js");o.PropTypes;e.exports=r},"../../common/src/data/remote-data-source/removal.js":function(e,t,n){"use strict";function r(e,t){s.call(this,e,t,{onConflict:!1}),this.isLocal()||(this.objects=_.map(t,function(e){return{id:e.id,deleted:!0}}))}var s=n("../../common/src/data/remote-data-source/storage.js");e.exports=r,r.prototype=Object.create(s.prototype)},"../../common/src/data/remote-data-source/search.js":function(e,t,n){"use strict";function r(e){l.call(this,e),this.criteria=e.criteria||{},this.remote=e.remote||!1,this.dirty=!1,this.cacheSignatureBefore="",this.cacheSignatureAfter="",this.updating=!1,this.scheduled=!1,this.lastRetrieved=0,this.missingResults=[],this.minimum=e.minimum,this.expected=e.expected,this.prefetch=e.prefetch,"number"!=typeof this.expected&&(this.expected=s(this.criteria,"id")||s(this.criteria,"name")||s(this.criteria,"filters")||void 0),this.criteria=o(this.criteria),this.criteria=i(this.criteria)}function s(e,t){if(e){var n=e[t];if(void 0!=n)return n instanceof Array?n.length:n?1:0}}function o(e){if(e instanceof Array){for(var t=[],n=0;n<e.length;n++){var r=e[n];void 0!==r&&(r instanceof Object&&(r=o(r)),t.push(r))}return t}if(e instanceof Object){var t={};for(var s in e){var r=e[s];void 0!==r&&(r instanceof Object&&(r=o(r)),t[s]=r)}return t}return e}function i(e){return a.mapValues(e,function(e,t){return e instanceof Array&&/(^|_)ids?$/.test(t)&&(e=a.filter(e,function(e){return!("number"==typeof e&&e<1)})),e})}var a=n("../../common/node_modules/lodash/lodash.js"),c=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),l=n("../../common/src/data/remote-data-source/operation.js"),u=n("../../common/src/data/session-start-time.js");e.exports=r,r.prototype=Object.create(l.prototype),r.prototype.getQuery=function(){return a.pick(this,"address","schema","table","criteria")},r.prototype.getCriteriaShape=function(){return a.mapValues(this.criteria,function(e){return null!=e?e.constructor:null})},r.prototype.match=function(e){return!!this.matchLocation(e)&&(!!this.matchCriteria(e)&&!!this.matchOptions(e))},r.prototype.matchCriteria=function(e){return a.isEqual(this.criteria,e.criteria)},r.prototype.matchOptions=function(e){return this.remote===e.remote},r.prototype.isSufficientlyRecent=function(e){if(this.isLocal())return!0;var t=a.map(this.results,"rtime"),n=a.min(t);if(n<u)return!1;var r=new Date(n);return!(.001*(new Date-r)>e)&&(this.finishTime=n,!0)},r.prototype.isFresh=function(e){return"local"===this.schema||!this.dirty&&!(this.getTimeElapsed()>e)},r.prototype.isSufficientlyCached=function(){var e=this.results.length;return void 0!=this.minimum&&!(e<this.minimum)},r.prototype.isMeetingExpectation=function(){return this.results.length===this.expected},r.prototype.validateResults=function(e){this.cacheSignatureAfter=e},r.prototype.getUpdateList=function(e,t){if(this.cacheSignatureBefore&&this.cacheSignatureBefore!==this.cacheSignatureAfter)return a.slice(e);var n=this.results,r=[];return a.each(e,function(e,s){var o=t[s],i=a.sortedIndexBy(n,{id:e},"id"),c=n?n[i]:null;c&&c.id===e&&c.gn===o||r.push(e)}),r},r.prototype.getRemovalList=function(e){if(this.cacheSignatureBefore&&this.cacheSignatureBefore!==this.cacheSignatureAfter)return[];var t=[];return a.each(this.results,function(n){a.includes(e,n.id)||t.push(n.id)}),t},r.prototype.getFetchList=function(e){if(this.cacheSignatureBefore&&this.cacheSignatureBefore!==this.cacheSignatureAfter)return[];var t=this.results,n=[];return a.each(e,function(e,r){var s=a.sortedIndexBy(t,{id:e},"id"),o=t?t[s]:null;o&&o.id===e||n.push(e)}),n},r.prototype.finish=function(e){var t=this,n=this.results,r=[],s=0;l.prototype.finish.call(this,e),this.dirty=!1,this.cacheSignatureBefore=this.cacheSignatureAfter,e&&(this.promise=c.resolve(this.results),a.each(this.results,function(e){e.rtime||s++,e.rtime=t.finishTime}),a.each(n,function(t){var n=a.sortedIndexBy(e,t,"id"),s=e[n];s&&s.id===t.id||r.push(t)})),this.missingResults=r,this.lastRetrieved=s}},"../../common/src/data/remote-data-source/storage.js":function(e,t,n){"use strict";function r(e,t,n){o.call(this,e),this.objects=t,this.options=n||{},this.canceled=!1}var s=n("../../common/node_modules/lodash/lodash.js"),o=n("../../common/src/data/remote-data-source/operation.js");e.exports=r,r.prototype=Object.create(o.prototype),r.prototype.finish=function(e){var t=this;o.prototype.finish.call(this,e),this.isLocal()||s.each(this.results,function(e){e.rtime=t.finishTime})}},"../../common/src/data/remote-data-source/temporary-id.js":function(e,t,n){"use strict";function r(){var e=s+1e-9;return s=e,e}t.allocate=r;var s=0},"../../common/src/data/session-manager.jsx":function(e,t,n){"use strict";var r=n("../../common/node_modules/lodash/lodash.js"),s=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),o=n("../../common/node_modules/react/react.js"),i=o.PropTypes,a=n("../../common/src/data/database.js"),c=n("../../common/src/mixins/update-check.js"),l=n("../../common/src/widgets/diagnostics.jsx"),u=n("../../common/src/widgets/diagnostics-section.jsx");e.exports=o.createClass({displayName:"SessionManager",mixins:[c],propTypes:{database:i.instanceOf(a)},getInitialState:function(){return this.removalQueue=[],{loaded:[],removed:[],saved:[]}},loadFromCache:function(e){var t=this;if(r.some(this.removalQueue,{address:e}))return s.resolve(null);var n=this.props.database.use({schema:"local",by:this}),o={key:e};return n.findOne({table:"session",criteria:o}).then(function(n){return n?(t.setState({loaded:r.union(t.state.loaded,[e])}),{address:n.key,handle:n.handle,token:n.token,user_id:n.user_id,etime:n.etime}):null})},saveToCache:function(e){var t=this,n=this.props.database.use({schema:"local",by:this}),s={key:e.address,handle:e.handle,token:e.token,user_id:e.user_id,etime:e.etime};return n.saveOne({table:"session"},s).then(function(n){return t.setState({saved:r.union(t.state.loaded,[e.address])}),n})},removeFromCache:function(e){var t=this;this.removalQueue.push(e);var n=this.props.database.use({schema:"local",by:this}),s={key:e.address};return n.removeOne({table:"session"},s).then(function(n){r.pull(t.removalQueue,e),t.setState({removed:r.union(t.state.loaded,[e.address])})})},render:function(){return o.createElement(l,{type:"session-manager"},o.createElement(u,{label:"Session Handling"},o.createElement("div",null,"Loaded from cache: ",r.join(this.state.loaded," ")),o.createElement("div",null,"Saved to cache: ",r.join(this.state.saved," ")),o.createElement("div",null,"Removed from cache: ",r.join(this.state.removed," "))))}})},"../../common/src/data/session-start-time.js":function(e,t,n){"use strict";e.exports=(new Date).toISOString()},"../../common/src/data/subscription-manager.jsx":function(e,t,n){"use strict";var r=n("../../common/node_modules/lodash/lodash.js"),s=(n("../../common/node_modules/bluebird/js/browser/bluebird.js"),n("../../common/node_modules/react/react.js")),o=s.PropTypes,i=n("../../common/src/data/database.js"),a=n("../../common/src/locale/locale.js"),c=n("../../common/src/mixins/update-check.js"),l=n("../../common/src/widgets/diagnostics.jsx"),u=n("../../common/src/widgets/diagnostics-section.jsx");e.exports=s.createClass({displayName:"SubscriptionManager",mixins:[c],propTypes:{area:o.oneOf(["client","admin"]).isRequired,connection:o.object,schema:o.string,database:o.instanceOf(i),locale:o.instanceOf(a)},getInitialState:function(){return{subscription:null,serverAddress:null}},componentWillReceiveProps:function(e){this.props.connection&&e.connection&&this.props.connection.address!==e.connection.address&&this.setState({subscription:null})},componentDidUpdate:function(e,t){var n=this;if(this.props.connection&&this.props.database&&this.props.locale){var s=this.props.database.use({schema:"global",by:this});s.start().then(function(e){var t=n.state.subscription,o=s.context.address,i={user_id:e,schema:n.props.schema,area:n.props.area,locale:n.props.locale.localeCode,method:n.props.connection.method,token:n.props.connection.token,relay:n.props.connection.relay,details:n.props.connection.details};if(t&&n.state.serverAddress===o){if(r.isMatch(t,i))return;r.assign(t,i),i=t}else n.setState({subscription:i,serverAddress:o});return s.saveOne({table:"subscription"},i).then(function(e){return n.setState({subscription:e}),null}).catch(function(e){if(404===e.statusCode&&i.id)return i.id=void 0,s.saveOne({table:"subscription"},i).then(function(e){return n.setState({subscription:e}),null})})}).catch(function(e){if(401!==e.statusCode)throw e})}},render:function(){var e=this.state.subscription||{};return s.createElement(l,{type:"subscription-manager"},s.createElement(u,{label:"Current subscription"},s.createElement("div",null,"ID: ",e.id),s.createElement("div",null,"Token: ",e.token),s.createElement("div",null,"Method: ",e.method),s.createElement("div",null,"Schema: ",e.schema),s.createElement("div",null,"Locale: ",e.locale),s.createElement("div",null,"Relay: ",e.relay)))}})},"../../common/src/errors/file-error.js":function(e,t,n){"use strict";function r(e){e instanceof Object&&(e=e.code),this.code=e,this.message=s[e]}e.exports=r;var s={1:"A required file or directory could not be found at the time an operation was processed",2:"Access to the file was denied",3:"Operation was aborted",4:"The file or directory cannot be read",5:"The URL is malformed",6:"The state of the underlying file system prevents any writing to a file or a directory",7:"The operation cannot be performed on the current state of the interface object",8:"Synax error",9:"The modification requested is not allowed",10:"Not enough remaining storage space or the storage quota was reached",11:"The app looked up an entry, but the entry found is of the wrong type",12:"The file or directory with the same path already exists"};r.prototype=Object.create(Error.prototype)},"../../common/src/errors/http-error.js":function(e,t,n){"use strict";function r(){for(var e=0;e<arguments.length;e++){var t=arguments[e];if("number"==typeof t)this.statusCode=t;else if("string"==typeof t)this.message=t;else if("object"===(void 0===t?"undefined":s(t)))for(var n in t)this[n]=t[n]}this.statusCode||(this.statusCode=500),this.hasOwnProperty("name")||(this.name=o[this.statusCode]),this.hasOwnProperty("message")||(this.message=this.name)}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};e.exports=r;var o={400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",422:"Unprocessable Entity",429:"Too Many Requests",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout"};r.prototype=Object.create(Error.prototype)},"../../common/src/languages.js":function(e,t,n){"use strict";e.exports=[{name:"ÄŒeÅ¡tina",code:"cz",script:"latin",countries:{cz:"ÄŒesko",pl:"Polsko",sk:"Slovensko"},defaultCountry:"cz",module:function(){return n.e("locale-cs").then(n.bind(null,"./locales/cs.js"))}},{name:"Dansk",code:"da",script:"latin",countries:{dk:"Danmark",fo:"FÃ¦rÃ¸erne",gl:"GrÃ¸nland",de:"Tyskland"},defaultCountry:"dk"},{name:"Deutsch",code:"de",script:"latin",countries:{at:"Ã–sterreich",be:"Belgien",de:"Deutschland",lu:"Luxemburg",ch:"Schweiz"},defaultCountry:"de",module:function(){return n.e("locale-de").then(n.bind(null,"./locales/de.js"))}},{name:"Î•Î»Î»Î·Î½Î¹ÎºÎ¬",code:"el",script:"greek",countries:{gr:"Î•Î»Î»Î¬Î´Î±",cy:"ÎšÏÏ€ÏÎ¿Ï‚"},defaultCountry:"gr"},{name:"English",code:"en",script:"latin",countries:{au:"Australia",ca:"Canada",hk:"Hong Kong",ie:"Ireland",sg:"Singapore",gb:"United Kingdom",us:"United States"},defaultCountry:"us",module:function(){return n.e("locale-en").then(n.bind(null,"./locales/en.js"))}},{name:"EspaÃ±ol",code:"es",script:"latin",countries:{ar:"Argentina",bo:"Bolivia",cl:"Chile",co:"Colombia",cr:"Costa Rica",cu:"Cuba",es:"EspaÃ±a",ec:"Ecuador",sv:"El Salvador",gq:"Guinea Ecuatorial",gt:"Guatemala",hn:"Honduras",mx:"MÃ©xico",ni:"Nicaragua",pa:"PanamÃ¡",py:"Paraguay",pe:"PerÃº",pr:"Puerto Rico",do:"RepÃºblica Dominicana",uy:"Uruguay",ve:"Venezuela"},defaultCountry:"es"},{name:"FranÃ§ais",code:"fr",script:"latin",countries:{be:"Belgique",bj:"BÃ©nin",bf:"Burkina Faso",bi:"Burundi",cm:"Cameroun",ca:"Canada",cg:"Congo",ci:"CÃ´te d'Ivoire",dj:"Djibouti",gq:"GuinÃ©e Ã©quatoriale",fr:"France",ga:"Gabon",gn:"GuinÃ©e",ht:"HaÃ¯ti",lu:"Luxembourg",mg:"Madagascar",ml:"Mali",ne:"Niger",rw:"Rwanda",cf:"RÃ©publique centrafricaine",cd:"RÃ©publique dÃ©mocratique du Congo",sn:"SÃ©nÃ©gal",sc:"Seychelles",ch:"Suisse",td:"Tchad",tg:"Togo"},defaultCountry:"fr",module:function(){return n.e("locale-fr").then(n.bind(null,"./locales/fr.js"))}},{name:"í•œêµ­ì–´",code:"ko",script:"hangul",countries:{kr:"í•œêµ­",cn:"ì¤‘êµ­"},defaultCountry:"kr"},{name:"Hrvatski",code:"hr",script:"latin",countries:{ba:"Bosna i Hercegovina",hr:"Hrvatska",rs:"Srbija"},defaultCountry:"hr"},{name:"Italiano",code:"it",script:"latin",countries:{it:"Italia",ch:"Svizzera",hr:"Croazia",si:"Slovenia"},defaultCountry:"it",module:function(){return n.e("locale-it").then(n.bind(null,"./locales/it.js"))}},{name:"Magyar",code:"hu",script:"latin",countries:{hr:"MagyarorszÃ¡g",ro:"RomÃ¡nia"},defaultCountry:"hu"},{name:"Nederlands",code:"nl",script:"latin",countries:{be:"BelgiÃ«",nl:"Nederland",sr:"Suriname"},defaultCountry:"nl"},{name:"æ—¥æœ¬èªž",code:"jp",script:"hiragana",countries:{jp:"æ—¥æœ¬"},defaultCountry:"jp"},{name:"Norsk",code:"nb",script:"latin",countries:{no:"Norge"},defaultCountry:"no",module:function(){return n.e("locale-nb").then(n.bind(null,"./locales/nb.js"))}},{name:"Polski",code:"pl",script:"latin",countries:{by:"BiaÅ‚oruÅ›",lt:"Litwa",pl:"Polska",ua:"Ukraina"},defaultCountry:"pl",module:function(){return n.e("locale-pl").then(n.bind(null,"./locales/pl.js"))}},{name:"PortuguÃªs",code:"pt",script:"latin",countries:{ao:"Angola",br:"Brasil",tl:"Timor Leste",gq:"GuinÃ© Equatorial",gw:"GuinÃ©-Bissau",mz:"MoÃ§ambique",mo:"Macao",pt:"Portugal"},defaultCountry:"pt"},{name:"Ð ÑƒÑÑÐºÐ¸Ð¹",code:"ru",script:"cyrillic",countries:{am:"ÐÑ€Ð¼ÐµÐ½Ð¸Ñ",by:"Ð‘ÐµÐ»Ð°Ñ€ÑƒÑÑŒ",ge:"Ð“Ñ€ÑƒÐ·Ð¸Ñ",lv:"Ð›Ð°Ñ‚Ð²Ð¸Ñ",kz:"ÐšÐ°Ð·Ð°Ñ…ÑÑ‚Ð°Ð½",kg:"ÐšÐ¸Ñ€Ð³Ð¸Ð·Ð¸Ñ",lt:"Ð›Ð¸Ñ‚Ð²Ð°",ru:"Ð Ð¾ÑÑÐ¸Ñ",tj:"Ð¢Ð°Ð´Ð¶Ð¸ÐºÐ¸ÑÑ‚Ð°Ð½",ua:"Ð£ÐºÑ€Ð°Ð¸Ð½Ð°",uz:"Ð£Ð·Ð±ÐµÐºÐ¸ÑÑ‚Ð°Ð½",es:"Ð­ÑÑ‚Ð¾Ð½Ð¸Ñ"},defaultCountry:"ru",module:function(){return n.e("locale-ru").then(n.bind(null,"./locales/ru.js"))}},{name:"Srpski",code:"sr",script:"latin",countries:{rs:"Srbija",hr:"Hrvatska",ba:"Bosna i Hercegovina"},defaultCountry:"sr"},{name:"Suomi",code:"fi",script:"latin",countries:{fi:"Suomi",se:"Ruotsi"},defaultCountry:"fi",module:function(){return n.e("locale-fi").then(n.bind(null,"./locales/fi.js"))}},{name:"SlovenÄina",code:"sk",script:"latin",countries:{cz:"ÄŒesko",sk:"Slovensko"},defaultCountry:"sk"},{name:"Svenska",code:"sv",script:"latin",countries:{fi:"Finland",se:"Sverige"},defaultCountry:"se"},{name:"Tiáº¿ng Viá»‡t",code:"vi",script:"latin",countries:{vn:"Viá»‡t Nam"},defaultCountry:"vn"},{name:"TÃ¼rkÃ§e",code:"tr",script:"latin",countries:{cy:"KÄ±brÄ±s",tr:"TÃ¼rkiye"},defaultCountry:"tr"},{name:"ä¸­æ–‡",code:"zh",script:"hanzi",countries:{cn:"ä¸­å›½",hk:"é¦™æ¸¯",mo:"æ¾³é–€",sg:"æ–°åŠ å¡",tw:"å°ç£"},defaultCountry:"cn",module:function(){return n.e("locale-zh").then(n.bind(null,"./locales/zh.js"))}}]},"../../common/src/locale/locale-manager.jsx":function(e,t,n){"use strict";function r(){function e(e){void 0===n&&e&&e.length>=2&&(n=s.toLower(e))}s.each(navigator.languages,e);var t=["language","browserLanguage","systemLanguage","userLanguage"];s.each(t,function(t){e(navigator[t])});var n;return n}var s=n("../../common/node_modules/lodash/lodash.js"),o=n("../../common/node_modules/react/react.js"),i=o.PropTypes,a=n("../../common/src/data/database.js"),c=n("../../common/src/widgets/diagnostics.jsx"),l=n("../../common/src/widgets/diagnostics-section.jsx");e.exports=o.createClass({displayName:"LocaleManager",propTypes:{defaultLanguageCode:i.string,database:i.instanceOf(a),directory:i.arrayOf(i.object).isRequired,onChange:i.func},getDefaultProps:function(){return{defaultLanguageCode:"en"}},getInitialState:function(){return{localeCode:"",localeCodeSaved:"",phraseTable:{},missingPhrases:[]}},getLocaleCode:function(){return this.state.localeCode},getDirectory:function(){return this.props.directory},translate:function(e){var t=this,n=this.state.phraseTable[e];if(null==n)return setTimeout(function(){var n=s.union(t.state.missingPhrases,[e]);t.setState({missingPhrases:n})},10),e;if("function"!=typeof n)return n;try{for(var r=arguments.length,o=Array(r>1?r-1:0),i=1;i<r;i++)o[i-1]=arguments[i];return n.apply(this,o)}catch(t){return console.error(t),"["+e+": "+t.message+"]"}},pick:function(e,t){if("string"==typeof e)return e;var n=this.state.localeCode.substr(0,2);t&&(n=t.substr(0,2));var r="",o="",i=this.props.defaultLanguageCode.substr(0,2),a="";for(var c in e){var l=e[c],u=s.toLower(c);u===n&&(r=l),o||(o=l),u===i&&(a=l)}return r||(a||o)},change:function(e){var t=this;return e=s.toLower(e),e===this.state.localeCode?Promise.resolve(!0):this.load(e).then(function(n){var r;r="function"==typeof n?n(e):n;var s={localeCode:e,phraseTable:r};return t.setState(s,function(){t.triggerChangeEvent()}),!0})},load:function(e){var t=e.substr(0,2),n=s.find(this.props.directory,{code:t});return n&&n.module?Promise.resolve(n.module()):Promise.reject(new Error("No module for language: "+t))},triggerChangeEvent:function(){this.props.onChange&&this.props.onChange({type:"change",target:this})},componentDidMount:function(){var e=this,t=r()||this.props.defaultLanguageCode;this.change(t).catch(function(t){e.change(e.props.defaultLanguageCode)})},componentDidUpdate:function(e,t){var n=this;if(!e.database&&this.props.database){var o=this.props.database.use({by:this,schema:"local"});o.start().then(function(){var e={key:"language"};return o.findOne({table:"settings",criteria:e})}).then(function(e){var t=s.get(e,"selectedLanguageCode");t&&(n.change(t),n.setState({localeCodeSaved:t}))})}if(t.localeCode!==this.state.localeCode&&this.props.database){var o=this.props.database.use({by:this,schema:"local"});o.start().then(function(){var e={key:"language",selectedLanguageCode:n.state.localeCode};return e.selectedLanguageCode!==r()?o.saveOne({table:"settings"},e):t.localeCode?o.removeOne({table:"settings"},e):void 0})}},render:function(){var e=r(),t=this.state.missingPhrases;return o.createElement(c,{type:"locale-manager"},o.createElement(l,{label:"Locale code"},o.createElement("div",null,"Current: ",this.state.localeCode),o.createElement("div",null,"Browser: ",e),o.createElement("div",null,"Previously saved: ",this.state.localeCodeSaved)),o.createElement(l,{label:"Missing phrases",hidden:s.isEmpty(t)},s.map(t,function(e,t){return o.createElement("div",{key:t},e)})))}})},"../../common/src/locale/locale.js":function(e,t,n){"use strict";function r(e){this.localeManager=e,this.directory=this.localeManager.getDirectory(),this.localeCode=this.localeManager.getLocaleCode();var t=_.split(this.localeCode,"-");this.languageCode=t[0],this.countryCode=t[1],this.translate=this.translate.bind(this),this.pick=this.pick.bind(this),this.name=this.name.bind(this),this.change=this.change.bind(this)}e.exports=r,r.prototype.translate=function(e){return e instanceof Object?this.localeManager.pick(e):this.localeManager.translate.apply(this.localeManager,arguments)},r.prototype.pick=function(e,t){return this.localeManager.pick(e,t)},r.prototype.name=function(e,t,n){var r=this.localeManager.pick(e,n),s=new String(r||"");return s.gender=t,s},r.prototype.change=function(e){return this.localeManager.change(e)}},"../../common/src/media/bitmap-view.jsx":function(e,t,n){"use strict";function r(e){var t=i(e,6),n=t[0],r=t[1],s=t[2],o=t[3],a=t[4],c=t[5],l=n*o-r*s;return[o/l,-r/l,-s/l,n/l,(s*c-o*a)/l,-(n*c-r*a)/l]}function s(e,t){var n=i(e,6),r=n[0],s=n[1],o=n[2],a=n[3],c=n[4],l=n[5],u=i(t,2),d=u[0],p=u[1];return[r*d+o*p+c,s*d+a*p+l]}function o(e,t){var n=[t.left,t.top],r=[t.left+t.width,t.top+t.height];return n=s(e,n),r=s(e,r),{width:Math.abs(r[0]-n[0]),height:Math.abs(r[1]-n[1]),left:Math.min(r[0],n[0]),top:Math.min(r[1],n[1])}}var i=function(){function e(e,t){var n=[],r=!0,s=!1,o=void 0;try{for(var i,a=e[Symbol.iterator]();!(r=(i=a.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){s=!0,o=e}finally{try{!r&&a.return&&a.return()}finally{if(s)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},c=n("../../common/node_modules/lodash/lodash.js"),l=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),u=n("../../common/node_modules/react/react.js"),d=u.PropTypes,p=n("../../common/src/transport/blob-manager.js"),h=n("../../common/src/transport/blob-reader.js"),m=n("../../common/src/media/media-loader.js"),f=n("../../common/src/media/jpeg-analyser.js"),g=n("../../common/src/utils/component-refs.js");e.exports=u.createClass({displayName:"BitmapView",propTypes:{url:d.string,clippingRect:d.object,onLoad:d.func,onError:d.func},getInitialState:function(){return this.components=g({canvas:HTMLCanvasElement}),{}},componentWillMount:function(){this.load(this.props.url)},componentWillReceiveProps:function(e){this.props.url!==e.url&&this.load(e.url),this.clippingRect!==e.clippingRect&&this.image&&this.drawImage(e.clippingRect)},render:function(){var e=this.components.setters,t=c.omit(this.props,"onLoad","url","clippingRect");return t.width=4,t.height=4,u.createElement("canvas",a({ref:e.canvas},t))},componentDidMount:function(){this.image&&this.redrawNeeded&&this.drawImage(this.props.clippingRect)},triggerLoadEvent:function(){this.props.onLoad&&this.props.onLoad({type:"load",target:this})},triggerErrorEvent:function(e){this.props.onError&&this.props.onError({type:"error",target:this,error:e})},load:function(e){var t=this;return e?p.fetch(e).then(function(e){var n=m.loadImage(e),r=h.loadUint8Array(e);return l.join(n,r,function(e,n){var r=f.getOrientation(n)||1;return t.image=e,t.orientation=r,r<5?(t.naturalWidth=e.naturalWidth,t.naturalHeight=e.naturalHeight):(t.naturalWidth=e.naturalHeight,t.naturalHeight=e.naturalWidth),t.drawImage(t.props.clippingRect),t.triggerLoadEvent(),null})}).catch(function(e){return console.error(e),t.triggerErrorEvent(e),null}):(this.clearCanvas(),l.resolve())},drawImage:function(e){var t=this.image;if(t){var n=this.components.canvas;if(!n)return void(this.redrawNeeded=!0);var s,i=this.orientation,a=t.naturalWidth,c=t.naturalHeight;switch(i){case 1:s=[1,0,0,1,0,0];break;case 2:s=[-1,0,0,1,a,0];break;case 3:s=[-1,0,0,-1,a,c];break;case 4:s=[1,0,0,-1,0,c];break;case 5:s=[0,1,1,0,0,0];break;case 6:s=[0,1,-1,0,c,0];break;case 7:s=[0,-1,-1,0,c,a];break;case 8:s=[0,-1,1,0,0,a]}e||(e={left:0,top:0,width:this.naturalWidth,height:this.naturalHeight}),this.width=e.width,this.height=e.height;var l=r(s),u=o(l,e),d=o(l,{left:0,top:0,width:e.width,height:e.height});n.width=d.width,n.height=d.height;var p=n.getContext("2d");p.transform.apply(p,s),p.drawImage(t,u.left,u.top,u.width,u.height,d.left,d.top,d.width,d.height)}},extractMosaic:function(){try{var e=this.components.canvas,t=document.createElement("CANVAS");t.width=48,t.height=48;t.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t.width,t.height);var n=document.createElement("CANVAS");n.width=4,n.height=4;var r=n.getContext("2d");r.drawImage(t,0,0,t.width,t.height,0,0,n.width,n.height);var s=r.getImageData(0,0,n.width,n.height),o=s.data;if(c.size(o)>=64){for(var i=[],a=0;a<16;a++){var l=o[4*a+0],u=o[4*a+1],d=o[4*a+2],p=l<<16|u<<8|d<<0;i.push(p.toString(16))}return i}}catch(e){}},clearCanvas:function(){var e=this.components.canvas;e&&(e.width=0,e.height=0),this.width=0,this.height=0,this.orientation=void 0}})},"../../common/src/media/device-manager.js":function(e,t,n){"use strict";(function(e){function t(e){return e?a.filter(l,{kind:e}):l}function r(e){return!navigator.mediaDevices||t(e).length>0}function s(e,t){"change"===e&&u.push(t)}function o(e,t){"change"===e&&(u=a.pull(u,t))}function i(){return c.try(function(){return navigator.mediaDevices?navigator.mediaDevices.enumerateDevices():[]}).then(function(t){l=t,a.each(u,function(t){t.call(e,{type:"change",target:e})})}).catch(function(e){})}var a=n("../../common/node_modules/lodash/lodash.js"),c=n("../../common/node_modules/bluebird/js/browser/bluebird.js");e.exports={getDevices:t,hasDevice:r,addEventListener:s,removeEventListener:o};var l=[],u=[];i().then(function(){navigator.mediaDevices&&navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",i)})}).call(t,n("../node_modules/webpack/buildin/module.js")(e))},"../../common/src/media/frame-grabber.js":function(e,t,n){"use strict";function r(e,t){return new i(function(n,r){function i(t){if(g)c(t);else if(t){var n=d*p*3,r=t.size,s=r/n;s>.02?c(t):((!f||f.size<t.size)&&(f=t),m>10?c(f):(e.currentTime+=1e3,m++))}else l(new Error("Unable to obtain a frame"))}function a(t){try{h.getContext("2d").drawImage(e,0,0,d,p),s(h,"image/jpeg",.75,i)}catch(e){l(e)}}function c(e){u(),n(e)}function l(e){u(),f?n(f):r(e)}function u(){g&&(e.removeEventListener("seeked",a),clearTimeout(y))}var d=e.videoWidth,p=e.videoHeight,h=document.createElement("CANVAS");h.width=d,h.height=p;var m=1,f=null,g=e.duration===1/0,v=o.get(t,"start",0),b=o.get(t,"timeout",1e3);if(g)a();else{e.addEventListener("seeked",a),e.addEventListener("ended",function(){l(new Error("Unable to obtain an image before video ended"))}),e.currentTime=v;var y=setTimeout(function(){l(new Error("Unable to obtain an image within time limit"))},b)}})}function s(e,t,r,s){if("function"==typeof e.toBlob)e.toBlob(s,t,90);else{s(n("../../common/node_modules/b64-to-blob/b64toBlob.js")(e.toDataURL(t,r).replace("data:image/jpeg;base64,",""),"image/jpeg"))}}var o=n("../../common/node_modules/lodash/lodash.js"),i=n("../../common/node_modules/bluebird/js/browser/bluebird.js");e.exports={capture:r}},"../../common/src/media/image-cropping.js":function(e,t,n){"use strict";function r(e,t){var n=0,r=0,s=Math.min(e,t);return e>s?n=Math.floor((e-s)/2):t>s&&(r=Math.floor((t-s)/2)),{left:n,top:r,width:s,height:s}}e.exports={centerSquare:r,default:r}},"../../common/src/media/jpeg-analyser.js":function(e,t,n){"use strict";function r(e){var t=u(e,function(e,t,n){if(65472===e||65474===e)return t});if(t>0){var n=(e[t++],o(e[t++],e[t++]));return{width:o(e[t++],e[t++]),height:n}}}function s(e){var t=o,n=a,r=u(e,function(r,s,o){if(65505===r){var a=s,l=s+o;if(69==e[a++]&&120==e[a++]&&105==e[a++]&&102==e[a++]&&0==e[a++]&&0==e[a++]){var u=a;"II"===String.fromCharCode(e[a++])+String.fromCharCode(e[a++])&&(t=i,n=c);if(42!==t(e[a++],e[a++]))return;do{var d=n(e[a++],e[a++],e[a++],e[a++]);if(0===d)break;a=u+d;for(var p=t(e[a++],e[a++]),h=0;h<p;h++){var m=t(e[a++],e[a++]),f=t(e[a++],e[a++]),g=n(e[a++],e[a++],e[a++],e[a++]);if(274===m&&3===f&&1===g)return a;a+=4}}while(a<l)}}});if(r>0){return t(e[r++],e[r++])}}function o(e,t){return e<<8|t}function i(e,t){return t<<8|e}function a(e,t,n,r){return e<<24|t<<16|n<<8|r}function c(e,t,n,r){return r<<24|n<<16|t<<8|e}function l(e){var t=d(e);return-1!==t?p(e,t):null}function u(e,t){var n=e.length,r=0;if(65496==o(e[r++],e[r++]))for(;r<n;){var s=o(e[r++],e[r++]),i=o(e[r++],e[r++]);if(65498==s)break;var a=t(s,r,i);if(void 0!==a&&!1!==a)return a;r+=i-2}return-1}function d(e){return u(e,function(t,n){if(65517==t&&80==e[n++]&&104==e[n++]&&111==e[n++]&&116==e[n++]&&111==e[n++]&&115==e[n++]&&104==e[n++]&&111==e[n++]&&112==e[n++]&&32==e[n++]&&51==e[n++]&&46==e[n++]&&48==e[n++])return n})}function p(e,t){for(var n=e.length,r=null,s=t;s+4<n;)if(56==e[s+0]&&66==e[s+1]&&73==e[s+2]&&77==e[s+3]){s+=4;for(var i=o(e[s++],e[s++]),a=e[s++],c="",l=0;l<a;l++)c+=String.fromCharCode(e[s++]);s++;var u=(o(e[s++],e[s++]),o(e[s++],e[s++]));i>=1999&&i<=2998&&(r||(r={}),r[c]=h(e,s,u)),s+=u}else s++;return r}function h(e,t,n){for(var r=n/26,s=0,i=[],c=[],l=t,u=0;u<r;u++){switch(o(e[l++],e[l++])){case 0:case 3:s=o(e[l++],e[l++]),l+=22;break;case 1:case 2:case 4:case 5:for(var d=0;d<3;d++){var p=a(e[l++],e[l++],e[l++],e[l++]),h=a(e[l++],e[l++],e[l++],e[l++]);p>=2147483648?p=(2147483647-p)/16777216:p/=16777216,h>=2147483648?h=(2147483647-h)/16777216:h/=16777216,c.push({x:h,y:p})}s--,0==s&&(c.push(c.shift()),c.push(c[0]),i.push(c),c=[]);break;default:l+=24}}return i}e.exports={getDimensions:r,getOrientation:s,extractPaths:l}},"../../common/src/media/media-loader.js":function(e,t,n){"use strict";function r(e){var t;return t="string"==typeof e?e:m.manage(e),new h(function(e,n){var r=document.createElement("IMG");r.src=t,r.onload=function(t){e(r)},r.onerror=function(e){console.log("load image error",e.message),n(new Error("Unable to load "+t))}})}function s(e){if(/iPhone/i.test(navigator.userAgent))return h.reject("Cannot load video on iPhone");var t;return t="string"==typeof e?e:m.manage(e),new h(function(e,n){var r=document.createElement("VIDEO");r.src=t,r.preload=!0,r.onloadeddata=function(t){e(r)},r.onerror=function(e){n(new Error("Unable to load "+t))}})}function o(e){var t;return t="string"==typeof e?e:m.manage(e),new h(function(e,n){var r=document.createElement("AUDIO");r.src=t,r.preload=!0,r.onloadeddata=function(t){e(r)},r.onerror=function(e){n(new Error("Unable to load "+t))}})}function i(e){return f.loadText(e).then(function(e){var t=new DOMParser,n=t.parseFromString(e,"text/xml"),r=n.getElementsByTagName("svg")[0];if(!r)throw new Error("Invalid SVG document");return r})}function a(e){if("string"==typeof e){var t=e;return m.fetch(t).then(function(e){return a(e)}).catch(function(e){return r(t).then(function(e){return{width:e.naturalWidth,height:e.naturalHeight,format:u(t,"image")}})})}var n=p(e.type);return"svg"===n?i(e).then(function(e){var t=e.width.baseVal.value,r=e.height.baseVal.value,s=e.viewBox.baseVal;return t||(t=s.width),r||(r=s.height),t||(t=1e3),r||(r=1e3),{width:t,height:r,format:n}}):"jpeg"===n?f.loadUint8Array(e).then(function(e){var t=g.getDimensions(e),r=g.getOrientation(e);if(!t)throw new Error("Invalid JPEG file");var s,o;return r>=5?(s=t.height,o=t.width):(s=t.width,o=t.height),{width:s,height:o,format:n}}):r(e).then(function(e){return{width:e.naturalWidth,height:e.naturalHeight,format:n}})}function c(e){if("string"==typeof e){var t=e;return m.fetch(t).then(function(e){return c(e)}).catch(function(e){return s(t).then(function(e){return v.capture(e).then(function(n){return{width:e.videoWidth,height:e.videoHeight,duration:Math.round(1e3*e.duration),format:u(t,"video"),poster:n}})})})}return s(e).then(function(t){return v.capture(t).then(function(n){return{width:t.videoWidth,height:t.videoHeight,duration:Math.round(1e3*t.duration),format:p(e.type),poster:n}})})}function l(e){if("string"==typeof e){var t=e;return m.fetch(t).then(function(e){return l(e)}).catch(function(e){return o(t).then(function(e){return{duration:Math.round(1e3*e.duration),format:u(t,"image")}})})}return o(e).then(function(t){return{duration:Math.round(1e3*t.duration),format:p(e.type)}})}function u(e,t){var n,r=/\.(\w+)$/.execute(e.replace(/#.*/,"").replace(/\?.*/,""));if(r)switch(n=_.toLower(r[1])){case"jpg":return"jpeg";default:return n}else switch(t){case"image":return"jpeg";case"video":return"mp4";case"audio":return"mp3";default:return""}}function d(e){var t=_.split(e,"/");return _.toLower(t[0])}function p(e){var t=_.split(e,"/"),n=_.toLower(t[1]);switch(n){case"svg+xml":return"svg";default:return n}}var h=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),m=n("../../common/src/transport/blob-manager.js"),f=n("../../common/src/transport/blob-reader.js"),g=n("../../common/src/media/jpeg-analyser.js"),v=n("../../common/src/media/frame-grabber.js");e.exports={loadImage:r,loadVideo:s,loadAudio:o,loadSVG:i,getImageMetadata:a,getVideoMetadata:c,getAudioMetadata:l,extractFileCategory:d,extractFileFormat:p}},"../../common/src/media/media-stream-utils.js":function(e,t,n){"use strict";function r(){return!(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)}function s(){return u.try(function(){var e={audio:!0};return navigator.mediaDevices.getUserMedia(e)})}function o(e){return u.try(function(){var t={video:!e||{deviceId:e},audio:!0};return navigator.mediaDevices.getUserMedia(t)})}function i(e){return u.try(function(){var t={video:!e||{deviceId:e}};return navigator.mediaDevices.getUserMedia(t)})}function a(e){var t=e.getVideoTracks()[0],n=t.getSettings(),r=n.width,s=n.height;return r>s&&screen.width<screen.height&&(r=n.height,s=n.width),{width:r,height:s}}function c(e,t){var n=function n(r){var s=e.videoWidth,o=e.videoHeight;t({width:s,height:o}),e.removeEventListener("loadedmetadata",n)};e.addEventListener("loadedmetadata",n)}function l(e){var t=e.getTracks();_.each(t,function(e){e.stop()})}var u=n("../../common/node_modules/bluebird/js/browser/bluebird.js");e.exports={hasSupport:r,getAudioStream:s,getVideoStream:o,getSilentVideoStream:i,getVideoDimensions:a,getActualVideoDimensions:c,stopAllTracks:l}},"../../common/src/media/media-tag-reader.js":function(e,t,n){"use strict";function r(e){return new o(function(t,n){var r=new i.Reader(e);r.setTagsToRead(["picture"]),r.read({onSuccess:function(e){var n=s.get(e,"tags.picture");if(n&&n.data){var r=n.data,o=new Uint8Array(r),i=new Blob([o],{type:n.format});t(i)}else t(null)},onError:function(e){t(null)}})})}var s=n("../../common/node_modules/lodash/lodash.js"),o=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),i=n("../node_modules/jsmediatags/dist/jsmediatags.js");e.exports={extractAlbumArt:r}},"../../common/src/media/quick-start.js":function(e,t,n){"use strict";function r(e){return o(e).then(function(t){var n=d.findIndex(t,{name:"ftyp"}),r=d.findIndex(t,{name:"moov"});if(!(0===n&&r>1))return null;var o=t[n],i=t[r];return a(e,o).then(function(t){return a(e,i).then(function(n){var r=new Uint8Array(n);s(r,8,r.length,o.offset+o.size,i.offset,i.size);var a=e.slice(o.offset+o.size,i.offset),c=e.slice(i.offset+i.size),l=[t,n,a,c];return new Blob(l,{type:e.type})})})}).catch(function(e){return null})}function s(e,t,n,r,o,i){for(;t<n;){var a=c(e,t),d=u(e,t+4);if(a<8)break;switch(d){case"stco":for(var p=c(e,t+12),h=0;h<p;h++){var m=t+16+4*h,f=c(e,m);r<=f&&f<=o&&(f+=i,e[m+0]=f>>24&255,e[m+1]=f>>16&255,e[m+2]=f>>8&255,e[m+3]=f>>0&255)}break;case"co64":for(var p=c(e,t+12),h=0;h<p;h++){var m=t+16+8*h,f=l(e,m);r<=f&&f<=o&&(f+=i,e[m+0]=f>>56&255,e[m+1]=f>>48&255,e[m+2]=f>>40&255,e[m+3]=f>>32&255,e[m+4]=f>>24&255,e[m+5]=f>>16&255,e[m+6]=f>>8&255,e[m+7]=f>>0&255)}break;case"trak":case"mdia":case"minf":case"stbl":s(e,t+8,t+a,r,o,i)}t+=a}}function o(e){var t=[],n=0,r=e.size,s=!1,o=!1;return h.do(function(){return i(e,n).then(function(e){var i=!1;if(s?"moov"===e.name&&(o=!0):"ftyp"===e.name?s=!0:i=!0,n+=e.size,n>r&&(i=!0),i)throw new Error("File does not appear to a QuickTime container");t.push(e)})}),h.while(function(){return!(s&&o)}),h.return(function(){return t}),h.end()}function i(e,t){return new p(function(n,r){var s=e.slice(t,t+16),o=new FileReader;o.readAsArrayBuffer(s),o.onload=function(e){var s=new Uint8Array(e.target.result),o=c(s,0),i=8;1===o&&(o=l(s,8),i=16),o>=i||r(new Error("Invalid atom size"));var a=u(s,4);n({offset:t,size:o,name:a})},o.onerror=function(e){r(new Error("Unable to load data"))}})}function a(e,t){return new p(function(n,r){var s=e.slice(t.offset,t.offset+t.size),o=new FileReader;o.readAsArrayBuffer(s),o.onload=function(e){n(e.target.result)},o.onerror=function(e){r(new Error("Unable to load data"))}})}function c(e,t){return e[t+0]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function l(e,t){return e[t+0]<<56|e[t+1]<<48|e[t+2]<<40|e[t+3]<<32|e[t+4]<<24|e[t+5]<<16|e[t+6]<<8|e[t+7]}function u(e,t){return String.fromCharCode(e[t+0])+String.fromCharCode(e[t+1])+String.fromCharCode(e[t+2])+String.fromCharCode(e[t+3])}var d=n("../../common/node_modules/lodash/lodash.js"),p=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),h=n("../../common/node_modules/async-do-while/index.js");e.exports={process:r}},"../../common/src/media/vector-view.jsx":function(e,t,n){"use strict";var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s=n("../../common/node_modules/lodash/lodash.js"),o=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),i=n("../../common/node_modules/react/react.js"),a=i.PropTypes,c=n("../../common/src/media/media-loader.js"),l=n("../../common/src/utils/component-refs.js");e.exports=i.createClass({displayName:"VectorView",propTypes:{url:a.string,clippingRect:a.object,title:a.string,onLoad:a.func,onError:a.func},getInitialState:function(){return this.components=l({svg:SVGGraphicsElement}),{}},componentWillMount:function(){this.load(this.props.url)},componentWillReceiveProps:function(e){this.props.url!==e.url&&this.load(e.url),this.props.clippingRect!==e.clippingRect&&this.setViewBox(e.clippingRect),this.props.title!==e.title&&this.setTitle(e.title)},render:function(){var e=this.components.setters,t=s.omit(this.props,"onLoad","url","clippingRect","title");return i.createElement("svg",r({ref:e.svg,viewBox:"0 0 4 4",width:4,height:4},t))},triggerLoadEvent:function(){this.props.onLoad&&this.props.onLoad({type:"load",target:this})},triggerErrorEvent:function(e){this.props.onError&&this.props.onError({type:"error",target:this,error:e})},load:function(e){var t=this;return e?c.loadSVG(e).then(function(e){var n=t.components.svg;if(!n)throw new Error("Invalid missing container");t.clear(),t.addTitle(t.props.title);for(var r;r=e.firstChild;)e.removeChild(r),n.appendChild(r);var s=e.width.baseVal.value,o=e.height.baseVal.value,i=e.viewBox.baseVal;s||(s=i.width),o||(o=i.height),s||(s=1e3),o||(o=1e3),t.originX=i.x,t.originY=i.y,t.zoomX=i.width?i.width/s:1,t.zoomY=i.height?i.height/o:1,t.naturalWidth=s,t.naturalHeight=o,t.setViewBox(t.props.clippingRect),t.triggerLoadEvent()}).catch(function(e){t.triggerErrorEvent(e)}):(this.clear(),this.originX=0,this.originY=0,this.zoomX=1,this.zoomY=1,this.naturalWidth=4,this.naturalHeight=4,this.setViewBox(),o.resolve())},clear:function(){for(var e=this.components.svg;e.firstChild;)e.removeChild(e.firstChild)},addTitle:function(e){var t=this.components.svg;if(e&&t){var n=document.createElementNS("http://www.w3.org/2000/svg","title");n.textContent=e,t.appendChild(n)}},setTitle:function(e){var t=svg.getElementByTagName("title");t?e?t.textContent=e:svg.removeChild(t):this.addTitle(e)},setViewBox:function(e){e||(e={left:0,top:0,width:this.naturalWidth,height:this.naturalHeight});var t=this.components.svg,n=t.viewBox.baseVal,r=t.width.baseVal,s=t.height.baseVal;n.x=e.left*this.zoomX+this.originX,n.y=e.top*this.zoomX+this.originY,n.width=e.width*this.zoomX,n.height=e.height*this.zoomY,r.value=e.width,s.value=e.height}})},"../../common/src/mixins/update-check.js":function(e,t,n){"use strict";function r(e,t){if(e===t)return!0;if(!e||!t)return!1;for(var n in t){var r=e[n];if(t[n]!==r)return!1}return!0}e.exports={shouldComponentUpdate:function(e,t){return!r(this.props,e)||!r(this.state,t)}}},"../../common/src/objects/finders/bookmark-finder.js":function(e,t,n){"use strict";function r(e,t,n,r){var s=o.map(n,"id");return s=o.sortBy(o.uniq(s)),o.isEmpty(s)||!t?i.resolve(a.array):e.find({table:"bookmark",criteria:{user_ids:[t.id],story_ids:s},minimum:r})}function s(e,t,n){return e.find({table:"bookmark",criteria:{target_user_id:t.id},prefetch:!0,minimum:n})}var o=n("../../common/node_modules/lodash/lodash.js"),i=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),a=n("../../common/src/data/empty.js");e.exports={findBookmarksByUser:r,findBookmarksForUser:s}},"../../common/src/objects/finders/device-finder.js":function(e,t,n){"use strict";function r(e,t,n){return t?e.find({schema:"global",table:"device",criteria:{user_id:t.id},prefetch:!0,minimum:n}):s.resolve(o.array)}var s=(n("../../common/node_modules/lodash/lodash.js"),n("../../common/node_modules/bluebird/js/browser/bluebird.js")),o=n("../../common/src/data/empty.js");e.exports={findUserDevices:r}},"../../common/src/objects/finders/notification-finder.js":function(e,t,n){"use strict";function r(e,t,n){return t?e.find({table:"notification",criteria:{target_user_id:t.id,limit:500},prefetch:!0,minimum:n}):i.resolve(a.array)}function s(e,t,n,r){return t?e.find({table:"notification",criteria:{target_user_id:t.id,time_range:c.getDayRange(n)},minimum:r}):i.resolve(a.array)}function o(e,t,n){return t?e.find({table:"notification",criteria:{target_user_id:t.id,seen:!1,limit:100},prefetch:!0,minimum:n}):i.resolve(a.array)}var i=(n("../../common/node_modules/lodash/lodash.js"),n("../../common/node_modules/bluebird/js/browser/bluebird.js")),a=n("../../common/src/data/empty.js"),c=(n("../../common/src/utils/date-tracker.js"),n("../../common/src/utils/date-utils.js"));e.exports={findNotificationsForUser:r,findNotificationsForUserOnDate:s,findNotificationsUnseenByUser:o}},"../../common/src/objects/finders/project-finder.js":function(e,t,n){"use strict";function r(e,t){return e.findOne({schema:"global",table:"project",criteria:{id:t},required:!0})}function s(e,t){return e.find({table:"project",criteria:{},minimum:t})}function o(e){return e.findOne({schema:"global",table:"project",criteria:{name:e.context.schema+""},required:!0})}function i(e,t){return e.find({schema:"global",table:"project",criteria:{archived:!1,deleted:!1},minimum:t})}function a(e,t,n){var r=l.map(t,"id");return l.isEmpty(r)?u.resolve(d.array):(r=l.sortBy(l.uniq(r)),e.find({schema:"global",table:"project",criteria:{user_ids:r},minimum:n}))}function c(e){return e.find({schema:"local",table:"project_link",criteria:{}}).filter(function(t){return e.findOne({schema:"local",table:"session",criteria:{key:t.address}}).then(function(e){if(e){if((new Date).toISOString()<e.etime)return!0}})})}var l=n("../../common/node_modules/lodash/lodash.js"),u=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),d=n("../../common/src/data/empty.js");e.exports={findProject:r,findAllProjects:s,findCurrentProject:o,findActiveProjects:i,findProjectsWithMembers:a,findProjectLinks:c}},"../../common/src/objects/finders/reaction-finder.js":function(e,t,n){"use strict";function r(e,t,n,r){var a=s.filter(s.uniq(s.map(t,"id")),function(e){return e>=1});return s.isEmpty(a)||!n?o.resolve(i.array):e.find({table:"reaction",criteria:{story_id:a,public:"guest"===n.type||void 0},minimum:r})}var s=n("../../common/node_modules/lodash/lodash.js"),o=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),i=n("../../common/src/data/empty.js");e.exports={findReactionsToStories:r}},"../../common/src/objects/finders/repo-finder.js":function(e,t,n){"use strict";function r(e,t){return e.findOne({schema:"global",table:"repo",criteria:{id:t},required:!0})}function s(e,t){return e.find({schema:"global",table:"repo",criteria:{},minimum:t})}function o(e,t){return e.find({schema:"global",table:"repo",criteria:{deleted:!1},minimum:t})}function i(e,t){if(t instanceof Array){var n=a.flatten(a.map(t,"repo_ids"));return a.isEmpty(n)?c.resolve(l.array):(n=a.sortBy(a.uniq(n)),e.find({schema:"global",table:"repo",criteria:{id:n,deleted:!1}}))}var r=t;return r?e.find({schema:"global",table:"repo",criteria:{id:r.repo_ids,deleted:!1},prefetch:!0}):c.resolve(l.array)}var a=n("../../common/node_modules/lodash/lodash.js"),c=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),l=n("../../common/src/data/empty.js");e.exports={findRepo:r,findAllRepos:s,findExistingRepos:o,findProjectRepos:i}},"../../common/src/objects/finders/role-finder.js":function(e,t,n){"use strict";function r(e,t){return e.findOne({schema:"global",table:"role",criteria:{id:t},required:!0})}function s(e,t){return e.find({schema:"global",table:"role",criteria:{},minimum:t})}function o(e,t){return e.find({schema:"global",table:"role",criteria:{deleted:!1,disabled:!1},minimum:t})}function i(e,t){var n=a.flatten(a.map(t,"role_ids"));return a.isEmpty(n)?c.resolve(l.array):(n=a.sortBy(a.uniq(n)),e.find({schema:"global",table:"role",criteria:{id:n}}))}var a=n("../../common/node_modules/lodash/lodash.js"),c=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),l=n("../../common/src/data/empty.js");e.exports={findRole:r,findAllRoles:s,findActiveRoles:o,findRolesOfUsers:i}},"../../common/src/objects/finders/statistics-finder.js":function(e,t,n){"use strict";function r(e,t){var n,r,o,a=!1;if(t&&(n=t.type,t.user?r=t.user:t.user_id&&(r={id:t.user_id}),t.project?o=t.project:t.schema?o={name:t.schema}:t.project_name&&(o={name:t.project_name}),a=t.public),"daily-activities"===n){if(r&&o)return i(e,o,r,a);if(o)return s(e,o,r,a)}else if("daily-notifications"===n&&r&&o)return c(e,o,r);return g.resolve(null)}function s(e,t,n){if(!t||t.deleted)return null;var r={schema:t.name,table:"statistics",criteria:{type:"story-date-range",filters:{public:n||void 0}},prefetch:!0};return e.findOne(r).then(function(r){if(p(r)){var s=y.getMonthRanges(r.details.start_time,r.details.end_time),o=y.getTimeZoneOffset(),i=f.map(s,function(e){return{time_range:e,tz_offset:o,public:n||void 0}}),a={schema:t.name,table:"statistics",criteria:{type:"daily-activities",filters:i},prefetch:!0};return e.find(a).then(function(e){return j(e,r)})}})}function o(e,t){return g.mapSeries(t,function(t){return s(e,t)}).then(function(e){var n=f.map(t,"id");return f.zipObject(n,e)})}function i(e,t,n,r){return n?a(e,t,[n],r).then(function(e){return f.get(e,n.id,null)}):null}function a(e,t,n,r){if(!t)return g.resolve(null);var s=(t.name,f.filter(n,function(e){return!e.deleted})),o=f.map(s,function(e){return{user_ids:[e.id],public:r||void 0}}),i={schema:t.name,table:"statistics",criteria:{type:"story-date-range",filters:o},prefetch:!0};return e.find(i).then(function(n){n=f.filter(n,p);var s=f.map(n,function(e){var t=y.getMonthRanges(e.details.start_time,e.details.end_time),n=y.getTimeZoneOffset();return f.map(t,function(t){return{user_ids:e.filters.user_ids,time_range:t,tz_offset:n,public:r||void 0}})}),o=f.flatten(s);if(f.isEmpty(o))return{};var i={schema:t.name,table:"statistics",criteria:{type:"daily-activities",filters:o},prefetch:!0};return e.find(i).then(function(e){return f.transform(n,function(t,n){var r=n.filters.user_ids[0],s=f.filter(e,function(e){return e.filters.user_ids[0]===r});t[r]=j(s,n)},{})})})}function c(e,t,n){return n?l(e,t,[n]).then(function(e){return f.get(e,n.id,null)}):null}function l(e,t,n){if(!t)return g.resolve(null);var r=t.name,s=f.filter(n,function(e){return!e.deleted}),o={type:"notification-date-range",filters:f.map(s,function(e){return{target_user_id:e.id}})};return e.find({schema:r,table:"statistics",criteria:o}).then(function(t){t=f.filter(t,p);var n=f.map(t,function(e){var t=y.getMonthRanges(e.details.start_time,e.details.end_time),n=y.getTimeZoneOffset();return f.map(t,function(t){return{target_user_id:e.filters.target_user_id,time_range:t,tz_offset:n}})}),s=f.flatten(n);if(f.isEmpty(s))return{};var o={type:"daily-notifications",filters:s};return e.find({schema:r,table:"statistics",criteria:o}).then(function(e){return f.transform(t,function(t,n){var r=n.filters.target_user_id,s=f.filter(e,function(e){return e.filters.target_user_id===r});t[r]=j(s,n)},{})})})}function u(e,t,n){return n?d(e,t,[n]).then(function(e){return f.get(e,n.id,null)}):null}function d(e,t,n){if(!t)return g.resolve(null);var r=t.name,s=f.filter(n,function(e){return!e.deleted}),o={type:"story-date-range",filters:f.map(s,function(e){return{external_object:f.find(e.external,{type:e.type})}})};return e.find({schema:r,table:"statistics",criteria:o}).then(function(t){t=f.filter(t,p);var s=f.map(t,function(e){var t=y.getMonthRanges(e.details.start_time,e.details.end_time),n=y.getTimeZoneOffset();return f.map(t,function(t){return{external_object:e.filters.external_object,time_range:t,tz_offset:n}})}),o=f.flatten(s);if(f.isEmpty(o))return{};var i={type:"daily-activities",filters:o};return e.find({schema:r,table:"statistics",criteria:i}).then(function(e){return f.transform(t,function(t,r){var s=r.filters.external_object,o=f.filter(e,function(e){return f.isEqual(e.filters.external_object,s)});t[f.find(n,function(e){return f.some(e.external,s)}).id]=j(o,r)},{})})})}function p(e){return e&&!!e.details.start_time&&!!e.details.end_time}function h(e,t){var n={total:0};return f.each(e,function(e){f.each(e.details,function(e,r){t&&r.substr(0,7)!==t||f.each(e,function(e,t){"#"!==t.charAt(0)&&(n.total+=e),n[t]?n[t]+=e:n[t]=e})})}),n}function m(e){var t={};return f.each(e,function(e){f.assign(t,e.details)}),t}var f=n("../../common/node_modules/lodash/lodash.js"),g=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),v=n("../../common/node_modules/moment/moment.js"),b=n("../../common/src/utils/memoize.js"),y=n("../../common/src/utils/date-utils.js");e.exports={find:r,findDailyActivitiesOfProject:s,findDailyActivitiesOfProjects:o,findDailyActivitiesOfUser:i,findDailyActivitiesOfUsers:a,findDailyNotificationsOfUser:c,findDailyNotificationsOfUsers:l,findDailyActivitiesOfRepo:u,findDailyActivitiesOfRepos:d};var j=b(function(e,t,n){var r=v().subtract(1,"month").format("YYYY-MM"),s=v().format("YYYY-MM"),o=m(e),i=h(e,r),a=h(e,s),c=h(e),l=t.details.start_time,u=t.details.end_time;if(0===i.total){l.substr(0,7)<=r||(i.total=void 0)}return{range:{start:l,end:u},last_month:i,this_month:a,to_date:c,daily:o}})},"../../common/src/objects/finders/story-finder.js":function(e,t,n){"use strict";function r(e,t){return e.findOne({table:"story",criteria:{id:t},required:!0})}function s(e,t){return w.isEmpty(t)?x.resolve(k.array):(t=w.sortBy(w.uniq(t)),e.find({table:"story",criteria:{id:t}}))}function o(e,t,n){return w.isEmpty(t)||!n?x.resolve(k.array):(t=w.sortBy(w.uniq(t)),e.find({table:"story",criteria:{id:t,published:!0,ready:!0,public:j(n)}}))}function i(e,t){return t?e.find({table:"story",criteria:{published:!1,user_ids:[t.id]}}):x.resolve(k.array)}function a(e,t,n){if(!t)return x.resolve(k.array);if(!n)return x.resolve(k.array);var r=w.filter(n,function(e){if(w.includes(e.user_ids,t.id)&&e.ptime>E.yesterdayISO)return!0}),s=w.map(r,"id");return e.find({table:"story",criteria:{exclude:s,user_ids:[t.id],newer_than:E.yesterdayISO,published:!0}})}function c(e,t,n,r,s){return e.find({table:"story",criteria:{search:{lang:n.languageCode,text:t},published:!0,ready:!0,public:j(r),limit:s?void 0:100,per_user_limit:s},remote:!0})}function l(e,t,n,r,s){return e.find({table:"story",criteria:{tags:t,published:!0,ready:!0,public:j(n),limit:r?void 0:500,per_user_limit:r},minimum:s})}function u(e,t,n,r,s){return e.find({table:"story",criteria:{time_range:C.getDayRange(t),published:!0,ready:!0,public:j(n),limit:r?void 0:500,per_user_limit:r},minimum:s})}function d(e,t,n,r){if(!n)return x.resolve(k.array);var s={table:"listing",criteria:{type:t,target_user_id:n.id,filters:{public:j(n)}},prefetch:!0};return r&&(s.blocking="stale"),e.findOne(s).then(function(r){return r?w.isEmpty(r.story_ids)&&r.dirty?e.await({table:"listing"},r,5e3).then(function(s){return s||e.refresh({table:"listing"},r),d(e,t,n)}):o(e,r.story_ids,n):null})}function p(e,t,n,r,s){return e.find({table:"story",criteria:{user_ids:[t.id],search:{lang:r.languageCode,text:n},published:!0,ready:!0,public:j(s),limit:100},remote:!0})}function h(e,t,n,r,s){return e.find({table:"story",criteria:{user_ids:[t.id],tags:n,published:!0,ready:!0,public:j(r),limit:500},minimum:s})}function m(e,t,n,r,s){return e.find({table:"story",criteria:{user_ids:[t.id],time_range:C.getDayRange(n),published:!0,ready:!0,public:j(r),limit:500},minimum:s})}function f(e,t,n,r,s){if(!r)return x.resolve(k.array);var i={table:"listing",criteria:{type:t,target_user_id:r.id,filters:{user_ids:[n.id],public:j(r)}},prefetch:!0};return s&&(i.blocking="stale"),e.findOne(i).then(function(s){return s?w.isEmpty(s.story_ids)&&s.dirty?e.await({table:"listing"},s,5e3).then(function(o){return o||e.refresh({table:"listing"},s),f(e,t,n,r)}):o(e,s.story_ids,r):null})}function g(e,t,n,r,s,i){var a={table:"listing",criteria:{type:t,target_user_id:r.id,filters:w.map(n,function(e){return{user_ids:[e.id],public:j(r)}})},prefetch:!0};return i&&(a.blocking="stale"),e.find(a).then(function(t){var n=w.flatten(w.map(t,function(e){return w.slice(e.story_ids,-s)}));return w.isEmpty(n)&&w.some(t,{dirty:!0})?null:o(e,n,r)})}function v(e,t,n,r,s){if(!r)return x.resolve(k.array);var i={table:"listing",criteria:{type:t,target_user_id:r.id,filters:{role_ids:n,public:j(r)}},prefetch:!0};return s&&(i.blocking="stale"),e.findOne(i).then(function(t){return t?w.isEmpty(t.story_ids)&&t.dirty?null:o(e,t.story_ids,r):null})}function b(e,t,n){return o(e,w.filter(w.map(t,"story_id")),n)}function y(e,t,n){return o(e,w.map(t,"story_id"),n)}function j(e){if(!e||"guest"===e.type)return!0}var w=n("../../common/node_modules/lodash/lodash.js"),x=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),k=n("../../common/src/data/empty.js"),E=n("../../common/src/utils/date-tracker.js"),C=n("../../common/src/utils/date-utils.js");e.exports={findStory:r,findStories:s,findDraftStories:i,findUnlistedStories:a,findStoriesMatchingText:c,findStoriesWithTags:l,findStoriesOnDate:u,findStoriesInListing:d,findStoriesByUserMatchingText:p,findStoriesByUserWithTags:h,findStoriesByUserOnDate:m,findStoriesByUserInListing:f,findStoriesByUsersInListings:g,findStoriesWithRolesInListing:v,findStoriesOfNotifications:b,findStoriesOfBookmarks:y}},"../../common/src/objects/finders/system-finder.js":function(e,t,n){"use strict";function r(e){return e.findOne({schema:"global",table:"system",criteria:{},prefetch:!0}).then(function(e){return e||{}})}n("../../common/node_modules/lodash/lodash.js"),n("../../common/node_modules/bluebird/js/browser/bluebird.js"),n("../../common/src/data/empty.js");e.exports={findSystem:r}},"../../common/src/objects/finders/user-finder.js":function(e,t,n){"use strict";function r(e,t){return e.findOne({schema:"global",table:"user",criteria:{id:t},required:!0})}function s(e,t){return f.isEmpty(t)?g.resolve(v.array):(t=f.sortBy(f.uniq(t)),e.find({schema:"global",table:"user",criteria:{id:t}}))}function o(e,t){return e.find({schema:"global",table:"user",criteria:{},minimum:t})}function i(e,t){var n;if(t instanceof Array)n=f.flatten(f.map(t,"user_ids"));else{var r=t;n=f.get(r,"user_ids")}return s(e,n)}function a(e,t){return e.find({schema:"global",table:"user",criteria:{deleted:!1},minimum:t})}function c(e,t){return e.find({schema:"global",table:"user",criteria:{deleted:!1,disabled:!1},minimum:t})}function l(e,t,n){var r=f.map(t,"id");return r=f.sortBy(f.uniq(r)),e.find({schema:"global",table:"user",criteria:{role_ids:r},minimum:n})}function u(e,t){return s(e,f.flatten(f.map(t,"user_ids")))}function d(e,t){return s(e,f.map(t,"user_id"))}function p(e,t){return s(e,f.map(t,"target_user_id"))}function h(e,t){return s(e,f.flatten(f.map(t,"user_ids")))}function m(e,t){return s(e,f.map(t,"user_id"))}var f=n("../../common/node_modules/lodash/lodash.js"),g=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),v=n("../../common/src/data/empty.js");e.exports={findUser:r,findUsers:s,findAllUsers:o,findUsersWithRoles:l,findProjectMembers:i,findExistingUsers:a,findActiveUsers:c,findStoryAuthors:u,findReactionAuthors:d,findBookmarkRecipients:p,findBookmarkSenders:h,findNotificationTriggerers:m}},"../../common/src/objects/settings/project-settings.js":function(e,t,n){"use strict";function r(e,t){if(e&&t&&!t.disabled){if("admin"===t.type||o.includes(e.user_ids,t.id))return e.archived?"read-only":"read-write";if(o.get(e,"settings.access_control.grant_view_access"))return e.archived?"read-only":o.get(e,"settings.access_control.grant_comment_access")?"read-comment":"read-only"}return null}function s(e,t){if(r(e,t))return!0;if("guest"===t.type){if(o.get(e,"settings.membership.allow_guest_request"))return!0}else if(o.get(e,"settings.membership.allow_user_request"))return!0;return!1}var o=n("../../common/node_modules/lodash/lodash.js");e.exports={default:{},isVisibleToUser:s,getUserAccessLevel:r}},"../../common/src/objects/types/notification-types.js":function(e,t,n){"use strict";e.exports=t=["like","comment","task-completion","vote","survey","coauthor","bookmark","mention","note","assignment","issue","push","merge","join-request"],t.admin=["join-request"],t.git=["push","merge","note","assignment","issue"],t.git.membership=["assignment"]},"../../common/src/objects/types/reaction-types.js":function(e,t,n){"use strict";e.exports=t=["like","comment","vote","task-completion","note","assignment","tracking"],t.editable=["comment"],t.git=["note","assignment"]},"../../common/src/objects/types/resource-types.js":function(e,t,n){"use strict";e.exports=["image","video","audio","website"]},"../../common/src/objects/types/story-types.js":function(e,t,n){"use strict";(function(r){e.exports=t=["push","merge","branch","tag","issue","milestone","merge-request","wiki","member","repo","post","survey","task-list"],t.editable=["post","task-list","survey"],t.trackable=["post"],t.git=["push","merge","branch","tag","issue","milestone","merge-request","wiki","member","repo"],"[object process]"===Object.prototype.toString.call(void 0!==r?r:0)||(t.icons={push:n("../node_modules/octicons/build/svg/repo-push.svg"),merge:n("../node_modules/octicons/build/svg/git-merge.svg"),branch:n("../node_modules/octicons/build/svg/git-branch.svg"),tag:n("../node_modules/octicons/build/svg/tag.svg"),issue:n("../node_modules/octicons/build/svg/issue-opened.svg"),"issue.opened":n("../node_modules/octicons/build/svg/issue-opened.svg"),"issue.closed":n("../node_modules/octicons/build/svg/issue-closed.svg"),"issue.reopened":n("../node_modules/octicons/build/svg/issue-reopened.svg"),milestone:n("../node_modules/octicons/build/svg/milestone.svg"),"merge-request":n("../node_modules/octicons/build/svg/git-pull-request.svg"),wiki:n("../node_modules/octicons/build/svg/file-text.svg"),member:n("../node_modules/octicons/build/svg/person.svg"),repo:n("../node_modules/octicons/build/svg/repo.svg"),post:n("../node_modules/octicons/build/svg/note.svg"),survey:n("../node_modules/octicons/build/svg/list-unordered.svg"),"task-list":n("../node_modules/octicons/build/svg/list-ordered.svg")})}).call(t,n("../node_modules/process/browser.js"))},"../../common/src/objects/utils/external-data-utils.js":function(e,t,n){"use strict";function r(e,t){return y.assign({type:e.type,server_id:e.id},t)}function s(e,t,n){var r=c(t,e);if(!r)throw new Error("Parent object is not linked to server");return r=y.pickBy(r,function(e,t){return"_"!==t.charAt(0)}),y.assign(r,n)}function o(e,t,n){return a(e,r(t,n))}function i(e,t,n,r){return a(e,s(t,n,r))}function a(e,t){return e.external?y.remove(e.external,{server_id:t.server_id}):e.external=[],e.external.push(t),t}function c(e,t,n){var r=y.find(e.external,{server_id:t.id});return!r||n&&!y.isMatch(r,n)?null:r}function l(e,t,n){var r=y.find(e.external,{type:t});return!r||n&&!y.isMatch(r,n)?null:r}function u(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return y.find(e.external,function(e){if(y.every(y.pick(e,n)))return!0})||null}function d(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),s=2;s<n;s++)r[s-2]=arguments[s];return y.find(e.external,function(e){return y.find(t.external,function(t){if(e.type===t.type&&e.server_id===t.server_id){if(y.isEmpty(r))return!0;if(y.isEqual(y.pick(e,r),y.pick(t,r)))return!0}})})||null}function p(e,t,n){y.remove(e.external,function(e){if(e.server_id===t.id&&(!n||y.isMatch(e,n)))return!0})}function h(e){return y.size(e.external)}function m(e,t,n,r){if(!r.ignore){var s,o=y.get(e,n),i=r.overwrite,a=y.indexOf(i,":");if(-1!==a&&(s=i.substr(a+1),i=i.substr(0,a)),"always"===i)void 0!==r.value?y.set(e,n,r.value):y.unset(e,n);else if("never"===i)void 0===o&&void 0!==r.value&&y.set(e,n,r.value);else{if("match-previous"!==i)throw new Error("Unknown option: "+i);var c=v(e,t),l=y.get(c,s);y.isEqual(o,l)&&(void 0!==r.value?(y.set(e,n,r.value),y.set(c,s,r.value)):(y.unset(e,n),y.unset(c,s)))}}}function f(e,t,n){if(!n.ignore){var r="details.resources",s=y.get(e,r,[]),o=y.findIndex(s,{type:n.type}),i=s[o],a=n.replace;if("always"===a)void 0===i?n.value&&s.push(n.value):n.value?s[o]=n.value:s.splice(o,1);else if("never"===a)void 0===i&&n.value&&s.push(n.value);else{if("match-previous"!==a)throw new Error("Unknown option: "+a);var c=v(e,t),l=y.get(c,"resources",[]),u=y.findIndex(l,{type:n.type}),d=l[u];y.isEqual(i,d)&&(void 0===i?n.value&&(s.push(n.value),l.push(n.value)):n.value?(s[o]=n.value,l[u]=n.value):(s.splice(o,1),l.splice(u,1))),y.isEmpty(l)?y.unset(c,"resources"):y.set(c,"resources",l)}y.isEmpty(s)?y.unset(e,r):y.set(e,r,s)}}function g(e,t,n,r,s){if(!s.ignore){var o,i=y.get(r,n),a=s.overwrite,c=y.indexOf(a,":");if(-1!==c&&(o=a.substr(c+1),a=a.substr(0,c)),"always"===a)y.set(r,n,s.value);else if("never"===a)void 0===i&&y.set(r,n,s.value);else{if("match-previous"!==a)throw new Error("Unknown option: "+a);var l=v(e,t),u=y.get(l,o);y.isEqual(i,u)&&(y.set(r,n,s.value),y.set(l,o,s.value))}}}function v(e,t){var n=y.find(e.exchange,{server_id:t.id});return n||(n={type:t.type,server_id:t.id,previous:{}},e.exchange||(e.exchange=[]),e.exchange.push(n)),n.previous}function b(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=y.first(t),s=y.slice(t,1),o=y.find(r.external,function(e){var t=y.pick(e,"server_id","type");return y.every(s,function(e){return y.some(e.external,t)})});return o?{id:o.server_id,type:o.type}:null}var y=n("../../common/node_modules/lodash/lodash.js");e.exports={createLink:r,extendLink:s,addLink:o,inheritLink:i,attachLink:a,findLink:c,findLinkByServerType:l,findLinkByRelations:u,findLinkByRelative:d,removeLink:p,countLinks:h,importProperty:m,importResource:f,exportProperty:g,findCommonServer:b}},"../../common/src/objects/utils/issue-utils.js":function(e,t,n){"use strict";function r(e,t){if(!e)return null;var n,r;return s.each(t,function(t){var s=o.findLinkByRelative(e,t,"project");s&&s.issue&&(n=t,r=s)}),n?{id:r.issue.id,number:r.issue.number,title:e.details.title||"",labels:e.details.labels||[],repo_id:n.id}:null}var s=n("../../common/node_modules/lodash/lodash.js"),o=n("../../common/src/objects/utils/external-data-utils.js");n("../../common/src/utils/tag-scanner.js");e.exports={extractIssueDetails:r}},"../../common/src/objects/utils/reaction-utils.js":function(e,t,n){"use strict";function r(e){return!!e&&!(e.id<1)}function s(e){return!!e&&(!!e.ptime&&!1!==e.ready)}function o(e){return!!e&&c.includes(u.editable,e.type)}function i(e,t,n){if(!e||!e.published)return!1;var r=e.ptime;return!r||l()<l(r).add(t,n)}function a(e){return e.uncommitted}var c=n("../../common/node_modules/lodash/lodash.js"),l=n("../../common/node_modules/moment/moment.js"),u=(n("../../common/src/data/merger.js"),n("../../common/src/objects/types/reaction-types.js")),d=n("../../common/src/objects/utils/story-utils.js");e.exports={isSaved:r,isActuallyPublished:s,isEditable:o,wasPublishedWithin:i,hasUncomittedChanges:a,mergeRemoteChanges:d.mergeRemoteChanges}},"../../common/src/objects/utils/resource-utils.js":function(e,t,n){"use strict";function r(e,t,n){var r=s(n,e),a=s(n,t),c=s(e,t),l=[];return o.each(n,function(n,s){var o=r[s],c=a[s],u=e[o],d=t[c];if(u&&d){var p={resource:u,index:o},h={resource:d,index:c},m={resource:n,index:s},f=i.mergeObjects(p,h,m);l.push(f)}}),o.each(t,function(e,t){o.includes(a,t)||l.push({resource:e,index:t})}),o.each(e,function(e,n){var s=c[n],i=t[s];o.includes(r,n)||i||l.push({resource:e,index:n})}),l=o.sortBy(l,"index"),o.map(l,"resource")}function s(e,t){var n=[],r=[];return o.each(e,function(e,s){var i=e.url||e.payload_token,a=o.findIndex(t,function(e,t){var n=e.url||e.payload_token;if(i===n&&!r[t])return!0});-1!==a&&(n[s]=a,r[a]=!0)}),n}var o=n("../../common/node_modules/lodash/lodash.js"),i=n("../../common/src/data/merger.js");e.exports={mergeLists:r}},"../../common/src/objects/utils/story-utils.js":function(e,t,n){"use strict";function r(e){return!!e&&!(e.id<1)}function s(e){return!!e&&!!e.ptime}function o(e){return!!e&&(!!d.includes(m.editable,e.type)||!("issue"!==e.type||!e.details.exported))}function i(e){return!!e&&(!("issue"!==e.type||!e.details.exported)||d.includes(m.trackable,e.type||"post"))}function a(e,t,n){if(!e||!e.published)return!1;var r=e.ptime;return!r||p()<p(r).add(t,n)}function c(e,t,n){if(!e||!e.published)return!1;var r=e.btime||e.ptime;return!r||p()<p(r).add(t,n)}function l(e){return e.uncommitted}function u(e,t,n){if(!t)return!1;var r={details:{resources:f.mergeLists}},s=h.mergeObjects(e,t,n,r);return d.assign(e,s),!0}var d=n("../../common/node_modules/lodash/lodash.js"),p=n("../../common/node_modules/moment/moment.js"),h=n("../../common/src/data/merger.js"),m=n("../../common/src/objects/types/story-types.js"),f=n("../../common/src/objects/utils/resource-utils.js");e.exports={isSaved:r,isEditable:o,isTrackable:i,isActuallyPublished:s,wasPublishedWithin:a,wasBumpedWithin:c,hasUncomittedChanges:l,mergeRemoteChanges:u}},"../../common/src/objects/utils/user-utils.js":function(e,t,n){"use strict";function r(e,t){return!(!e||!t)&&E.includes(t.user_ids,e.id)}function s(e,t){return!(!e||!t)&&E.includes(e.requested_project_ids,t.id)}function o(e,t){return!!r(e,t)||!(!e||!t)&&("admin"===e.type||E.get(t,"settings.access_control.grant_view_access",!1))}function i(e,t){return!(!e||!t)&&("guest"===e.type?E.get(t,"settings.membership.allow_guest_request",!1):E.get(t,"settings.membership.allow_user_request",!1))}function a(e,t){return!(!e||!t)&&!!E.includes(t.user_ids,e.id)}function c(e){return!!e&&("admin"===e.type||"moderator"===e.type)}function l(e,t,n){if("read-write"!==n)return!1;if(C.isEditable(t)){if(c(t)&&C.wasPublishedWithin(t,14,"day"))return!0;if(a(e,t)&&C.wasPublishedWithin(t,3,"day"))return!0}return!1}function u(e,t,n){return"read-write"===n&&(!!c(e)||!(!a(e,t)||"guest"===e.type))}function d(e,t,n){if("read-write"!==n)return!1;if(c(e)){if(C.wasPublishedWithin(t,14,"day"))return!0}else if(a(e,t)&&C.wasPublishedWithin(t,3,"day"))return!0;return!1}function p(e,t,n){return"read-write"===n&&!(!c(e)&&!a(e,t)||C.wasBumpedWithin(t,1,"day"))}function h(e,t,n,r){return!!e&&("read-write"===r&&(!(!C.isTrackable(t)||!c(e)&&!a(e,t))&&E.some(n,function(t){if(E.includes(t.user_ids,e.id)&&t.details.issues_enabled)return!0})))}function m(e,t){return!(!e||!t)&&!(!E.includes(t.user_ids,e.id)||!t.details.web_url)}function f(e,t,n){return!!e}function g(e,t,n){return"guest"!==e.type&&("read-write"===n&&f(e,t,n))}function v(e,t){return!(!e||!t)&&t.user_id===e.id}function b(e,t,n,r){return!!e&&!(!_.isEditable(n)||!v(e,n)||"read-write"!==r&&"read-comment"!==r||!_.wasPublishedWithin(n,3,"day"))}function y(e,t,n,r){return!(!c(e)||"read-write"!==r)||(!(!v(e,n)||"read-write"!==r&&"read-comment"!==r||!_.wasPublishedWithin(n,3,"day"))||!(!a(e,t)||"read-write"!==r||!_.wasPublishedWithin(n,7,"day")))}function j(e,t,n,r){return"vote"!==n.type&&(!(!c(e)||"read-write"!==r)||!(!a(e,t)||"guest"===e.type||"read-write"!==r))}function w(e,t,n){if(E.includes(S.git,n)){if(t){if(E.isEmpty(t))return!1;if(E.includes(S.git.membership,n)&&e){var r=E.some(t,function(t){return m(e,t)});if(!r)return!1}}}else if(E.includes(S.admin,n)&&e&&"admin"!==e.type)return!1;return!0}function x(e,t){if(!e)return"Â ";var n=t.pick(e.details.name);return E.trim(n)||(n=E.capitalize(e.username)),n}function k(e,t){if(!e)return"Â ";var n=t.name(e.details.name,e.details.gender);return E.trim(n)||(n=t.name(E.capitalize(e.username),e.details.gender)),n}var E=n("../../common/node_modules/lodash/lodash.js"),C=(n("../../common/node_modules/moment/moment.js"),n("../../common/src/objects/utils/story-utils.js")),_=n("../../common/src/objects/utils/reaction-utils.js"),S=n("../../common/src/objects/types/notification-types.js");e.exports={isMember:r,isPendingMember:s,isAuthor:a,isRespondent:v,canJoinProject:i,canViewProject:o,canModerate:c,canEditStory:l,canHideStory:u,canRemoveStory:d,canBumpStory:p,canAddIssue:h,canAccessRepo:m,canCreateBookmark:f,canSendBookmarks:g,canEditReaction:b,canHideReaction:j,canRemoveReaction:y,canReceiveNotification:w,getDisplayName:x,getDisplayNameWithGender:k,mergeRemoteChanges:C.mergeRemoteChanges}},"../../common/src/routing/cors-rewriter.js":function(e,t,n){"use strict";function r(e,t){var n,r,s=new RegExp("^/(https?)/([^/]*)"),o=s.exec(e.path);o?(r=o[1]+":",n=o[2],e.path=e.path.substr(o[0].length),t.cors=!0):(n=window.location.host,r=window.location.protocol,t.cors=!1),r&&n&&(t.address=r+"//"+n)}function s(e,t){if(t.cors){var n=t.address;if(n){var r=n.indexOf("://"),s=n.substr(0,r),o=n.substr(r+3);e.path="/"+s+"/"+o+e.path}}}e.exports={extract:r,insert:s}},"../../common/src/routing/link-manager.jsx":function(e,t,n){"use strict";var r=n("../../common/node_modules/lodash/lodash.js"),s=(n("../../common/node_modules/bluebird/js/browser/bluebird.js"),n("../../common/node_modules/react/react.js")),o=s.PropTypes,i=n("../../common/src/data/database.js"),a=n("../../common/src/routing/route.js"),c=n("../../common/src/mixins/update-check.js"),l=n("../../common/src/widgets/diagnostics.jsx"),u=n("../../common/src/widgets/diagnostics-section.jsx");e.exports=s.createClass({displayName:"LinkManager",mixins:[c],propTypes:{hasAccess:o.bool,database:o.instanceOf(i),route:o.instanceOf(a)},getInitialState:function(){return{found:[],added:[]}},findRecentLocation:function(){var e=this,t=this.props.database.use({by:this}),n={};return t.find({schema:"local",table:"project_link",criteria:n}).then(function(t){var n=r.sortBy(t,"atime"),s=r.last(n);return e.setState({found:r.map(n,"key")}),s})},saveLocation:function(e,t){var n=e+"/"+t;this.setState({added:r.union(r.without(this.state.added,n),[n])});var s=this.props.database.use({by:this}),o={name:t};s.findOne({schema:"global",table:"project",criteria:o}).then(function(r){if(!r)return null;var o=r.details.title,i=(new Date).toISOString(),a={key:n,address:e,schema:t,name:o,atime:i};return s.saveOne({schema:"local",table:"project_link"},a)})},removeLocations:function(e){var t=this.props.database.use({by:this}),n={address:e};return t.find({schema:"local",table:"project_link",criteria:n}).then(function(e){return t.remove({schema:"local",table:"project_link"},e)})},removeDefunctLocations:function(e){var t=this.props.database.use({by:this}),n={};return t.find({schema:"global",table:"project",criteria:n}).then(function(s){return t.find({schema:"local",table:"project_link",criteria:n}).then(function(n){var o=r.filter(n,function(t){if(t.address===e&&!r.some(s,{name:t.schema}))return!0});return t.remove({schema:"local",table:"project_link"},o)})}).catch(function(e){})},componentDidUpdate:function(e,t){if(this.props.hasAccess&&(e.route!==this.props.route||!e.hasAccess)){var n=r.get(e.route,"parameters.address"),s=r.get(e.route,"parameters.schema"),o=r.get(this.props.route,"parameters.address"),i=r.get(this.props.route,"parameters.schema");n===o&&s===i&&e.hasAccess||o&&i&&this.saveLocation(o,i),n!==o&&this.removeDefunctLocations(o)}},render:function(){return s.createElement(l,{type:"link-manager"},s.createElement(u,{label:"Links"},s.createElement("div",null,"Found in cache: ",r.join(this.state.found," ")),s.createElement("div",null,"Added to cache: ",r.join(this.state.added," "))))}})},"../../common/src/routing/route-manager.jsx":function(e,t,n){"use strict";function r(e){var t=e,n="",r=t.indexOf("#");-1!==r&&(n=t.substr(r+1),t=t.substr(0,r));var o={},i=t.indexOf("?");return-1!==i&&(o=s(t.substr(i+1)),t=t.substr(0,i)),{path:t,query:o,hash:n}}function s(e){var t={},n=i.split(e,"&");return i.each(n,function(e){var n=i.split(e,"="),r=decodeURIComponent(n[0]),s=decodeURIComponent(n[1]||"");s=i.replace(s,/\+/g," "),t[r]=s}),t}function o(e){return e.pathname+e.search+e.hash}var i=n("../../common/node_modules/lodash/lodash.js"),a=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),c=n("../../common/node_modules/react/react.js"),l=c.PropTypes,u=n("../../common/src/data/database.js");e.exports=c.createClass({displayName:"RouteManager",propTypes:{pages:l.array.isRequired,database:l.instanceOf(u),rewrite:l.func,onChange:l.func,onRedirectionRequest:l.func},getInitialState:function(){return{basePath:this.getBasePath(),url:null,component:null,parameters:null,query:null,hash:""}},getBasePath:function(){var e=document.getElementsByTagName("BASE")[0];if(e){var t=e.getAttribute("href");return i.replace(t,/\/+$/,"")}return""},getURL:function(){return this.state.url},getComponent:function(){return this.state.component},getParameters:function(){return this.state.parameters},getQuery:function(){return this.state.query},getHash:function(){return this.state.hash},goTo:function(e,t){var n=o(e);return this.change(n,t)},find:function(e,t){var n,r;e instanceof Array?(n=e[0],r=i.slice(e,1)):n=e,t=i.clone(t)||{};var s=n.getURL(t),o=this.state.basePath;o&&(s.path=o+s.path),this.props.rewrite&&this.props.rewrite(s,t,"find");var a=s.path;if(!i.isEmpty(s.query)){var c="";i.forIn(s.query,function(e,t){c+=c?"&":"?",c+=t+"="+encodeURIComponent(e).replace(/%20/g,"+")}),a+=c}var l=i.map(r,function(e){return e.getHash(t)}),u=i.join(l,"");return u&&(a+="#"+u),a},parse:function(e){var t=this,n=r(e),s={};this.props.rewrite&&this.props.rewrite(n,s,"parse");var o=this.state.basePath;if(o){if(!i.startsWith(n.path,o))return null;n.path=n.path.substr(o.length)}var a,c=0;try{i.each(this.props.pages,function(e){if("function"!=typeof e.parseURL){var r=i.get(e,"displayName","Page");throw new Error(r+" does not implement the static function parseURL()")}var o=e.parseURL(n.path,n.query);if(o&&o.match.length>c){var l=i.assign(i.omit(o,"match"),s),u=t.find(e,l);n.hash&&(u+="#"+n.hash),a={url:u,component:e,parameters:l,query:n.query,hash:n.hash},c=o.match.length}})}catch(e){return console.error(e),null}return a},change:function(e,t,n){var r=this;if(this.state.url===e)return a.resolve(!1);var s=this.parse(e);return s?(this.setState(s,function(){n||(n=s.url);var e=window.location.protocol,o=window.location.host,i=e+"//"+o+n;window.location.href!==i&&(t?window.history.replaceState({},"",i):window.history.pushState({},"",i)),r.triggerChangeEvent()}),a.resolve(!0)):this.triggerRedirectionRequest(e,t)},reanchor:function(e){var t=window.location.href,n=t.indexOf("#"),r=-1!==n?t.substr(0,n):t;e&&(r+="#"+e),t!==r&&window.history.replaceState({},"",r),this.state.hash!==e&&this.setState({hash:e})},triggerChangeEvent:function(){this.props.onChange&&this.props.onChange({type:"change",target:this})},triggerRedirectionRequest:function(e,t){var n=this;if(this.props.onRedirectionRequest&&!this.redirecting){var r=this.state.basePath;return r&&i.startsWith(e,r)&&(e=e.substr(r.length),i.startsWith(e,"/")||(e="/"+e)),this.redirecting=!0,a.try(function(){return n.props.onRedirectionRequest({type:"redirection",target:n,url:e,replacing:t})}).finally(function(){n.redirecting=!1})}return a.reject(new Error("Unable to route URL to a page: "+e))},render:function(){return null},componentDidMount:function(){this.componentDidUpdate({},{}),window.addEventListener("popstate",this.handlePopState)},componentDidUpdate:function(e,t){!e.database&&this.props.database&&this.goTo(window.location,!0).catch(function(e){console.error(e)})},componentWillUnmount:function(){window.removeEventListener("popstate",this.handlePopState)},handlePopState:function(e){var t=this;e.preventDefault();var n=o(window.location),r=this.parse(n);r&&this.setState(r,function(){t.triggerChangeEvent()})}})},"../../common/src/routing/route.js":function(e,t,n){"use strict";function r(e){this.routeManager=e,this.url=this.routeManager.getURL(),this.path=o.replace(this.url,/[?#].*/,""),this.component=this.routeManager.getComponent(),this.parameters=this.routeManager.getParameters(),this.query=this.routeManager.getQuery(),this.hash=this.routeManager.getHash(),this.callbacks=[]}function s(e){var t=c[e];if(!t){var n=[],r=e.replace(/(:\w+)/g,function(e){return n.push(e),"([^\\/]+)"});t=c[e]=new RegExp("^"+r),t.names=n}return t}var o=("function"==typeof Symbol&&Symbol.iterator,n("../../common/node_modules/lodash/lodash.js")),i=n("../../common/node_modules/bluebird/js/browser/bluebird.js");e.exports=r,r.prototype.change=function(e,t,n){var r=this;if("string"!=typeof e)throw new Error("Invalid argument");return this.ask(e,!0).then(function(s){return!!s&&r.routeManager.change(e,t,n)})},r.prototype.find=function(e,t){return this.routeManager.find(e,t)},r.prototype.push=function(e,t){var n=this.routeManager.find(e,t);return this.change(n,!1)},r.prototype.replace=function(e,t){var n=this.routeManager.find(e,t);return this.change(n,!0)},r.prototype.reanchor=function(e){this.routeManager.reanchor(e),this.hash=e||""},r.prototype.ask=function(e,t){return t?i.reduce(this.callbacks,function(t,n){try{if(!t)return!1;var r=n(e,!0);return i.resolve(r)}catch(e){return console.error(e),!0}},!0).then(function(e){return e}):o.reduce(this.callbacks,function(e,t){try{if(!e)return!1;var n=t(!1);if("boolean"!=typeof n)throw new Error("Callback passed to keep() should return a boolean when interactive (2nd argument) is true");return n}catch(e){return console.error(e),!0}},!0)},r.prototype.keep=function(e){this.callbacks.push(e)},r.prototype.free=function(e){o.pull(this.callbacks,e)},r.prototype.toString=function(){return this.url},r.compare=function(e,t){if(e&&t){if(e.component!==t.component)return!1;var n=e.parameters,r=t.parameters,s=o.union(o.keys(n),o.keys(r));return o.every(s,function(e){var t=n[e],s=r[e];return!(!o.isEqual(t,s)&&(t instanceof Array&&0===t.length&&(t=null),s instanceof Array&&0===s.length&&(s=null),t||s))})}return!1},r.match=function(e,t,n){for(var r=0;r<t.length;r++){var i=s(t[r]),a=i.exec(e);if(a){var c={};return o.each(i.names,function(e,t){c[e.substr(1)]=a[t+1]}),n&&(c=n(c)),c&&(c.match=a[0]),c}}},r.parseIdList=function(e){if(void 0!=e){if(e){var t=o.split(e,/[\s\+]/);return o.map(t,o.strictParseInt)}return a}};var a=[];r.parseId=function(e,t){if(void 0!=e){if(t instanceof RegExp){var n=t.exec(e);if(!n)return;e=n[1]}return o.strictParseInt(e)}},r.parseDate=function(e){if(void 0!=e)return/\d{4}-\d{2}-\d{2}/.test(e)?e:""};var c={}},"../../common/src/routing/universal-link.js":function(e,t,n){"use strict";function r(e,t,n,r){var s="/"+o.replace(e,"://","/"),a=i+s+t;if(!o.isEmpty(n)){a+="?"+o.filter(o.map(n,function(e,t){if(void 0!=e)return t+"="+encodeURIComponent(e)})).join("&")}return r&&(a+="#"+r),a}function s(e){var t=a.exec(e);if(!t)return null;var n,e=t[1],r=t[2],s=o.replace(r.substr(1),"/","://"),i=t[3],c=t[4];if(c){n={};var l=o.split(c.substr(1),"&");o.each(l,function(e){var t=o.split(e,"="),r=t[0],s=decodeURIComponent(t[1]);n[r]=s})}var u=t[6];return{address:s,path:i,query:n,hash:u,url:e}}var o=n("../../common/node_modules/lodash/lodash.js");e.exports={parse:s,form:r};var i="https://trambar.io",a=new RegExp("^"+i+"((/https?/[^/]*)([^?]*)([^#]*)?(#(.*))?)")},"../../common/src/theme/theme-manager.jsx":function(e,t,n){"use strict";function r(e){var t;if("number"==typeof e)return e;if(t=/^(\d+)\s*vw/.exec(e)){var n=parseInt(t[1]);return Math.round(n*document.body.offsetWidth/100)}if(t=/^(\d+)\s*vh/.exec(e)){var n=parseInt(t[1]);return Math.round(n*document.body.offsetHeight/100)}}function s(e){switch(e){case"cellular":case"2g":return"50kbps";case"3g":return"400kbps";case"4g":return"5000kbps";case"ethernet":case"wifi":default:return"10000kpbs"}}function o(e,t){if(t.original)return null;var n=e.clip;return t.hasOwnProperty("clip")?n=t.clip:n||(n=h.default(e.width,e.height)),n}function i(){var e=document.createElement("CANVAS");if(e.width=e.height=1,e.toDataURL){if(5===e.toDataURL("image/webp").indexOf("image/webp"))return!0}return!1}function a(){var e=navigator.userAgent;return!(!/Android/.test(e)||/Edge/.test(e))}function c(){if(!a())return!1;var e=window.innerHeight;return screen.height-e>200}function l(){var e=navigator.userAgent;return!!/iPhone|iPad|iPod/.test(e)||(!!/Android/.test(e)||!!/Windows Phone/.test(e))}var u=n("../../common/node_modules/lodash/lodash.js"),d=n("../../common/node_modules/react/react.js"),p=d.PropTypes,h=n("../../common/src/media/image-cropping.js"),m=n("../../common/src/transport/blob-manager.js"),f=n("../../common/src/data/database.js");e.exports=d.createClass({displayName:"ThemeManager",propTypes:{modes:p.object,serverAddress:p.string,networkType:p.string,database:p.instanceOf(f),useWebP:p.bool,onChange:p.func},getInitialState:function(){return{mode:this.selectMode(),onscreenKeyboard:c(),touchInterface:l(),devicePixelRatio:window.devicePixelRatio,webpSupport:i(),details:null}},getMode:function(){return this.state.mode},getModes:function(){var e=u.sortBy(u.toPairs(this.props.modes),1);u.map(e,0);return u.keys(this.props.modes)},getBandwidth:function(){return 1e3*parseInt(s(this.props.networkType))},getDetails:function(){return this.state.details},hasKeyboard:function(){return this.state.onscreenKeyboard},hasTouchInterface:function(){return this.state.touchInterface},getImageURL:function(e,t){if(!e)return null;t||(t={});var n=this.getRemoteImageURL(e,t);return n||t.remote||(n=this.getLocalImageURL(e,t)),n},getLocalImageURL:function(e,t){if(e.payload_token){var n;switch(e.type){case"video":case"audio":case"website":n="poster";break;default:n="main"}var r="payload:"+e.payload_token+"/"+n,s=m.find(r);if(!s)return null;var i={url:m.url(s),clip:o(e,t),format:e.format};return"json:"+JSON.stringify(i)}},getRemoteImageURL:function(e,t){var n;switch(e.type){case"video":case"audio":case"website":n=e.poster_url;break;default:n=e.url}if(n){var s="";if(!t.original){var i=[],a=o(e,t);if(a){var c=u.map([a.left,a.top,a.width,a.height],Math.round);i.push("cr"+c.join("-"))}var l=r(t.width),d=r(t.height);1!==this.state.devicePixelRatio&&(l*=this.state.devicePixelRatio,d*=this.state.devicePixelRatio),l=Math.round(l),d=Math.round(d);var p=l||d;p&&(l&&d?i.push("re"+l+"-"+d):!l&&d?i.push("h"+d):!d&&l&&i.push("w"+l),"png"!==e.format&&"gif"!==e.format||i.push("sh")),void 0!==t.quality&&i.push("q"+t.quality);var h;"svg"===e.format?h="svg":this.state.webpSupport&&!1!==this.props.useWebP||!0===this.props.useWebP?(h="webp","png"!==e.format&&"gif"!==e.format||p||i.push("l")):h="png"===e.format||"gif"===e.format?"png":"jpg",s="/"+i.join("+")+"."+h}return""+this.props.serverAddress+n+s}},getVideoURL:function(e,t){if(!e.url)return null;t||(t={});var n=""+this.props.serverAddress+e.url;if(!t||!t.original){var r=this.pickVideoVersion(e,t);r&&(n+="."+r.name+"."+r.format)}return n},getAudioURL:function(e,t){if(!e.url)return null;t||(t={});var n=""+this.props.serverAddress+e.url;if(!t||!t.original){var r=this.pickAudioVersion(e,t);r&&(n+="."+r.name+"."+r.format)}return n},getImageDimensions:function(e,t){t||(t={});var n=o(e,t);return n&&!t.original?{width:n.width,height:n.height}:{width:e.width,height:e.height}},getDimensions:function(e,t){if("video"===e.type){if(!t.original){var n=this.pickVideoVersion(e,t);if(n&&n.width&&n.height)return{width:n.width,height:n.height}}return{width:e.width,height:e.height}}return this.getImageDimensions(e,t)},pickVideoVersion:function(e,t){if(t.hasOwnProperty("bitrate"))return u.find(e.resources,{bitrates:{video:t.bitrate}})||null;var n=this.getBandwidth(),r=function(e){return parseInt(u.get(e,"bitrates.video"))},s=function(e){var t=r(e);return t<=n?n-t:1/0},o=function(e){var t=r(e);return t>n?t-n:0},i=u.sortBy(e.versions,[s,o]);return u.first(i)||null},pickAudioVersion:function(e,t){if(t.hasOwnProperty("bitrate"))return u.find(e.resources,{bitrates:{audio:t.bitrate}})||null;var n=this.getBandwidth(),r=function(e){return parseInt(u.get(e,"bitrates.audio"))},s=function(e){var t=r(e);return t<=n?n-t:1/0},o=function(e){var t=r(e);return t>n?t-n:0},i=u.sortBy(e.versions,[s,o]);return u.first(i)||null},getURL:function(e,t){switch(e.type){case"image":return this.getImageURL(e,t);case"video":return this.getVideoURL(e,t);case"website":return e.url;case"audio":return this.getAudioURL(e,t)}},selectMode:function(){var e=document.body.parentNode.offsetWidth,t="";for(var n in this.props.modes){e>=this.props.modes[n]&&(t=n)}return t},change:function(e){var t=this;return u.isEqual(this.state.details,e)?Promise.resolve(!0):(this.setState({details:e},function(){t.triggerChangeEvent()}),Promise.resolve(!0))},componentWillMount:function(){window.addEventListener("resize",this.handleWindowResize)},render:function(){return null},componentDidMount:function(){this.change(g)},componentDidUpdate:function(e,t){var n=this;if(!e.database&&this.props.database){var r=this.props.database.use({schema:"local",by:this});r.start().then(function(){return r.findOne({table:"settings",key:"theme"})}).then(function(e){e&&e.theme&&n.change(e.theme)})}},componentWillUnmount:function(){window.removeEventListener("resize",this.handleWindowResize)},triggerChangeEvent:function(){this.props.onChange&&this.props.onChange({type:"change",target:this})},handleWindowResize:function(e){var t=this,n={},r=this.selectMode();this.state.mode!==r&&(n.mode=r);var s=c();if(this.state.onscreenKeyboard!==s&&(n.onscreenKeyboard=s,s&&a())){var o=document.activeElement;o&&setTimeout(function(){o.scrollIntoViewIfNeeded({behavior:"smooth",block:"center"})},100)}this.state.devicePixelRatio!==window.devicePixelRatio&&(n.devicePixelRatio=window.devicePixelRatio),u.isEmpty(n)||this.setState(n,function(){t.triggerChangeEvent()})}});var g={}},"../../common/src/theme/theme.js":function(e,t,n){"use strict";function r(e){this.themeManager=e,this.mode=this.themeManager.getMode(),this.modes=this.themeManager.getModes(),this.keyboard=this.themeManager.hasKeyboard(),this.touch=this.themeManager.hasTouchInterface(),this.details=this.themeManager.getDetails()}var s=n("../../common/node_modules/lodash/lodash.js");e.exports=r,r.prototype.change=function(e){return this.themeManager.change(e)},r.prototype.isAboveMode=function(e){var t=s.indexOf(this.modes,e);return s.indexOf(this.modes,this.mode)>=t},r.prototype.isBelowMode=function(e){return!this.isAboveMode(e)},r.prototype.getImageURL=function(e,t){return this.themeManager.getImageURL(e,t)},r.prototype.getVideoURL=function(e,t){return this.themeManager.getVideoURL(e,t)},r.prototype.getAudioURL=function(e,t){return this.themeManager.getAudioURL(e,t)},r.prototype.getURL=function(e,t){return this.themeManager.getURL(e,t)},r.prototype.getImageDimensions=function(e,t){return this.themeManager.getImageDimensions(e,t)},r.prototype.getDimensions=function(e,t){return this.themeManager.getDimensions(e,t)}},"../../common/src/transport/background-file-transfer.js":function(e,t,n){"use strict";function r(){try{c=a.init(),c.on("success",function(e){var t=i.find(l,{id:e.id});t&&t.onSuccess&&t.onSuccess(e),i.pull(l,t)}),c.on("progress",function(e){var t=i.find(l,{id:e.id});t&&t.onProgress&&t.onProgress(e)}),c.on("error",function(e){var t=i.find(l,{id:e.id});t&&t.onError&&t.onError(new Error(e.error))})}catch(e){c=null}}function s(e,t,n,r){var s={id:e,filePath:t,serverUrl:n,fileKey:"file",headers:i.get(r,"headers",{}),parameters:i.get(r,"parameters",{})};c.startUpload(s);var o={id:e,onSuccess:i.get(r,"onSuccess"),onError:i.get(r,"onError"),onProgress:i.get(r,"onProgress")};l.push(o)}function o(e){return new Promise(function(t,n){var r=function(e){t(e)},s=function(e){n(new Error(e.error))};c.removeUpload(e,r,s)})}var i=n("../../common/node_modules/lodash/lodash.js"),a=window.FileTransferManager;e.exports={initialize:r,send:s,cancel:o};var c,l=[]},"../../common/src/transport/blob-manager.js":function(e,t,n){"use strict";function r(e){var t=new Date,n=u.find(h,{blob:e});if(n)return n.atime=t,n.localURL;var r;e instanceof Blob&&(r=URL.createObjectURL(e));var s=[r];return h.push({blob:e,localURL:r,urls:s,atime:t}),r}function s(e){if(!e)return null;var t=u.find(h,function(t){return u.includes(t.urls,e)});return t?(t.atime=new Date,t.blob):null}function o(e,t){if(e&&t){var n=u.find(h,{blob:e});n||(r(e),n=u.find(h,{blob:e})),n.urls.push(t)}}function i(e){if(!e)throw d.reject(new Error("Invalid argument"));var t=s(e);if(t)return d.resolve(t);var n={responseType:"blob"};return p.fetch("GET",e,null,n).then(function(t){r(t);return o(t,e),t})}function a(e){var t=u.findIndex(h,{blob:e});if(-1!==t){var n=h[t];h.splice(t,1),c(n)}}function c(e){e.blob instanceof Blob&&URL.revokeObjectURL(e.localURL)}function l(){var e=new Date,t=u.remove(h,function(t){if(u.some(t.urls,function(e){return/https?:/.test(e)})&&e-t.atime>18e4)return!0});u.each(t,function(e){c(e)})}var u=n("../../common/node_modules/lodash/lodash.js"),d=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),p=(n("../../common/node_modules/moment/moment.js"),n("../../common/src/transport/http-request.js"));e.exports={manage:r,find:s,associate:o,fetch:i,release:a,url:r};var h=[];setInterval(l,6e4)},"../../common/src/transport/blob-reader.js":function(e,t,n){"use strict";function r(e){return s(e).then(function(e){return new Uint8Array(e)})}function s(e){if("string"==typeof e){var t=e;return a.fetch(t).then(function(e){return s(e)})}return new i(function(t,n){var r=new FileReader;r.onload=function(e){t(r.result)},r.onerror=function(e){n(new Error("Unable to load blob"))},r.readAsArrayBuffer(e)})}function o(e){if("string"==typeof e){var t=e;return a.fetch(t).then(function(e){return o(e)})}return new i(function(t,n){var r=new FileReader;r.onload=function(e){t(r.result)},r.onerror=function(e){n(new Error("Unable to load text"))},r.readAsText(e)})}var i=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),a=n("../../common/src/transport/blob-manager.js");e.exports={loadUint8Array:r,loadArrayBuffer:s,loadText:o}},"../../common/src/transport/blob-stream.js":function(e,t,n){"use strict";function r(e,t){this.id=c.generate(),this.address=e,this.options=t,this.parts=[],this.closed=!1,this.error=null,this.pullResult=null,this.waitResult=null,this.size=0,this.started=!1,this.canceled=!1,this.finished=!1,this.online=!0,this.transferred=0,this.promise=null,this.onProgress=null,this.onComplete=null,this.onError=null}function s(){var e={};return e.promise=new i(function(t,n){e.resolve=t,e.reject=n}),e}var o=n("../../common/node_modules/lodash/lodash.js"),i=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),a=n("../../common/src/transport/http-request.js"),c=n("../../common/src/utils/random-token.js"),l=n("../../common/node_modules/async-do-while/index.js");e.exports=r,r.prototype.toBlob=function(){var e=o.map(this.parts,"blob");if(e.length>1){var t=e[0].type;return new Blob(e,{type:t})}return 1===e.length?e[0]:new Blob},r.prototype.setOptions=function(e){if(this.started)throw new Error("Cannot set options once a stream has started");this.options=o.assign({},this.options,e)},r.prototype.push=function(e){this.parts.push({blob:e,sent:!1}),this.size+=e.size,this.pullResult&&(this.pullResult.resolve(e),this.pullResult=null)},r.prototype.close=function(){this.closed=!0,o.find(this.parts,{sent:!1})||(this.pullResult&&(this.pullResult.resolve(null),this.pullResult=null),this.waitResult&&(this.waitResult.resolve(),this.waitResult=null))},r.prototype.pull=function(){var e=o.find(this.parts,{sent:!1});return e?i.resolve(e.blob):this.closed?i.resolve(null):(this.pullResult||(this.pullResult=s()),this.pullResult.promise)},r.prototype.finalize=function(e){var t=o.find(this.parts,{blob:e});if(t&&(t.sent=!0),this.waitResult){!o.find(this.parts,{sent:!1})&&this.closed&&this.waitResult.resolve()}},r.prototype.abandon=function(e){this.error=e,this.waitResult&&this.waitResult.reject(e)},r.prototype.wait=function(){if(this.closed){if(this.error)return i.reject(this.error);if(!o.find(this.parts,{sent:!1}))return i.resolve()}return this.waitResult||(this.waitResult=s()),this.waitResult.promise},r.prototype.pipe=function(e,t){t||(t=1048576);for(var n=e.size,r=e.type,s=0;s<n;s+=t){var o=Math.min(t,n-s),i=e.slice(s,s+o,r);this.push(i)}return this.close(),this},r.prototype.suspend=function(e){this.online&&(this.online=!1)},r.prototype.resume=function(){if(!this.online&&(this.online=!0,this.onConnectivity)){var e=this.onConnectivity;this.onConnectivity=null,this.connectivityPromise=null,e()}},r.prototype.waitForConnectivity=function(){var e=this;return this.online?i.resolve():(this.connectivityPromise||(this.connectivityPromise=new i(function(t,n){e.onConnectivity=t})),this.connectivityPromise)},r.prototype.start=function(){var e=this;return this.promise||(this.promise=this.waitForConnectivity().then(function(){return e.started=!0,new i(function(t,n){var r=0,s=!1,c=0,u=0,d=1e3;l.do(function(){return e.waitForConnectivity().then(function(){return e.pull().then(function(n){if(e.canceled)throw new Error("Stream was canceled");var r=e.getURL(),i=new FormData;n?(i.append("file",n),i.append("chunk",u),0===u&&o.each(e.options,function(e,t){i.append(t,e)})):s=!0;var l={responseType:"json",onUploadProgress:function(t){if(n){var r=Math.round(n.size*(t.loaded/t.total));r&&e.updateProgress(c+r)}}};return e.chunkPromise=a.fetch("POST",r,i,l),e.chunkPromise.then(function(r){n&&(e.finalize(n),c+=n.size),0===u&&t(),u++}).finally(function(){e.chunkPromise=null})}).catch(function(t){if(!e.canceled&&!(t.statusCode>=400&&t.statusCode<=499&&429!==t.statusCode)&&++r<10)return d=Math.min(2*d,3e4),i.delay(d);throw t})})}),l.while(function(){return!s}),l.end().then(function(){e.finished=!0,e.onComplete&&e.onComplete({type:"complete",target:e})}).catch(function(t){if(e.abandon(t),0!==u){var r=e.getURL(),s=new FormData;return s.append("abort",1),a.fetch("POST",r,s).catch(function(e){}).finally(function(){e.onError&&e.onError(t)})}n(t)})})})),this.promise},r.prototype.cancel=function(){this.canceled||this.finished||(this.canceled=!0,this.chunkPromise&&this.chunkPromise.isPending()&&this.chunkPromise.cancel())},r.prototype.getURL=function(){return this.address+"/srv/media/stream/?id="+this.id},r.prototype.updateProgress=function(e){this.transferred=e,this.onProgress&&this.onProgress({type:"progress",target:this,loaded:e,total:this.size,lengthComputable:this.closed})}},"../../common/src/transport/connectivity-monitor.jsx":function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(){return navigator.connection||navigator.mozConnection||navigator.webkitConnection}function o(){var e=navigator.userAgent;return!(!/Android/.test(e)||/Edge/.test(e))}var i=n("../../common/node_modules/lodash/lodash.js"),a=(n("../../common/node_modules/bluebird/js/browser/bluebird.js"),n("../../common/node_modules/react/react.js")),c=a.PropTypes,l=n("../../common/src/mixins/update-check.js"),u=n("../../common/src/widgets/diagnostics.jsx"),d=n("../../common/src/widgets/diagnostics-section.jsx");e.exports=a.createClass({displayName:"ConnectivityMonitor",mixins:[l],propTypes:{inForeground:c.bool,onChange:c.func},getInitialState:function(){return{online:this.isOnline(),type:this.getConnectionType()}},isOnline:function(){return navigator.onLine},getConnectionType:function(){var e=s();return e?e.effectiveType:"unknown"},componentWillMount:function(){var e=this;window.addEventListener("online",this.handleBrowserOnline),window.addEventListener("offline",this.handleBrowserOffline);var t=s();t&&t.addEventListener("typechange",this.handleConnectionTypeChange),navigator.getBattery&&navigator.getBattery().then(function(t){t.addEventListener("levelchange",e.handleBatteryChange),t.addEventListener("chargingchange",e.handleBatteryChange),e.setState({battery:i.pick(t,"charging","level")})})},componentWillReceiveProps:function(e){var t=this;if(this.props.inForeground!==e.inForeground){if(o())if(e.inForeground){clearTimeout(this.offlineTimeout);var n=this.isOnline();!this.state.online&&n&&this.setState({online:!0},function(){t.triggerChangeEvent(t.state.online,t.state.type)})}else this.offlineTimeout=setTimeout(function(){t.state.online&&t.state.battery&&t.state.battery.level<.2&&t.setState({online:!1},function(){t.triggerChangeEvent(t.state.online,t.state.type)})},3e4);if(e.inForeground){var n=this.isOnline();this.state.online!==n&&this.setState({online:n},function(){t.triggerChangeEvent(t.state.online,t.state.type)})}}},componentDidMount:function(){this.triggerChangeEvent(this.state.online,this.state.type)},componentWillUnmount:function(){var e=this;window.removeEventListener("online",this.handleBrowserOnline),window.removeEventListener("offline",this.handleBrowserOffline);var t=s();t&&t.removeEventListener("typechange",this.handleConnectionTypeChange),navigator.getBattery&&navigator.getBattery().then(function(t){t.removeEventListener("levelchange",e.handleBatteryChange),t.removeEventListener("chargingchange",e.handleBatteryChange)})},triggerChangeEvent:function(e,t){this.props.onChange&&this.props.onChange(r({type:"alertclick",target:this,online:e},"type",t))},handleBrowserOffline:function(e){var t=this;this.setState({online:!1},function(){t.triggerChangeEvent(!1,t.state.type)})},handleBrowserOnline:function(e){var t=this,n=this.getConnectionType();this.setState({online:!0,type:n},function(){t.triggerChangeEvent(!0,n)})},handleConnectionTypeChange:function(e){var t=this.getConnectionType();this.setState({type:t}),this.triggerChangeEvent(this.state.online,t)},handleBatteryChange:function(e){this.setState({battery:i.pick(e.target,"charging","level")})},render:function(){return a.createElement(u,{type:"connectivity-monitor"},a.createElement(d,{label:"Connection"},a.createElement("div",null,"Online: ",this.state.online?"yes":"no"),a.createElement("div",null,"Type: ",this.state.type)))}})},"../../common/src/transport/http-request.js":function(e,t,n){"use strict";function r(e,t,n,r){var c=new XMLHttpRequest,l=new i(function(i,l){var u=o.get(r,"username",null),d=o.get(r,"password",null),p=o.get(r,"contentType",null);if("GET"===(e=o.toUpper(e))&&!o.isEmpty(n)){var h=[];o.forIn(n,function(e,t){t=encodeURIComponent(t),void 0!==(e=encodeURIComponent(e))&&h.push(t+"="+e)}),-1===o.indexOf(t,"?")?t+="?":t+="&",t+=o.join(h,"&"),n=null}"json"===p&&(p="application/json"),"application/json"===p&&o.isObject(n)&&(n=JSON.stringify(n,s)),c.timeout=o.get(r,"timeout"),c.withCredentials=o.get(r,"crossSite",!1),c.responseType=o.get(r,"responseType",""),c.attributes=o.get(r,"attributes"),c.attributes&&c.upload&&(c.upload.attributes=c.attributes),c.open(e,t,!0,u,d),p&&c.setRequestHeader("Content-Type",p),c.onload=function(e){if(c.status>=400){var t=new a(c.status,c.response);l(t)}else{var n=c.response;i(n)}},c.ontimeout=function(e){l(new Error("Request timed out"))},c.onerror=function(e){l(new Error(e.message))},c.onabort=function(e){l(new Error("Transfer aborted: "+t))};var m=o.get(r,"onDownloadProgress"),f=o.get(r,"onUploadProgress");c.onprogress=function(e){m&&m(e)},c.upload.onprogress=function(e){f&&f(e)},c.send(n)});return l.cancel=function(){c.abort()},l}function s(e,t){if(!(t instanceof Blob))return t}var o=n("../../common/node_modules/lodash/lodash.js"),i=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),a=n("../../common/src/errors/http-error.js");e.exports={fetch:r}},"../../common/src/transport/notification-unpacker.js":function(e,t,n){"use strict";function r(e){return e.changes?{type:"change",changes:s(e)}:e.alert?{type:"alert",alert:o(e)}:e.revalidation?{type:"revalidation",revalidation:i(e)}:e.socket?{type:"connection",connection:a(e)}:e.address&&e.schema&&e.notification_id?{type:"alert",alert:c(e)}:null}function s(e){var t=[],n=e.address;return l.each(e.changes,function(e,r){var s=l.split(r,"."),o=s[0],i=s[1];l.each(e.ids,function(r,s){var a=e.gns[s];t.push({address:n,schema:o,table:i,id:r,gn:a})})}),t}function o(e){var t=e.address,n=l.clone(e.alert);return n.address=t,n.profile_image&&(n.profile_image=t+n.profile_image),n.attached_image&&(n.attached_image=t+n.attached_image),n}function i(e){var t=e.address,n=l.clone(e.revalidation);return n.address=t,n}function a(e){return{method:"websocket",relay:null,token:e.socket,address:e.address,details:{user_agent:navigator.userAgent}}}function c(e){return{title:"",message:"",type:e.type,address:e.address,schema:e.schema,notification_id:parseInt(e.notification_id),reaction_id:parseInt(e.reaction_id),story_id:parseInt(e.story_id),user_id:parseInt(e.user_id),foreground:!!e.foreground}}var l=n("../../common/node_modules/lodash/lodash.js");e.exports={unpack:r}},"../../common/src/transport/payload-manager.jsx":function(e,t,n){"use strict";(function(t){function r(e){return e>=1073741824?s.round(e/1073741824)+" GB":e>=1048576?s.round(e/1048576)+" MB":e>=1024?s.round(e/1024)+" KB":e>0?e+" bytes":"0"}var s=n("../../common/node_modules/lodash/lodash.js"),o=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),i=n("../../common/node_modules/react/react.js"),a=i.PropTypes,c=n("../../common/node_modules/moment/moment.js"),l=n("../../common/src/transport/blob-stream.js"),u=n("../../common/src/transport/payload.js"),d=n("../../common/src/data/database.js"),p=n("../../common/src/routing/route.js"),h=n("../../common/src/widgets/diagnostics.jsx"),m=n("../../common/src/widgets/diagnostics-section.jsx");e.exports=i.createClass({displayName:"PayloadManager",propTypes:{online:a.bool,database:a.instanceOf(d),route:a.instanceOf(p),onChange:a.func},getDefaultProps:function(){return{online:!0}},getInitialState:function(){var e={payloads:[],streams:[]};return s.assign(this,e),e},updateList:function(e,t){var n=this[e],r=t(n);this[e]=r;var s={};s[e]=r,this.setState(s)},add:function(e,t){t||(t={});var n=this.props.route.parameters,r=t.address||n.address,o=t.schema||n.schema||"global",i=new u(r,o,e);return i.onUploadProgress=this.handleUploadProgress,i.onUploadComplete=this.handleUploadComplete,this.updateList("payloads",function(e){return s.concat(e,i)}),i},stream:function(){var e=this.props.route.parameters,t=new l(e.address);return this.props.online||t.suspend(),this.updateList("streams",function(e){return s.concat(e,t)}),t},dispatch:function(e){var t=this,n=s.filter(this.payloads,function(t){return s.includes(e,t.token)});s.isEmpty(n)||this.acquirePermission(n).then(function(){return s.each(n,function(e){e.send()}),null}).then(function(){t.triggerChangeEvent()})},abandon:function(e){var t=s.filter(this.payloads,function(t){return s.includes(e,t.token)});s.isEmpty(t)||(s.each(t,function(e){e.cancel()}),s.pullAll(this.payloads,t),this.triggerChangeEvent())},inquire:function(e){var n=this;if(s.isEmpty(e))return null;var r=s.filter(this.payloads,function(t){return s.includes(e,t.token)});if(r.length<e)return t(function(){var t=n.props.route.parameters,r=[];s.each(e,function(e){s.find(n.payloads,{token:e})||r.push(new u(t.address,t.schema,"unknown",e))}),n.updateList("payloads",function(e){return s.concat(e,r)})}),{action:"unknown",progress:void 0};var o=0,i=0;if(s.each(r,function(e){o+=e.getSize(),i+=e.getUploaded()}),(i=o>0?Math.round(i/o*100):100)<100)return{action:"uploading",progress:i};if(s.some(r,{failed:!0}))return{action:"failed"};var a=s.filter(r,function(e){return"web-site"===e.type});if(s.some(a,{completed:!1})){var c=0;return s.each(l,function(e){c+=e.processed}),c=Math.round(c/s.size(a)),{action:"rendering",progress:c}}var l=s.filter(r,function(e){return"video"===e.type||"audio"===e.type});if(s.some(l,{completed:!1})){var d=0;return s.each(l,function(e){d+=e.processed}),d=Math.round(d/s.size(l)),{action:"transcoding",progress:d}}return null},getUploadProgress:function(){var e=0,t=0;return s.each(this.payloads,function(n){n.started&&(n.failed||n.sent||(t+=n.getRemainingFiles(),e+=n.getRemainingBytes()))}),t>0?{files:t,bytes:e}:null},acquirePermission:function(e){var t=s.filter(e,{approved:!1});if(s.isEmpty(t))return o.resolve();var n=this.props.database.use({by:this});return n.start().then(function(r){var o,i=s.map(t,function(e){o=e.schema;var t={};return s.each(e.parts,function(e){t[e.name]=!1}),{token:e.token,action:e.action,options:t,user_id:r}});return n.save({schema:o,table:"task"},i).then(function(t){s.each(e,function(e){e.approved=!0})}).catch(function(t){s.each(e,function(e){e.failed=!0})})})},componentDidMount:function(){},componentDidUpdate:function(e,t){var n=this;!e.database&&this.props.database&&this.triggerChangeEvent(),e.database===this.props.database&&t.payloads===this.state.payloads||this.props.route&&this.updateBackendProgress(),e.online!==this.props.online&&s.each(this.streams,function(e){n.props.online?e.resume():e.suspend()})},updateBackendProgress:function(){var e=this,t=this.props.route.parameters,n=t.schema||"global",r=s.filter(this.payloads,{sent:!0,completed:!1,address:t.address,schema:n});if(!s.isEmpty(r)){var o=this.props.database.use({schema:n,by:this});o.start().then(function(t){var n={token:s.map(r,"token"),user_id:t};return o.find({table:"task",criteria:n}).then(function(t){var n=!1;s.each(t,function(e){var t=s.find(r,{token:e.token});t&&t.updateBackendStatus(e)&&(n=!0)}),n&&e.triggerChangeEvent()})})}},triggerChangeEvent:function(){this.props.onChange&&this.props.onChange({type:"change",target:this})},handleUploadProgress:function(e){this.triggerChangeEvent()},handleUploadComplete:function(e){this.triggerChangeEvent()},render:function(){var e=this.state.payloads;if(s.isEmpty(e))return null;var t=s.filter(e,{started:!1}),n=s.filter(e,{started:!0,sent:!1,failed:!1}),r=s.filter(e,{sent:!0,completed:!1}),o=s.filter(e,{failed:!0}),a=s.filter(e,{completed:!0});return i.createElement(h,{type:"payload-manager"},i.createElement(m,{label:"Pending payloads",hidden:s.isEmpty(t)},s.map(t,this.renderPayload)),i.createElement(m,{label:"Payloads in transit",hidden:s.isEmpty(n)},s.map(n,this.renderPayload)),i.createElement(m,{label:"Payloads in backend process",hidden:s.isEmpty(r)},s.map(r,this.renderPayload)),i.createElement(m,{label:"Failed payloads",hidden:s.isEmpty(o)},s.map(o,this.renderPayload)),i.createElement(m,{label:"Completed payloads",hidden:s.isEmpty(a)},s.map(a,this.renderPayload)))},renderPayload:function(e,t){return i.createElement("div",{key:t},i.createElement("div",null,"Payload token: ",e.token),i.createElement("div",null,"Resource type: ",e.type),this.renderTransferStatus(e),this.renderBackendStatus(e),i.createElement("ol",null,s.map(e.parts,this.renderPayloadPart)))},renderTransferStatus:function(e){if(!e.started)return null;if(e.sent){var t,n=.001*(c(e.uploadEndTime)-c(e.uploadStartTime)),o=e.getSize();o>0&&(t="("+r(o/n)+" per sec)");var a=s.round(n,n<1?2:0)+"s";return i.createElement("div",null,"Upload duration: ",a," ",t)}var o=e.getSize(),l=e.getUploaded(),u=Math.round(l/o*100||0)+"%";return i.createElement("div",null,"Upload progress: ",u)},renderBackendStatus:function(e){if(!e.sent)return null;if(e.completed){var t=.001*(c(e.processEndTime)-c(e.uploadEndTime)),n=s.round(t,t<1?2:0)+"s";return i.createElement("div",null,"Backend duration: ",n)}var r=e.processed+"%";return i.createElement("div",null,"Backend progress: ",r)},renderPayloadPart:function(e,t){var n,s=e.name;e.blob||e.cordovaFile?n="File":e.stream?n="Stream":e.url&&(n="URL");var o;return e.size>0&&(o=i.createElement("span",{className:"file-size"},r(e.size))),i.createElement("li",{key:t},n," - ",s," ",o)}})}).call(t,n("../node_modules/timers-browserify/main.js").setImmediate)},"../../common/src/transport/payload.js":function(e,t,n){"use strict";function r(e,t,n,r){this.address=e,this.schema=t,this.type=n,this.action="add-"+n,this.token=r||d.generate(),this.recreated=!!r,this.options={},this.url="payload:"+this.token,this.processed=0,this.promise=null,this.parts=[],this.approved=!1,this.started=!!r,this.sent=!1,this.failed=!1,this.canceled=!1,this.completed=!1,this.uploadStartTime=null,this.uploadEndTime=null,this.processEndTime=null,this.onUploadProgress=null,this.onUploadComplete=null}var s=n("../../common/node_modules/lodash/lodash.js"),o=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),i=n("../../common/node_modules/moment/moment.js"),a=(n("../../common/src/transport/blob-stream.js"),n("../../common/src/transport/blob-manager.js")),c=n("../../common/src/transport/http-request.js"),l=n("../../common/src/transport/background-file-transfer.js"),u=n("../../common/src/errors/http-error.js"),d=(n("../../common/src/errors/file-error.js"),n("../../common/src/utils/random-token.js")),p=n("../../common/node_modules/async-do-while/index.js");e.exports=r,r.getImageURL=function(e){if(e.payload_token){var t;switch(e.type){case"image":t="main";break;default:t="poster"}var n="payload:"+e.payload_token+"/"+t;return a.find(n)}},r.prototype.attachFile=function(e,t){t||(t="main");var n="payload:"+this.token+"/"+t;return a.associate(e,n),e instanceof Blob&&this.parts.push({blob:e,size:e.size,uploaded:0,sent:!1,name:t}),this},r.prototype.attachStream=function(e,t){return t||(t="main"),this.parts.push({stream:e,size:e.size,uploaded:e.transferred,sent:!1,name:t}),this},r.prototype.attachURL=function(e,t){return t||(t="main"),this.parts.push({url:e,name:t,sent:!1}),this},r.prototype.attachStep=function(e,t){var n;switch(t){case"poster":n={generate_poster:!0}}return this.setPartOptions(n,e),this.parts.push({name:t,sent:!1}),this},r.prototype.setPartOptions=function(e,t){t||(t="main");var n=s.find(this.parts,{name:t});if(!n)throw new Error("Unable to find part: "+t);n.stream?n.stream.setOptions(e):n.options=s.assign({},n.options,e)},r.prototype.send=function(){var e=this;if(!this.started){if(!this.approved)throw new u(403);this.started=!0,this.uploadStartTime=i().toISOString(),o.each(this.parts,function(t){var n=!1,r=1,s=1e3;return p.do(function(){return e.sendPart(t).then(function(){n=t.sent=!0}).catch(function(t){if(t.statusCode>=400&&t.statusCode<=499)throw t;return s=Math.min(2*s,1e4),o.delay(s).then(function(){e.canceled||r++})})}),p.while(function(){return!n&&!e.canceled}),p.end()}).then(function(){e.sent=!0,e.uploadEndTime=i().toISOString(),e.onUploadComplete&&e.onUploadComplete({type:"uploadcomplete",target:e})})}},r.prototype.sendPart=function(e){return e.stream?this.sendStream(e):e.blob?this.sendBlob(e):(e.cordovaFile,e.url?this.sendURL(e):o.resolve())},r.prototype.sendBlob=function(e){var t=this,n=this.getDestinationURL(e.name),r=e.blob,o=new FormData;o.append("file",r),s.each(e.options,function(e,t){o.append(t,e)});var i={responseType:"json",onUploadProgress:function(n){t.updateProgress(e,n.loaded/n.total)}};return e.uploaded=0,e.promise=c.fetch("POST",n,o,i),e.promise.then(function(e){return t.associateRemoteURL(e.url,r),e})},r.prototype.sendCordovaFile=function(e){return},r.prototype.sendStream=function(e){var t=this,n=this.getDestinationURL(e.name),r=e.stream;return r.onProgress=function(n){t.updateProgress(e,n.loaded/n.total)},r.start().then(function(){var e={responseType:"json",contentType:"json"};return c.fetch("POST",n,{stream:r.id},e)})},r.prototype.sendURL=function(e){var t=this.getDestinationURL(e.name),n={responseType:"json",contentType:"json"},r=s.extend({url:e.url},e.options);return e.promise=c.fetch("POST",t,r,n),e.promise},r.prototype.cancel=function(){var e=this;return!this.started||this.completed||this.failed||this.canceled?o.resolve(!1):(this.canceled=!0,o.each(this.parts,function(t){if(!t.sent)return e.cancelPart(t)}).then(function(){return!0}))},r.prototype.cancelPart=function(e){return e.stream?this.cancelStream(e):e.blob?this.cancelBlob(e):(e.cordovaFile,e.url?this.cancelURL(e):o.resolve())},r.prototype.cancelStream=function(e){return o.try(function(){return e.stream.cancel()}).catch(function(e){})},r.prototype.cancelBlob=function(e){return o.try(function(){if(e.promise&&e.promise.isPending())return e.promise.cancel()}).catch(function(e){})},r.prototype.cancelCordovaFile=function(e){var t=this;return o.try(function(){var n=s.indexOf(t.parts,e),r=t.token+"-"+(n+1);return l.cancel(r)}).catch(function(e){})},r.prototype.cancelURL=function(e){return o.try(function(){if(e.promise&&e.promise.isPending())return e.promise.cancel()}).catch(function(e){})},r.prototype.getSize=function(){var e=s.map(this.parts,function(e){return e.size||0});return s.sum(e)},r.prototype.getUploaded=function(){var e=s.map(this.parts,function(e){return e.uploaded||0});return s.sum(e)},r.prototype.getRemainingFiles=function(){return s.filter(this.parts,function(e){if(e.size>0&&e.uploaded<e.size)return!0}).length},r.prototype.getRemainingBytes=function(){var e=s.map(this.parts,function(e){return e.size>0?e.size-e.uploaded:0});return s.sum(e)},r.prototype.getDestinationURL=function(e){var t;switch(this.type){case"image":"main"===e&&(t="/srv/media/images/upload/"+this.schema+"/");break;case"video":"main"===e?t="/srv/media/videos/upload/"+this.schema+"/":"poster"===e&&(t="/srv/media/videos/poster/"+this.schema+"/");break;case"audio":"main"===e?t="/srv/media/audios/upload/"+this.schema+"/":"poster"===e&&(t="/srv/media/audios/poster/"+this.schema+"/");break;case"website":"poster"===e&&(t="/srv/media/html/poster/"+this.schema+"/")}return t?""+this.address+t+"?token="+this.token:null},r.prototype.updateProgress=function(e,t){t&&(e.uploaded=Math.round(e.size*t),this.onUploadProgress&&this.onUploadProgress({type:"uploadprogress",target:this}))},r.prototype.updateBackendStatus=function(e){var t=!1;return"unknown"===this.type&&(this.action=e.action,this.type=s.replace(this.action,/^add\-/,""),this.sent=e.completion>0,t=!0),this.processed!==e.completion&&(this.processed=e.completion,t=!0),this.processEndTime!==e.etime&&(this.processEndTime=e.etime,e.etime&&!e.failed&&(this.completed=!0),t=!0),e.failed&&!this.failed&&(this.failed=!0,t=!0),t},r.prototype.associateRemoteURL=function(e,t){e&&a.associate(t,this.address+e)}},"../../common/src/transport/payloads.js":function(e,t,n){"use strict";function r(e,t){this.payloadManager=e,this.destination=t,this.uploading=this.payloadManager.getUploadProgress()}function s(e){var t=[];if(e){var n=e.details;n&&(n.resources?o.each(n.resources,function(e){e.payload_token&&t.push(e.payload_token)}):n.payload_token&&t.push(n.payload_token))}return t}var o=n("../../common/node_modules/lodash/lodash.js");n("../../common/node_modules/bluebird/js/browser/bluebird.js");e.exports=r,r.prototype.add=function(e){return this.payloadManager.add(e,this.destination)},r.prototype.cancel=function(e){return this.payloadManager.abandon([e])},r.prototype.override=function(e){return new r(this.payloadManager,e)},r.prototype.stream=function(){return this.payloadManager.stream()},r.prototype.dispatch=function(e){var t=s(e);return this.payloadManager.dispatch(t)},r.prototype.abandon=function(e){var t=s(e);return this.payloadManager.abandon(t)},r.prototype.inquire=function(e){var t=s(e);return this.payloadManager.inquire(t)}},"../../common/src/transport/websocket-notifier.jsx":function(e,t,n){"use strict";function r(){return new a(function(e,t){Notification.requestPermission(function(n){"granted"===n?e():t(new Error("Unable to gain permission"))})})}function s(e,t){return c.createElement("pre",{key:t},JSON.stringify(e,void 0,4))}function o(e){try{return JSON.parse(e)}catch(e){return{}}}var i=n("../../common/node_modules/lodash/lodash.js"),a=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),c=n("../../common/node_modules/react/react.js"),l=c.PropTypes,u=n("../../common/node_modules/sockjs-client/lib/entry.js"),d=n("../../common/node_modules/async-do-while/index.js"),p=n("../../common/src/transport/notification-unpacker.js"),h=n("../../common/src/locale/locale.js"),m=n("../../common/src/widgets/diagnostics.jsx"),f=n("../../common/src/widgets/diagnostics-section.jsx");e.exports=c.createClass({displayName:"WebsocketNotifier",propTypes:{serverAddress:l.string,basePath:l.string,initialReconnectionDelay:l.number,maximumReconnectionDelay:l.number,defaultProfileImage:l.string,online:l.bool,locale:l.instanceOf(h),onConnect:l.func,onDisconnect:l.func,onNotify:l.func,onAlertClick:l.func,onRevalidate:l.func},statics:{isAvailable:function(){return!0}},getDefaultProps:function(){return{basePath:"/srv/socket",online:!0,initialReconnectionDelay:500,maximumReconnectionDelay:3e4}},getInitialState:function(){return{socket:null,notificationPermitted:!1,reconnectionCount:0,recentMessages:[]}},componentWillMount:function(){var e=this;r().then(function(){e.setState({notificationPermitted:!0})}).catch(function(e){}),this.updateConnection(this.props)},componentWillReceiveProps:function(e){this.props.serverAddress!==e.serverAddress&&this.updateConnection(e),!this.props.online&&e.online?this.onConnectivity&&this.onConnectivity():this.props.online&&!e.online&&this.state.socket&&this.state.socket.close()},updateConnection:function(e){this.disconnect(),e.serverAddress&&this.connect(e.serverAddress)},waitForConnectivity:function(){var e=this;return this.props.online?a.resolve():(this.connectivityPromise||(this.connectivityPromise=new a(function(t,n){e.onConnectivity=function(){e.connectivityPromise=null,e.onConnectivity=null,t()}})),this.connectivityPromise)},connect:function(e){var t=this,n=this.connectionAttempt;if(n&&n.serverAddress===e)return n.promise;n=this.connectionAttempt={serverAddress:e};var r=!1,s=this.props.initialReconnectionDelay,c=this.props.maximumReconnectionDelay;return d.do(function(){return t.createSocket(e).then(function(s){n===t.connectionAttempt&&(s.onmessage=function(n){if(t.state.socket===s){var r=o(n.data),a=i.assign({address:e},r),c=p.unpack(a);"change"===c.type?t.triggerNotifyEvent(c.changes):"alert"===c.type?t.showAlert(c.alert):"connection"===c.type?(s.id=c.connection.token,t.triggerConnectEvent(c.connection)):"revalidation"===c.type&&t.triggerRevalidateEvent(c.revalidation);var l=i.slice(t.state.recentMessages);l.unshift(r),l.length>10&&l.splice(10),t.setState({recentMessages:l})}},s.onclose=function(){t.state.socket===s&&(t.setState({socket:null},function(){t.connect(e).then(function(e){if(e){var n=t.state.reconnectionCount+1;t.setState({reconnectionCount:n}),console.log("Connection reestablished")}})}),t.props.serverAddress===e&&(console.log("Disconnect"),t.triggerDisconnectEvent()))},t.setState({socket:s})),r=!0}).catch(function(t){return s*=2,s>c&&(s=c),console.log("Connection attempt in "+s+"ms: "+e),a.delay(s)})}),d.while(function(){return n===t.connectionAttempt&&!r}),d.return(function(){return t.connectionAttempt=null,r}),n.promise=d.end(),n.promise},disconnect:function(){var e=this.state.socket;e&&this.setState({socket:null,reconnectionCount:0},function(){e.close()})},createSocket:function(e){var t=this.props.basePath;return this.waitForConnectivity().then(function(){return new a(function(n,r){var s=""+e+t,o=new u(s),i=!1;o.onopen=function(e){i||(i=!0,n(o))},o.onclose=function(){i||r(new Error("Unable to establish a connection"))},o.onerror=function(e){i||(i=!0,r(new Error(e.message)))}})})},triggerNotifyEvent:function(e){this.props.onNotify&&this.props.onNotify({type:"notify",target:this,changes:e})},triggerConnectEvent:function(e){this.props.onConnect&&this.props.onConnect({type:"connect",target:this,connection:e})},triggerDisconnectEvent:function(){this.props.onDisconnect&&this.props.onDisconnect({type:"disconnect",target:this})},triggerAlertClickEvent:function(e){this.props.onAlertClick&&this.props.onAlertClick({type:"alertclick",target:this,alert:e})},triggerRevalidateEvent:function(e){this.props.onRevalidate&&this.props.onRevalidate({type:"invalidate",target:this,revalidation:e})},showAlert:function(e){var t=this;if(this.state.notificationPermitted){var n={};e.profile_image?n.icon=e.profile_image:n.icon=this.props.defaultProfileImage,e.message?n.body=e.message:e.attached_image&&(n.image=e.attached_image),n.lang=i.get(this.props.locale,"languageCode");var r=new Notification(e.title,n);r.addEventListener("click",function(){t.triggerAlertClickEvent(e),r.close()})}},render:function(){var e=i.get(this.state.socket,"id");return c.createElement(m,{type:"websocket-notifier"},c.createElement(f,{label:"Connection"},c.createElement("div",null,"ID: ",e),c.createElement("div",null,"Socket: ",this.state.socket?"established":"none"),c.createElement("div",null,"Reconnection count: ",this.state.reconnectionCount),c.createElement("div",null,"Notification: ",this.state.notificationPermitted?"permitted":"denied")),c.createElement(f,{label:"Recent messages"},i.map(this.state.recentMessages,s)))}})},"../../common/src/utils/component-refs.js":function(e,t,n){"use strict";function r(e){if(!this)return new r(e);var t=this,n={};s.forIn(e,function(e,r){var s=function(e){if(!(arguments.length>0))return t[r];t[r]=e};n[r]=s}),this.setters=n,s.forIn(e,function(e,n){t[n]=null})}var s=n("../../common/node_modules/lodash/lodash.js");e.exports=r},"../../common/src/utils/date-tracker.js":function(e,t,n){"use strict";function r(e,t){"change"===e&&t&&h.push(t)}function s(e,t){"change"===e&&t&&u.pull(h,t)}function o(e){m=e,a(d())&&l()}function i(e){return e.format("YYYY-MM-DD")}function a(e){var n=!1;return u.each(p,function(r,s){var o=r(e.clone()),a=t[s];if(o){var c=i(o);a!==c&&(t[s]=c,t[s+"ISO"]=o.toISOString(),n=!0)}}),n}function c(){var e=d();i(e)!==t.today&&(a(e),l())}function l(){var e={type:"change",target:t};u.each(h,function(t){t(e)})}var u=n("../../common/node_modules/lodash/lodash.js"),d=n("../../common/node_modules/moment/moment.js");e.exports=t={addEventListener:r,removeEventListener:s,setLocale:o,today:void 0};var p={today:function(e){return e.startOf("day")},yesterday:function(e){return e.subtract(1,"day").startOf("day")},oneWeekAgo:function(e){return e.subtract(7,"day").startOf("day")},twoWeeksAgo:function(e){return e.subtract(14,"day").startOf("day")},oneMonthAgo:function(e){return e.subtract(1,"month").startOf("day")},twoMonthsAgo:function(e){return e.subtract(2,"month").startOf("day")},startOfWeek:function(e){if(m)return e.locale(m).startOf("week")},endOfWeek:function(e){if(m)return e.locale(m).endOf("week")},startOfMonth:function(e){return e.startOf("month")},endOfMonth:function(e){return e.endOf("month")},startOfLastMonth:function(e){return e.subtract(1,"month").startOf("month")},endOfLastMonth:function(e){return e.subtract(1,"month").endOf("month")},startOfYear:function(e){return e.startOf("year")},endOfYear:function(e){return e.endOf("year")}},h=[],m="";setInterval(c,1e3),c()},"../../common/src/utils/date-utils.js":function(e,t,n){"use strict";function r(e){var t=e instanceof a?e:a(e),n=t.clone().endOf("day");return"["+t.toISOString()+","+n.toISOString()+"]"}function s(e,t){for(var n=e instanceof a?e:a(e),r=t instanceof a?t:a(t),s=n.startOf("month"),o=r.endOf("month"),i=[],c=s.clone();c<=o;c.add(1,"month")){var l=c.toISOString(),u=c.clone().endOf("month").toISOString(),d="["+l+","+u+"]";i.push(d)}return i}function o(e,t){for(var n=startTime instanceof a?startTime:a(startTime),r=t instanceof a?t:a(t),s=n.startOf("day"),o=r.endOf("day"),i=[],c=s.clone();c<=o;c.add(1,"day")){var l=c.format("YYYY-MM-DD");i.push(l)}return i}function i(){return a().utcOffset()}var a=n("../../common/node_modules/moment/moment.js");n("../../common/src/utils/date-tracker.js");e.exports={getDayRange:r,getMonthRanges:s,getTimeZoneOffset:i,getDates:o}},"../../common/src/utils/focus-manager.js":function(e,t,n){"use strict";function r(e,t){a.unshift({component:e,props:t}),c=i.filter(c,function(n){return!i.isMatch(t,n)||(e.focus(),!1)})}function s(e){a=i.filter(a,function(t){return t.component!==e})}function o(e){var t=i.find(a,{props:e});t?t.component.focus():c.push(e)}var i=n("../../common/node_modules/lodash/lodash.js");e.exports={register:r,unregister:s,focus:o};var a=[],c=[]},"../../common/src/utils/konami-code.js":function(e,t,n){"use strict";function r(e){a.push(e),1===a.length&&window.addEventListener("keydown",o)}function s(e){i.pull(a,e),0===a.length&&window.removeEventListener("keydown",o)}function o(t){l.push(t.keyCode),l.length>c.length&&l.splice(0,l.length-c.length),i.isEqual(l,c)&&i.each(a,function(t){t({type:"cheat",target:e.exports})})}var i=n("../../common/node_modules/lodash/lodash.js");e.exports={addListener:r,removeListener:s};var a=[],c=[38,38,40,40,37,39,37,39,66,65],l=[]},"../../common/src/utils/link-parser.js":function(e,t,n){"use strict";function r(e){var t={},n=s.split(e,/[\r\n]+/);return s.each(n,function(e){var n=/^(\w+)\s*=\s*(.*)/.exec(e);if(n){var r=s.lowerCase(n[1]),o=s.trim(n[2]);t[r]=o}}),console.log(t),t.url?t:null}var s=n("../../common/node_modules/lodash/lodash.js");e.exports={parse:r}},"../../common/src/utils/list-parser.js":function(e,t,n){"use strict";function r(e){e=e||"";for(var t,n=[],r=0,s=null,o=1,i=1;t=p.exec(e);){var a=e.substring(r,t.index);if(a)if(s)if(d.trim(a))s=null,i++,n.push(a);else{var c=d.last(s);c.after+=a}else n.push(a);var l=t[1],u=t[2],h=!!d.trim(u),m=t[3],f=t[4],g=t[5],v={label:f,checked:h,answer:u,before:l,between:m,after:g,list:i,key:o};s?s.push(v):(s=[v],n.push(s)),r=t.index+t[0].length,o++}var b=e.substring(r);return b&&n.push(b),n}function s(e){if("object"===(void 0===e?"undefined":u(e)))return d.some(e,s);var t=r(e);return d.some(t,function(e){return e instanceof Array})}function o(e,t,n,r,s){d.each(e,function(e){e instanceof Array&&d.each(e,function(e){e.list==t&&(e.key==n?(e.checked=r,l(e)):r&&s&&(e.checked=!1,l(e)))})})}function i(e,t,n){return d.reduce(e,function(e,r){return e||r instanceof Array&&(e=d.find(r,function(e){if(e.list==t&&e.key==n)return!0})),e},null)}function a(e,t){return d.reduce(e,function(e,n){return n instanceof Array&&d.each(n,function(n){void 0!==t&&n.checked!==t||e++}),e},0)}function c(e){return e=d.flattenDeep(e),d.reduce(e,function(e,t){return t instanceof Object?e+t.before+"* ["+t.answer+"]"+t.between+t.label+t.after:e+t},"")}function l(e){if(e.checked){var t;t=/[\u0x0400-\u0x04ff]/.test(e.label)?"Ñ…":/[\u0x0370-\u0x03ff]/.test(e.label)?"Ï‡":"x",e.answer=t}else e.answer=" "}var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d=n("../../common/node_modules/lodash/lodash.js");e.exports={extract:r,detect:s,set:o,find:i,count:a,join:c};var p=/^([ \t]*)\*\s+\[([ xÑ…Ï‡])\]([ \t]*)(.*?)([ \t]*?)$/gim},"../../common/src/utils/lodash-extra.js":function(e,t,n){"use strict";function r(e){switch(void 0===e?"undefined":s(e)){case"number":return 0;case"string":return o.repeat("x",e.length);case"boolean":return!1;case"object":return e instanceof Array?o.map(e,r):o.mapValues(e,r)}}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=n("../../common/node_modules/lodash/lodash.js"),i={};o.mixin({decouple:function(e,t,n){"string"==typeof t?t=o.split(t,"."):t instanceof Array||(t=[t]),n||(n=i);var r=o.clone(e);r instanceof Object||(r={});for(var s=r,a=e,c=0;c<t.length;c++){var l=t[c],u=a?a[l]:void 0,d=o.clone(u);c===t.length-1?d instanceof n.constructor||(d=n):d instanceof Object||(d={}),s[l]=d,s=d,a=u}return r},decoupleSet:function(e,t,n){if("string"==typeof t?t=o.split(t,"."):t instanceof Array||(t=[t]),t.length<0)throw new Error("Empty path");var r=o.slice(t,0,-1),s=o.decouple(e,r,{});return o.set(s,t,n),s},decoupleUnset:function(e,t){if("string"==typeof t?t=o.split(t,"."):t instanceof Array||(t=[t]),t.length<0)throw new Error("Empty path");var n=o.slice(t,0,-1),r=o.decouple(e,n,{});return o.unset(r,t),r},decouplePush:function(e,t){for(var n=o.decouple(e,t,[]),r=o.get(n,t),s=arguments.length,i=Array(s>2?s-2:0),a=2;a<s;a++)i[a-2]=arguments[a];return Array.prototype.push.apply(r,i),n},shallowDiff:function(e,t){return o.pickBy(e,function(e,n){return t[n]!==e})},obscure:function(e,t){var n=o.cloneDeep(e);return o.each(t,function(e){var t=o.get(n,e);o.set(n,e,r(t))}),n},strictParseInt:function(e){var t=o.parseInt(e);if(t.toString()!==e)throw new Error("Not an integer: "+e);return t},fileSize:function(e){if(e<1024)return e+"B";var t=e/1024;if(t<1024)return o.round(t)+"KB";var n=t/1024;if(n<1024)return o.round(n,1)+"MB";var r=n/1024;return o.round(r,2)+"GB"}})},"../../common/src/utils/markdown.js":function(e,t,n){"use strict";function r(e,t){if("object"===(void 0===e?"undefined":f(e)))return g.some(e,r);var n=l(t),s=n.extractBlocks(e);return g.some(s,function(e){switch(e.type){case"space":return!1;case"paragraph":case"text_block":var t,r=n.inlineLexer;for(r.start(e.markdown);t=r.captureToken();)switch(t.type){case"url":case"text":case"autolink":case"br":break;default:return!0}break;case"list":return g.every(e.children,function(e){var t=e.children[0];return"text_block"!==t.type||!/^\s*\[/.test(t.markdown)});default:return!0}})}function s(e,t){var n=l(t),r=u(),s=n.parse(e);return r.render(s)}function o(e,t,n,r){var s=y.extract(e),o=c(s,r);return g.map(s,function(e,r){if(e instanceof Array){var s=g.map(e,function(e,s){var i=e.checked,a=o[r][s];if(t){var c=t[e.list];void 0!==c&&(i=e.key==c)}return v.createElement("div",{className:"list-item",key:s},v.createElement("label",null,v.createElement("input",{type:"radio",name:e.list,value:e.key,checked:i,readOnly:!n,onChange:n})," ",a))});return v.createElement("div",{key:r},s)}return o[r]})}function i(e,t,n){var r=y.extract(e),s=c(r,n);return g.map(r,function(e,n){if(e instanceof Array){var r=g.map(e,function(e,r){var o=s[n][r],i=t[e.list],a=g.get(i,"total",0),c=g.get(i,["answers",e.key],0),l=Math.round(a>0?c/a*100:0)+"%",u="color-"+e.key%12,d="vote-count";return c===a&&(d+=" unanimous"),v.createElement("div",{className:d,key:r},v.createElement("div",{className:"label"},o),v.createElement("div",{className:"bar"},v.createElement("span",{className:"filled "+u,style:{width:l}}),v.createElement("span",{className:"percent"},l),v.createElement("span",{className:"count"},c+"/"+a)))});return v.createElement("div",{key:n},r)}return s[n]})}function a(e,t,n,r){var s=y.extract(e),o=c(s,r);return g.map(s,function(e,r){if(e instanceof Array){var s=g.map(e,function(e,s){var i=e.checked,a=o[r][s];if(t){var c=t[e.list];if(void 0!==c){var l=c[e.key];void 0!==l&&(i=l)}}return v.createElement("div",{className:"list-item",key:s},v.createElement("label",null,v.createElement("input",{type:"checkbox",name:e.list,value:e.key,checked:i,readOnly:!n,onChange:n})," ",a))});return v.createElement("div",{key:r},s)}return o[r]})}function c(e,t){var n=l(t),r=g.map(e,function(e,t){return e instanceof Array?g.map(e,function(e){return n.extractBlocks(e.label)}):n.extractBlocks(e)});g.each(e,function(e,t){var s=r[t];e instanceof Array?g.each(s,function(e){n.processInline(e)}):n.processInline(s)});var s=u();return g.map(e,function(e,t){var n=r[t];return e instanceof Array?g.map(e,function(e,t){var r=g.first(s.render(n[t]));return r&&r.props&&"p"===r.type&&(r=r.props.children),r}):s.render(n)})}function l(e){var t=new b.BlockLexer,n=new b.InlineLexer({links:t.links,findRefLink:h,onReference:e});return new b.Parser({blockLexer:t,inlineLexer:n})}function u(){return new b.Renderer({renderImage:d,renderText:p})}function d(e,t){var n=e.href,r=e.title,s=e.text;return v.createElement(w,{key:t,url:n,alt:s,title:r})}function p(e,t){return j.renderEmoji(e.text,{key:t})}function h(e,t){var n=this.links[e];return n||(this.onReference&&(n=this.onReference({type:"reference",target:this,name:e,forImage:t})),n)}function m(e,t){var n=/^(picture|image|photo|video|audio|website)(-(\d+))?$/.exec(t);if(n){var r=n[1];"picture"!==r&&"photo"!==r||(r="image");var s=g.filter(e,{type:r}),o=parseInt(n[3])||1,i=s[o-1];if(i)return i}return null}var f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},g=n("../../common/node_modules/lodash/lodash.js"),v=n("../../common/node_modules/react/react.js"),b=n("../../common/node_modules/mark-gor/react.js"),y=n("../../common/src/utils/list-parser.js"),j=n("../../common/src/utils/plain-text.js"),w=(n("../../common/src/theme/theme.js"),n("../../common/src/widgets/resource-view.jsx"));e.exports={detect:r,render:s,renderSurvey:o,renderSurveyResults:i,renderTaskList:a,createParser:l,createRenderer:u,findReferencedResource:m}},"../../common/src/utils/memoize.js":function(e,t,n){"use strict";function r(e,t,n){void 0===t&&(t=null);var r=!1!==n?o(e):s(e);return function(){return null!=arguments[0]?r.apply(null,arguments):t}}var s=n("../node_modules/memoizee/index.js"),o=n("../node_modules/memoizee/weak.js");e.exports=r},"../../common/src/utils/plain-text.js":function(e,t,n){"use strict";function r(e,t,n){var r=p.extract(e);return l.map(r,function(e,r){return e instanceof Array?l.map(e,function(e,r){var s=e.checked;if(t){var o=t[e.list];void 0!==o&&(s=e.key==o)}return u.createElement("span",null,e.before,u.createElement("label",null,u.createElement("input",{type:"radio",name:e.list,value:e.key,checked:s,readOnly:!n,onChange:n}),e.between,i(e.label)),e.after)}):e})}function s(e,t){var n=p.extract(e);return l.map(n,function(e,n){return e instanceof Array?l.map(e,function(e,n){var r=t[e.list],s=l.get(r,"total",0),o=l.get(r,["answers",e.key],0),a=Math.round(s>0?o/s*100:0)+"%",c="color-"+e.key%12,d="vote-count";return o===s&&(d+=" unanimous"),u.createElement("span",null,e.before,u.createElement("span",{className:d},u.createElement("span",{className:"label"},i(e.label)),u.createElement("span",{className:"bar"},u.createElement("span",{className:"filled "+c,style:{width:a}}),u.createElement("span",{className:"percent"},a),u.createElement("span",{className:"count"},o+"/"+s))),e.after)}):e})}function o(e,t,n){var r=p.extract(e);return l.map(r,function(e,r){return e instanceof Array?l.map(e,function(e,r){var s=e.checked;if(t){var o=t[e.list];if(void 0!==o){var a=o[e.key];void 0!==a&&(s=a)}}return u.createElement("span",null,e.before,u.createElement("label",null,u.createElement("input",{type:"checkbox",name:e.list,value:e.key,checked:s,readOnly:!n,onChange:n}),e.between,i(e.label)),e.after)}):e})}function i(e,t){if(!h)return[e];var n=l.get(t,"key");return d(e,a.bind(null,n))}function a(e,t,n,r){var s=void 0!==e?e+"."+r:r,o="https://twemoji.maxcdn.com/2/72x72/"+t+".png";return u.createElement("img",{key:s,alt:n,draggable:!1,src:o,style:m})}function c(){var e=document.createElement("canvas");if(!e.getContext)return!1;var t=e.getContext("2d");if(!t.fillText)return!1;return t.textBaseline="top",t.font="32px Arial",t.fillText("ðŸ˜ƒ",0,0),0!==t.getImageData(16,16,1,1).data[0]}var l=n("../../common/node_modules/lodash/lodash.js"),u=n("../../common/node_modules/react/react.js"),d=n("../../common/node_modules/react-easy-emoji/index.js"),p=n("../../common/src/utils/list-parser.js");e.exports={renderSurvey:r,renderSurveyResults:s,renderTaskList:o,renderEmoji:i,hasEmojiSupport:c};var h=!c(),m={height:"1em",width:"1em",margin:"0 .05em 0 .1em",verticalAlign:"-0.1em"}},"../../common/src/utils/random-token.js":function(e,t,n){"use strict";function r(){var e=new Uint32Array(4);window.crypto.getRandomValues(e);var t=[];return e.forEach(function(e){for(var n=e.toString(16);n.length<8;)n="0"+n;t.push(n)}),t.join("")}e.exports={generate:r}},"../../common/src/utils/tag-scanner.js":function(e,t,n){"use strict";function r(e){var t;return"string"==typeof e?(e=i(e),e=a(e),t=e.match(u)):e instanceof Object&&(t=c.flatten(c.filter(c.map(e,function(e){return e=i(e),e=a(e),String(e).match(u)})))),c.sortBy(c.uniq(t))}function s(e){return d.test(e)}function o(e){return c.trim(String(e).replace(u,""))}function i(e){return e.replace(/https?:\/\/\S+/g,"")}function a(e){return e.replace(/\w+@\w+.\w+/g,"")}var c=n("../../common/node_modules/lodash/lodash.js");e.exports={findTags:r,isTag:s,removeTags:o};var l="[@#][a-zA-Z][a-zA-Z0-9_\\-]*",u=new RegExp(""+l,"g"),d=new RegExp("^"+l+"$")},"../../common/src/widgets/autosize-text-area.jsx":function(e,t,n){"use strict";var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s=n("../../common/node_modules/lodash/lodash.js"),o=n("../../common/node_modules/react/react.js"),i=(o.PropTypes,n("../../common/src/utils/component-refs.js")),a=n("../../common/src/mixins/update-check.js");n("../../common/src/widgets/autosize-text-area.scss"),e.exports=o.createClass({displayName:"AutosizeTextArea",mixins:[a],getInitialState:function(){return this.components=i({actual:HTMLTextAreaElement,shadow:HTMLTextAreaElement}),{requiredHeight:void 0}},getElement:function(){return this.components.actual},componentWillReceiveProps:function(e){if(this.props.value!==e.value){var t=this.components.actual;t&&t===document.activeElement&&t.value!==e.value&&(this.caretPosition={selectionStart:t.selectionStart,selectionEnd:t.selectionEnd,text:t.value})}},render:function(){var e=this.components.setters,t=s.extend({height:this.state.requiredHeight},this.props.style),n=s.omit(this.props,"style");return o.createElement("div",{className:"autosize-text-area"},o.createElement("textarea",{ref:e.shadow,style:t,className:"shadow",value:n.value,readOnly:!0}),o.createElement("textarea",r({ref:e.actual,style:t},n)))},componentDidMount:function(){window.removeEventListener("resize",this.handleDocumentResize),this.updateSize()},componentDidUpdate:function(e,t){if(this.caretPosition){var n,r,o=this.components.actual,i=this.caretPosition.selectionStart,a=this.caretPosition.selectionEnd,c=this.caretPosition.text,l=this.props.value,u=c.substring(0,i),d=c.substring(a),p=c.substring(i,a);s.startsWith(l,u)&&(n=i),s.endsWith(l,d)&&(r=l.length-d.length),void 0!==n&&void 0===r?(r=n+p.length)>l.length&&(r=l.length):void 0===n&&void 0!==r&&(n=r-p.length)<0&&(n=0),void 0!==n&&void 0!==r&&(p||(n=r),o.selectionStart=n,o.selectionEnd=r),this.caretPosition=null}e.value!==this.props.value&&this.updateSize()},componentWillUnmount:function(){window.removeEventListener("resize",this.handleDocumentResize)},focus:function(){this.components.actual.focus()},updateSize:function(){var e=this.components.shadow,t=this.components.actual;if(e&&t){var n=e.offsetHeight,r=e.scrollHeight,s=e.clientHeight,o=t.offsetHeight,i=r+(n-s)+1;if(this.state.height!==i){if(o>i&&o>this.state.requiredHeight)return;this.setState({requiredHeight:i})}}},handleResize:function(e){},handleDocumentResize:function(e){this.updateSize()}})},"../../common/src/widgets/autosize-text-area.scss":function(e,t){},"../../common/src/widgets/chartist.jsx":function(e,t,n){"use strict";var r=n("../../common/node_modules/lodash/lodash.js"),s=n("../../common/node_modules/react/react.js"),o=s.PropTypes,i=(n("../../common/node_modules/react-dom/index.js"),n("../../common/node_modules/chartist/dist/chartist.js")),a=n("../../common/src/utils/component-refs.js");n("./widgets/chartist.scss"),e.exports=s.createClass({displayName:"Chartist",propTypes:{type:o.oneOf(["line","bar","pie"]).isRequired,data:o.object.isRequired,className:o.string,options:o.object,responsiveOptions:o.array,style:o.object,onDraw:o.func,onClick:o.func},getInitialState:function(){return this.components=a({container:HTMLDivElement}),{}},componentWillReceiveProps:function(e){this.props.onDraw!==e.onDraw&&(this.chartist?this.chartist.off("draw",this.props.onDraw):this.chartist.on("draw",e.onDraw))},render:function(){var e=["ct-chart"];this.props.className&&e.push(this.props.className);var t={ref:this.components.setters.container,className:e.join(" "),style:this.props.style,onClick:this.props.onClick};return s.createElement("div",t)},componentDidUpdate:function(e,t){e.type!==this.props.type?(this.destroyChart(),this.createChart()):e.data===this.props.data&&e.options===this.props.options&&e.responsiveOptions===this.props.responsiveOptions||this.updateChart()},componentDidMount:function(){this.createChart()},createChart:function(){var e=i[r.upperFirst(this.props.type)],t=this.components.container;this.chartist=new e(t,this.props.data,this.props.options,this.props.responsiveOptions),this.props.onDraw&&this.chartist.on("draw",this.props.onDraw)},updateChart:function(){this.chartist.update(this.props.data,this.props.options,this.props.responsiveOptions)},destroyChart:function(){this.chartist&&this.chartist.detach();var e=this.components.container;if(e)for(;e.firstChild;)e.removeChild(e.firstChild)}}),e.exports.Interpolation=i.Interpolation,e.exports.Svg=i.Svg},"../../common/src/widgets/collapsible-container.jsx":function(e,t,n){"use strict";function r(e){var t=e.offsetHeight,n=e.getElementsByClassName("collapsible-container");return _.each(n,function(e){if(t-=e.offsetHeight,parseInt(e.style.height)>0){var n=e.children[0];t+=n.offsetHeight}}),t}var s=n("../../common/node_modules/react/react.js"),o=(s.PropTypes,n("../../common/src/utils/component-refs.js"));n("../../common/src/widgets/collapsible-container.scss"),e.exports=s.createClass({displayName:"CollapsibleContainer",propTypes:{open:s.PropTypes.bool},getInitialState:function(){return this.components=o({container:HTMLDivElement,contents:HTMLDivElement}),{contentHeight:void 0,collapsing:!1,expanding:!1}},componentWillReceiveProps:function(e){this.props.open!==e.open&&(e.open?this.setState({collapsing:!1,expanding:!0}):this.setState({collapsing:!0,expanding:!1}))},render:function(){var e=this.components.setters,t={};this.props.open?t.height=this.state.contentHeight:t.height=0;var n="collapsible-container";return this.state.expanding?n+=" expanding":this.state.collapsing&&(n+=" collapsing"),s.createElement("div",{ref:e.container,className:n,style:t},s.createElement("div",{ref:e.contents,className:"collapsible-contents"},this.props.children))},componentDidMount:function(){this.props.open&&(this.updateHeight(),this.updateTimeout=setTimeout(this.updateHeight,10))},componentDidUpdate:function(e,t){this.updateHeight(),this.updateTimeout=setTimeout(this.updateHeight,10)},componentWillUnmount:function(){this.updateTimeout&&clearTimeout(this.updateTimeout)},updateHeight:function(){if(this.components.contents){var e=r(this.components.contents);this.state.contentHeight!==e&&this.setState({contentHeight:e})}}})},"../../common/src/widgets/collapsible-container.scss":function(e,t){},"../../common/src/widgets/diagnostics-section.jsx":function(e,t,n){"use strict";var r=n("../../common/node_modules/react/react.js"),s=r.PropTypes,o=n("../../common/src/widgets/collapsible-container.jsx");e.exports=r.createClass({displayName:"DiagnosticsSection",propTypes:{label:s.string,hidden:s.bool},getInitialState:function(){return{open:!1}},render:function(){if(this.props.hidden)return null;var e="diagnostics-section";return this.state.open&&(e+=" open"),r.createElement("div",{className:e},r.createElement("div",{className:"title",onClick:this.handleLabelClick},this.props.label),r.createElement(o,{open:this.state.open},this.props.children))},handleLabelClick:function(e){var t=!this.state.open;this.setState({open:t})}})},"../../common/src/widgets/diagnostics.jsx":function(e,t,n){"use strict";(function(t){function r(n){var r=n.type,s=n.children;return i[r]=s,c||(c=t(function(){c=0,_.each(a,function(t){t({type:"change",target:e.exports})})})),null}var s=n("../../common/node_modules/react/react.js"),o=s.PropTypes,i={},a=[],c=0;e.exports=r,r.propTypes={type:o.string.isRequired},r.get=function(e){return i[e]},r.addListener=function(e){e&&a.push(e)},r.removeListener=function(e){_.pull(a,e)}}).call(t,n("../node_modules/timers-browserify/main.js").setImmediate)},"../../common/src/widgets/image-cropper.jsx":function(e,t,n){"use strict";function r(e,t,n){e.left<0?e.left=0:e.left+e.width>t&&(e.left=t-e.width),e.top<0?e.top=0:e.top+e.height>n&&(e.top=n-e.height)}var s=n("../../common/node_modules/lodash/lodash.js"),o=(n("../../common/node_modules/bluebird/js/browser/bluebird.js"),n("../../common/node_modules/react/react.js")),i=o.PropTypes,a=(n("../../common/node_modules/react-dom/index.js"),n("../node_modules/hammerjs/hammer.js")),c=n("../../common/src/utils/component-refs.js"),l=n("../../common/src/media/bitmap-view.jsx"),u=n("../../common/src/media/vector-view.jsx");n("../../common/src/widgets/image-cropper.scss"),e.exports=o.createClass({displayName:"ImageCropper",propTypes:{url:i.string.isRequired,clippingRect:i.object,vector:i.bool,disabled:i.bool,onChange:i.func,onLoad:i.func},getDefaultProps:function(){return{vector:!1}},getInitialState:function(){return this.components=c({container:HTMLElement,image:l}),{clippingRect:this.props.clippingRect,hasFocus:!1}},componentWillReceiveProps:function(e){this.props.clippingRect!==e.clippingRect&&(this.zoomChangeTimeout?console.log("Ignoring incoming clipping rect"):this.setState({clippingRect:e.clippingRect})),this.props.url!==e.url&&this.zoomChangeTimeout&&(clearTimeout(this.zoomChangeTimeout),this.triggerChangeEvent(this.state.clippingRect),this.zoomChangeTimeout=0)},render:function(){var e=this.components.setters,t={ref:e.container,className:"image-cropper"};this.props.disabled||(s.assign(t,{tabIndex:0,onMouseDown:this.handleMouseDown,onFocus:this.handleFocus,onBlur:this.handleBlur}),this.state.hasFocus&&s.assign(t,{onWheel:this.handleMouseWheel,onKeyDown:this.handleKeyDown}));var n={ref:e.image,url:this.props.url,clippingRect:this.state.clippingRect,onLoad:this.props.onLoad},r=l;return this.props.vector&&(r=u),o.createElement("div",t,o.createElement(r,n))},focus:function(){this.components.container.focus()},extractMosaic:function(){var e=this.components.image;if(e instanceof l)return e.extractMosaic()},activateTouchHandling:function(){var e=this.components.container;if(e&&!this.hammer){this.hammer=new a(e);var t=this.hammer.get("pan").set({direction:a.DIRECTION_ALL,threshold:5});this.hammer.get("pinch").set({enable:!0}).recognizeWith(t),this.hammer.on("panstart",this.handlePanStart),this.hammer.on("panmove",this.handlePanMove),this.hammer.on("panend",this.handlePanEnd),this.hammer.on("pinchstart",this.handlePinchStart),this.hammer.on("pinchmove",this.handlePinchMove),this.hammer.on("pinchend",this.handlePinchEnd)}},deactivateTouchHandling:function(){this.hammer&&(this.hammer.off("panstart",this.handlePanStart),this.hammer.off("panmove",this.handlePanMove),this.hammer.off("panend",this.handlePanEnd),this.hammer.off("pinchstart",this.handlePinchStart),this.hammer.off("pinchmove",this.handlePinchMove),this.hammer.off("pinchend",this.handlePinchEnd),this.hammer.stop(!0),this.hammer.element.style.touchAction="",this.hammer.destroy(),this.hammer=null)},componentDidUpdate:function(e,t){!t.hasFocus&&this.state.hasFocus?this.activateTouchHandling():t.hasFocus&&!this.state.hasFocus&&this.deactivateTouchHandling()},componentWillUnmount:function(){this.dragStart&&this.handleMouseUp(),this.zoomChangeTimeout&&(clearTimeout(this.zoomChangeTimeout),this.triggerChangeEvent(this.state.clippingRect)),this.deactivateTouchHandling()},triggerChangeEvent:function(e){s.isEqual(this.props.clippingRect,e)||this.props.onChange&&this.props.onChange({type:"change",target:this,rect:e})},handleFocus:function(e){this.setState({hasFocus:!0})},handleBlur:function(e){this.setState({hasFocus:!1})},handleMouseDown:function(e){if(0===e.button){var t=this.components.image,n=this.components.container;if(t&&n&&this.state.clippingRect){var r=n.getBoundingClientRect(),s=this.state.clippingRect;this.dragStart={clippingRect:s,boundingRect:r,pageX:e.pageX,pageY:e.pageY,naturalWidth:t.naturalWidth,naturalHeight:t.naturalHeight},document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("mouseup",this.handleMouseUp)}}},handleMouseMove:function(e){if(e.preventDefault(),this.dragStart){var t={x:this.dragStart.pageX-e.pageX,y:this.dragStart.pageY-e.pageY},n=this.dragStart.boundingRect,o=s.clone(this.dragStart.clippingRect),i=t.x*o.width/n.width,a=t.y*o.height/n.height;o.left+=Math.round(i),o.top+=Math.round(a),r(o,this.dragStart.naturalWidth,this.dragStart.naturalHeight),this.setState({clippingRect:o})}},handleMouseUp:function(e){this.dragStart&&(document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),this.triggerChangeEvent(this.state.clippingRect),this.dragStart=null)},handleMouseWheel:function(e){var t=this;e.preventDefault();var n=this.components.image,o=this.components.container;if(n&&o&&this.state.clippingRect){var i=4;e.shiftKey&&(i=1);var a,c=o.getBoundingClientRect(),l=s.clone(this.state.clippingRect);switch(e.deltaMode){case 0:a=e.deltaY;break;case 1:a=18*e.deltaY;break;case 2:a=480*e.deltaY}var u=Math.round(a*l.height/c.height/i),d=l.width+u;d>n.naturalWidth&&(d=n.naturalWidth,u=d-l.width);var p=l.height+u;p>n.naturalHeight&&(p=n.naturalHeight,u=p-l.height,d=l.width+u);var h={x:e.pageX-c.left,y:e.pageY-c.top},m=-h.x*u/c.width,f=-h.y*u/c.height;l.left+=Math.round(m),l.top+=Math.round(f),l.width=d,l.height=p,r(l,n.naturalWidth,n.naturalHeight),this.setState({clippingRect:l},function(){t.zoomChangeTimeout&&clearTimeout(t.zoomChangeTimeout),t.zoomChangeTimeout=setTimeout(function(){t.triggerChangeEvent(l),t.zoomChangeTimeout=0},1e3)}),this.dragStart&&(this.dragStart={clippingRect:l,boundingRect:c,pageX:e.pageX,pageY:e.pageY,naturalWidth:n.naturalWidth,naturalHeight:n.naturalHeight})}},handlePanStart:function(e){if("mouse"!==e.pointerType){var t=this.components.image,n=this.components.container;if(t&&n&&this.state.clippingRect){var r=n.getBoundingClientRect(),s=this.state.clippingRect;this.panStart={clippingRect:s,boundingRect:r,naturalWidth:t.naturalWidth,naturalHeight:t.naturalHeight},this.handlePanMove(e)}}},handlePanMove:function(e){if(this.panStart){var t=this.panStart.boundingRect,n=s.clone(this.panStart.clippingRect),o=-e.deltaX*n.width/t.width,i=-e.deltaY*n.height/t.height;n.left+=Math.round(o),n.top+=Math.round(i),r(n,this.panStart.naturalWidth,this.panStart.naturalHeight),this.setState({clippingRect:n})}},handlePanEnd:function(e){this.panStart&&(this.triggerChangeEvent(this.state.clippingRect),this.panStart=null)},handlePinchStart:function(e){if("mouse"!==e.pointerType){var t=this.components.image,n=this.components.container;if(t&&n&&this.state.clippingRect){var r=n.getBoundingClientRect(),o=this.state.clippingRect;this.pinchStart={clippingRect:o,boundingRect:r,pointers:s.map(e.pointers,function(e){return{pageX:e.pageX,pageY:e.pageY}})},this.handlePinchMove(e)}}},handlePinchMove:function(e){if(this.pinchStart){var t=this.components.image,n=s.clone(this.pinchStart.clippingRect),o=this.pinchStart.boundingRect,i=1/e.scale,a=Math.round(n.width*i);a>t.naturalWidth&&(a=t.naturalWidth,i=a/n.width);var c=Math.round(n.height*i);c>t.naturalHeight&&(c=t.naturalHeight,i=c/n.height,a=Math.round(n.width*i));var l={x:this.pinchStart.pointers[0].pageX-o.left,y:this.pinchStart.pointers[0].pageY-o.top},u={x:this.pinchStart.pointers[1].pageX-o.left,y:this.pinchStart.pointers[1].pageY-o.top},d={x:e.pointers[0].pageX-o.left,y:e.pointers[0].pageY-o.top},p={x:e.pointers[1].pageX-o.left,y:e.pointers[1].pageY-o.top},h=(l.x*n.width-d.x*a)/o.width,m=(u.x*n.width-p.x*a)/o.width,f=(l.y*n.height-d.y*c)/o.height,g=(u.y*n.height-p.y*c)/o.height;n.left+=Math.round((h+m)/2),n.top+=Math.round((f+g)/2),n.width=a,n.height=c,r(n,t.naturalWidth,t.naturalHeight),this.setState({clippingRect:n})}},handlePinchEnd:function(e){this.pinchStart&&(this.triggerChangeEvent(this.state.clippingRect),this.pinchStart=null)},handleKeyDown:function(e){if(27===e.keyCode){this.components.container.blur()}}})},"../../common/src/widgets/image-cropper.scss":function(e,t){},"../../common/src/widgets/overlay.jsx":function(e,t,n){"use strict";function r(e){var t=_.omit(e,"className","children","show");return t.className="overlay",e.show?t.className+=" show":t.className+=" hide",e.className&&(t.className+=" "+e.className),s.createElement("div",t,s.createElement("div",{className:"background"}),s.createElement("div",{className:"foreground"},e.children))}var s=n("../../common/node_modules/react/react.js"),o=s.PropTypes,i=n("../../common/node_modules/react-dom/index.js");n("../../common/src/theme/theme.js");n("../../common/src/widgets/overlay.scss"),e.exports=s.createClass({displayName:"OverlayProxy",propTypes:{className:o.string,show:o.bool,onBackgroundClick:o.func},statics:{active:!1},getDefaultProps:function(){return{show:!1}},render:function(){return null},componentDidMount:function(){this.props.show&&this.show()},componentDidUpdate:function(e){e.show!==this.props.show?this.props.show?this.show():this.hide():e.children!==this.props.children&&this.props.show&&this.redraw(this.shown)},componentWillUnmount:function(){this.hide()},show:function(){var e=this;if(this.containerNode)this.containerRemovalTimeout&&(clearTimeout(this.containerRemovalTimeout),this.containerRemovalTimeout=0);else{var t=document.getElementById("application");this.containerNode=document.createElement("DIV"),t.appendChild(this.containerNode),t.addEventListener("keydown",this.handleKeyDown);var n=document.activeElement;n&&n!==document.body?(this.originalFocusElement=n,n.blur()):this.originalFocusElement=null}this.redraw(!1),this.shown=!1,setTimeout(function(){e.shown=!0,e.redraw(e.shown)},10),this.constructor.active=!0},redraw:function(e){var t={show:e,onClick:this.handleClick,onTouchMove:this.handleTouchMove,children:this.props.children};i.render(s.createElement(r,t),this.containerNode)},hide:function(){var e=this;this.containerNode&&(this.containerRemovalTimeout||(this.containerRemovalTimeout=setTimeout(function(){var t=document.getElementById("application");i.unmountComponentAtNode(e.containerNode),t.removeChild(e.containerNode),t.removeEventListener("keydown",e.handleKeyDown),e.containerNode=null,e.containerRemovalTimeout=0},500),this.originalFocusElement&&(this.originalFocusElement.focus(),this.originalFocusElement=null)),this.shown=!1,this.redraw(this.shown),this.constructor.active=!1)},handleClick:function(e){if(0===e.button){var t=e.target.className;"foreground"!==t&&"background"!==t||this.props.onBackgroundClick&&this.props.onBackgroundClick(e)}},handleTouchMove:function(e){for(var t=e.target,n=null,r=t;r&&r!==this.containerNode;r=r.parentNode){var s=getComputedStyle(r);if("auto"===s.overflowY||"scroll"===s.overflowY){r.scrollHeight>r.clientHeight&&(n=r);break}}n||e.preventDefault()},handleKeyDown:function(e){27===e.keyCode&&this.props.onBackgroundClick&&this.props.onBackgroundClick(e)}})},"../../common/src/widgets/overlay.scss":function(e,t){},"../../common/src/widgets/resource-view.jsx":function(e,t,n){"use strict";function r(e){return a.startsWith(e,"json:")}function s(e){var t=e.substr(5);return JSON.parse(t)}function o(e){return e.length<6&&(e="000000".substr(e.length)+e),"#"+e}var i=function(){function e(e,t){var n=[],r=!0,s=!1,o=void 0;try{for(var i,a=e[Symbol.iterator]();!(r=(i=a.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){s=!0,o=e}finally{try{!r&&a.return&&a.return()}finally{if(s)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=n("../../common/node_modules/lodash/lodash.js"),c=n("../../common/node_modules/react/react.js"),l=c.PropTypes,u=n("../../common/src/media/media-loader.js"),d=(n("../../common/src/media/image-cropping.js"),n("../../common/src/transport/payload.js"),n("../../common/src/theme/theme.js")),p=n("../../common/src/media/bitmap-view.jsx"),h=n("../../common/src/media/vector-view.jsx");n("../../common/src/widgets/resource-view.scss"),e.exports=c.createClass({displayName:"ResourceView",propTypes:{clip:l.bool,animation:l.bool,mosaic:l.bool,resource:l.object,url:l.string,width:l.number,height:l.number,theme:l.instanceOf(d)},getDefaultProps:function(){return{clip:!0,animation:!1,mosaic:!1}},getInitialState:function(){return{waitingForRemoteImage:!1,remoteImageLoaded:!1}},getURL:function(e){if(e=e||this.props,e.resource){var t={};return e.animation&&"gif"===e.resource.format?t.original=!0:(e.clip||(t.clip=null),e.width&&(t.width=e.width),e.height&&(t.height=e.height)),e.theme.getImageURL(e.resource,t)}return e.url},getDimensions:function(e){e=e||this.props;var t=e.width,n=e.height;if(e.resource){var r=e.theme.getImageDimensions(e.resource,{original:!this.props.clip});t?n=Math.round(t*r.height/r.width):n?t=Math.round(n*r.width/r.height):(t=r.width,n=r.height)}return{width:t,height:n}},componentWillReceiveProps:function(e){var t=this;if(this.props.resource!==e.resource){var n=this.getURL(),s=this.getURL(e);r(n)&&!r(s)&&(this.setState({waitingForRemoteImage:!0}),u.loadImage(s).catch(function(e){}).then(function(){t.setState({waitingForRemoteImage:!1})}))}},shouldComponentUpdate:function(e,t){return!t.waitingForRemoteImage},render:function(){var e=this.getURL();if(!e)return this.props.children||null;var t=a.omit(this.props,"clip","animation","mosaic","resource","url","width","height","theme");if(r(e)){var n=s(e);return t.url=n.url,t.clippingRect=n.clip,"svg"===n.format?c.createElement(h,t):c.createElement(p,t)}var l={className:"resource-view"},u=this.getDimensions();if(t.src=e,t.width=u.width,t.height=u.height,!this.state.remoteImageLoaded&&this.props.mosaic){t.onLoad=this.handleRemoteImageLoad;var d=t.height/t.width;l.className+=" loading",l.style={paddingTop:100*d+"%"};var m=a.get(this.props.resource,"mosaic");if(this.props.clip&&16===a.size(m)){var f=a.chunk(m,4),g=a.map(f,function(e){var t=a.map(e,o),n=i(t,4),r=n[0],s=n[1],c=n[2],l=n[3];return"linear-gradient(90deg, "+r+" 0%, "+r+" 25%, "+s+" 25%, "+s+" 50%, "+c+" 50%, "+c+" 75%, "+l+" 75%, "+l+" 100%)"}),v=["0 0%","0 "+100/3+"%","0 "+200/3+"%","0 100%"];l.style.backgroundRepeat="no-repeat",l.style.backgroundSize="100% 25.5%",l.style.backgroundImage=g.join(", "),l.style.backgroundPosition=v.join(", ")}}return c.createElement("span",l,c.createElement("img",t))},handleRemoteImageLoad:function(e){this.setState({remoteImageLoaded:!0})}})},"../../common/src/widgets/resource-view.scss":function(e,t){},"../../common/src/widgets/smart-list.jsx":function(e,t,n){"use strict";function r(e){this.node=e}var s=n("../../common/node_modules/lodash/lodash.js"),o=n("../../common/node_modules/react/react.js"),i=o.PropTypes,a=n("../../common/node_modules/react-dom/index.js");n("../../common/src/widgets/smart-list.scss"),e.exports=o.createClass({displayName:"SmartList",propTypes:{items:i.arrayOf(i.object),behind:i.number,ahead:i.number,anchor:i.string,offset:i.number,inverted:i.bool,transitioning:i.number,onIdentity:i.func.isRequired,onTransition:i.func,onRender:i.func.isRequired,onAnchorChange:i.func,onBeforeAnchor:i.func},getDefaultProps:function(){return{behind:5,ahead:10,offset:0,inverted:!1,transitioning:5}},getInitialState:function(){var e={};return this.updateAnchor(this.props,e),this.updateSlots(this.props,e),e},releaseAnchor:function(){this.setState({currentAnchor:null})},componentWillReceiveProps:function(e){var t=s.clone(this.state);this.props.anchor!==e.anchor&&this.updateAnchor(e,t),this.props.items!==e.items&&this.updateSlots(e,t);var n=s.shallowDiff(t,this.state);s.isEmpty(n)||this.setState(n)},updateAnchor:function(e,t){t.currentAnchor!==e.anchor&&(t.currentAnchor=e.anchor,this.anchorOffset=e.offset)},updateSlots:function(e,t){var n=this,r=e.items,o=function(t,r,s){return e.onIdentity({type:"identity",target:n,item:t,currentIndex:r,alternative:s||!1})},i=function(t,r){return!e.onTransition||e.onTransition({type:"transition",target:n,item:t,currentIndex:r})},a=s.slice(t.slots),c=s.transform(a,function(e,t){e[t.id]=t},{}),l=!s.isEmpty(a),u={};s.each(r,function(e,t){var r=o(e,t),s=c[r];if(!s){var d=o(e,t,!0);d&&(s=c[d])&&(s.id=r)}if(s)s.item=e,s.index=t,"disappearing"===s.state&&(s.state="present");else{var p="present";l&&i(e,t)&&(p="appearing"),s=n.createSlot(r,e,t,p),a.push(s)}u[r]=!0}),s.each(a,function(e){u[e.id]||(l&&n.isSlotVisible(e)?e.state="disappearing":e.state="gone")});var d=0,p=0,h=this.props.transitioning;s.each(a,function(e){"appearing"===e.state?d<h?d++:e.state="present":"disappearing"===e.state&&(p<h?p++:e.state="gone")});var m=s.remove(a,{state:"gone"});if(s.some(m,{unseen:!0})){var f=s.filter(a,{unseen:!0});this.triggerBeforeAnchorEvent(f)}t.slots=s.sortBy(a,"index")},createSlot:function(e,t,n,s){var o={id:e,key:e,index:n,state:s,item:t,transition:!1,rendering:void 0,contents:null,unseen:!1,height:void 0,node:null,setter:null};return o.setter=r.bind(o),o},render:function(){var e=this,t=this.state.slots,n=0;this.state.currentAnchor&&(n=s.findIndex(t,{id:this.state.currentAnchor}));var r=Math.max(0,n-this.props.behind),i=Math.min(s.size(t),n+this.props.ahead+1),a=this.props.onRender,c=s.map(t,function(t,n){var s,c=r<=n&&n<i;if("disappearing"!==t.state){var l={type:"render",target:e,item:t.item,needed:c,startIndex:r,currentIndex:n,endIndex:i,previousHeight:t.height,estimatedHeight:e.state.estimatedHeight};s=t.contents=a(l)}else s=t.contents;c&&(t.rendering=!0);var u,d="slot";return"appearing"===t.state?(d+=" transition in",t.transition?u={height:t.height}:d+=" hidden"):"disappearing"===t.state&&(d+=" transition out",t.transition?d+=" hidden":u={height:t.height}),o.createElement("div",{key:t.key,ref:t.setter,className:d,style:u},s)});return this.startIndex=r,this.endIndex=i,this.props.inverted&&s.reverse(c),o.createElement("div",{className:"smart-list",onTransitionEnd:this.handleTransitionEnd},c)},componentDidMount:function(){this.container=a.findDOMNode(this);for(var e=this.container.parentNode;e;e=e.parentNode){var t=getComputedStyle(e);if("auto"===t.overflowY||"scroll"===t.overflowY){this.scrollContainer=e;break}}this.scrollContainerWidth=this.scrollContainer.clientWidth,this.scrollContainer.addEventListener("scroll",this.handleScroll),window.addEventListener("resize",this.handleWindowResize),this.maintainScrollPosition(),this.setSlotHeights()},componentDidUpdate:function(e,t){this.scrolling||this.maintainScrollPosition(),this.setSlotHeights(),this.markUnseenSlots(),this.setTransitionState()},maintainScrollPosition:function(){var e,t;if(this.state.currentAnchor?(e=s.find(this.state.slots,{id:this.state.currentAnchor}),t=this.anchorOffset):this.props.inverted&&(e=s.first(this.state.slots),t=1/0),e&&e.node&&void 0!==t){var n=this.scrollContainer.offsetTop,r=this.scrollContainer.scrollTop,o=e.node.offsetTop-n;if(this.props.inverted){var i=this.scrollContainer.scrollHeight,a=this.scrollContainer.offsetHeight,c=i-r-a,l=e.node.offsetHeight,u=i-o-l,d=u-c;if(d!==t){var p=Math.max(0,u-t),h=i-p-a;this.scrollContainer.scrollTop=h}}else{var d=o-r;if(d!==t){var h=Math.max(0,o-t);this.scrollContainer.scrollTop=h}}}},isSlotVisible:function(e){if(!e.rendering||!e.node)return!1;if(e.transition)return!0;if(this.scrollContainer){var t=this.scrollContainer.offsetHeight,n=this.scrollContainer.offsetTop,r=this.scrollContainer.scrollTop,s=r+t,o=e.node.offsetTop-n;if(r<o&&o<=s)return!0;var i=o+e.height;if(r<i&&i<=s)return!0}return!1},setSlotHeights:function(){var e=[];if(s.each(this.state.slots,function(t){if(t.rendering){var n=t.node.firstChild,r=n?n.offsetHeight:0;t.height=r,e.push(r)}}),void 0===this.state.estimatedHeight&&!s.isEmpty(e)){var t=s.sum(e)/e.length,n=Math.round(t);0!==n&&this.setState({estimatedHeight:n})}},markUnseenSlots:function(){var e=this,t=this.state.slots,n=s.findIndex(t,{id:this.state.currentAnchor}),r=!1;if(s.each(t,function(t,s){"appearing"===t.state?s<n&&(e.isSlotVisible(t)||(t.unseen=!0,r=!0)):t.unseen&&s>=n&&(t.unseen=!1,r=!0)}),r){var o=s.filter(t,{unseen:!0});this.triggerBeforeAnchorEvent(o)}},setTransitionState:function(){var e=this,t=s.clone(this.state.slots),n=!1;s.each(t,function(t){if(("appearing"===t.state||"disappearing"===t.state)&&!t.transition){var r=e.isSlotVisible(t);e.props.inverted&&("appearing"!==t.state||e.state.currentAnchor||(e.scrollPositionInterval||(e.scrollPositionInterval=setInterval(e.maintainScrollPosition,10)),e.scrollToAnchorNode=t.node,r=!0)),r?t.transition=!0:t.state="present",n=!0}}),n&&this.setState({slots:t})},componentWillUnmount:function(){this.scrollContainer.removeEventListener("scroll",this.handleScroll),window.removeEventListener("resize",this.handleWindowResize)},triggerAnchorChangeEvent:function(e){this.props.onAnchorChange&&this.props.onAnchorChange({type:"anchorchange",target:this,anchor:e?e.id:null,item:e?e.item:null})},triggerBeforeAnchorEvent:function(e){this.props.onBeforeAnchor&&this.props.onBeforeAnchor({type:"beforeanchor",target:this,items:s.map(e,"item")})},findAnchorSlot:function(e){var t,n=this.scrollContainer.scrollTop,r=this.scrollContainer.offsetTop;if(this.props.inverted){var s,o=this.scrollContainer.scrollHeight,i=this.scrollContainer.offsetHeight,a=o-n-i;if(a>0)for(var c=0;c<e.length;c++){var l=e[c];t=l;var u=t.node.offsetTop-r,d=t.node.offsetHeight,s=o-u-d;if(s>a)break}this.anchorOffset=t?s-a:void 0}else{var u;if(n>0)for(var c=0;c<e.length;c++){var l=e[c];if(t=l,(u=t.node.offsetTop-r)>n)break}this.anchorOffset=t?u-n:void 0}return t},handleScroll:function(e){var t=this;if(!this.scrollPositionInterval){if(this.resizing)return void this.maintainScrollPosition();var n=this.findAnchorSlot(this.state.slots),r=n?n.id:void 0;this.state.currentAnchor!==r&&(this.setState({currentAnchor:r}),this.triggerAnchorChangeEvent(n)),this.scrolling=!0,this.scrollingEndTimeout&&clearTimeout(this.scrollingEndTimeout),this.scrollingEndTimeout=setTimeout(function(){t.scrolling=!1,t.scrollingEndTimeout=0},500)}},handleWindowResize:function(){var e=this;if(this.scrollContainerWidth!==this.scrollContainer.clientWidth){this.scrollContainerWidth=this.scrollContainer.clientWidth;var t=s.slice(this.state.slots);s.each(t,function(e){e.height=void 0}),this.setState({slots:t,estimatedHeight:void 0}),this.resizing=!0,this.resizingEndTimeout&&clearTimeout(this.resizingEndTimeout),this.resizingEndTimeout=setTimeout(function(){e.resizing=!1,e.resizingEndTimeout=0},50)}},handleTransitionEnd:function(e){var t=s.slice(this.state.slots);if("opacity"===e.propertyName){var n=s.find(t,{node:e.target});n&&"appearing"===n.state&&(n.state="present",n.transition=!1,this.setState({slots:t}),this.scrollToAnchorNode===e.target&&(this.maintainScrollPosition(),clearInterval(this.scrollPositionInterval),this.scrollPositionInterval=null,this.scrollToAnchorNode=null))}else if("height"===e.propertyName){var n=s.find(t,{node:e.target});if(n&&"disappearing"===n.state){var r=s.indexOf(t,n);t.splice(r,1);var o=this.findAnchorSlot(t),i=o?o.id:void 0;i!==this.state.currentAnchor&&this.triggerAnchorChangeEvent(o),this.setState({slots:t,currentAnchor:i})}}}})},"../../common/src/widgets/smart-list.scss":function(e,t){},"../../common/src/widgets/time.jsx":function(e,t,n){"use strict";function r(e){return e.format("YYYY-MM-DD")}function s(){var e=d.slice();o.each(e,function(e){e&&e.update()})}var o=n("../../common/node_modules/lodash/lodash.js"),i=n("../../common/node_modules/react/react.js"),a=i.PropTypes,c=n("../../common/node_modules/moment/moment.js"),l=n("../../common/src/utils/date-tracker.js"),u=n("../../common/src/locale/locale.js");e.exports=i.createClass({displayName:"Time",propTypes:{locale:a.instanceOf(u).isRequired,time:a.string,compact:a.bool},getDefaultProps:function(){return{compact:!1}},getInitialState:function(){var e=c(this.props.time),t={time:e,date:r(e)};return this.updateClassName(t,this.props),this.updateText(t,this.props),t},updateClassName:function(e,t){var n;n=e.time.isValid()?e.date===l.today?"today":e.date===l.yesterday?"yesterday":"older":"invalid",e.className=n},updateText:function(e,t){var n,r=t.locale.translate,s=t.locale.localeCode,o=e.time.clone().locale(s);if("today"===e.className){var i=c(),a=.001*(i-o);if(a<60)n=r("time-just-now");else if(a<3600){var l=Math.floor(a*(1/60));n=t.compact?r("time-$min-ago",l):r("time-$minutes-ago",l)}else{var u=Math.floor(a*(1/3600));n=t.compact?r("time-$hr-ago",u):r("time-$hours-ago",u)}}else n="yesterday"===e.className?r("time-yesterday"):"older"===e.className?t.compact?o.format("ll"):o.format("LL"):"";e.text=n},update:function(){var e=o.clone(this.state);this.updateClassName(e,this.props),this.updateText(e,this.props);var t=o.shallowDiff(e,this.state);o.isEmpty(t)||this.setState(t)},componentWillReceiveProps:function(e){var t=o.clone(this.state),n=c(e.time);t.time=n,t.date=r(n),this.updateClassName(t,e),this.updateText(t,e);var s=o.shallowDiff(t,this.state);o.isEmpty(s)||this.setState(s)},render:function(){return i.createElement("span",{className:"time "+this.state.className},this.state.text)},componentDidMount:function(){this.componentDidUpdate()},componentDidUpdate:function(e,t){"today"===this.state.className||"yesterday"===this.state.className?o.includes(d,this)||d.push(this):o.pull(d,this)},componentWillUnmount:function(){o.pull(d,this)}});var d=[];setInterval(s,15e3)},"../../common/src/widgets/upload-progress.jsx":function(e,t,n){"use strict";var r=n("../../common/node_modules/lodash/lodash.js"),s=n("../../common/node_modules/react/react.js"),o=s.PropTypes,i=n("../../common/src/locale/locale.js"),a=n("../../common/src/transport/payloads.js");n("../../common/src/widgets/upload-progress.scss"),e.exports=s.createClass({displayName:"UploadProgress",propTypes:{payloads:o.instanceOf(a).isRequired,locale:o.instanceOf(i).isRequired},render:function(){var e=this.props.locale.translate,t=this.props.payloads.uploading;if(!t)return null;var n=r.fileSize(t.bytes),o=t.files;return s.createElement("div",{className:"upload-progress"},e("upload-progress-uploading-$count-files-$size-remaining",o,n))}})},"../../common/src/widgets/upload-progress.scss":function(e,t){},"../assets/explosion.gif":function(e,t,n){e.exports=n.p+"37253a4919d17c8ab9ca739de7996eb5.gif"},"../assets/favicon recursive ^\\.\\/.*\\.png$":function(e,t,n){function r(e){return n(s(e))}function s(e){var t=o[e];if(!(t+1))throw new Error("Cannot find module '"+e+"'.");return t}var o={"./apple-touch-icon-114x114.png":"../assets/favicon/apple-touch-icon-114x114.png","./apple-touch-icon-120x120.png":"../assets/favicon/apple-touch-icon-120x120.png","./apple-touch-icon-144x144.png":"../assets/favicon/apple-touch-icon-144x144.png","./apple-touch-icon-152x152.png":"../assets/favicon/apple-touch-icon-152x152.png","./apple-touch-icon-57x57.png":"../assets/favicon/apple-touch-icon-57x57.png","./apple-touch-icon-60x60.png":"../assets/favicon/apple-touch-icon-60x60.png","./apple-touch-icon-72x72.png":"../assets/favicon/apple-touch-icon-72x72.png","./apple-touch-icon-76x76.png":"../assets/favicon/apple-touch-icon-76x76.png","./favicon-128.png":"../assets/favicon/favicon-128.png","./favicon-16x16.png":"../assets/favicon/favicon-16x16.png","./favicon-196x196.png":"../assets/favicon/favicon-196x196.png","./favicon-32x32.png":"../assets/favicon/favicon-32x32.png","./favicon-96x96.png":"../assets/favicon/favicon-96x96.png","./mstile-144x144.png":"../assets/favicon/mstile-144x144.png","./mstile-150x150.png":"../assets/favicon/mstile-150x150.png","./mstile-310x150.png":"../assets/favicon/mstile-310x150.png","./mstile-310x310.png":"../assets/favicon/mstile-310x310.png","./mstile-70x70.png":"../assets/favicon/mstile-70x70.png"};r.keys=function(){return Object.keys(o)},r.resolve=s,e.exports=r,r.id="../assets/favicon recursive ^\\.\\/.*\\.png$"},"../assets/favicon-notification recursive \\.png$":function(e,t,n){function r(e){return n(s(e))}function s(e){var t=o[e];if(!(t+1))throw new Error("Cannot find module '"+e+"'.");return t}var o={"./apple-touch-icon-114x114.png":"../assets/favicon-notification/apple-touch-icon-114x114.png","./apple-touch-icon-120x120.png":"../assets/favicon-notification/apple-touch-icon-120x120.png","./apple-touch-icon-144x144.png":"../assets/favicon-notification/apple-touch-icon-144x144.png","./apple-touch-icon-152x152.png":"../assets/favicon-notification/apple-touch-icon-152x152.png","./apple-touch-icon-57x57.png":"../assets/favicon-notification/apple-touch-icon-57x57.png","./apple-touch-icon-60x60.png":"../assets/favicon-notification/apple-touch-icon-60x60.png","./apple-touch-icon-72x72.png":"../assets/favicon-notification/apple-touch-icon-72x72.png","./apple-touch-icon-76x76.png":"../assets/favicon-notification/apple-touch-icon-76x76.png","./favicon-128.png":"../assets/favicon-notification/favicon-128.png","./favicon-16x16.png":"../assets/favicon-notification/favicon-16x16.png","./favicon-196x196.png":"../assets/favicon-notification/favicon-196x196.png","./favicon-32x32.png":"../assets/favicon-notification/favicon-32x32.png","./favicon-96x96.png":"../assets/favicon-notification/favicon-96x96.png"};r.keys=function(){return Object.keys(o)},r.resolve=s,e.exports=r,r.id="../assets/favicon-notification recursive \\.png$"},"../assets/favicon-notification recursive ^\\.\\/.*\\.png$":function(e,t,n){function r(e){return n(s(e))}function s(e){var t=o[e];if(!(t+1))throw new Error("Cannot find module '"+e+"'.");return t}var o={"./apple-touch-icon-114x114.png":"../assets/favicon-notification/apple-touch-icon-114x114.png","./apple-touch-icon-120x120.png":"../assets/favicon-notification/apple-touch-icon-120x120.png","./apple-touch-icon-144x144.png":"../assets/favicon-notification/apple-touch-icon-144x144.png","./apple-touch-icon-152x152.png":"../assets/favicon-notification/apple-touch-icon-152x152.png","./apple-touch-icon-57x57.png":"../assets/favicon-notification/apple-touch-icon-57x57.png","./apple-touch-icon-60x60.png":"../assets/favicon-notification/apple-touch-icon-60x60.png","./apple-touch-icon-72x72.png":"../assets/favicon-notification/apple-touch-icon-72x72.png","./apple-touch-icon-76x76.png":"../assets/favicon-notification/apple-touch-icon-76x76.png","./favicon-128.png":"../assets/favicon-notification/favicon-128.png","./favicon-16x16.png":"../assets/favicon-notification/favicon-16x16.png","./favicon-196x196.png":"../assets/favicon-notification/favicon-196x196.png","./favicon-32x32.png":"../assets/favicon-notification/favicon-32x32.png","./favicon-96x96.png":"../assets/favicon-notification/favicon-96x96.png"};r.keys=function(){return Object.keys(o)},r.resolve=s,e.exports=r,r.id="../assets/favicon-notification recursive ^\\.\\/.*\\.png$"},"../assets/favicon-notification/apple-touch-icon-114x114.png":function(e,t,n){e.exports=n.p+"b8cf38e314f988b7f61c7ab27df43fc2.png"},"../assets/favicon-notification/apple-touch-icon-120x120.png":function(e,t,n){e.exports=n.p+"e0e2ff0632486f60e9b6109f86eda583.png"},"../assets/favicon-notification/apple-touch-icon-144x144.png":function(e,t,n){e.exports=n.p+"e03f845f146f2247a0aecb2978e5d253.png"},"../assets/favicon-notification/apple-touch-icon-152x152.png":function(e,t,n){e.exports=n.p+"2b3a29cc6c30c32393c237e567ca6cf5.png"},"../assets/favicon-notification/apple-touch-icon-57x57.png":function(e,t,n){e.exports=n.p+"5c44ab6d22ae6c0a10765769f60d720e.png"},"../assets/favicon-notification/apple-touch-icon-60x60.png":function(e,t,n){e.exports=n.p+"e6aea96cc3f2a144a6cf53c838b55e4b.png"},"../assets/favicon-notification/apple-touch-icon-72x72.png":function(e,t,n){e.exports=n.p+"6c1a9a9c48487ce503a4dfbdb9b711a6.png"},"../assets/favicon-notification/apple-touch-icon-76x76.png":function(e,t,n){e.exports=n.p+"337aa694f21523c7e2dc0ada09f20ec2.png"},"../assets/favicon-notification/favicon-128.png":function(e,t,n){e.exports=n.p+"ee581f2d338f7b9d3e386c79be970831.png"},"../assets/favicon-notification/favicon-16x16.png":function(e,t,n){e.exports=n.p+"5a6cd044c3abe571bd76c150bee839ff.png"},"../assets/favicon-notification/favicon-196x196.png":function(e,t,n){e.exports=n.p+"d1bdaed46ab1125c0e77d9f92299d78e.png"},"../assets/favicon-notification/favicon-32x32.png":function(e,t,n){e.exports=n.p+"91d27ccd154fa929e7458b4afe06f9de.png"},"../assets/favicon-notification/favicon-96x96.png":function(e,t,n){e.exports=n.p+"a3fb4fe34192a7a90a8ed4f371bbabf1.png"},"../assets/favicon/apple-touch-icon-114x114.png":function(e,t,n){e.exports=n.p+"ee141d1b002541c24fa79391f52200db.png"},"../assets/favicon/apple-touch-icon-120x120.png":function(e,t,n){e.exports=n.p+"716d5f1dc6c95c82cfac16c394db733b.png"},"../assets/favicon/apple-touch-icon-144x144.png":function(e,t,n){e.exports=n.p+"72bb4a181bab6923b6bc3421016cb573.png"},"../assets/favicon/apple-touch-icon-152x152.png":function(e,t,n){e.exports=n.p+"7fbc441dc116c285bf2bb3be1d2f3616.png"},"../assets/favicon/apple-touch-icon-57x57.png":function(e,t,n){e.exports=n.p+"6abad3de23e8db566c4cafd3a8ee7f24.png"},"../assets/favicon/apple-touch-icon-60x60.png":function(e,t,n){e.exports=n.p+"11164feb11ebf5b10f4fb8a015d166e9.png"},"../assets/favicon/apple-touch-icon-72x72.png":function(e,t,n){e.exports=n.p+"1d631316668fba6a8f6c7d4f4411587f.png"},"../assets/favicon/apple-touch-icon-76x76.png":function(e,t,n){e.exports=n.p+"6939925abcb6fcfbcc49465dee1032c5.png"},"../assets/favicon/favicon-128.png":function(e,t,n){e.exports=n.p+"4ae70e06469cf691b724146e8c0728b3.png"},"../assets/favicon/favicon-16x16.png":function(e,t,n){e.exports=n.p+"1f68ea20b77e7d8717c22708ea6968c1.png"},"../assets/favicon/favicon-196x196.png":function(e,t,n){e.exports=n.p+"563cc3494172864075b55660bdffc75a.png"},"../assets/favicon/favicon-32x32.png":function(e,t,n){e.exports=n.p+"ce7a0e79e69f7f86d3a0c9a310372aa4.png"},"../assets/favicon/favicon-96x96.png":function(e,t,n){e.exports=n.p+"ee78976e8358ad86d606d2de1e220931.png"},"../assets/favicon/mstile-144x144.png":function(e,t,n){e.exports=n.p+"72bb4a181bab6923b6bc3421016cb573.png"},"../assets/favicon/mstile-150x150.png":function(e,t,n){e.exports=n.p+"7af9ee3a80ed151b77494dea1e8b9a89.png"},"../assets/favicon/mstile-310x150.png":function(e,t,n){e.exports=n.p+"dbe43e1b6a21cb4ee792d70b7d813114.png"},"../assets/favicon/mstile-310x310.png":function(e,t,n){e.exports=n.p+"e72f85d8622d3ab0c93af4e0dc3b3ae3.png"},"../assets/favicon/mstile-70x70.png":function(e,t,n){e.exports=n.p+"4ae70e06469cf691b724146e8c0728b3.png"},"../assets/profile-image-placeholder.png":function(e,t,n){e.exports=n.p+"be613ad3c1fb13a04edca971d584e375.png"},"../assets/trambar-logo.svg":function(e,t,n){function r(e){return s.createElement("svg",e,[s.createElement("defs",{className:"ClipPathGroup",key:0},s.createElement("clipPath",{clipPathUnits:"userSpaceOnUse"},s.createElement("rect",{x:"1000",y:"1000",width:"5080",height:"6299"}))),s.createElement("defs",{className:"TextShapeIndex",key:1}),s.createElement("defs",{className:"EmbeddedBulletChars",key:2},[s.createElement("path",{d:"M0.3-0.6L0.6-0.3 0.3 0 0-0.3 0.3-0.6Z",key:0}),s.createElement("path",{d:"M0-0.6L0.6-0.6 0.6 0 0 0 0-0.6Z",key:1}),s.createElement("path",{d:"M0.1 0L0.3-0.4 0.1-0.7 0.7-0.4 0.1 0ZM1358 739L309 1346 659 739 1358 739Z",key:2}),s.createElement("path",{d:"M1-0.4L0.6 0 0.4 0 0.6-0.3 0.1-0.3 0.1-0.5 0.6-0.5 0.4-0.7 0.6-0.7 1-0.4Z",key:3}),s.createElement("path",{d:"M0 0C0 0 0 0 0 0L0.2-0.3C0.1-0.4 0.1-0.5 0.1-0.5 0.1-0.5 0.1-0.5 0.1-0.5 0.1-0.5 0.1-0.5 0.1-0.5 0.2-0.5 0.2-0.5 0.2-0.5L0.2-0.5 0.2-0.4 0.4-0.5 0.4-0.5 0.4-0.5C0.4-0.5 0.4-0.5 0.5-0.5 0.4-0.5 0.4-0.4 0.4-0.4 0.4-0.4 0.3-0.3 0.3-0.3L0.4-0.1C0.4-0.1 0.4-0.1 0.3-0.1L0.4-0.1C0.4 0 0.3 0 0.3 0 0.3 0 0.3-0.1 0.2-0.2L0.1 0C0.1 0.1 0.1 0.1 0 0.1 0 0.1 0 0.1 0 0 0 0 0 0 0 0 0 0 0 0 0 0Z",key:4}),s.createElement("path",{d:"M0.1 0C0.1 0 0.1 0 0-0.1 0-0.1 0-0.2 0-0.2 0-0.3 0-0.3 0-0.3 0.1-0.4 0.1-0.4 0.1-0.4 0.1-0.4 0.2-0.4 0.2-0.3L0.2-0.2C0.2-0.2 0.2-0.2 0.2-0.2L0.6-0.5C0.6-0.6 0.6-0.6 0.6-0.6 0.6-0.6 0.6-0.5 0.6-0.5L0.6-0.5C0.6-0.5 0.6-0.4 0.6-0.4L0.2 0C0.2 0 0.2 0 0.1 0Z",key:5}),s.createElement("path",{d:"M0.4 0C0.3 0 0.2 0 0.2-0.1 0.1-0.1 0.1-0.2 0.1-0.3 0.1-0.4 0.1-0.4 0.2-0.5 0.2-0.6 0.3-0.6 0.4-0.6 0.5-0.6 0.6-0.6 0.6-0.5 0.7-0.4 0.7-0.4 0.7-0.3 0.7-0.2 0.7-0.1 0.6-0.1 0.6 0 0.5 0 0.4 0Z",key:6}),s.createElement("path",{d:"M0.2-0.2C0.1-0.2 0.1-0.2 0.1-0.3 0-0.3 0-0.3 0-0.4 0-0.4 0-0.4 0.1-0.4 0.1-0.5 0.1-0.5 0.2-0.5 0.2-0.5 0.2-0.5 0.3-0.4 0.3-0.4 0.3-0.4 0.3-0.4 0.3-0.3 0.3-0.3 0.3-0.3 0.2-0.2 0.2-0.2 0.2-0.2Z",key:7}),s.createElement("path",{d:"M0-0.2L0.6-0.2 0.6-0.3 0-0.3 0-0.2Z",key:8})]),s.createElement("defs",{className:"TextEmbeddedBitmaps",key:3}),s.createElement("g",{className:"SlideGroup",key:4},s.createElement("g",{className:"Slide",clipPath:"url(#presentation_clip_path)"},s.createElement("g",{className:"Page"},s.createElement("g",{className:"com.sun.star.drawing.ClosedBezierShape"},[s.createElement("rect",{className:"BoundingBox",x:"1000",y:"1000",width:"5082",height:"6301",fill:"none",key:0}),s.createElement("path",{d:"M1655 2259L5444 2259 6080 2890 6080 3520 5233 3520 5233 3099 1847 3099 1847 3918 1847 4758 1847 5619 1847 6459 5233 6459 5233 5619 4809 5619 4809 4989 6080 4989 6080 6669 5444 7299 1635 7299 1000 6669 1000 2890 1655 2259ZM3116 6459L3116 4569 3963 4569 3963 6459 3116 6459ZM3540 3520C3780 3520 3963 3701 3963 3939 3963 4178 3780 4360 3540 4360 3300 4360 3116 4178 3116 3939 3116 3701 3300 3520 3540 3520ZM3116 3520L3116 3520ZM3964 4361L3964 4361ZM3328 2259L3328 1419 2693 1419 2693 1000 4387 1000 4387 1419 3752 1419 3752 2259 3328 2259Z",fill:"rgb(0,0,0)",key:1})]))))])}var s=n("../../common/node_modules/react/react.js");r.displayName="TrambarLogo",r.defaultProps={viewBox:"1000 1000 5080 6299",preserveAspectRatio:"xMidYMid",style:{strokeLinejoin:"round",strokeWidth:"30"}},e.exports=r,r.default=r},"../assets/unicorn.svg":function(e,t,n){function r(e){return s.createElement("svg",e,[s.createElement("polygon",{points:"280,653 373,679 255,840",fill:"black",stroke:"black",strokeLinejoin:"round",strokeWidth:"3",key:0}),s.createElement("polygon",{points:"102,634 298,439 373,430 297,540 447,585 387,674 281,646 285,575",fill:"black",stroke:"black",strokeLinejoin:"round",strokeWidth:"3",key:1}),s.createElement("polygon",{points:"312,528 386,425 431,428",fill:"black",stroke:"black",strokeLinejoin:"round",strokeWidth:"3",key:2}),s.createElement("polygon",{points:"332,520 485,397 513,414 496,435",fill:"black",stroke:"black",strokeLinejoin:"round",strokeWidth:"3",key:3}),s.createElement("polygon",{points:"316,534 492,443 467,467 521,509 515,543 565,587 560,592 498,549",fill:"black",stroke:"black",strokeLinejoin:"round",strokeWidth:"3",key:4}),s.createElement("polygon",{points:"318,542 496,557 555,595 548,605",fill:"black",stroke:"black",strokeLinejoin:"round",strokeWidth:"3",key:5}),s.createElement("polygon",{points:"550,611 574,592 599,618",fill:"black",stroke:"black",strokeLinejoin:"round",strokeWidth:"3",key:6}),s.createElement("polygon",{points:"476,466 543,399 521,500",fill:"black",stroke:"black",strokeLinejoin:"round",strokeWidth:"3",key:7}),s.createElement("polygon",{points:"525,524 555,392 600,427",fill:"black",stroke:"black",strokeLinejoin:"round",strokeWidth:"3",key:8}),s.createElement("polygon",{points:"522,542 605,435 597,604",fill:"black",stroke:"black",strokeLinejoin:"round",strokeWidth:"3",key:9}),s.createElement("polygon",{points:"613,444 743,521 685,543 775,833 554,617 605,625",fill:"black",stroke:"black",strokeLinejoin:"round",strokeWidth:"3",key:10}),s.createElement("polygon",{points:"565,318 620,318 655,457 613,434",fill:"black",stroke:"black",strokeLinejoin:"round",strokeWidth:"3",key:11}),s.createElement("polygon",{points:"629,310 695,204 751,184 733,267 740,508 661,462",fill:"black",stroke:"black",strokeLinejoin:"round",strokeWidth:"3",key:12}),s.createElement("polygon",{points:"757,183 869,81 776,196",fill:"black",stroke:"black",strokeLinejoin:"round",strokeWidth:"3",key:13}),s.createElement("polygon",{points:"743,273 755,194 848,270 853,338",fill:"black",stroke:"black",strokeLinejoin:"round",strokeWidth:"3",key:14})])}var s=n("../../common/node_modules/react/react.js");r.displayName="Unicorn",r.defaultProps={version:"1.1",viewBox:"0 0 1000 1000"},e.exports=r,r.default=r},"../node_modules/compute-scroll-into-view/es/index.js":function(e,t,n){"use strict";function r(e){return null!=e&&"object"==typeof e&&(1===e.nodeType||11===e.nodeType)}function s(e,t){return(!t||"hidden"!==e)&&("visible"!==e&&"clip"!==e)}function o(e,t){if(e.clientHeight<e.scrollHeight||e.clientWidth<e.scrollWidth){var n=getComputedStyle(e,null);return s(n.overflowY,t)||s(n.overflowX,t)}return!1}function i(e,t,n,r,s,o,i,a){return o<e&&i>t||o>e&&i<t?0:o<e&&a<n||i>t&&a>n?o-e-r:i>t&&a<n||o<e&&a>n?i-t+s:0}t.a=function(e,t){var n=t.scrollMode,s=t.block,a=t.inline,c=t.boundary,l=t.skipOverflowHiddenElements,u="function"==typeof c?c:function(e){return e!==c};if(!r(e))throw new TypeError("Invalid target");for(var d=document.scrollingElement||document.documentElement,p=[],h=e;r(h)&&u(h);){if((h=h.parentNode||h.host)===d){p.push(h);break}h===document.body&&o(h)&&!o(document.documentElement)||o(h,l)&&p.push(h)}for(var m=window.visualViewport?visualViewport.width:innerWidth,f=window.visualViewport?visualViewport.height:innerHeight,g=window.scrollX||pageXOffset,v=window.scrollY||pageYOffset,b=e.getBoundingClientRect(),y=b.height,j=b.width,w=b.top,x=b.right,k=b.bottom,E=b.left,C="start"===s||"nearest"===s?w:"end"===s?k:w+y/2,_="center"===a?E+j/2:"end"===a?x:E,S=[],R=0;R<p.length;R++){var N=p[R],O=N.getBoundingClientRect(),P=O.height,T=O.width,D=O.top,A=O.right,U=O.bottom,F=O.left;if("if-needed"===n&&w>=0&&E>=0&&k<=f&&x<=m&&w>=D&&k<=U&&E>=F&&x<=A)return S;var I=getComputedStyle(N),L=parseInt(I.borderLeftWidth,10),B=parseInt(I.borderTopWidth,10),M=parseInt(I.borderRightWidth,10),q=parseInt(I.borderBottomWidth,10),z=0,H=0,V="offsetWidth"in N?N.offsetWidth-N.clientWidth-L-M:0,W="offsetHeight"in N?N.offsetHeight-N.clientHeight-B-q:0;if(d===N)z="start"===s?C:"end"===s?C-f:"nearest"===s?i(v,v+f,f,B,q,v+C,v+C+y,y):C-f/2,H="start"===a?_:"center"===a?_-m/2:"end"===a?_-m:i(g,g+m,m,L,M,g+_,g+_+j,j),z=Math.max(0,z+v),H=Math.max(0,H+g);else{z="start"===s?C-D-B:"end"===s?C-U+q+W:"nearest"===s?i(D,U,P,B,q+W,C,C+y,y):C-(D+P/2)+W/2,H="start"===a?_-F-L:"center"===a?_-(F+T/2)+V/2:"end"===a?_-A+M+V:i(F,A,T,L,M+V,_,_+j,j);var $=N.scrollLeft,Y=N.scrollTop;z=Math.max(0,Math.min(Y+z,N.scrollHeight-P+W)),H=Math.max(0,Math.min($+H,N.scrollWidth-T+V)),C+=Y-z,_+=$-H}S.push({el:N,top:z,left:H})}return S}},"../node_modules/css-loader/index.js!../node_modules/less-loader/index.js!../node_modules/font-awesome-webpack/font-awesome-styles.loader.js!../node_modules/font-awesome-webpack/font-awesome.config.js":function(e,t,n){var r=n("../node_modules/css-loader/lib/url/escape.js");t=e.exports=n("../node_modules/css-loader/lib/css-base.js")(!1),t.push([e.i,'.fa-border {\n  padding: 0.2em 0.25em 0.15em;\n  border: solid 0.08em #eee;\n  border-radius: 0.1em;\n}\n.fa-pull-left {\n  float: left;\n}\n.fa-pull-right {\n  float: right;\n}\n.fa.fa-pull-left {\n  margin-right: 0.3em;\n}\n.fa.fa-pull-right {\n  margin-left: 0.3em;\n}\n/* Deprecated as of 4.4.0 */\n.pull-right {\n  float: right;\n}\n.pull-left {\n  float: left;\n}\n.fa.pull-left {\n  margin-right: 0.3em;\n}\n.fa.pull-right {\n  margin-left: 0.3em;\n}\n.fa {\n  display: inline-block;\n  font: normal normal normal 14px/1 FontAwesome;\n  font-size: inherit;\n  text-rendering: auto;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n.fa-fw {\n  width: 1.28571429em;\n  text-align: center;\n}\n/* Font Awesome uses the Unicode Private Use Area (PUA) to ensure screen\n   readers do not read off random characters that represent icons */\n.fa-glass:before {\n  content: "\\F000";\n}\n.fa-music:before {\n  content: "\\F001";\n}\n.fa-search:before {\n  content: "\\F002";\n}\n.fa-envelope-o:before {\n  content: "\\F003";\n}\n.fa-heart:before {\n  content: "\\F004";\n}\n.fa-star:before {\n  content: "\\F005";\n}\n.fa-star-o:before {\n  content: "\\F006";\n}\n.fa-user:before {\n  content: "\\F007";\n}\n.fa-film:before {\n  content: "\\F008";\n}\n.fa-th-large:before {\n  content: "\\F009";\n}\n.fa-th:before {\n  content: "\\F00A";\n}\n.fa-th-list:before {\n  content: "\\F00B";\n}\n.fa-check:before {\n  content: "\\F00C";\n}\n.fa-remove:before,\n.fa-close:before,\n.fa-times:before {\n  content: "\\F00D";\n}\n.fa-search-plus:before {\n  content: "\\F00E";\n}\n.fa-search-minus:before {\n  content: "\\F010";\n}\n.fa-power-off:before {\n  content: "\\F011";\n}\n.fa-signal:before {\n  content: "\\F012";\n}\n.fa-gear:before,\n.fa-cog:before {\n  content: "\\F013";\n}\n.fa-trash-o:before {\n  content: "\\F014";\n}\n.fa-home:before {\n  content: "\\F015";\n}\n.fa-file-o:before {\n  content: "\\F016";\n}\n.fa-clock-o:before {\n  content: "\\F017";\n}\n.fa-road:before {\n  content: "\\F018";\n}\n.fa-download:before {\n  content: "\\F019";\n}\n.fa-arrow-circle-o-down:before {\n  content: "\\F01A";\n}\n.fa-arrow-circle-o-up:before {\n  content: "\\F01B";\n}\n.fa-inbox:before {\n  content: "\\F01C";\n}\n.fa-play-circle-o:before {\n  content: "\\F01D";\n}\n.fa-rotate-right:before,\n.fa-repeat:before {\n  content: "\\F01E";\n}\n.fa-refresh:before {\n  content: "\\F021";\n}\n.fa-list-alt:before {\n  content: "\\F022";\n}\n.fa-lock:before {\n  content: "\\F023";\n}\n.fa-flag:before {\n  content: "\\F024";\n}\n.fa-headphones:before {\n  content: "\\F025";\n}\n.fa-volume-off:before {\n  content: "\\F026";\n}\n.fa-volume-down:before {\n  content: "\\F027";\n}\n.fa-volume-up:before {\n  content: "\\F028";\n}\n.fa-qrcode:before {\n  content: "\\F029";\n}\n.fa-barcode:before {\n  content: "\\F02A";\n}\n.fa-tag:before {\n  content: "\\F02B";\n}\n.fa-tags:before {\n  content: "\\F02C";\n}\n.fa-book:before {\n  content: "\\F02D";\n}\n.fa-bookmark:before {\n  content: "\\F02E";\n}\n.fa-print:before {\n  content: "\\F02F";\n}\n.fa-camera:before {\n  content: "\\F030";\n}\n.fa-font:before {\n  content: "\\F031";\n}\n.fa-bold:before {\n  content: "\\F032";\n}\n.fa-italic:before {\n  content: "\\F033";\n}\n.fa-text-height:before {\n  content: "\\F034";\n}\n.fa-text-width:before {\n  content: "\\F035";\n}\n.fa-align-left:before {\n  content: "\\F036";\n}\n.fa-align-center:before {\n  content: "\\F037";\n}\n.fa-align-right:before {\n  content: "\\F038";\n}\n.fa-align-justify:before {\n  content: "\\F039";\n}\n.fa-list:before {\n  content: "\\F03A";\n}\n.fa-dedent:before,\n.fa-outdent:before {\n  content: "\\F03B";\n}\n.fa-indent:before {\n  content: "\\F03C";\n}\n.fa-video-camera:before {\n  content: "\\F03D";\n}\n.fa-photo:before,\n.fa-image:before,\n.fa-picture-o:before {\n  content: "\\F03E";\n}\n.fa-pencil:before {\n  content: "\\F040";\n}\n.fa-map-marker:before {\n  content: "\\F041";\n}\n.fa-adjust:before {\n  content: "\\F042";\n}\n.fa-tint:before {\n  content: "\\F043";\n}\n.fa-edit:before,\n.fa-pencil-square-o:before {\n  content: "\\F044";\n}\n.fa-share-square-o:before {\n  content: "\\F045";\n}\n.fa-check-square-o:before {\n  content: "\\F046";\n}\n.fa-arrows:before {\n  content: "\\F047";\n}\n.fa-step-backward:before {\n  content: "\\F048";\n}\n.fa-fast-backward:before {\n  content: "\\F049";\n}\n.fa-backward:before {\n  content: "\\F04A";\n}\n.fa-play:before {\n  content: "\\F04B";\n}\n.fa-pause:before {\n  content: "\\F04C";\n}\n.fa-stop:before {\n  content: "\\F04D";\n}\n.fa-forward:before {\n  content: "\\F04E";\n}\n.fa-fast-forward:before {\n  content: "\\F050";\n}\n.fa-step-forward:before {\n  content: "\\F051";\n}\n.fa-eject:before {\n  content: "\\F052";\n}\n.fa-chevron-left:before {\n  content: "\\F053";\n}\n.fa-chevron-right:before {\n  content: "\\F054";\n}\n.fa-plus-circle:before {\n  content: "\\F055";\n}\n.fa-minus-circle:before {\n  content: "\\F056";\n}\n.fa-times-circle:before {\n  content: "\\F057";\n}\n.fa-check-circle:before {\n  content: "\\F058";\n}\n.fa-question-circle:before {\n  content: "\\F059";\n}\n.fa-info-circle:before {\n  content: "\\F05A";\n}\n.fa-crosshairs:before {\n  content: "\\F05B";\n}\n.fa-times-circle-o:before {\n  content: "\\F05C";\n}\n.fa-check-circle-o:before {\n  content: "\\F05D";\n}\n.fa-ban:before {\n  content: "\\F05E";\n}\n.fa-arrow-left:before {\n  content: "\\F060";\n}\n.fa-arrow-right:before {\n  content: "\\F061";\n}\n.fa-arrow-up:before {\n  content: "\\F062";\n}\n.fa-arrow-down:before {\n  content: "\\F063";\n}\n.fa-mail-forward:before,\n.fa-share:before {\n  content: "\\F064";\n}\n.fa-expand:before {\n  content: "\\F065";\n}\n.fa-compress:before {\n  content: "\\F066";\n}\n.fa-plus:before {\n  content: "\\F067";\n}\n.fa-minus:before {\n  content: "\\F068";\n}\n.fa-asterisk:before {\n  content: "\\F069";\n}\n.fa-exclamation-circle:before {\n  content: "\\F06A";\n}\n.fa-gift:before {\n  content: "\\F06B";\n}\n.fa-leaf:before {\n  content: "\\F06C";\n}\n.fa-fire:before {\n  content: "\\F06D";\n}\n.fa-eye:before {\n  content: "\\F06E";\n}\n.fa-eye-slash:before {\n  content: "\\F070";\n}\n.fa-warning:before,\n.fa-exclamation-triangle:before {\n  content: "\\F071";\n}\n.fa-plane:before {\n  content: "\\F072";\n}\n.fa-calendar:before {\n  content: "\\F073";\n}\n.fa-random:before {\n  content: "\\F074";\n}\n.fa-comment:before {\n  content: "\\F075";\n}\n.fa-magnet:before {\n  content: "\\F076";\n}\n.fa-chevron-up:before {\n  content: "\\F077";\n}\n.fa-chevron-down:before {\n  content: "\\F078";\n}\n.fa-retweet:before {\n  content: "\\F079";\n}\n.fa-shopping-cart:before {\n  content: "\\F07A";\n}\n.fa-folder:before {\n  content: "\\F07B";\n}\n.fa-folder-open:before {\n  content: "\\F07C";\n}\n.fa-arrows-v:before {\n  content: "\\F07D";\n}\n.fa-arrows-h:before {\n  content: "\\F07E";\n}\n.fa-bar-chart-o:before,\n.fa-bar-chart:before {\n  content: "\\F080";\n}\n.fa-twitter-square:before {\n  content: "\\F081";\n}\n.fa-facebook-square:before {\n  content: "\\F082";\n}\n.fa-camera-retro:before {\n  content: "\\F083";\n}\n.fa-key:before {\n  content: "\\F084";\n}\n.fa-gears:before,\n.fa-cogs:before {\n  content: "\\F085";\n}\n.fa-comments:before {\n  content: "\\F086";\n}\n.fa-thumbs-o-up:before {\n  content: "\\F087";\n}\n.fa-thumbs-o-down:before {\n  content: "\\F088";\n}\n.fa-star-half:before {\n  content: "\\F089";\n}\n.fa-heart-o:before {\n  content: "\\F08A";\n}\n.fa-sign-out:before {\n  content: "\\F08B";\n}\n.fa-linkedin-square:before {\n  content: "\\F08C";\n}\n.fa-thumb-tack:before {\n  content: "\\F08D";\n}\n.fa-external-link:before {\n  content: "\\F08E";\n}\n.fa-sign-in:before {\n  content: "\\F090";\n}\n.fa-trophy:before {\n  content: "\\F091";\n}\n.fa-github-square:before {\n  content: "\\F092";\n}\n.fa-upload:before {\n  content: "\\F093";\n}\n.fa-lemon-o:before {\n  content: "\\F094";\n}\n.fa-phone:before {\n  content: "\\F095";\n}\n.fa-square-o:before {\n  content: "\\F096";\n}\n.fa-bookmark-o:before {\n  content: "\\F097";\n}\n.fa-phone-square:before {\n  content: "\\F098";\n}\n.fa-twitter:before {\n  content: "\\F099";\n}\n.fa-facebook-f:before,\n.fa-facebook:before {\n  content: "\\F09A";\n}\n.fa-github:before {\n  content: "\\F09B";\n}\n.fa-unlock:before {\n  content: "\\F09C";\n}\n.fa-credit-card:before {\n  content: "\\F09D";\n}\n.fa-feed:before,\n.fa-rss:before {\n  content: "\\F09E";\n}\n.fa-hdd-o:before {\n  content: "\\F0A0";\n}\n.fa-bullhorn:before {\n  content: "\\F0A1";\n}\n.fa-bell:before {\n  content: "\\F0F3";\n}\n.fa-certificate:before {\n  content: "\\F0A3";\n}\n.fa-hand-o-right:before {\n  content: "\\F0A4";\n}\n.fa-hand-o-left:before {\n  content: "\\F0A5";\n}\n.fa-hand-o-up:before {\n  content: "\\F0A6";\n}\n.fa-hand-o-down:before {\n  content: "\\F0A7";\n}\n.fa-arrow-circle-left:before {\n  content: "\\F0A8";\n}\n.fa-arrow-circle-right:before {\n  content: "\\F0A9";\n}\n.fa-arrow-circle-up:before {\n  content: "\\F0AA";\n}\n.fa-arrow-circle-down:before {\n  content: "\\F0AB";\n}\n.fa-globe:before {\n  content: "\\F0AC";\n}\n.fa-wrench:before {\n  content: "\\F0AD";\n}\n.fa-tasks:before {\n  content: "\\F0AE";\n}\n.fa-filter:before {\n  content: "\\F0B0";\n}\n.fa-briefcase:before {\n  content: "\\F0B1";\n}\n.fa-arrows-alt:before {\n  content: "\\F0B2";\n}\n.fa-group:before,\n.fa-users:before {\n  content: "\\F0C0";\n}\n.fa-chain:before,\n.fa-link:before {\n  content: "\\F0C1";\n}\n.fa-cloud:before {\n  content: "\\F0C2";\n}\n.fa-flask:before {\n  content: "\\F0C3";\n}\n.fa-cut:before,\n.fa-scissors:before {\n  content: "\\F0C4";\n}\n.fa-copy:before,\n.fa-files-o:before {\n  content: "\\F0C5";\n}\n.fa-paperclip:before {\n  content: "\\F0C6";\n}\n.fa-save:before,\n.fa-floppy-o:before {\n  content: "\\F0C7";\n}\n.fa-square:before {\n  content: "\\F0C8";\n}\n.fa-navicon:before,\n.fa-reorder:before,\n.fa-bars:before {\n  content: "\\F0C9";\n}\n.fa-list-ul:before {\n  content: "\\F0CA";\n}\n.fa-list-ol:before {\n  content: "\\F0CB";\n}\n.fa-strikethrough:before {\n  content: "\\F0CC";\n}\n.fa-underline:before {\n  content: "\\F0CD";\n}\n.fa-table:before {\n  content: "\\F0CE";\n}\n.fa-magic:before {\n  content: "\\F0D0";\n}\n.fa-truck:before {\n  content: "\\F0D1";\n}\n.fa-pinterest:before {\n  content: "\\F0D2";\n}\n.fa-pinterest-square:before {\n  content: "\\F0D3";\n}\n.fa-google-plus-square:before {\n  content: "\\F0D4";\n}\n.fa-google-plus:before {\n  content: "\\F0D5";\n}\n.fa-money:before {\n  content: "\\F0D6";\n}\n.fa-caret-down:before {\n  content: "\\F0D7";\n}\n.fa-caret-up:before {\n  content: "\\F0D8";\n}\n.fa-caret-left:before {\n  content: "\\F0D9";\n}\n.fa-caret-right:before {\n  content: "\\F0DA";\n}\n.fa-columns:before {\n  content: "\\F0DB";\n}\n.fa-unsorted:before,\n.fa-sort:before {\n  content: "\\F0DC";\n}\n.fa-sort-down:before,\n.fa-sort-desc:before {\n  content: "\\F0DD";\n}\n.fa-sort-up:before,\n.fa-sort-asc:before {\n  content: "\\F0DE";\n}\n.fa-envelope:before {\n  content: "\\F0E0";\n}\n.fa-linkedin:before {\n  content: "\\F0E1";\n}\n.fa-rotate-left:before,\n.fa-undo:before {\n  content: "\\F0E2";\n}\n.fa-legal:before,\n.fa-gavel:before {\n  content: "\\F0E3";\n}\n.fa-dashboard:before,\n.fa-tachometer:before {\n  content: "\\F0E4";\n}\n.fa-comment-o:before {\n  content: "\\F0E5";\n}\n.fa-comments-o:before {\n  content: "\\F0E6";\n}\n.fa-flash:before,\n.fa-bolt:before {\n  content: "\\F0E7";\n}\n.fa-sitemap:before {\n  content: "\\F0E8";\n}\n.fa-umbrella:before {\n  content: "\\F0E9";\n}\n.fa-paste:before,\n.fa-clipboard:before {\n  content: "\\F0EA";\n}\n.fa-lightbulb-o:before {\n  content: "\\F0EB";\n}\n.fa-exchange:before {\n  content: "\\F0EC";\n}\n.fa-cloud-download:before {\n  content: "\\F0ED";\n}\n.fa-cloud-upload:before {\n  content: "\\F0EE";\n}\n.fa-user-md:before {\n  content: "\\F0F0";\n}\n.fa-stethoscope:before {\n  content: "\\F0F1";\n}\n.fa-suitcase:before {\n  content: "\\F0F2";\n}\n.fa-bell-o:before {\n  content: "\\F0A2";\n}\n.fa-coffee:before {\n  content: "\\F0F4";\n}\n.fa-cutlery:before {\n  content: "\\F0F5";\n}\n.fa-file-text-o:before {\n  content: "\\F0F6";\n}\n.fa-building-o:before {\n  content: "\\F0F7";\n}\n.fa-hospital-o:before {\n  content: "\\F0F8";\n}\n.fa-ambulance:before {\n  content: "\\F0F9";\n}\n.fa-medkit:before {\n  content: "\\F0FA";\n}\n.fa-fighter-jet:before {\n  content: "\\F0FB";\n}\n.fa-beer:before {\n  content: "\\F0FC";\n}\n.fa-h-square:before {\n  content: "\\F0FD";\n}\n.fa-plus-square:before {\n  content: "\\F0FE";\n}\n.fa-angle-double-left:before {\n  content: "\\F100";\n}\n.fa-angle-double-right:before {\n  content: "\\F101";\n}\n.fa-angle-double-up:before {\n  content: "\\F102";\n}\n.fa-angle-double-down:before {\n  content: "\\F103";\n}\n.fa-angle-left:before {\n  content: "\\F104";\n}\n.fa-angle-right:before {\n  content: "\\F105";\n}\n.fa-angle-up:before {\n  content: "\\F106";\n}\n.fa-angle-down:before {\n  content: "\\F107";\n}\n.fa-desktop:before {\n  content: "\\F108";\n}\n.fa-laptop:before {\n  content: "\\F109";\n}\n.fa-tablet:before {\n  content: "\\F10A";\n}\n.fa-mobile-phone:before,\n.fa-mobile:before {\n  content: "\\F10B";\n}\n.fa-circle-o:before {\n  content: "\\F10C";\n}\n.fa-quote-left:before {\n  content: "\\F10D";\n}\n.fa-quote-right:before {\n  content: "\\F10E";\n}\n.fa-spinner:before {\n  content: "\\F110";\n}\n.fa-circle:before {\n  content: "\\F111";\n}\n.fa-mail-reply:before,\n.fa-reply:before {\n  content: "\\F112";\n}\n.fa-github-alt:before {\n  content: "\\F113";\n}\n.fa-folder-o:before {\n  content: "\\F114";\n}\n.fa-folder-open-o:before {\n  content: "\\F115";\n}\n.fa-smile-o:before {\n  content: "\\F118";\n}\n.fa-frown-o:before {\n  content: "\\F119";\n}\n.fa-meh-o:before {\n  content: "\\F11A";\n}\n.fa-gamepad:before {\n  content: "\\F11B";\n}\n.fa-keyboard-o:before {\n  content: "\\F11C";\n}\n.fa-flag-o:before {\n  content: "\\F11D";\n}\n.fa-flag-checkered:before {\n  content: "\\F11E";\n}\n.fa-terminal:before {\n  content: "\\F120";\n}\n.fa-code:before {\n  content: "\\F121";\n}\n.fa-mail-reply-all:before,\n.fa-reply-all:before {\n  content: "\\F122";\n}\n.fa-star-half-empty:before,\n.fa-star-half-full:before,\n.fa-star-half-o:before {\n  content: "\\F123";\n}\n.fa-location-arrow:before {\n  content: "\\F124";\n}\n.fa-crop:before {\n  content: "\\F125";\n}\n.fa-code-fork:before {\n  content: "\\F126";\n}\n.fa-unlink:before,\n.fa-chain-broken:before {\n  content: "\\F127";\n}\n.fa-question:before {\n  content: "\\F128";\n}\n.fa-info:before {\n  content: "\\F129";\n}\n.fa-exclamation:before {\n  content: "\\F12A";\n}\n.fa-superscript:before {\n  content: "\\F12B";\n}\n.fa-subscript:before {\n  content: "\\F12C";\n}\n.fa-eraser:before {\n  content: "\\F12D";\n}\n.fa-puzzle-piece:before {\n  content: "\\F12E";\n}\n.fa-microphone:before {\n  content: "\\F130";\n}\n.fa-microphone-slash:before {\n  content: "\\F131";\n}\n.fa-shield:before {\n  content: "\\F132";\n}\n.fa-calendar-o:before {\n  content: "\\F133";\n}\n.fa-fire-extinguisher:before {\n  content: "\\F134";\n}\n.fa-rocket:before {\n  content: "\\F135";\n}\n.fa-maxcdn:before {\n  content: "\\F136";\n}\n.fa-chevron-circle-left:before {\n  content: "\\F137";\n}\n.fa-chevron-circle-right:before {\n  content: "\\F138";\n}\n.fa-chevron-circle-up:before {\n  content: "\\F139";\n}\n.fa-chevron-circle-down:before {\n  content: "\\F13A";\n}\n.fa-html5:before {\n  content: "\\F13B";\n}\n.fa-css3:before {\n  content: "\\F13C";\n}\n.fa-anchor:before {\n  content: "\\F13D";\n}\n.fa-unlock-alt:before {\n  content: "\\F13E";\n}\n.fa-bullseye:before {\n  content: "\\F140";\n}\n.fa-ellipsis-h:before {\n  content: "\\F141";\n}\n.fa-ellipsis-v:before {\n  content: "\\F142";\n}\n.fa-rss-square:before {\n  content: "\\F143";\n}\n.fa-play-circle:before {\n  content: "\\F144";\n}\n.fa-ticket:before {\n  content: "\\F145";\n}\n.fa-minus-square:before {\n  content: "\\F146";\n}\n.fa-minus-square-o:before {\n  content: "\\F147";\n}\n.fa-level-up:before {\n  content: "\\F148";\n}\n.fa-level-down:before {\n  content: "\\F149";\n}\n.fa-check-square:before {\n  content: "\\F14A";\n}\n.fa-pencil-square:before {\n  content: "\\F14B";\n}\n.fa-external-link-square:before {\n  content: "\\F14C";\n}\n.fa-share-square:before {\n  content: "\\F14D";\n}\n.fa-compass:before {\n  content: "\\F14E";\n}\n.fa-toggle-down:before,\n.fa-caret-square-o-down:before {\n  content: "\\F150";\n}\n.fa-toggle-up:before,\n.fa-caret-square-o-up:before {\n  content: "\\F151";\n}\n.fa-toggle-right:before,\n.fa-caret-square-o-right:before {\n  content: "\\F152";\n}\n.fa-euro:before,\n.fa-eur:before {\n  content: "\\F153";\n}\n.fa-gbp:before {\n  content: "\\F154";\n}\n.fa-dollar:before,\n.fa-usd:before {\n  content: "\\F155";\n}\n.fa-rupee:before,\n.fa-inr:before {\n  content: "\\F156";\n}\n.fa-cny:before,\n.fa-rmb:before,\n.fa-yen:before,\n.fa-jpy:before {\n  content: "\\F157";\n}\n.fa-ruble:before,\n.fa-rouble:before,\n.fa-rub:before {\n  content: "\\F158";\n}\n.fa-won:before,\n.fa-krw:before {\n  content: "\\F159";\n}\n.fa-bitcoin:before,\n.fa-btc:before {\n  content: "\\F15A";\n}\n.fa-file:before {\n  content: "\\F15B";\n}\n.fa-file-text:before {\n  content: "\\F15C";\n}\n.fa-sort-alpha-asc:before {\n  content: "\\F15D";\n}\n.fa-sort-alpha-desc:before {\n  content: "\\F15E";\n}\n.fa-sort-amount-asc:before {\n  content: "\\F160";\n}\n.fa-sort-amount-desc:before {\n  content: "\\F161";\n}\n.fa-sort-numeric-asc:before {\n  content: "\\F162";\n}\n.fa-sort-numeric-desc:before {\n  content: "\\F163";\n}\n.fa-thumbs-up:before {\n  content: "\\F164";\n}\n.fa-thumbs-down:before {\n  content: "\\F165";\n}\n.fa-youtube-square:before {\n  content: "\\F166";\n}\n.fa-youtube:before {\n  content: "\\F167";\n}\n.fa-xing:before {\n  content: "\\F168";\n}\n.fa-xing-square:before {\n  content: "\\F169";\n}\n.fa-youtube-play:before {\n  content: "\\F16A";\n}\n.fa-dropbox:before {\n  content: "\\F16B";\n}\n.fa-stack-overflow:before {\n  content: "\\F16C";\n}\n.fa-instagram:before {\n  content: "\\F16D";\n}\n.fa-flickr:before {\n  content: "\\F16E";\n}\n.fa-adn:before {\n  content: "\\F170";\n}\n.fa-bitbucket:before {\n  content: "\\F171";\n}\n.fa-bitbucket-square:before {\n  content: "\\F172";\n}\n.fa-tumblr:before {\n  content: "\\F173";\n}\n.fa-tumblr-square:before {\n  content: "\\F174";\n}\n.fa-long-arrow-down:before {\n  content: "\\F175";\n}\n.fa-long-arrow-up:before {\n  content: "\\F176";\n}\n.fa-long-arrow-left:before {\n  content: "\\F177";\n}\n.fa-long-arrow-right:before {\n  content: "\\F178";\n}\n.fa-apple:before {\n  content: "\\F179";\n}\n.fa-windows:before {\n  content: "\\F17A";\n}\n.fa-android:before {\n  content: "\\F17B";\n}\n.fa-linux:before {\n  content: "\\F17C";\n}\n.fa-dribbble:before {\n  content: "\\F17D";\n}\n.fa-skype:before {\n  content: "\\F17E";\n}\n.fa-foursquare:before {\n  content: "\\F180";\n}\n.fa-trello:before {\n  content: "\\F181";\n}\n.fa-female:before {\n  content: "\\F182";\n}\n.fa-male:before {\n  content: "\\F183";\n}\n.fa-gittip:before,\n.fa-gratipay:before {\n  content: "\\F184";\n}\n.fa-sun-o:before {\n  content: "\\F185";\n}\n.fa-moon-o:before {\n  content: "\\F186";\n}\n.fa-archive:before {\n  content: "\\F187";\n}\n.fa-bug:before {\n  content: "\\F188";\n}\n.fa-vk:before {\n  content: "\\F189";\n}\n.fa-weibo:before {\n  content: "\\F18A";\n}\n.fa-renren:before {\n  content: "\\F18B";\n}\n.fa-pagelines:before {\n  content: "\\F18C";\n}\n.fa-stack-exchange:before {\n  content: "\\F18D";\n}\n.fa-arrow-circle-o-right:before {\n  content: "\\F18E";\n}\n.fa-arrow-circle-o-left:before {\n  content: "\\F190";\n}\n.fa-toggle-left:before,\n.fa-caret-square-o-left:before {\n  content: "\\F191";\n}\n.fa-dot-circle-o:before {\n  content: "\\F192";\n}\n.fa-wheelchair:before {\n  content: "\\F193";\n}\n.fa-vimeo-square:before {\n  content: "\\F194";\n}\n.fa-turkish-lira:before,\n.fa-try:before {\n  content: "\\F195";\n}\n.fa-plus-square-o:before {\n  content: "\\F196";\n}\n.fa-space-shuttle:before {\n  content: "\\F197";\n}\n.fa-slack:before {\n  content: "\\F198";\n}\n.fa-envelope-square:before {\n  content: "\\F199";\n}\n.fa-wordpress:before {\n  content: "\\F19A";\n}\n.fa-openid:before {\n  content: "\\F19B";\n}\n.fa-institution:before,\n.fa-bank:before,\n.fa-university:before {\n  content: "\\F19C";\n}\n.fa-mortar-board:before,\n.fa-graduation-cap:before {\n  content: "\\F19D";\n}\n.fa-yahoo:before {\n  content: "\\F19E";\n}\n.fa-google:before {\n  content: "\\F1A0";\n}\n.fa-reddit:before {\n  content: "\\F1A1";\n}\n.fa-reddit-square:before {\n  content: "\\F1A2";\n}\n.fa-stumbleupon-circle:before {\n  content: "\\F1A3";\n}\n.fa-stumbleupon:before {\n  content: "\\F1A4";\n}\n.fa-delicious:before {\n  content: "\\F1A5";\n}\n.fa-digg:before {\n  content: "\\F1A6";\n}\n.fa-pied-piper-pp:before {\n  content: "\\F1A7";\n}\n.fa-pied-piper-alt:before {\n  content: "\\F1A8";\n}\n.fa-drupal:before {\n  content: "\\F1A9";\n}\n.fa-joomla:before {\n  content: "\\F1AA";\n}\n.fa-language:before {\n  content: "\\F1AB";\n}\n.fa-fax:before {\n  content: "\\F1AC";\n}\n.fa-building:before {\n  content: "\\F1AD";\n}\n.fa-child:before {\n  content: "\\F1AE";\n}\n.fa-paw:before {\n  content: "\\F1B0";\n}\n.fa-spoon:before {\n  content: "\\F1B1";\n}\n.fa-cube:before {\n  content: "\\F1B2";\n}\n.fa-cubes:before {\n  content: "\\F1B3";\n}\n.fa-behance:before {\n  content: "\\F1B4";\n}\n.fa-behance-square:before {\n  content: "\\F1B5";\n}\n.fa-steam:before {\n  content: "\\F1B6";\n}\n.fa-steam-square:before {\n  content: "\\F1B7";\n}\n.fa-recycle:before {\n  content: "\\F1B8";\n}\n.fa-automobile:before,\n.fa-car:before {\n  content: "\\F1B9";\n}\n.fa-cab:before,\n.fa-taxi:before {\n  content: "\\F1BA";\n}\n.fa-tree:before {\n  content: "\\F1BB";\n}\n.fa-spotify:before {\n  content: "\\F1BC";\n}\n.fa-deviantart:before {\n  content: "\\F1BD";\n}\n.fa-soundcloud:before {\n  content: "\\F1BE";\n}\n.fa-database:before {\n  content: "\\F1C0";\n}\n.fa-file-pdf-o:before {\n  content: "\\F1C1";\n}\n.fa-file-word-o:before {\n  content: "\\F1C2";\n}\n.fa-file-excel-o:before {\n  content: "\\F1C3";\n}\n.fa-file-powerpoint-o:before {\n  content: "\\F1C4";\n}\n.fa-file-photo-o:before,\n.fa-file-picture-o:before,\n.fa-file-image-o:before {\n  content: "\\F1C5";\n}\n.fa-file-zip-o:before,\n.fa-file-archive-o:before {\n  content: "\\F1C6";\n}\n.fa-file-sound-o:before,\n.fa-file-audio-o:before {\n  content: "\\F1C7";\n}\n.fa-file-movie-o:before,\n.fa-file-video-o:before {\n  content: "\\F1C8";\n}\n.fa-file-code-o:before {\n  content: "\\F1C9";\n}\n.fa-vine:before {\n  content: "\\F1CA";\n}\n.fa-codepen:before {\n  content: "\\F1CB";\n}\n.fa-jsfiddle:before {\n  content: "\\F1CC";\n}\n.fa-life-bouy:before,\n.fa-life-buoy:before,\n.fa-life-saver:before,\n.fa-support:before,\n.fa-life-ring:before {\n  content: "\\F1CD";\n}\n.fa-circle-o-notch:before {\n  content: "\\F1CE";\n}\n.fa-ra:before,\n.fa-resistance:before,\n.fa-rebel:before {\n  content: "\\F1D0";\n}\n.fa-ge:before,\n.fa-empire:before {\n  content: "\\F1D1";\n}\n.fa-git-square:before {\n  content: "\\F1D2";\n}\n.fa-git:before {\n  content: "\\F1D3";\n}\n.fa-y-combinator-square:before,\n.fa-yc-square:before,\n.fa-hacker-news:before {\n  content: "\\F1D4";\n}\n.fa-tencent-weibo:before {\n  content: "\\F1D5";\n}\n.fa-qq:before {\n  content: "\\F1D6";\n}\n.fa-wechat:before,\n.fa-weixin:before {\n  content: "\\F1D7";\n}\n.fa-send:before,\n.fa-paper-plane:before {\n  content: "\\F1D8";\n}\n.fa-send-o:before,\n.fa-paper-plane-o:before {\n  content: "\\F1D9";\n}\n.fa-history:before {\n  content: "\\F1DA";\n}\n.fa-circle-thin:before {\n  content: "\\F1DB";\n}\n.fa-header:before {\n  content: "\\F1DC";\n}\n.fa-paragraph:before {\n  content: "\\F1DD";\n}\n.fa-sliders:before {\n  content: "\\F1DE";\n}\n.fa-share-alt:before {\n  content: "\\F1E0";\n}\n.fa-share-alt-square:before {\n  content: "\\F1E1";\n}\n.fa-bomb:before {\n  content: "\\F1E2";\n}\n.fa-soccer-ball-o:before,\n.fa-futbol-o:before {\n  content: "\\F1E3";\n}\n.fa-tty:before {\n  content: "\\F1E4";\n}\n.fa-binoculars:before {\n  content: "\\F1E5";\n}\n.fa-plug:before {\n  content: "\\F1E6";\n}\n.fa-slideshare:before {\n  content: "\\F1E7";\n}\n.fa-twitch:before {\n  content: "\\F1E8";\n}\n.fa-yelp:before {\n  content: "\\F1E9";\n}\n.fa-newspaper-o:before {\n  content: "\\F1EA";\n}\n.fa-wifi:before {\n  content: "\\F1EB";\n}\n.fa-calculator:before {\n  content: "\\F1EC";\n}\n.fa-paypal:before {\n  content: "\\F1ED";\n}\n.fa-google-wallet:before {\n  content: "\\F1EE";\n}\n.fa-cc-visa:before {\n  content: "\\F1F0";\n}\n.fa-cc-mastercard:before {\n  content: "\\F1F1";\n}\n.fa-cc-discover:before {\n  content: "\\F1F2";\n}\n.fa-cc-amex:before {\n  content: "\\F1F3";\n}\n.fa-cc-paypal:before {\n  content: "\\F1F4";\n}\n.fa-cc-stripe:before {\n  content: "\\F1F5";\n}\n.fa-bell-slash:before {\n  content: "\\F1F6";\n}\n.fa-bell-slash-o:before {\n  content: "\\F1F7";\n}\n.fa-trash:before {\n  content: "\\F1F8";\n}\n.fa-copyright:before {\n  content: "\\F1F9";\n}\n.fa-at:before {\n  content: "\\F1FA";\n}\n.fa-eyedropper:before {\n  content: "\\F1FB";\n}\n.fa-paint-brush:before {\n  content: "\\F1FC";\n}\n.fa-birthday-cake:before {\n  content: "\\F1FD";\n}\n.fa-area-chart:before {\n  content: "\\F1FE";\n}\n.fa-pie-chart:before {\n  content: "\\F200";\n}\n.fa-line-chart:before {\n  content: "\\F201";\n}\n.fa-lastfm:before {\n  content: "\\F202";\n}\n.fa-lastfm-square:before {\n  content: "\\F203";\n}\n.fa-toggle-off:before {\n  content: "\\F204";\n}\n.fa-toggle-on:before {\n  content: "\\F205";\n}\n.fa-bicycle:before {\n  content: "\\F206";\n}\n.fa-bus:before {\n  content: "\\F207";\n}\n.fa-ioxhost:before {\n  content: "\\F208";\n}\n.fa-angellist:before {\n  content: "\\F209";\n}\n.fa-cc:before {\n  content: "\\F20A";\n}\n.fa-shekel:before,\n.fa-sheqel:before,\n.fa-ils:before {\n  content: "\\F20B";\n}\n.fa-meanpath:before {\n  content: "\\F20C";\n}\n.fa-buysellads:before {\n  content: "\\F20D";\n}\n.fa-connectdevelop:before {\n  content: "\\F20E";\n}\n.fa-dashcube:before {\n  content: "\\F210";\n}\n.fa-forumbee:before {\n  content: "\\F211";\n}\n.fa-leanpub:before {\n  content: "\\F212";\n}\n.fa-sellsy:before {\n  content: "\\F213";\n}\n.fa-shirtsinbulk:before {\n  content: "\\F214";\n}\n.fa-simplybuilt:before {\n  content: "\\F215";\n}\n.fa-skyatlas:before {\n  content: "\\F216";\n}\n.fa-cart-plus:before {\n  content: "\\F217";\n}\n.fa-cart-arrow-down:before {\n  content: "\\F218";\n}\n.fa-diamond:before {\n  content: "\\F219";\n}\n.fa-ship:before {\n  content: "\\F21A";\n}\n.fa-user-secret:before {\n  content: "\\F21B";\n}\n.fa-motorcycle:before {\n  content: "\\F21C";\n}\n.fa-street-view:before {\n  content: "\\F21D";\n}\n.fa-heartbeat:before {\n  content: "\\F21E";\n}\n.fa-venus:before {\n  content: "\\F221";\n}\n.fa-mars:before {\n  content: "\\F222";\n}\n.fa-mercury:before {\n  content: "\\F223";\n}\n.fa-intersex:before,\n.fa-transgender:before {\n  content: "\\F224";\n}\n.fa-transgender-alt:before {\n  content: "\\F225";\n}\n.fa-venus-double:before {\n  content: "\\F226";\n}\n.fa-mars-double:before {\n  content: "\\F227";\n}\n.fa-venus-mars:before {\n  content: "\\F228";\n}\n.fa-mars-stroke:before {\n  content: "\\F229";\n}\n.fa-mars-stroke-v:before {\n  content: "\\F22A";\n}\n.fa-mars-stroke-h:before {\n  content: "\\F22B";\n}\n.fa-neuter:before {\n  content: "\\F22C";\n}\n.fa-genderless:before {\n  content: "\\F22D";\n}\n.fa-facebook-official:before {\n  content: "\\F230";\n}\n.fa-pinterest-p:before {\n  content: "\\F231";\n}\n.fa-whatsapp:before {\n  content: "\\F232";\n}\n.fa-server:before {\n  content: "\\F233";\n}\n.fa-user-plus:before {\n  content: "\\F234";\n}\n.fa-user-times:before {\n  content: "\\F235";\n}\n.fa-hotel:before,\n.fa-bed:before {\n  content: "\\F236";\n}\n.fa-viacoin:before {\n  content: "\\F237";\n}\n.fa-train:before {\n  content: "\\F238";\n}\n.fa-subway:before {\n  content: "\\F239";\n}\n.fa-medium:before {\n  content: "\\F23A";\n}\n.fa-yc:before,\n.fa-y-combinator:before {\n  content: "\\F23B";\n}\n.fa-optin-monster:before {\n  content: "\\F23C";\n}\n.fa-opencart:before {\n  content: "\\F23D";\n}\n.fa-expeditedssl:before {\n  content: "\\F23E";\n}\n.fa-battery-4:before,\n.fa-battery:before,\n.fa-battery-full:before {\n  content: "\\F240";\n}\n.fa-battery-3:before,\n.fa-battery-three-quarters:before {\n  content: "\\F241";\n}\n.fa-battery-2:before,\n.fa-battery-half:before {\n  content: "\\F242";\n}\n.fa-battery-1:before,\n.fa-battery-quarter:before {\n  content: "\\F243";\n}\n.fa-battery-0:before,\n.fa-battery-empty:before {\n  content: "\\F244";\n}\n.fa-mouse-pointer:before {\n  content: "\\F245";\n}\n.fa-i-cursor:before {\n  content: "\\F246";\n}\n.fa-object-group:before {\n  content: "\\F247";\n}\n.fa-object-ungroup:before {\n  content: "\\F248";\n}\n.fa-sticky-note:before {\n  content: "\\F249";\n}\n.fa-sticky-note-o:before {\n  content: "\\F24A";\n}\n.fa-cc-jcb:before {\n  content: "\\F24B";\n}\n.fa-cc-diners-club:before {\n  content: "\\F24C";\n}\n.fa-clone:before {\n  content: "\\F24D";\n}\n.fa-balance-scale:before {\n  content: "\\F24E";\n}\n.fa-hourglass-o:before {\n  content: "\\F250";\n}\n.fa-hourglass-1:before,\n.fa-hourglass-start:before {\n  content: "\\F251";\n}\n.fa-hourglass-2:before,\n.fa-hourglass-half:before {\n  content: "\\F252";\n}\n.fa-hourglass-3:before,\n.fa-hourglass-end:before {\n  content: "\\F253";\n}\n.fa-hourglass:before {\n  content: "\\F254";\n}\n.fa-hand-grab-o:before,\n.fa-hand-rock-o:before {\n  content: "\\F255";\n}\n.fa-hand-stop-o:before,\n.fa-hand-paper-o:before {\n  content: "\\F256";\n}\n.fa-hand-scissors-o:before {\n  content: "\\F257";\n}\n.fa-hand-lizard-o:before {\n  content: "\\F258";\n}\n.fa-hand-spock-o:before {\n  content: "\\F259";\n}\n.fa-hand-pointer-o:before {\n  content: "\\F25A";\n}\n.fa-hand-peace-o:before {\n  content: "\\F25B";\n}\n.fa-trademark:before {\n  content: "\\F25C";\n}\n.fa-registered:before {\n  content: "\\F25D";\n}\n.fa-creative-commons:before {\n  content: "\\F25E";\n}\n.fa-gg:before {\n  content: "\\F260";\n}\n.fa-gg-circle:before {\n  content: "\\F261";\n}\n.fa-tripadvisor:before {\n  content: "\\F262";\n}\n.fa-odnoklassniki:before {\n  content: "\\F263";\n}\n.fa-odnoklassniki-square:before {\n  content: "\\F264";\n}\n.fa-get-pocket:before {\n  content: "\\F265";\n}\n.fa-wikipedia-w:before {\n  content: "\\F266";\n}\n.fa-safari:before {\n  content: "\\F267";\n}\n.fa-chrome:before {\n  content: "\\F268";\n}\n.fa-firefox:before {\n  content: "\\F269";\n}\n.fa-opera:before {\n  content: "\\F26A";\n}\n.fa-internet-explorer:before {\n  content: "\\F26B";\n}\n.fa-tv:before,\n.fa-television:before {\n  content: "\\F26C";\n}\n.fa-contao:before {\n  content: "\\F26D";\n}\n.fa-500px:before {\n  content: "\\F26E";\n}\n.fa-amazon:before {\n  content: "\\F270";\n}\n.fa-calendar-plus-o:before {\n  content: "\\F271";\n}\n.fa-calendar-minus-o:before {\n  content: "\\F272";\n}\n.fa-calendar-times-o:before {\n  content: "\\F273";\n}\n.fa-calendar-check-o:before {\n  content: "\\F274";\n}\n.fa-industry:before {\n  content: "\\F275";\n}\n.fa-map-pin:before {\n  content: "\\F276";\n}\n.fa-map-signs:before {\n  content: "\\F277";\n}\n.fa-map-o:before {\n  content: "\\F278";\n}\n.fa-map:before {\n  content: "\\F279";\n}\n.fa-commenting:before {\n  content: "\\F27A";\n}\n.fa-commenting-o:before {\n  content: "\\F27B";\n}\n.fa-houzz:before {\n  content: "\\F27C";\n}\n.fa-vimeo:before {\n  content: "\\F27D";\n}\n.fa-black-tie:before {\n  content: "\\F27E";\n}\n.fa-fonticons:before {\n  content: "\\F280";\n}\n.fa-reddit-alien:before {\n  content: "\\F281";\n}\n.fa-edge:before {\n  content: "\\F282";\n}\n.fa-credit-card-alt:before {\n  content: "\\F283";\n}\n.fa-codiepie:before {\n  content: "\\F284";\n}\n.fa-modx:before {\n  content: "\\F285";\n}\n.fa-fort-awesome:before {\n  content: "\\F286";\n}\n.fa-usb:before {\n  content: "\\F287";\n}\n.fa-product-hunt:before {\n  content: "\\F288";\n}\n.fa-mixcloud:before {\n  content: "\\F289";\n}\n.fa-scribd:before {\n  content: "\\F28A";\n}\n.fa-pause-circle:before {\n  content: "\\F28B";\n}\n.fa-pause-circle-o:before {\n  content: "\\F28C";\n}\n.fa-stop-circle:before {\n  content: "\\F28D";\n}\n.fa-stop-circle-o:before {\n  content: "\\F28E";\n}\n.fa-shopping-bag:before {\n  content: "\\F290";\n}\n.fa-shopping-basket:before {\n  content: "\\F291";\n}\n.fa-hashtag:before {\n  content: "\\F292";\n}\n.fa-bluetooth:before {\n  content: "\\F293";\n}\n.fa-bluetooth-b:before {\n  content: "\\F294";\n}\n.fa-percent:before {\n  content: "\\F295";\n}\n.fa-gitlab:before {\n  content: "\\F296";\n}\n.fa-wpbeginner:before {\n  content: "\\F297";\n}\n.fa-wpforms:before {\n  content: "\\F298";\n}\n.fa-envira:before {\n  content: "\\F299";\n}\n.fa-universal-access:before {\n  content: "\\F29A";\n}\n.fa-wheelchair-alt:before {\n  content: "\\F29B";\n}\n.fa-question-circle-o:before {\n  content: "\\F29C";\n}\n.fa-blind:before {\n  content: "\\F29D";\n}\n.fa-audio-description:before {\n  content: "\\F29E";\n}\n.fa-volume-control-phone:before {\n  content: "\\F2A0";\n}\n.fa-braille:before {\n  content: "\\F2A1";\n}\n.fa-assistive-listening-systems:before {\n  content: "\\F2A2";\n}\n.fa-asl-interpreting:before,\n.fa-american-sign-language-interpreting:before {\n  content: "\\F2A3";\n}\n.fa-deafness:before,\n.fa-hard-of-hearing:before,\n.fa-deaf:before {\n  content: "\\F2A4";\n}\n.fa-glide:before {\n  content: "\\F2A5";\n}\n.fa-glide-g:before {\n  content: "\\F2A6";\n}\n.fa-signing:before,\n.fa-sign-language:before {\n  content: "\\F2A7";\n}\n.fa-low-vision:before {\n  content: "\\F2A8";\n}\n.fa-viadeo:before {\n  content: "\\F2A9";\n}\n.fa-viadeo-square:before {\n  content: "\\F2AA";\n}\n.fa-snapchat:before {\n  content: "\\F2AB";\n}\n.fa-snapchat-ghost:before {\n  content: "\\F2AC";\n}\n.fa-snapchat-square:before {\n  content: "\\F2AD";\n}\n.fa-pied-piper:before {\n  content: "\\F2AE";\n}\n.fa-first-order:before {\n  content: "\\F2B0";\n}\n.fa-yoast:before {\n  content: "\\F2B1";\n}\n.fa-themeisle:before {\n  content: "\\F2B2";\n}\n.fa-google-plus-circle:before,\n.fa-google-plus-official:before {\n  content: "\\F2B3";\n}\n.fa-fa:before,\n.fa-font-awesome:before {\n  content: "\\F2B4";\n}\n.fa-handshake-o:before {\n  content: "\\F2B5";\n}\n.fa-envelope-open:before {\n  content: "\\F2B6";\n}\n.fa-envelope-open-o:before {\n  content: "\\F2B7";\n}\n.fa-linode:before {\n  content: "\\F2B8";\n}\n.fa-address-book:before {\n  content: "\\F2B9";\n}\n.fa-address-book-o:before {\n  content: "\\F2BA";\n}\n.fa-vcard:before,\n.fa-address-card:before {\n  content: "\\F2BB";\n}\n.fa-vcard-o:before,\n.fa-address-card-o:before {\n  content: "\\F2BC";\n}\n.fa-user-circle:before {\n  content: "\\F2BD";\n}\n.fa-user-circle-o:before {\n  content: "\\F2BE";\n}\n.fa-user-o:before {\n  content: "\\F2C0";\n}\n.fa-id-badge:before {\n  content: "\\F2C1";\n}\n.fa-drivers-license:before,\n.fa-id-card:before {\n  content: "\\F2C2";\n}\n.fa-drivers-license-o:before,\n.fa-id-card-o:before {\n  content: "\\F2C3";\n}\n.fa-quora:before {\n  content: "\\F2C4";\n}\n.fa-free-code-camp:before {\n  content: "\\F2C5";\n}\n.fa-telegram:before {\n  content: "\\F2C6";\n}\n.fa-thermometer-4:before,\n.fa-thermometer:before,\n.fa-thermometer-full:before {\n  content: "\\F2C7";\n}\n.fa-thermometer-3:before,\n.fa-thermometer-three-quarters:before {\n  content: "\\F2C8";\n}\n.fa-thermometer-2:before,\n.fa-thermometer-half:before {\n  content: "\\F2C9";\n}\n.fa-thermometer-1:before,\n.fa-thermometer-quarter:before {\n  content: "\\F2CA";\n}\n.fa-thermometer-0:before,\n.fa-thermometer-empty:before {\n  content: "\\F2CB";\n}\n.fa-shower:before {\n  content: "\\F2CC";\n}\n.fa-bathtub:before,\n.fa-s15:before,\n.fa-bath:before {\n  content: "\\F2CD";\n}\n.fa-podcast:before {\n  content: "\\F2CE";\n}\n.fa-window-maximize:before {\n  content: "\\F2D0";\n}\n.fa-window-minimize:before {\n  content: "\\F2D1";\n}\n.fa-window-restore:before {\n  content: "\\F2D2";\n}\n.fa-times-rectangle:before,\n.fa-window-close:before {\n  content: "\\F2D3";\n}\n.fa-times-rectangle-o:before,\n.fa-window-close-o:before {\n  content: "\\F2D4";\n}\n.fa-bandcamp:before {\n  content: "\\F2D5";\n}\n.fa-grav:before {\n  content: "\\F2D6";\n}\n.fa-etsy:before {\n  content: "\\F2D7";\n}\n.fa-imdb:before {\n  content: "\\F2D8";\n}\n.fa-ravelry:before {\n  content: "\\F2D9";\n}\n.fa-eercast:before {\n  content: "\\F2DA";\n}\n.fa-microchip:before {\n  content: "\\F2DB";\n}\n.fa-snowflake-o:before {\n  content: "\\F2DC";\n}\n.fa-superpowers:before {\n  content: "\\F2DD";\n}\n.fa-wpexplorer:before {\n  content: "\\F2DE";\n}\n.fa-meetup:before {\n  content: "\\F2E0";\n}\n/* makes the font 33% larger relative to the icon container */\n.fa-lg {\n  font-size: 1.33333333em;\n  line-height: 0.75em;\n  vertical-align: -15%;\n}\n.fa-2x {\n  font-size: 2em;\n}\n.fa-3x {\n  font-size: 3em;\n}\n.fa-4x {\n  font-size: 4em;\n}\n.fa-5x {\n  font-size: 5em;\n}\n.fa-ul {\n  padding-left: 0;\n  margin-left: 2.14285714em;\n  list-style-type: none;\n}\n.fa-ul > li {\n  position: relative;\n}\n.fa-li {\n  position: absolute;\n  left: -2.14285714em;\n  width: 2.14285714em;\n  top: 0.14285714em;\n  text-align: center;\n}\n.fa-li.fa-lg {\n  left: -1.85714286em;\n}\n/* FONT PATH\n * -------------------------- */\n@font-face {\n  font-family: \'FontAwesome\';\n  src: url('+r(n("../node_modules/font-awesome/fonts/fontawesome-webfont.eot?v=4.7.0"))+");\n  src: url("+r(n("../node_modules/font-awesome/fonts/fontawesome-webfont.eot"))+"?#iefix&v=4.7.0) format('embedded-opentype'), url("+r(n("../node_modules/font-awesome/fonts/fontawesome-webfont.woff2?v=4.7.0"))+") format('woff2'), url("+r(n("../node_modules/font-awesome/fonts/fontawesome-webfont.woff?v=4.7.0"))+") format('woff'), url("+r(n("../node_modules/font-awesome/fonts/fontawesome-webfont.ttf?v=4.7.0"))+") format('truetype'), url("+r(n("../node_modules/font-awesome/fonts/fontawesome-webfont.svg?v=4.7.0"))+'#fontawesomeregular) format(\'svg\');\n  font-weight: normal;\n  font-style: normal;\n}\n.fa-rotate-90 {\n  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=1)";\n  -webkit-transform: rotate(90deg);\n  -ms-transform: rotate(90deg);\n  transform: rotate(90deg);\n}\n.fa-rotate-180 {\n  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=2)";\n  -webkit-transform: rotate(180deg);\n  -ms-transform: rotate(180deg);\n  transform: rotate(180deg);\n}\n.fa-rotate-270 {\n  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=3)";\n  -webkit-transform: rotate(270deg);\n  -ms-transform: rotate(270deg);\n  transform: rotate(270deg);\n}\n.fa-flip-horizontal {\n  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=0, mirror=1)";\n  -webkit-transform: scale(-1, 1);\n  -ms-transform: scale(-1, 1);\n  transform: scale(-1, 1);\n}\n.fa-flip-vertical {\n  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)";\n  -webkit-transform: scale(1, -1);\n  -ms-transform: scale(1, -1);\n  transform: scale(1, -1);\n}\n:root .fa-rotate-90,\n:root .fa-rotate-180,\n:root .fa-rotate-270,\n:root .fa-flip-horizontal,\n:root .fa-flip-vertical {\n  filter: none;\n}\n.fa-spin {\n  -webkit-animation: fa-spin 2s infinite linear;\n  animation: fa-spin 2s infinite linear;\n}\n.fa-pulse {\n  -webkit-animation: fa-spin 1s infinite steps(8);\n  animation: fa-spin 1s infinite steps(8);\n}\n@-webkit-keyframes fa-spin {\n  0% {\n    -webkit-transform: rotate(0deg);\n    transform: rotate(0deg);\n  }\n  100% {\n    -webkit-transform: rotate(359deg);\n    transform: rotate(359deg);\n  }\n}\n@keyframes fa-spin {\n  0% {\n    -webkit-transform: rotate(0deg);\n    transform: rotate(0deg);\n  }\n  100% {\n    -webkit-transform: rotate(359deg);\n    transform: rotate(359deg);\n  }\n}\n.fa-stack {\n  position: relative;\n  display: inline-block;\n  width: 2em;\n  height: 2em;\n  line-height: 2em;\n  vertical-align: middle;\n}\n.fa-stack-1x,\n.fa-stack-2x {\n  position: absolute;\n  left: 0;\n  width: 100%;\n  text-align: center;\n}\n.fa-stack-1x {\n  line-height: inherit;\n}\n.fa-stack-2x {\n  font-size: 2em;\n}\n.fa-inverse {\n  color: #fff;\n}\n',""])},"../node_modules/css-loader/lib/css-base.js":function(e,t){function n(e,t){var n=e[1]||"",s=e[3];if(!s)return n;if(t&&"function"==typeof btoa){var o=r(s);return[n].concat(s.sources.map(function(e){return"/*# sourceURL="+s.sourceRoot+e+" */"})).concat([o]).join("\n")}return[n].join("\n")}function r(e){return"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(e))))+" */"}e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var r=n(t,e);return t[2]?"@media "+t[2]+"{"+r+"}":r}).join("")},t.i=function(e,n){"string"==typeof e&&(e=[[null,e,""]]);for(var r={},s=0;s<this.length;s++){var o=this[s][0];"number"==typeof o&&(r[o]=!0)}for(s=0;s<e.length;s++){var i=e[s];"number"==typeof i[0]&&r[i[0]]||(n&&!i[2]?i[2]=n:n&&(i[2]="("+i[2]+") and ("+n+")"),t.push(i))}},t}},"../node_modules/css-loader/lib/url/escape.js":function(e,t){e.exports=function(e){return"string"!=typeof e?e:(/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),/["'() \t\n]/.test(e)?'"'+e.replace(/"/g,'\\"').replace(/\n/g,"\\n")+'"':e)}},"../node_modules/file-loader/index.js!../assets/speaker.svg":function(e,t,n){e.exports=n.p+"a35c7db833cd86e54c0020a2d07dcd2f.svg"},"../node_modules/font-awesome-webpack/index.js":function(e,t,n){n("../node_modules/style-loader/index.js!../node_modules/css-loader/index.js!../node_modules/less-loader/index.js!../node_modules/font-awesome-webpack/font-awesome-styles.loader.js!../node_modules/font-awesome-webpack/font-awesome.config.js")},"../node_modules/font-awesome/fonts/fontawesome-webfont.eot":function(e,t,n){e.exports=n.p+"674f50d287a8c48dc19ba404d20fe713.eot"},"../node_modules/font-awesome/fonts/fontawesome-webfont.eot?v=4.7.0":function(e,t,n){e.exports=n.p+"674f50d287a8c48dc19ba404d20fe713.eot"},"../node_modules/font-awesome/fonts/fontawesome-webfont.svg?v=4.7.0":function(e,t,n){e.exports=n.p+"912ec66d7572ff821749319396470bde.svg"},"../node_modules/font-awesome/fonts/fontawesome-webfont.ttf?v=4.7.0":function(e,t,n){e.exports=n.p+"b06871f281fee6b241d60582ae9369b9.ttf"},"../node_modules/font-awesome/fonts/fontawesome-webfont.woff2?v=4.7.0":function(e,t,n){e.exports=n.p+"af7ae505a9eed503f8b8e6982036873e.woff2"},"../node_modules/font-awesome/fonts/fontawesome-webfont.woff?v=4.7.0":function(e,t,n){e.exports=n.p+"fee66e712a8a08eef5805a46892932ad.woff"},"../node_modules/is-promise/index.js":function(e,t){function n(e){return!!e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof e.then}e.exports=n},"../node_modules/lru-queue/index.js":function(e,t,n){"use strict";var r=n("../../common/node_modules/es5-ext/number/to-pos-integer.js"),s=Object.create,o=Object.prototype.hasOwnProperty;e.exports=function(e){var t,n=0,i=1,a=s(null),c=s(null),l=0;return e=r(e),{hit:function(r){var s=c[r],u=++l;if(a[u]=r,c[r]=u,!s){if(++n<=e)return;return r=a[i],t(r),r}if(delete a[s],i===s)for(;!o.call(a,++i);)continue},delete:t=function(e){var t=c[e];if(t&&(delete a[t],delete c[e],--n,i===t)){if(!n)return l=0,void(i=1);for(;!o.call(a,++i);)continue}},clear:function(){n=0,i=1,a=s(null),c=s(null),l=0}}}},"../node_modules/memoizee/ext/async.js":function(e,t,n){"use strict";var r=n("../../common/node_modules/es5-ext/array/from/index.js"),s=n("../../common/node_modules/es5-ext/object/map.js"),o=n("../../common/node_modules/es5-ext/object/mixin.js"),i=n("../../common/node_modules/es5-ext/function/_define-length.js"),a=n("../../common/node_modules/next-tick/index.js"),c=Array.prototype.slice,l=Function.prototype.apply,u=Object.create;n("../node_modules/memoizee/lib/registered-extensions.js").async=function(e,t){var n,d,p,h=u(null),m=u(null),f=t.memoized,g=t.original;t.memoized=i(function(e){var t=arguments,r=t[t.length-1];return"function"==typeof r&&(n=r,t=c.call(t,0,-1)),f.apply(d=this,p=t)},f);try{o(t.memoized,f)}catch(e){}t.on("get",function(e){var r,s,o;if(n){if(h[e])return"function"==typeof h[e]?h[e]=[h[e],n]:h[e].push(n),void(n=null);r=n,s=d,o=p,n=d=p=null,a(function(){var i;hasOwnProperty.call(m,e)?(i=m[e],t.emit("getasync",e,o,s),l.call(r,i.context,i.args)):(n=r,d=s,p=o,f.apply(s,o))})}}),t.original=function(){var e,s,o,i;return n?(e=r(arguments),s=function e(n){var s,o,c=e.id;return null==c?void a(l.bind(e,this,arguments)):(delete e.id,s=h[c],delete h[c],s?(o=r(arguments),t.has(c)&&(n?t.delete(c):(m[c]={context:this,args:o},t.emit("setasync",c,"function"==typeof s?1:s.length))),"function"==typeof s?i=l.call(s,this,o):s.forEach(function(e){i=l.call(e,this,o)},this),i):void 0)},o=n,n=d=p=null,e.push(s),i=l.call(g,this,e),s.cb=o,n=s,i):l.call(g,this,arguments)},t.on("set",function(e){if(!n)return void t.delete(e);h[e]?"function"==typeof h[e]?h[e]=[h[e],n.cb]:h[e].push(n.cb):h[e]=n.cb,delete n.cb,n.id=e,n=null}),t.on("delete",function(e){var n;hasOwnProperty.call(h,e)||m[e]&&(n=m[e],delete m[e],t.emit("deleteasync",e,c.call(n.args,1)))}),t.on("clear",function(){var e=m;m=u(null),t.emit("clearasync",s(e,function(e){return c.call(e.args,1)}))})}},"../node_modules/memoizee/ext/dispose.js":function(e,t,n){"use strict";var r=n("../../common/node_modules/es5-ext/object/valid-callable.js"),s=n("../../common/node_modules/es5-ext/object/for-each.js"),o=n("../node_modules/memoizee/lib/registered-extensions.js"),i=Function.prototype.apply;o.dispose=function(e,t,n){var a;if(r(e),n.async&&o.async||n.promise&&o.promise)return t.on("deleteasync",a=function(t,n){i.call(e,null,n)}),void t.on("clearasync",function(e){s(e,function(e,t){a(t,e)})});t.on("delete",a=function(t,n){e(n)}),t.on("clear",function(e){s(e,function(e,t){a(t,e)})})}},"../node_modules/memoizee/ext/max-age.js":function(e,t,n){"use strict";var r=n("../../common/node_modules/es5-ext/array/from/index.js"),s=n("../../common/node_modules/es5-ext/object/for-each.js"),o=n("../../common/node_modules/next-tick/index.js"),i=n("../node_modules/is-promise/index.js"),a=n("../node_modules/timers-ext/valid-timeout.js"),c=n("../node_modules/memoizee/lib/registered-extensions.js"),l=Function.prototype,u=Math.max,d=Math.min,p=Object.create;c.maxAge=function(e,t,n){var h,m,f,g;(e=a(e))&&(h=p(null),m=n.async&&c.async||n.promise&&c.promise?"async":"",t.on("set"+m,function(n){h[n]=setTimeout(function(){t.delete(n)},e),"function"==typeof h[n].unref&&h[n].unref(),g&&(g[n]&&"nextTick"!==g[n]&&clearTimeout(g[n]),g[n]=setTimeout(function(){delete g[n]},f),"function"==typeof g[n].unref&&g[n].unref())}),t.on("delete"+m,function(e){clearTimeout(h[e]),delete h[e],g&&("nextTick"!==g[e]&&clearTimeout(g[e]),delete g[e])}),n.preFetch&&(f=!0===n.preFetch||isNaN(n.preFetch)?.333:u(d(Number(n.preFetch),1),0))&&(g={},f=(1-f)*e,t.on("get"+m,function(e,s,a){g[e]||(g[e]="nextTick",o(function(){var o;"nextTick"===g[e]&&(delete g[e],t.delete(e),n.async&&(s=r(s),s.push(l)),o=t.memoized.apply(a,s),n.promise&&i(o)&&("function"==typeof o.done?o.done(l,l):o.then(l,l)))}))})),t.on("clear"+m,function(){s(h,function(e){clearTimeout(e)}),h={},g&&(s(g,function(e){"nextTick"!==e&&clearTimeout(e)}),g={})}))}},"../node_modules/memoizee/ext/max.js":function(e,t,n){"use strict";var r=n("../../common/node_modules/es5-ext/number/to-pos-integer.js"),s=n("../node_modules/lru-queue/index.js"),o=n("../node_modules/memoizee/lib/registered-extensions.js");o.max=function(e,t,n){var i,a,c;(e=r(e))&&(a=s(e),i=n.async&&o.async||n.promise&&o.promise?"async":"",t.on("set"+i,c=function(e){void 0!==(e=a.hit(e))&&t.delete(e)}),t.on("get"+i,c),t.on("delete"+i,a.delete),t.on("clear"+i,a.clear))}},"../node_modules/memoizee/ext/promise.js":function(e,t,n){"use strict";var r=n("../../common/node_modules/es5-ext/object/map.js"),s=n("../../common/node_modules/es5-ext/object/primitive-set.js"),o=n("../../common/node_modules/es5-ext/object/validate-stringifiable-value.js"),i=n("../../common/node_modules/es5-ext/to-short-string-representation.js"),a=n("../node_modules/is-promise/index.js"),c=n("../../common/node_modules/next-tick/index.js"),l=Object.create,u=s("then","then:finally","done","done:finally");n("../node_modules/memoizee/lib/registered-extensions.js").promise=function(e,t){var n=l(null),s=l(null),d=l(null);if(!0===e)e=null;else if(e=o(e),!u[e])throw new TypeError("'"+i(e)+"' is not valid promise mode");t.on("set",function(r,o,i){var l=!1;if(!a(i))return s[r]=i,void t.emit("setasync",r,1);n[r]=1,d[r]=i;var u=function(e){var o=n[r];if(l)throw new Error("Memoizee error: Detected unordered then|done & finally resolution, which in turn makes proper detection of success/failure impossible (when in 'done:finally' mode)\nConsider to rely on 'then' or 'done' mode instead.");o&&(delete n[r],s[r]=e,t.emit("setasync",r,o))},p=function(){l=!0,n[r]&&(delete n[r],delete d[r],t.delete(r))},h=e;if(h||(h="then"),"then"===h)i.then(function(e){c(u.bind(this,e))},function(){c(p)});else if("done"===h){if("function"!=typeof i.done)throw new Error("Memoizee error: Retrieved promise does not implement 'done' in 'done' mode");i.done(u,p)}else if("done:finally"===h){if("function"!=typeof i.done)throw new Error("Memoizee error: Retrieved promise does not implement 'done' in 'done:finally' mode");if("function"!=typeof i.finally)throw new Error("Memoizee error: Retrieved promise does not implement 'finally' in 'done:finally' mode");i.done(u),i.finally(p)}}),t.on("get",function(e,r,s){var o;if(n[e])return void++n[e];o=d[e];var i=function(){t.emit("getasync",e,r,s)};a(o)?"function"==typeof o.done?o.done(i):o.then(function(){c(i)}):i()}),t.on("delete",function(e){if(delete d[e],n[e])return void delete n[e];if(hasOwnProperty.call(s,e)){var r=s[e];delete s[e],t.emit("deleteasync",e,[r])}}),t.on("clear",function(){var e=s;s=l(null),n=l(null),d=l(null),t.emit("clearasync",r(e,function(e){return[e]}))})}},"../node_modules/memoizee/ext/ref-counter.js":function(e,t,n){"use strict";var r=n("../../common/node_modules/d/index.js"),s=n("../node_modules/memoizee/lib/registered-extensions.js"),o=Object.create,i=Object.defineProperties;s.refCounter=function(e,t,n){var a,c;a=o(null),c=n.async&&s.async||n.promise&&s.promise?"async":"",t.on("set"+c,function(e,t){a[e]=t||1}),t.on("get"+c,function(e){++a[e]}),t.on("delete"+c,function(e){delete a[e]}),t.on("clear"+c,function(){a={}}),i(t.memoized,{deleteRef:r(function(){var e=t.get(arguments);return null===e?null:a[e]?!--a[e]&&(t.delete(e),!0):null}),getRefCount:r(function(){var e=t.get(arguments);return null===e?0:a[e]?a[e]:0})})}},"../node_modules/memoizee/index.js":function(e,t,n){"use strict";var r=n("../../common/node_modules/es5-ext/object/normalize-options.js"),s=n("../node_modules/memoizee/lib/resolve-length.js"),o=n("../node_modules/memoizee/plain.js");e.exports=function(e){var t,i=r(arguments[1]);return i.normalizer||0!==(t=i.length=s(i.length,e.length,i.async))&&(i.primitive?!1===t?i.normalizer=n("../node_modules/memoizee/normalizers/primitive.js"):t>1&&(i.normalizer=n("../node_modules/memoizee/normalizers/get-primitive-fixed.js")(t)):i.normalizer=!1===t?n("../node_modules/memoizee/normalizers/get.js")():1===t?n("../node_modules/memoizee/normalizers/get-1.js")():n("../node_modules/memoizee/normalizers/get-fixed.js")(t)),i.async&&n("../node_modules/memoizee/ext/async.js"),i.promise&&n("../node_modules/memoizee/ext/promise.js"),i.dispose&&n("../node_modules/memoizee/ext/dispose.js"),i.maxAge&&n("../node_modules/memoizee/ext/max-age.js"),i.max&&n("../node_modules/memoizee/ext/max.js"),i.refCounter&&n("../node_modules/memoizee/ext/ref-counter.js"),o(e,i)}},"../node_modules/memoizee/lib/configure-map.js":function(e,t,n){"use strict";var r=n("../../common/node_modules/es5-ext/error/custom.js"),s=n("../../common/node_modules/es5-ext/function/_define-length.js"),o=n("../../common/node_modules/d/index.js"),i=n("../../common/node_modules/event-emitter/index.js").methods,a=n("../node_modules/memoizee/lib/resolve-resolve.js"),c=n("../node_modules/memoizee/lib/resolve-normalize.js"),l=Function.prototype.apply,u=Function.prototype.call,d=Object.create,p=Object.defineProperties,h=i.on,m=i.emit;e.exports=function(e,t,n){var i,f,g,v,b,y,j,w,x,k,E,C,_,S,R,N=d(null);return f=!1!==t?t:isNaN(e.length)?1:e.length,n.normalizer&&(k=c(n.normalizer),g=k.get,v=k.set,b=k.delete,y=k.clear),null!=n.resolvers&&(R=a(n.resolvers)),S=g?s(function(t){var n,s,o=arguments;if(R&&(o=R(o)),null!==(n=g(o))&&hasOwnProperty.call(N,n))return E&&i.emit("get",n,o,this),N[n];if(s=1===o.length?u.call(e,this,o[0]):l.call(e,this,o),null===n){if(null!==(n=g(o)))throw r("Circular invocation","CIRCULAR_INVOCATION");n=v(o)}else if(hasOwnProperty.call(N,n))throw r("Circular invocation","CIRCULAR_INVOCATION");return N[n]=s,C&&i.emit("set",n,null,s),s},f):0===t?function(){var t;if(hasOwnProperty.call(N,"data"))return E&&i.emit("get","data",arguments,this),N.data;if(t=arguments.length?l.call(e,this,arguments):u.call(e,this),hasOwnProperty.call(N,"data"))throw r("Circular invocation","CIRCULAR_INVOCATION");return N.data=t,C&&i.emit("set","data",null,t),t}:function(t){var n,s,o=arguments;if(R&&(o=R(arguments)),s=String(o[0]),hasOwnProperty.call(N,s))return E&&i.emit("get",s,o,this),N[s];if(n=1===o.length?u.call(e,this,o[0]):l.call(e,this,o),hasOwnProperty.call(N,s))throw r("Circular invocation","CIRCULAR_INVOCATION");return N[s]=n,C&&i.emit("set",s,null,n),n},i={original:e,memoized:S,profileName:n.profileName,get:function(e){return R&&(e=R(e)),g?g(e):String(e[0])},has:function(e){return hasOwnProperty.call(N,e)},delete:function(e){var t;hasOwnProperty.call(N,e)&&(b&&b(e),t=N[e],delete N[e],_&&i.emit("delete",e,t))},clear:function(){var e=N;y&&y(),N=d(null),i.emit("clear",e)},on:function(e,t){return"get"===e?E=!0:"set"===e?C=!0:"delete"===e&&(_=!0),h.call(this,e,t)},emit:m,updateEnv:function(){e=i.original}},j=g?s(function(e){var t,n=arguments;R&&(n=R(n)),null!==(t=g(n))&&i.delete(t)},f):0===t?function(){return i.delete("data")}:function(e){return R&&(e=R(arguments)[0]),i.delete(e)},w=s(function(){var e,n=arguments;return 0===t?N.data:(R&&(n=R(n)),e=g?g(n):String(n[0]),N[e])}),x=s(function(){var e,n=arguments;return 0===t?i.has("data"):(R&&(n=R(n)),null!==(e=g?g(n):String(n[0]))&&i.has(e))}),p(S,{__memoized__:o(!0),delete:o(j),clear:o(i.clear),_get:o(w),_has:o(x)}),i}},"../node_modules/memoizee/lib/registered-extensions.js":function(e,t,n){"use strict"},"../node_modules/memoizee/lib/resolve-length.js":function(e,t,n){"use strict";var r=n("../../common/node_modules/es5-ext/number/to-pos-integer.js");e.exports=function(e,t,n){var s;return isNaN(e)?(s=t,s>=0?n&&s?s-1:s:1):!1!==e&&r(e)}},"../node_modules/memoizee/lib/resolve-normalize.js":function(e,t,n){"use strict";var r=n("../../common/node_modules/es5-ext/object/valid-callable.js");e.exports=function(e){var t;return"function"==typeof e?{set:e,get:e}:(t={get:r(e.get)},void 0!==e.set?(t.set=r(e.set),e.delete&&(t.delete=r(e.delete)),e.clear&&(t.clear=r(e.clear)),t):(t.set=t.get,t))}},"../node_modules/memoizee/lib/resolve-resolve.js":function(e,t,n){"use strict";var r,s=n("../../common/node_modules/es5-ext/array/to-array.js"),o=n("../../common/node_modules/es5-ext/object/is-value.js"),i=n("../../common/node_modules/es5-ext/object/valid-callable.js"),a=Array.prototype.slice;r=function(e){return this.map(function(t,n){return t?t(e[n]):e[n]}).concat(a.call(e,this.length))},e.exports=function(e){return e=s(e),e.forEach(function(e){o(e)&&i(e)}),r.bind(e)}},"../node_modules/memoizee/lib/weak.js":function(e,t,n){"use strict";var r=n("../../common/node_modules/es5-ext/error/custom.js"),s=n("../../common/node_modules/es5-ext/function/_define-length.js"),o=n("../../common/node_modules/es5-ext/function/#/partial.js"),i=n("../../common/node_modules/es5-ext/object/copy.js"),a=n("../../common/node_modules/es5-ext/object/normalize-options.js"),c=n("../../common/node_modules/es5-ext/object/valid-callable.js"),l=n("../../common/node_modules/d/index.js"),u=n("../../common/node_modules/es6-weak-map/index.js"),d=n("../node_modules/memoizee/lib/resolve-length.js"),p=n("../node_modules/memoizee/lib/registered-extensions.js"),h=n("../node_modules/memoizee/lib/resolve-resolve.js"),m=n("../node_modules/memoizee/lib/resolve-normalize.js"),f=Array.prototype.slice,g=Object.defineProperties;e.exports=function(e){return function(t){var n,v,b,y,j,w=a(arguments[1]);return c(t),hasOwnProperty.call(t,"__memoized__")&&!w.force?t:(v=d(w.length,t.length,w.async&&p.async),w.length=v?v-1:0,n=new u,w.resolvers&&(y=h(w.resolvers)),w.normalizer&&(j=m(w.normalizer)),1!==v||j||w.async||w.dispose||w.maxAge||w.max||w.refCounter?(b=g(s(function(r){var s,a=arguments;return y&&(a=y(a),r=a[0]),s=n.get(r),s||(j&&(w=i(w),w.normalizer=i(j),w.normalizer.get=o.call(w.normalizer.get,r),w.normalizer.set=o.call(w.normalizer.set,r),w.normalizer.delete&&(w.normalizer.delete=o.call(w.normalizer.delete,r))),n.set(r,s=e(o.call(t,r),w))),s.apply(this,f.call(a,1))},v),{__memoized__:l(!0),delete:l(s(function(e){var t,r=arguments;y&&(r=y(r),e=r[0]),(t=n.get(e))&&t.delete.apply(this,f.call(r,1))},v))}),w.refCounter?(g(b,{deleteRef:l(s(function(e){var t,r=arguments;return y&&(r=y(r),e=r[0]),t=n.get(e),t?t.deleteRef.apply(this,f.call(r,1)):null},v)),getRefCount:l(s(function(e){var t,r=arguments;return y&&(r=y(r),e=r[0]),t=n.get(e),t?t.getRefCount.apply(this,f.call(r,1)):0},v))}),b):b):g(function(e){var s,o=arguments;if(y&&(o=y(o)),e=o[0],n.has(e))return n.get(e);if(s=t.apply(this,o),n.has(e))throw r("Circular invocation","CIRCULAR_INVOCATION");return n.set(e,s),s},{__memoized__:l(!0),delete:l(function(e){return y&&(e=y(arguments)[0]),n.delete(e)})}))}}},"../node_modules/memoizee/normalizers/get-1.js":function(e,t,n){"use strict";var r=n("../../common/node_modules/es5-ext/array/#/e-index-of.js");e.exports=function(){var e=0,t=[],n=[];return{get:function(e){var s=r.call(t,e[0]);return-1===s?null:n[s]},set:function(r){return t.push(r[0]),n.push(++e),e},delete:function(e){var s=r.call(n,e);-1!==s&&(t.splice(s,1),n.splice(s,1))},clear:function(){t=[],n=[]}}}},"../node_modules/memoizee/normalizers/get-fixed.js":function(e,t,n){"use strict";var r=n("../../common/node_modules/es5-ext/array/#/e-index-of.js"),s=Object.create;e.exports=function(e){var t=0,n=[[],[]],o=s(null);return{get:function(t){for(var s,o=0,i=n;o<e-1;){if(-1===(s=r.call(i[0],t[o])))return null;i=i[1][s],++o}return s=r.call(i[0],t[o]),-1===s?null:i[1][s]||null},set:function(s){for(var i,a=0,c=n;a<e-1;)i=r.call(c[0],s[a]),-1===i&&(i=c[0].push(s[a])-1,c[1].push([[],[]])),c=c[1][i],++a;return i=r.call(c[0],s[a]),-1===i&&(i=c[0].push(s[a])-1),c[1][i]=++t,o[t]=s,t},delete:function(t){for(var s,i=0,a=n,c=[],l=o[t];i<e-1;){if(-1===(s=r.call(a[0],l[i])))return;c.push(a,s),a=a[1][s],++i}if(-1!==(s=r.call(a[0],l[i]))){for(t=a[1][s],a[0].splice(s,1),a[1].splice(s,1);!a[0].length&&c.length;)s=c.pop(),a=c.pop(),a[0].splice(s,1),a[1].splice(s,1);delete o[t]}},clear:function(){n=[[],[]],o=s(null)}}}},"../node_modules/memoizee/normalizers/get-primitive-fixed.js":function(e,t,n){"use strict";e.exports=function(e){return e?function(t){for(var n=String(t[0]),r=0,s=e;--s;)n+=""+t[++r];return n}:function(){return""}}},"../node_modules/memoizee/normalizers/get.js":function(e,t,n){"use strict";var r=n("../../common/node_modules/es5-ext/array/#/e-index-of.js"),s=Object.create;e.exports=function(){var e=0,t=[],n=s(null);return{get:function(e){var n,s=0,o=t,i=e.length;if(0===i)return o[i]||null;if(o=o[i]){for(;s<i-1;){if(-1===(n=r.call(o[0],e[s])))return null;o=o[1][n],++s}return n=r.call(o[0],e[s]),-1===n?null:o[1][n]||null}return null},set:function(s){var o,i=0,a=t,c=s.length;if(0===c)a[c]=++e;else{for(a[c]||(a[c]=[[],[]]),a=a[c];i<c-1;)o=r.call(a[0],s[i]),-1===o&&(o=a[0].push(s[i])-1,a[1].push([[],[]])),a=a[1][o],++i;o=r.call(a[0],s[i]),-1===o&&(o=a[0].push(s[i])-1),a[1][o]=++e}return n[e]=s,e},delete:function(e){var s,o=0,i=t,a=n[e],c=a.length,l=[];if(0===c)delete i[c];else if(i=i[c]){for(;o<c-1;){if(-1===(s=r.call(i[0],a[o])))return;l.push(i,s),i=i[1][s],++o}if(-1===(s=r.call(i[0],a[o])))return;for(e=i[1][s],i[0].splice(s,1),i[1].splice(s,1);!i[0].length&&l.length;)s=l.pop(),i=l.pop(),i[0].splice(s,1),i[1].splice(s,1)}delete n[e]},clear:function(){t=[],n=s(null)}}}},"../node_modules/memoizee/normalizers/primitive.js":function(e,t,n){"use strict";e.exports=function(e){var t,n,r=e.length;if(!r)return"";for(t=String(e[n=0]);--r;)t+=""+e[++n];return t}},"../node_modules/memoizee/plain.js":function(e,t,n){"use strict";var r=n("../../common/node_modules/es5-ext/object/valid-callable.js"),s=n("../../common/node_modules/es5-ext/object/for-each.js"),o=n("../node_modules/memoizee/lib/registered-extensions.js"),i=n("../node_modules/memoizee/lib/configure-map.js"),a=n("../node_modules/memoizee/lib/resolve-length.js");e.exports=function e(t){var n,c,l;if(r(t),n=Object(arguments[1]),n.async&&n.promise)throw new Error("Options 'async' and 'promise' cannot be used together");return hasOwnProperty.call(t,"__memoized__")&&!n.force?t:(c=a(n.length,t.length,n.async&&o.async),l=i(t,c,n),s(o,function(e,t){n[t]&&e(n[t],l,n)}),e.__profiler__&&e.__profiler__(l),l.updateEnv(),l.memoized)}},"../node_modules/memoizee/weak.js":function(e,t,n){"use strict";e.exports=n("../node_modules/memoizee/lib/weak.js")(n("../node_modules/memoizee/index.js"))},"../node_modules/octicons/build/svg/file-text.svg":function(e,t,n){function r(e){return s.createElement("svg",e,s.createElement("path",{d:"M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"}))}var s=n("../../common/node_modules/react/react.js");r.displayName="FileText",r.defaultProps={viewBox:"0 0 12 16"},e.exports=r,r.default=r},"../node_modules/octicons/build/svg/git-branch.svg":function(e,t,n){function r(e){return s.createElement("svg",e,s.createElement("path",{fillRule:"evenodd",d:"M10 5c0-1.11-.89-2-2-2a1.993 1.993 0 0 0-1 3.72v.3c-.02.52-.23.98-.63 1.38-.4.4-.86.61-1.38.63-.83.02-1.48.16-2 .45V4.72a1.993 1.993 0 0 0-1-3.72C.88 1 0 1.89 0 3a2 2 0 0 0 1 1.72v6.56c-.59.35-1 .99-1 1.72 0 1.11.89 2 2 2 1.11 0 2-.89 2-2 0-.53-.2-1-.53-1.36.09-.06.48-.41.59-.47.25-.11.56-.17.94-.17 1.05-.05 1.95-.45 2.75-1.25S8.95 7.77 9 6.73h-.02C9.59 6.37 10 5.73 10 5zM2 1.8c.66 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2C1.35 4.2.8 3.65.8 3c0-.65.55-1.2 1.2-1.2zm0 12.41c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zm6-8c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2z"}))}var s=n("../../common/node_modules/react/react.js");r.displayName="GitBranch",r.defaultProps={viewBox:"0 0 10 16"},e.exports=r,r.default=r},"../node_modules/octicons/build/svg/git-merge.svg":function(e,t,n){function r(e){return s.createElement("svg",e,s.createElement("path",{fillRule:"evenodd",d:"M10 7c-.73 0-1.38.41-1.73 1.02V8C7.22 7.98 6 7.64 5.14 6.98c-.75-.58-1.5-1.61-1.89-2.44A1.993 1.993 0 0 0 2 .99C.89.99 0 1.89 0 3a2 2 0 0 0 1 1.72v6.56c-.59.35-1 .99-1 1.72 0 1.11.89 2 2 2a1.993 1.993 0 0 0 1-3.72V7.67c.67.7 1.44 1.27 2.3 1.69.86.42 2.03.63 2.97.64v-.02c.36.61 1 1.02 1.73 1.02 1.11 0 2-.89 2-2 0-1.11-.89-2-2-2zm-6.8 6c0 .66-.55 1.2-1.2 1.2-.65 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2zM2 4.2C1.34 4.2.8 3.65.8 3c0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zm8 6c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2z"}))}var s=n("../../common/node_modules/react/react.js");r.displayName="GitMerge",r.defaultProps={viewBox:"0 0 12 16"},e.exports=r,r.default=r},"../node_modules/octicons/build/svg/git-pull-request.svg":function(e,t,n){function r(e){return s.createElement("svg",e,s.createElement("path",{fillRule:"evenodd",d:"M11 11.28V5c-.03-.78-.34-1.47-.94-2.06C9.46 2.35 8.78 2.03 8 2H7V0L4 3l3 3V4h1c.27.02.48.11.69.31.21.2.3.42.31.69v6.28A1.993 1.993 0 0 0 10 15a1.993 1.993 0 0 0 1-3.72zm-1 2.92c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zM4 3c0-1.11-.89-2-2-2a1.993 1.993 0 0 0-1 3.72v6.56A1.993 1.993 0 0 0 2 15a1.993 1.993 0 0 0 1-3.72V4.72c.59-.34 1-.98 1-1.72zm-.8 10c0 .66-.55 1.2-1.2 1.2-.65 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2zM2 4.2C1.34 4.2.8 3.65.8 3c0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2z"}))}var s=n("../../common/node_modules/react/react.js");r.displayName="GitPullRequest",r.defaultProps={viewBox:"0 0 12 16"},e.exports=r,r.default=r},"../node_modules/octicons/build/svg/issue-closed.svg":function(e,t,n){function r(e){return s.createElement("svg",e,s.createElement("path",{fillRule:"evenodd",d:"M7 10h2v2H7v-2zm2-6H7v5h2V4zm1.5 1.5l-1 1L12 9l4-4.5-1-1L12 7l-1.5-1.5zM8 13.7A5.71 5.71 0 0 1 2.3 8c0-3.14 2.56-5.7 5.7-5.7 1.83 0 3.45.88 4.5 2.2l.92-.92A6.947 6.947 0 0 0 8 1C4.14 1 1 4.14 1 8s3.14 7 7 7 7-3.14 7-7l-1.52 1.52c-.66 2.41-2.86 4.19-5.48 4.19v-.01z"}))}var s=n("../../common/node_modules/react/react.js");r.displayName="IssueClosed",r.defaultProps={viewBox:"0 0 16 16"},e.exports=r,r.default=r},"../node_modules/octicons/build/svg/issue-opened.svg":function(e,t,n){function r(e){return s.createElement("svg",e,s.createElement("path",{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))}var s=n("../../common/node_modules/react/react.js");r.displayName="IssueOpened",r.defaultProps={viewBox:"0 0 14 16"},e.exports=r,r.default=r},"../node_modules/octicons/build/svg/issue-reopened.svg":function(e,t,n){function r(e){return s.createElement("svg",e,s.createElement("path",{fillRule:"evenodd",d:"M8 9H6V4h2v5zm-2 3h2v-2H6v2zm6.33-2H10l1.5 1.5c-1.05 1.33-2.67 2.2-4.5 2.2A5.71 5.71 0 0 1 1.3 8c0-.34.03-.67.09-1H.08C.03 7.33 0 7.66 0 8c0 3.86 3.14 7 7 7 2.19 0 4.13-1.02 5.41-2.59L14 14v-4h-1.67zM1.67 6H4L2.5 4.5C3.55 3.17 5.17 2.3 7 2.3c3.14 0 5.7 2.56 5.7 5.7 0 .34-.03.67-.09 1h1.31c.05-.33.08-.66.08-1 0-3.86-3.14-7-7-7-2.19 0-4.13 1.02-5.41 2.59L0 2v4h1.67z"}))}var s=n("../../common/node_modules/react/react.js");r.displayName="IssueReopened",r.defaultProps={viewBox:"0 0 14 16"},e.exports=r,r.default=r},"../node_modules/octicons/build/svg/list-ordered.svg":function(e,t,n){function r(e){return s.createElement("svg",e,s.createElement("path",{fillRule:"evenodd",d:"M12 13c0 .59 0 1-.59 1H4.59C4 14 4 13.59 4 13c0-.59 0-1 .59-1h6.81c.59 0 .59.41.59 1H12zM4.59 4h6.81c.59 0 .59-.41.59-1 0-.59 0-1-.59-1H4.59C4 2 4 2.41 4 3c0 .59 0 1 .59 1zm6.81 3H4.59C4 7 4 7.41 4 8c0 .59 0 1 .59 1h6.81c.59 0 .59-.41.59-1 0-.59 0-1-.59-1zM2 1h-.72c-.3.19-.58.25-1.03.34V2H1v2.14H.16V5H3v-.86H2V1zm.25 8.13c-.17 0-.45.03-.66.06.53-.56 1.14-1.25 1.14-1.89C2.71 6.52 2.17 6 1.37 6c-.59 0-.97.2-1.38.64l.58.58c.19-.19.38-.38.64-.38.28 0 .48.16.48.52 0 .53-.77 1.2-1.7 2.06V10h3l-.09-.88h-.66l.01.01zm-.08 3.78v-.03c.44-.19.64-.47.64-.86 0-.7-.56-1.11-1.44-1.11-.48 0-.89.19-1.28.52l.55.64c.25-.2.44-.31.69-.31.27 0 .42.13.42.36 0 .27-.2.44-.86.44v.75c.83 0 .98.17.98.47 0 .25-.23.38-.58.38-.28 0-.56-.14-.81-.38l-.48.66c.3.36.77.56 1.41.56.83 0 1.53-.41 1.53-1.16 0-.5-.31-.81-.77-.94v.01z"}))}var s=n("../../common/node_modules/react/react.js");r.displayName="ListOrdered",r.defaultProps={viewBox:"0 0 12 16"},e.exports=r,r.default=r},"../node_modules/octicons/build/svg/list-unordered.svg":function(e,t,n){function r(e){return s.createElement("svg",e,s.createElement("path",{fillRule:"evenodd",d:"M2 13c0 .59 0 1-.59 1H.59C0 14 0 13.59 0 13c0-.59 0-1 .59-1h.81c.59 0 .59.41.59 1H2zm2.59-9h6.81c.59 0 .59-.41.59-1 0-.59 0-1-.59-1H4.59C4 2 4 2.41 4 3c0 .59 0 1 .59 1zM1.41 7H.59C0 7 0 7.41 0 8c0 .59 0 1 .59 1h.81c.59 0 .59-.41.59-1 0-.59 0-1-.59-1h.01zm0-5H.59C0 2 0 2.41 0 3c0 .59 0 1 .59 1h.81c.59 0 .59-.41.59-1 0-.59 0-1-.59-1h.01zm10 5H4.59C4 7 4 7.41 4 8c0 .59 0 1 .59 1h6.81c.59 0 .59-.41.59-1 0-.59 0-1-.59-1h.01zm0 5H4.59C4 12 4 12.41 4 13c0 .59 0 1 .59 1h6.81c.59 0 .59-.41.59-1 0-.59 0-1-.59-1h.01z"}))}var s=n("../../common/node_modules/react/react.js");r.displayName="ListUnordered",r.defaultProps={viewBox:"0 0 12 16"},e.exports=r,r.default=r},"../node_modules/octicons/build/svg/milestone.svg":function(e,t,n){function r(e){return s.createElement("svg",e,s.createElement("path",{fillRule:"evenodd",d:"M8 2H6V0h2v2zm4 5H2c-.55 0-1-.45-1-1V4c0-.55.45-1 1-1h10l2 2-2 2zM8 4H6v2h2V4zM6 16h2V8H6v8z"}))}var s=n("../../common/node_modules/react/react.js");r.displayName="Milestone",r.defaultProps={viewBox:"0 0 14 16"},e.exports=r,r.default=r},"../node_modules/octicons/build/svg/note.svg":function(e,t,n){function r(e){return s.createElement("svg",e,s.createElement("path",{fillRule:"evenodd",d:"M3 10h4V9H3v1zm0-2h6V7H3v1zm0-2h8V5H3v1zm10 6H1V3h12v9zM1 2c-.55 0-1 .45-1 1v9c0 .55.45 1 1 1h12c.55 0 1-.45 1-1V3c0-.55-.45-1-1-1H1z"}))}var s=n("../../common/node_modules/react/react.js");r.displayName="Note",r.defaultProps={viewBox:"0 0 14 16"},e.exports=r,r.default=r},"../node_modules/octicons/build/svg/person.svg":function(e,t,n){function r(e){return s.createElement("svg",e,s.createElement("path",{fillRule:"evenodd",d:"M12 14.002a.998.998 0 0 1-.998.998H1.001A1 1 0 0 1 0 13.999V13c0-2.633 4-4 4-4s.229-.409 0-1c-.841-.62-.944-1.59-1-4 .173-2.413 1.867-3 3-3s2.827.586 3 3c-.056 2.41-.159 3.38-1 4-.229.59 0 1 0 1s4 1.367 4 4v1.002z"}))}var s=n("../../common/node_modules/react/react.js");r.displayName="Person",r.defaultProps={viewBox:"0 0 12 16"},e.exports=r,r.default=r},"../node_modules/octicons/build/svg/repo-push.svg":function(e,t,n){function r(e){return s.createElement("svg",e,s.createElement("path",{fillRule:"evenodd",d:"M4 3H3V2h1v1zM3 5h1V4H3v1zm4 0L4 9h2v7h2V9h2L7 5zm4-5H1C.45 0 0 .45 0 1v12c0 .55.45 1 1 1h4v-1H1v-2h4v-1H2V1h9.02L11 10H9v1h2v2H9v1h2c.55 0 1-.45 1-1V1c0-.55-.45-1-1-1z"}))}var s=n("../../common/node_modules/react/react.js");r.displayName="RepoPush",r.defaultProps={viewBox:"0 0 12 16"},e.exports=r,r.default=r},"../node_modules/octicons/build/svg/repo.svg":function(e,t,n){function r(e){return s.createElement("svg",e,s.createElement("path",{fillRule:"evenodd",d:"M4 9H3V8h1v1zm0-3H3v1h1V6zm0-2H3v1h1V4zm0-2H3v1h1V2zm8-1v12c0 .55-.45 1-1 1H6v2l-1.5-1.5L3 16v-2H1c-.55 0-1-.45-1-1V1c0-.55.45-1 1-1h10c.55 0 1 .45 1 1zm-1 10H1v2h2v-1h3v1h5v-2zm0-10H2v9h9V1z"}))}var s=n("../../common/node_modules/react/react.js");r.displayName="Repo",r.defaultProps={viewBox:"0 0 12 16"},e.exports=r,r.default=r},"../node_modules/octicons/build/svg/tag.svg":function(e,t,n){function r(e){return s.createElement("svg",e,s.createElement("path",{fillRule:"evenodd",d:"M7.73 1.73C7.26 1.26 6.62 1 5.96 1H3.5C2.13 1 1 2.13 1 3.5v2.47c0 .66.27 1.3.73 1.77l6.06 6.06c.39.39 1.02.39 1.41 0l4.59-4.59a.996.996 0 0 0 0-1.41L7.73 1.73zM2.38 7.09c-.31-.3-.47-.7-.47-1.13V3.5c0-.88.72-1.59 1.59-1.59h2.47c.42 0 .83.16 1.13.47l6.14 6.13-4.73 4.73-6.13-6.15zM3.01 3h2v2H3V3h.01z"}))}var s=n("../../common/node_modules/react/react.js");r.displayName="Tag",r.defaultProps={viewBox:"0 0 14 16"},e.exports=r,r.default=r},"../node_modules/relaks/async-rendering-interrupted.js":function(e,t){function n(){this.message="Async rendering interrupted"}var r=Object.create(Error.prototype);r.constructor=n,r.constructor.prototype=r,e.exports=r.constructor},"../node_modules/relaks/class.js":function(e,t,n){function r(e){return!(!e||"function"!=typeof e.then)}function s(e,t){if(e===t)return!0;if(!e||!t)return!1;for(var n in t){var r=e[n];if(t[n]!==r)return!1}return!0}var o=n("../node_modules/relaks/async-rendering-interrupted.js"),i=n("../node_modules/relaks/meanwhile.js");e.exports=function(e){function t(){}var n=Object.create(e.Component.prototype);return n.constructor=t,n.constructor.prototype=n,n.render=function(){var e=this.relaks;if(!e)return console.warn("Relaks context is missing. Make sure you are calling componentWillMount() and componentWillUnmount() of the superclass"),null;if(e.promisedElementExpected)return e.promisedElementExpected=!1,e.progressElement=null,e.progressElementRendered=null,e.promisedElement;if(e.progressElementExpected)return e.progressElementExpected=!1,e.progressElementRendered=e.progressElement,e.progressElement;var t=e.meanwhile;if(t){e.meanwhile=null;try{t.cancel()}catch(e){console.error(e)}}e.previous=e.current,e.current={props:this.props,state:this.state||{}};var n=e.meanwhile=new i(this,t);try{var s;s=this.renderAsync.length>1?this.renderAsync(n,this.props,this.state,this.context):this.renderAsync(n),n.synchronous=!1}catch(t){return console.error(t),e.meanwhile.clear(),e.meanwhile=null,e.progressElement||e.progressElementRendered||e.promisedElement}if(r(s)){var a=this,c=function(t){n!==e.meanwhile?n.cancel():a.relaks?(n.finish(),e.promisedElement=t,e.promisedElementExpected=!0,e.meanwhile=null,a.forceUpdate()):n.cancel()},l=function(t){if(t instanceof o);else{console.error(t);var n=e.progressElement||e.promisedElement;c(n)}};s.then(c,l)}else{var u=s;e.meanwhile=null,e.promisedElement=u,e.progressElement=null,e.progressElementRendered=null}return e.promisedElement?e.promisedElement:e.progressElement&&(n.showingProgress||n.showingProgressInitially)?e.progressElement:e.progressElementRendered?e.progressElementRendered:null},n.shouldComponentUpdate=function(e,t){return!s(this.props,e)||!s(this.state,t)},n.componentWillMount=function(){this.relaks={progressElement:null,progressElementExpected:!1,promisedElement:null,promisedElementExpected:!1,progressElementRendered:null,meanwhile:null,previous:null,current:{props:{},state:{}}}},n.componentWillUnmount=function(){var e=this.relaks;e&&(e.meanwhile&&e.meanwhile.cancel(),this.relaks=void 0)},{Component:n.constructor,AsyncComponent:n.constructor,AsyncRenderingInterrupted:o,Meanwhile:i}}},"../node_modules/relaks/create-class.js":function(e,t,n){function r(e){if(e.render)throw new Error("Class definition should not contain render()");if(!e.renderAsync)throw new Error("Class definition should contain renderAsync()");var t=a.Component.prototype;return e=s(e),e.render=t.render,e.componentWillMount=o(e.componentWillMount,t.componentWillMount),e.componentWillUnmount=o(e.componentWillUnmount,t.componentWillUnmount),e.shouldComponentUpdate=e.shouldComponentUpdate||t.shouldComponentUpdate,i.createClass(e)}function s(e){var t={};for(var n in e)t[n]=e[n];return t}function o(e,t){return e?function(){e.call(this),t.call(this)}:t}var i=n("../../common/node_modules/react/react.js"),a=n("../node_modules/relaks/index.js");e.exports=r,a.createClass=r},"../node_modules/relaks/index.js":function(e,t,n){e.exports=n("../node_modules/relaks/class.js")(n("../../common/node_modules/react/react.js"))},"../node_modules/relaks/meanwhile.js":function(e,t,n){function r(e,t){var n=e.relaks;this.component=e,this.synchronous=!0,this.showingProgress=!1,this.showingProgressInitially=!1,this.delayWhenEmpty=50,this.delayWhenRendered=1/0,this.canceled=!1,this.prior=t?t.prior:n.previous,this.previous=n.previous,this.current=n.current,this.updateTimeout=0,this.startTime=s(),this.onCancel=null,this.onComplete=null,this.onProgress=null}function s(){return new Date-a}var o=n("../node_modules/relaks/async-rendering-interrupted.js"),i=r.prototype;i.check=function(){var e=this.component.relaks;if(!e||this!==e.meanwhile)throw new o},i.show=function(e,t){var n=this.component.relaks;if(this.check(),n.progressElement=e,this.showingProgress)return this.update(),!0;if("always"===t)return this.update(!0),!0;if("initial"===t&&!n.promisedElement&&!n.progressElementRendered)return this.update(!0),!0;if(this.updateTimeout)return!1;var r;if((r=n.promisedElement?this.delayWhenRendered:this.delayWhenEmpty)>0){if(r!==1/0){var s=this;this.updateTimeout=setTimeout(function(){0!==s.updateTimeout&&s.update()},r)}return!1}return this.update(),!0},i.revising=function(){return!!this.component.relaks.promisedElement},i.delay=function(e,t){"number"==typeof e&&(this.delayWhenEmpty=e),"number"==typeof t&&(this.delayWhenRendered=t)},i.update=function(e){var t=this.component.relaks;if(e||(this.showingProgress=!0),t.promisedElement&&(t.promisedElement=null),this.synchronous)return void(e&&(this.showingProgressInitially=!0));if(this.onProgress){var n=s()-this.startTime;this.onProgress({type:"progress",target:this,elapsed:n})}t.progressElement!==t.progressElementRendered&&(t.progressElementExpected=!0,this.component.forceUpdate())},i.cancel=function(){this.clear(),this.canceled||(this.canceled=!0,this.onCancel&&this.onCancel({type:"cancel",target:this}))},i.finish=function(){if(this.clear(),this.onComplete){var e=s()-this.startTime;this.onComplete({type:"complete",target:this,elapsed:e})}},i.clear=function(){this.component.relaks;this.updateTimeout&&(clearTimeout(this.updateTimeout),this.updateTimeout=0)};var a=new Date;e.exports=i.constructor},"../node_modules/scroll-into-view-if-needed/es/index.js":function(e,t,n){"use strict";function r(e){return e===Object(e)&&0!==Object.keys(e).length}function s(e,t){void 0===t&&(t="auto");var n="scrollBehavior"in document.body.style;e.forEach(function(e){var r=e.el,s=e.top,o=e.left;r.scroll&&n?r.scroll({top:s,left:o,behavior:t}):(r.scrollTop=s,r.scrollLeft=o)})}function o(e){return!1===e?{block:"end",inline:"nearest"}:r(e)?e:{block:"start",inline:"nearest"}}function i(e,t){if(r(t)&&"function"==typeof t.behavior)return t.behavior(Object(a.a)(e,t));var n=o(t);return s(Object(a.a)(e,n),n.behavior)}Object.defineProperty(t,"__esModule",{value:!0});var a=n("../node_modules/compute-scroll-into-view/es/index.js");t.default=i},"../node_modules/style-loader/addStyles.js":function(e,t,n){function r(e,t){for(var n=0;n<e.length;n++){var r=e[n],s=m[r.id];if(s){s.refs++;for(var o=0;o<s.parts.length;o++)s.parts[o](r.parts[o]);for(;o<r.parts.length;o++)s.parts.push(u(r.parts[o],t))}else{for(var i=[],o=0;o<r.parts.length;o++)i.push(u(r.parts[o],t));m[r.id]={id:r.id,refs:1,parts:i}}}}function s(e,t){for(var n=[],r={},s=0;s<e.length;s++){var o=e[s],i=t.base?o[0]+t.base:o[0],a=o[1],c=o[2],l=o[3],u={css:a,media:c,sourceMap:l};r[i]?r[i].parts.push(u):n.push(r[i]={id:i,parts:[u]})}return n}function o(e,t){var n=g(e.insertInto);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var r=y[y.length-1];if("top"===e.insertAt)r?r.nextSibling?n.insertBefore(t,r.nextSibling):n.appendChild(t):n.insertBefore(t,n.firstChild),y.push(t);else{if("bottom"!==e.insertAt)throw new Error("Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.");n.appendChild(t)}}function i(e){e.parentNode.removeChild(e);var t=y.indexOf(e);t>=0&&y.splice(t,1)}function a(e){var t=document.createElement("style");return e.attrs.type="text/css",l(t,e.attrs),o(e,t),t}function c(e){var t=document.createElement("link");return e.attrs.type="text/css",e.attrs.rel="stylesheet",l(t,e.attrs),o(e,t),t}function l(e,t){Object.keys(t).forEach(function(n){e.setAttribute(n,t[n])})}function u(e,t){var n,r,s,o;if(t.transform&&e.css){if(!(o=t.transform(e.css)))return function(){};e.css=o}if(t.singleton){var l=b++;n=v||(v=a(t)),r=d.bind(null,n,l,!1),s=d.bind(null,n,l,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=c(t),r=h.bind(null,n,t),s=function(){i(n),n.href&&URL.revokeObjectURL(n.href)}):(n=a(t),r=p.bind(null,n),s=function(){i(n)});return r(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;r(e=t)}else s()}}function d(e,t,n,r){var s=n?"":r.css;if(e.styleSheet)e.styleSheet.cssText=w(t,s);else{var o=document.createTextNode(s),i=e.childNodes;i[t]&&e.removeChild(i[t]),i.length?e.insertBefore(o,i[t]):e.appendChild(o)}}function p(e,t){var n=t.css,r=t.media;if(r&&e.setAttribute("media",r),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}function h(e,t,n){var r=n.css,s=n.sourceMap,o=void 0===t.convertToAbsoluteUrls&&s;(t.convertToAbsoluteUrls||o)&&(r=j(r)),s&&(r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(s))))+" */");var i=new Blob([r],{type:"text/css"}),a=e.href;e.href=URL.createObjectURL(i),a&&URL.revokeObjectURL(a)}var m={},f=function(e){var t;return function(){return void 0===t&&(t=e.apply(this,arguments)),t}}(function(){return window&&document&&document.all&&!window.atob}),g=function(e){var t={};return function(n){return void 0===t[n]&&(t[n]=e.call(this,n)),t[n]}}(function(e){return document.querySelector(e)}),v=null,b=0,y=[],j=n("../node_modules/style-loader/fixUrls.js");e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");t=t||{},t.attrs="object"==typeof t.attrs?t.attrs:{},void 0===t.singleton&&(t.singleton=f()),void 0===t.insertInto&&(t.insertInto="head"),void 0===t.insertAt&&(t.insertAt="bottom");var n=s(e,t);return r(n,t),function(e){for(var o=[],i=0;i<n.length;i++){var a=n[i],c=m[a.id];c.refs--,o.push(c)}if(e){r(s(e,t),t)}for(var i=0;i<o.length;i++){var c=o[i];if(0===c.refs){for(var l=0;l<c.parts.length;l++)c.parts[l]();delete m[c.id]}}}};var w=function(){var e=[];return function(t,n){return e[t]=n,e.filter(Boolean).join("\n")}}()},"../node_modules/style-loader/fixUrls.js":function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var n=t.protocol+"//"+t.host,r=n+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(e,t){var s=t.trim().replace(/^"(.*)"$/,function(e,t){return t}).replace(/^'(.*)'$/,function(e,t){return t});if(/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/)/i.test(s))return e;var o;return o=0===s.indexOf("//")?s:0===s.indexOf("/")?n+s:r+s.replace(/^\.\//,""),"url("+JSON.stringify(o)+")"})}},"../node_modules/style-loader/index.js!../node_modules/css-loader/index.js!../node_modules/less-loader/index.js!../node_modules/font-awesome-webpack/font-awesome-styles.loader.js!../node_modules/font-awesome-webpack/font-awesome.config.js":function(e,t,n){var r=n("../node_modules/css-loader/index.js!../node_modules/less-loader/index.js!../node_modules/font-awesome-webpack/font-awesome-styles.loader.js!../node_modules/font-awesome-webpack/font-awesome.config.js");"string"==typeof r&&(r=[[e.i,r,""]]);var s={};s.transform=void 0;n("../node_modules/style-loader/addStyles.js")(r,s);r.locals&&(e.exports=r.locals)},"../node_modules/timers-ext/max-timeout.js":function(e,t,n){"use strict";e.exports=2147483647},"../node_modules/timers-ext/valid-timeout.js":function(e,t,n){"use strict";var r=n("../../common/node_modules/es5-ext/number/to-pos-integer.js"),s=n("../node_modules/timers-ext/max-timeout.js");e.exports=function(e){if((e=r(e))>s)throw new TypeError(e+" exceeds maximum possible timeout");return e}},"./application.jsx":function(e,t,n){"use strict";function r(e){for(;e&&"A"!==e.tagName;)e=e.parentNode;return e}var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o=n("../../common/node_modules/lodash/lodash.js"),i=(n("../../common/node_modules/bluebird/js/browser/bluebird.js"),n("../../common/node_modules/moment/moment.js"),n("../../common/node_modules/react/react.js"));i.PropTypes;n("../node_modules/relaks/index.js").createClass=n("../node_modules/relaks/create-class.js");var a,c=n("../../common/src/utils/component-refs.js"),l=(n("../../common/src/errors/http-error.js"),n("../../common/src/routing/cors-rewriter.js")),u=(n("../../common/src/objects/finders/system-finder.js"),n("../../common/src/data/remote-data-source/index.jsx")),d=n("../../common/src/data/database.js"),p=n("../../common/src/routing/route-manager.jsx"),h=n("../../common/src/routing/route.js"),m=n("../../common/src/transport/payload-manager.jsx"),f=n("../../common/src/transport/payloads.js"),g=n("../../common/src/transport/connectivity-monitor.jsx"),v=n("../../common/src/locale/locale-manager.jsx"),b=n("../../common/src/locale/locale.js"),y=n("../../common/src/theme/theme-manager.jsx"),j=n("../../common/src/theme/theme.js"),w=n("../../common/src/data/subscription-manager.jsx"),x=n("../../common/src/data/session-manager.jsx"),k=n("../../common/src/routing/link-manager.jsx"),E=n("./pages/start-page.jsx"),C=n("./pages/news-page.jsx"),_=n("./pages/people-page.jsx"),S=n("./pages/notifications-page.jsx"),R=n("./pages/bookmarks-page.jsx"),N=n("./pages/settings-page.jsx"),O=n("./pages/error-page.jsx"),P=n("./widgets/top-navigation.jsx"),T=n("./widgets/bottom-navigation.jsx"),D=n("../../common/src/widgets/upload-progress.jsx"),A=n("./views/notification-view.jsx"),U=n("../../common/src/data/indexed-db-cache.jsx"),F=n("../../common/src/data/local-storage-cache.jsx");U.isAvailable()?a=U:F.isAvailable()&&(a=F);var I=n("../../common/src/transport/websocket-notifier.jsx"),L=I||null,B=n("./keys.js"),M=[E,C,_,S,R,N,O];n("../../common/src/utils/lodash-extra.js"),n("./application.scss"),n("../node_modules/font-awesome-webpack/index.js"),e.exports=i.createClass({displayName:"Application",getInitialState:function(){return this.components=c({remoteDataSource:u,routeManager:p,localeManager:v,themeManager:y,payloadManager:m,subscriptionManager:w,sessionManager:x,linkManager:k,cache:a,notifier:L}),{database:null,payloads:null,route:null,locale:null,theme:null,canAccessServer:!1,canAccessSchema:!1,connection:null,searching:!1,inForeground:!0,sleepTime:null,pageKey:0,pushRelay:null,renderingStartPage:!1,showingUploadProgress:!1,online:!0,networkType:"unknown"}},isReady:function(){return!!(this.state.database&&this.state.payloads&&this.state.route&&this.state.locale&&this.state.theme)},isShowingStartPage:function(){return this.state.route.component===E||this.state.route.component!==O&&(!this.state.canAccessServer||!this.state.canAccessSchema)},render:function(){return i.createElement("div",{onClick:this.handleClick},this.renderUserInterface(),this.renderConfiguration())},renderUserInterface:function(){if(!this.isReady())return null;var e=this.state.route.component.configureUI(this.state.route),t={settings:e,database:this.state.database,payloads:this.state.payloads,online:this.state.online,connected:!!this.state.connection||void 0,searching:this.state.searching,route:this.state.route,locale:this.state.locale,theme:this.state.theme},n={settings:e,hasAccess:this.state.canAccessServer&&this.state.canAccessSchema,database:this.state.database,route:this.state.route,locale:this.state.locale,theme:this.state.theme};this.isShowingStartPage()&&(o.set(e,"navigation.top",!1),o.set(e,"navigation.bottom",!1));var r="application "+this.state.theme.mode;return this.state.theme.keyboard&&(r+=" keyboard"),this.state.theme.touch||(r+=" no-touch"),i.createElement("div",{className:r,id:"application"},i.createElement(P,t),i.createElement("section",{className:"page-view-port"},this.renderCurrentPage()),i.createElement(T,n),this.renderStartPage(),this.renderUploadProgress())},renderCurrentPage:function(){var e=this.state.route.component;if(this.isShowingStartPage())return null;var t={database:this.state.database,route:this.state.route,payloads:this.state.payloads,locale:this.state.locale,theme:this.state.theme};return i.createElement(e,s({key:this.state.pageKey},t))},renderStartPage:function(){if(!this.isShowingStartPage()&&!this.state.renderingStartPage)return null;var e={canAccessServer:this.state.canAccessServer,canAccessSchema:this.state.canAccessSchema,database:this.state.database,route:this.state.route,locale:this.state.locale,theme:this.state.theme,onEntry:this.handleStartPageEntry,onExit:this.handleStartPageExit,onAvailableSchemas:this.handleAvailableSchemas};return i.createElement(E,e)},renderConfiguration:function(){var e=this.components.setters,t=this.state.route,r=t?t.parameters.address:null,c=t?t.parameters.schema:null,l={ref:e.remoteDataSource,inForeground:this.state.inForeground,online:this.state.online,connected:!!this.state.connection||void 0,discoveryFlags:{include_uncommitted:!0},onChange:this.handleDatabaseChange,onSearch:this.handleDatabaseSearch,onAuthorization:this.handleAuthorization,onExpiration:this.handleExpiration,onViolation:this.handleViolation,onStupefaction:this.handleStupefaction},d={ref:e.payloadManager,online:this.state.online,database:this.state.database,route:this.state.route,onChange:this.handlePayloadsChange},h={ref:e.routeManager,pages:M,database:this.state.database,rewrite:this.rewriteURL,onChange:this.handleRouteChange,onRedirectionRequest:this.handleRedirectionRequest},f={ref:e.localeManager,database:this.state.database,directory:n("../../common/src/languages.js"),onChange:this.handleLocaleChange},b={ref:e.themeManager,database:this.state.database,modes:{"single-col":0,"double-col":700,"triple-col":1300},networkType:this.state.networkType,serverAddress:r,onChange:this.handleThemeChange},j={ref:e.cache,databaseName:"trambar"},E={inForeground:this.state.inForeground,onChange:this.handleConnectivityChange},C={ref:e.notifier,serverAddress:r,online:this.state.online,onConnect:this.handleConnection,onDisconnect:this.handleDisconnection,onNotify:this.handleChangeNotification,onAlertClick:this.handleAlertClick,onRevalidate:this.handleCacheRevalidation};L===I?o.assign(C,{locale:this.state.locale,defaultProfileImage:n("../assets/profile-image-placeholder.png")}):null===L&&(o.assign(C,{android:{icon:"push",iconColor:"#fca326"}}),this.state.pushRelay&&o.assign(C,{relayAddress:this.state.pushRelay.url,searching:this.state.searching})),c&&this.state.canAccessSchema||(c="global");var _={ref:e.subscriptionManager,area:"client",connection:this.state.connection||null,schema:c,database:this.state.database,locale:this.state.locale},S={ref:e.sessionManager,database:this.state.database},R={ref:e.linkManager,hasAccess:this.state.canAccessServer||this.state.canAccessSchema,database:this.state.database,route:this.state.route};this.state.inForeground,B.codePushDeployment;return i.createElement("div",null,i.createElement(a,j),i.createElement(L,C),i.createElement(u,s({},l,{cache:this.components.cache})),i.createElement(m,d),i.createElement(p,h),i.createElement(v,f),i.createElement(y,b),i.createElement(w,_),i.createElement(x,S),i.createElement(k,R),i.createElement(g,E),null)},renderUploadProgress:function(){if(!this.state.showingUploadProgress)return null;var e={payloads:this.state.payloads,locale:this.state.locale};return i.createElement(D,e)},componentDidMount:function(){window.addEventListener("beforeunload",this.handleBeforeUnload),document.addEventListener("visibilitychange",this.handleVisibilityChange)},componentDidUpdate:function(e,t){var n=this;!this.splashScreenHidden&&this.isReady()&&(this.splashScreenHidden=!0,setTimeout(function(){n.hideSplashScreen()},100))},componentWillUnmount:function(){window.removeEventListener("beforeunload",this.handleBeforeUnload),document.removeEventListener("visibilitychange",this.handleVisibilityChange)},discoverPushRelay:function(){return},rewriteURL:function(e,t,n){"parse"===n?l.extract(e,t):(this.state.route&&(t=o.defaults(t,this.state.route.parameters)),l.insert(e,t))},handleDatabaseChange:function(e){var t;this.state.route&&(t={address:this.state.route.parameters.address,schema:this.state.route.parameters.schema});var n=new d(e.target,t,this.state.online);this.setState({database:n})},handleDatabaseSearch:function(e){this.setState({searching:e.searching})},handleAuthorization:function(e){this.components.sessionManager.saveToCache(e.session);var t=this.state.route.parameters.address;e.session.address===t&&this.setState({canAccessServer:!0,canAccessSchema:!0})},handleExpiration:function(e){this.components.sessionManager.removeFromCache(e.session),this.components.linkManager.removeLocations(e.session.address);var t=this.state.route.parameters.address;e.session.address===t&&this.setState({canAccessServer:!1,canAccessSchema:!1})},handleViolation:function(e){var t=this.state.route.parameters.address,n=this.state.route.parameters.schema;e.address===t&&e.schema===n&&this.setState({canAccessSchema:!1})},handleStupefaction:function(e){var t=this.state.route,n=t.url,r=t.parameters.schema;r&&"project"===e.query.table&&e.query.criteria.name===r&&(r=null);var s=t.find(O,{code:404,schema:r});t.change(s,!0,n)},handlePayloadsChange:function(e){var t=new f(e.target),n=this.state.showingUploadProgress;t.uploading||(n=!1),this.setState({payloads:t,showingUploadProgress:n})},handleLocaleChange:function(e){var t=new b(e.target);this.setState({locale:t}),document.title=t.translate("app-name")},handleRouteChange:function(e){var t=this,n=new h(e.target),r=this.components.remoteDataSource,s=this.state.route,o=this.state.pageKey;h.compare(s,n)||o++;var i=this.state.database,a=n.parameters.address;if(a!=i.context.address&&(i=new d(r,{address:a},this.state.online)),this.state.route)if(a!=i.context.address)r.abandon(a);else{var c=this.state.route.parameters.schema,l=n.parameters.schema;c!==l&&r.abandon(a,c)}var u=function(e){t.setState({route:n,database:i,pageKey:o,canAccessServer:e,canAccessSchema:e},function(){if(e&&null===L&&t.discoverPushRelay(),t.scrollBoxNode){var n=document.activeElement;n&&n!==document.body||t.scrollBoxNode.focus()}})};i.hasAuthorization()?u(!0):this.components.sessionManager.loadFromCache(a).then(function(e){e&&i.restoreSession(e),u(i.hasAuthorization(a)?!0:!1)})},handleAvailableSchemas:function(e){var t=this.state.route.parameters.schema;o.includes(e.schemas,t)&&this.setState({canAccessSchema:!0})},handleStartPageEntry:function(e){this.setState({renderingStartPage:!0})},handleStartPageExit:function(e){this.setState({renderingStartPage:!1})},handleRedirectionRequest:function(e){var t=e.target,n=e.url,r=e.replacing,s=t.find(O,{code:404});return t.change(s,r,n)},handleClick:function(e){if(0===e.button){var t=r(e.target);if(t&&!t.target&&!t.download){var n=t.getAttribute("href")||t.getAttribute("data-url");n&&-1===n.indexOf(":")&&(this.state.route.change(n),e.preventDefault(),t.blur())}}},handleThemeChange:function(e){var t=new j(e.target);this.setState({theme:t})},handleConnection:function(e){this.setState({connection:e.connection})},handleDisconnection:function(e){var t=this;this.setState({connection:!1},function(){var e=t.components.remoteDataSource;e.revalidate(),e.invalidate()})},handleChangeNotification:function(e){this.components.remoteDataSource.invalidate(e.changes)},handleCacheRevalidation:function(e){var t=this.components.remoteDataSource;t.revalidate(e.revalidation),t.invalidate()},handleAlertClick:function(e){var t=e.alert,n={id:t.notification_id,type:t.type,user_id:t.user_id,reaction_id:t.reaction_id,story_id:t.story_id},r=A.getNotificationURL(n,this.state.route),s=A.getNotificationTarget(n);if(s){var o=document.createElement("A");o.href=r,o.target=s,o.click()}else this.state.route.change(r),window.focus();var i=this.state.route.parameters,a=this.state.database.use({schema:i.schema,by:this});a.start().then(function(e){var n={id:t.notification_id,seen:!0};return a.saveOne({table:"notification"},n)})},handleBeforeUnload:function(e){if(this.state.payloads&&this.state.payloads.uploading)return this.setState({showingUploadProgress:!0}),e.returnValue="Are you sure?"},handlePause:function(e){},handleResume:function(e){},handleVisibilityChange:function(e){this.setState({inForeground:!document.hidden})},handleConnectivityChange:function(e){var t={online:e.online,networkType:e.type},n=this.state.database;n&&(t.database=new d(n.remoteDataSource,n.context,e.online)),this.setState(t)},handleDebugKeydown:function(e){},hideSplashScreen:function(){var e=document.getElementById("splash-screen"),t=document.getElementById("splash-screen-style");e&&(e.className="transition-out",setTimeout(function(){e.parentNode&&e.parentNode.removeChild(e),t&&t.parentNode&&t.parentNode.removeChild(t)},1e3))}})},"./application.scss":function(e,t){},"./dialogs/app-component-dialog-box.jsx":function(e,t,n){"use strict";var r=n("../../common/node_modules/react/react.js"),s=r.PropTypes,o=n("../../common/node_modules/mark-gor/react.js"),i=n("../../common/src/locale/locale.js"),a=n("../../common/src/theme/theme.js"),c=n("../../common/src/widgets/overlay.jsx"),l=n("./widgets/push-button.jsx"),u=n("../../common/src/widgets/resource-view.jsx");n("./dialogs/app-component-dialog-box.scss"),e.exports=r.createClass({displayName:"AppComponentDialogBox",propTypes:{show:s.bool,component:s.object.isRequired,locale:s.instanceOf(i).isRequired,theme:s.instanceOf(a).isRequired,onClose:s.func},render:function(){if(!this.props.component)return null;var e={show:this.props.show,onBackgroundClick:this.props.onClose};return r.createElement(c,e,r.createElement("div",{className:"app-component-dialog-box"},r.createElement("div",{className:"contents"},this.renderPicture(),this.renderText()),this.renderButtons()))},renderPicture:function(){var e=this.props.component;if(e.image)return r.createElement("div",{className:"picture"},r.createElement(u,{resource:e.image,height:48,theme:this.props.theme}));var t=e.icon||{},n=t.class||"fa-cubes",s={color:t.color,backgroundColor:t.backgroundColor};return r.createElement("div",{className:"picture"},r.createElement("div",{className:"icon",style:s},r.createElement("i",{className:"fa fa-fw "+n})))},renderText:function(){var e=this.props.locale.pick,t=e(this.props.component.text),n=o.parse(t);return r.createElement("div",{className:"text"},n)},renderButtons:function(){var e=this.props.locale.translate,t={label:e("app-component-close"),emphasized:!0,onClick:this.props.onClose};return r.createElement("div",{className:"buttons"},r.createElement(l,t))}})},"./dialogs/app-component-dialog-box.scss":function(e,t){},"./dialogs/audio-capture-dialog-box-browser.jsx":function(e,t,n){"use strict";var r=n("../../common/node_modules/lodash/lodash.js"),s=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),o=n("../../common/node_modules/react/react.js"),i=o.PropTypes,a=n("../../common/src/media/media-stream-utils.js"),c=n("../../common/src/transport/payloads.js"),l=n("../../common/src/locale/locale.js"),u=n("../../common/src/mixins/update-check.js"),d=n("../../common/src/widgets/overlay.jsx"),p=n("./widgets/push-button.jsx"),h=n("./widgets/device-placeholder.jsx"),m=n("./widgets/duration-indicator.jsx");n("./dialogs/audio-capture-dialog-box-browser.scss"),e.exports=o.createClass({displayName:"AudioCaptureDialogBox",mixins:[u],propTypes:{show:i.bool,payloads:i.instanceOf(c).isRequired,locale:i.instanceOf(l).isRequired,onCancel:i.func,onCapturePending:i.func,onCaptureError:i.func,onCapture:i.func},statics:{isAvailable:function(){return!!a.hasSupport()&&("function"==typeof MediaRecorder&&"function"==typeof AudioContext)}},getInitialState:function(){return{liveAudioStream:null,liveAudioContext:null,liveAudioProcessor:null,liveAudioSource:null,liveAudioLevel:0,liveAudioError:null,liveAudioRecorder:null,mediaRecorder:null,capturedAudio:null,previewURL:null,startTime:null,duration:0}},componentWillMount:function(){this.props.show&&this.initializeMicrophone()},componentWillReceiveProps:function(e){var t=this;this.props.show!==e.show&&(e.show?(this.clearCapturedAudio(),this.initializeMicrophone()):setTimeout(function(){t.shutdownMicrophone(),t.clearCapturedAudio()},500))},clearCapturedAudio:function(){this.state.capturedAudio&&(URL.revokeObjectURL(this.state.previewURL),this.setState({capturedAudio:null,previewURL:null}))},initializeMicrophone:function(){var e=this;this.createLiveAudioStream().then(function(t){e.setLiveAudioState(null,t)}).catch(function(t){e.setLiveAudioState(t,null)})},shutdownMicrophone:function(){var e=this;this.destroyLiveAudioStream().then(function(){e.setLiveAudioState(null,null)})},setLiveAudioState:function(e,t){var n=this;this.state.liveAudioProcessor&&(this.state.liveAudioSource.disconnect(this.state.liveAudioProcessor),this.state.liveAudioProcessor.disconnect(this.state.liveAudioContext.destination));var r,s,o;if(t){var r=new AudioContext,s=r.createScriptProcessor(4096,1,1),o=r.createMediaStreamSource(t);s.addEventListener("audioprocess",function(e){for(var t=e.inputBuffer.getChannelData(0),r=0,s=t.length,o=0;o<s;o++){var i=t[o];i>r&&(r=i)}var a=Math.round(100*r);a!==n.state.liveAudioLevel&&n.setState({liveAudioLevel:a})}),o.connect(s),s.connect(r.destination)}this.setState({liveAudioStream:t,liveAudioContext:r,liveAudioProcessor:s,liveAudioSource:o,liveAudioError:e}),e&&console.error(e)},setLiveAudioNode:function(e){this.audioNode=e,this.audioNode&&(this.audioNode.srcObject=this.state.liveAudioStream)},render:function(){var e={show:this.props.show,onBackgroundClick:this.handleCancelClick};return o.createElement(d,e,o.createElement("div",{className:"audio-capture-dialog-box"},o.createElement("div",{className:"container"},this.renderView()),o.createElement("div",{className:"controls"},this.renderDuration(),this.renderButtons())))},renderView:function(){return this.state.capturedAudio?this.renderCapturedAudio():this.state.liveAudioStream?this.renderLiveAudio():this.renderPlaceholder()},renderPlaceholder:function(){var e={blocked:!!this.state.liveAudioError,icon:"microphone"};return o.createElement(h,e)},renderLiveAudio:function(){var e,t={ref:this.setLiveAudioNode,autoPlay:!0,muted:!0},n=this.state.liveAudioLevel;return e=n<10?"volume-off":n<50?"volume-down":"volume-up",o.createElement("div",null,o.createElement("div",{className:"volume-meter"},o.createElement("div",{className:"icon"},o.createElement("i",{className:"fa fa-"+e})),o.createElement("div",{className:"bar-container"},o.createElement("div",{className:"bar"},o.createElement("div",{className:"fill",style:{width:n+"%"}})))),o.createElement("audio",t))},renderCapturedAudio:function(){var e={src:this.state.previewURL,controls:!0};return o.createElement("audio",e)},renderDuration:function(){if(!this.state.mediaRecorder)return null;var e={duration:this.state.duration,startTime:this.state.startTime};return o.createElement(m,e)},renderButtons:function(){var e=this.props.locale.translate;if(this.state.mediaRecorder){var t="paused"===this.state.mediaRecorder.state,n={label:e("audio-capture-pause"),onClick:this.handlePauseClick,hidden:t},r={label:e("audio-capture-resume"),onClick:this.handleResumeClick,hidden:!t,emphasized:!0},s={label:e("audio-capture-stop"),onClick:this.handleStopClick,emphasized:!t};return o.createElement("div",{className:"buttons"},o.createElement(p,n),o.createElement(p,r),o.createElement(p,s))}if(this.state.capturedAudio){var i={label:e("audio-capture-rerecord"),onClick:this.handleRerecordClick},a={label:e("audio-capture-accept"),onClick:this.handleAcceptClick,emphasized:!0};return o.createElement("div",{className:"buttons"},o.createElement(p,i),o.createElement(p,a))}var c={label:e("audio-capture-cancel"),onClick:this.handleCancelClick},l={label:e("audio-capture-start"),onClick:this.handleStartClick,disabled:!this.state.liveAudioStream,emphasized:!0};return o.createElement("div",{className:"buttons"},o.createElement(p,c),o.createElement(p,l))},componentWillUnmount:function(){this.destroyLiveAudioStream()},createLiveAudioStream:function(){return this.audioStreamPromise||(this.audioStreamPromise=a.getAudioStream()),this.audioStreamPromise},destroyLiveAudioStream:function(){if(!this.audioStreamPromise)return s.resolve();var e=this.audioStreamPromise;return this.audioStreamPromise=null,e.then(function(e){a.stopAllTracks(e)})},beginRecording:function(){var e=this;return s.try(function(){var t={audioBitsPerSecond:128e3,mimeType:"audio/webm"},n=new MediaRecorder(e.state.liveAudioStream,t),r=e.props.payloads.stream();return n.promise=new s(function(e,t){n.resolve=e,n.reject=t}),n.outputStream=r,n.addEventListener("dataavailable",function(e){this.outputStream.push(e.data)}),n.addEventListener("stop",function(e){this.outputStream.close(),n.resolve()}),n.start(3e3),r.start(),n})},pauseRecording:function(){var e=this;return s.try(function(){var t=e.state.mediaRecorder;t&&t.pause()})},resumeRecording:function(){var e=this;return s.try(function(){var t=e.state.mediaRecorder;t&&t.resume()})},endRecording:function(){var e=this;return s.try(function(){var t=e.state.mediaRecorder;if(t)return t.stop(),t.promise})},triggerCaptureEvent:function(e){this.props.onCapture&&this.props.onCapture({type:"capture",target:this,resource:e})},triggerCloseEvent:function(){this.props.onClose&&this.props.onClose({type:"close",target:this})},handleStartClick:function(e){var t=this;return this.beginRecording().then(function(e){return t.props.payloads.stream(e.outputStream),t.setState({mediaRecorder:e,startTime:new Date,duration:0}),null})},handlePauseClick:function(e){var t=this;return this.pauseRecording().then(function(){var e=new Date,n=e-t.state.startTime,r=t.state.duration+n;t.setState({duration:r,startTime:null})})},handleResumeClick:function(e){var t=this;return this.resumeRecording().then(function(){var e=new Date;t.setState({startTime:e})})},handleStopClick:function(e){var t=this;return this.endRecording().then(function(){var e=t.state.mediaRecorder,n=e.outputStream.toBlob(),s=URL.createObjectURL(n),o=0;if(t.state.startTime){o=new Date-t.state.startTime}var i={format:r.last(r.split(e.mimeType,"/")),audioBitsPerSecond:e.audioBitsPerSecond,stream:e.outputStream,duration:t.state.duration+o};t.setState({capturedAudio:i,previewURL:s,mediaRecorder:null})})},handleRerecordClick:function(e){this.clearCapturedAudio()},handleAcceptClick:function(e){var t=this.state.capturedAudio,n=this.props.payloads.add("audio");n.attachStream(t.stream);var r={type:"audio",payload_token:n.token,duration:t.duration,format:t.format,bitrates:{audio:t.audioBitsPerSecond}};this.triggerCloseEvent(),this.triggerCaptureEvent(r)},handleCancelClick:function(e){this.triggerCloseEvent()}})},"./dialogs/audio-capture-dialog-box-browser.scss":function(e,t){},"./dialogs/audio-capture-dialog-box.jsx":function(e,t,n){"use strict";e.exports=n("./dialogs/audio-capture-dialog-box-browser.jsx")},"./dialogs/confirmation-dialog-box.jsx":function(e,t,n){"use strict";var r=n("../../common/node_modules/react/react.js"),s=r.PropTypes,o=n("../../common/src/locale/locale.js"),i=n("../../common/src/widgets/overlay.jsx"),a=n("./widgets/push-button.jsx");n("./dialogs/confirmation-dialog-box.scss"),e.exports=r.createClass({displayName:"ConfirmationDialogBox",propTypes:{show:s.bool,locale:s.instanceOf(o).isRequired,onClose:s.func,onConfirm:s.func},render:function(){var e={show:this.props.show,onBackgroundClick:this.props.onClose};return r.createElement(i,e,r.createElement("div",{className:"confirmation-dialog-box"},this.renderMessage(),this.renderButtons()))},renderMessage:function(){return r.createElement("div",{className:"message"},this.props.children)},renderButtons:function(){var e=this.props.locale.translate,t={label:e("confirmation-cancel"),onClick:this.props.onClose,hidden:!this.props.onClose},n={label:e("confirmation-confirm"),onClick:this.props.onConfirm,hidden:!this.props.onConfirm,emphasized:!0};return r.createElement("div",{className:"buttons"},r.createElement(a,t),r.createElement(a,n))}})},"./dialogs/confirmation-dialog-box.scss":function(e,t){},"./dialogs/issue-dialog-box.jsx":function(e,t,n){"use strict";var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s=n("../../common/node_modules/lodash/lodash.js"),o=(n("../../common/node_modules/bluebird/js/browser/bluebird.js"),n("../../common/node_modules/react/react.js")),i=o.PropTypes,a=n("../../common/src/utils/component-refs.js"),c=n("../../common/src/utils/tag-scanner.js"),l=n("../../common/src/locale/locale.js"),u=n("../../common/src/theme/theme.js"),d=n("../../common/src/mixins/update-check.js"),p=n("../../common/src/widgets/overlay.jsx"),h=n("./widgets/push-button.jsx"),m=n("./widgets/text-field.jsx");n("./dialogs/issue-dialog-box.scss"),e.exports=o.createClass({displayName:"IssueDialogBox",mixins:[d],propTypes:{show:i.bool,allowDeletion:i.bool.isRequired,story:i.object.isRequired,repos:i.arrayOf(i.object),issue:i.object,locale:i.instanceOf(l).isRequired,theme:i.instanceOf(u).isRequired,onConfirm:i.func,onClose:i.func},getInitialState:function(){return this.components=a({textField:m}),{issue:this.props.issue?null:this.getDefaultIssue()}},getIssueProperty:function(e){var t=this.state.issue||this.props.issue||{};return s.get(t,e)},setIssueProperty:function(e,t){var n=this.state.issue||this.props.issue||{};n=s.decoupleSet(n,e,t),"repo_id"===e&&(f=t,window.localStorage.last_selected_repo_id=t),this.setState({issue:n})},getDefaultIssue:function(){var e=this,t=this.props.locale.translate,n=t(this.props.story.details.text),r=s.split(s.trim(n),/[\r\n]+/),o=c.removeTags(r[0]),i="";o.length<100&&(i=o);var a=s.uniq(s.flatten(s.map(this.props.repos,"details.labels"))),l=s.filter(a,function(t){var n="#"+s.replace(t,/\s+/g,"-");return s.includes(e.props.story.tags,n)});return!i&&s.isEmpty(l)?null:{title:i,labels:l}},getSelectedRepo:function(){var e=this.getIssueProperty("repo_id"),t=this.getAvailableRepos(),n=s.find(this.props.repos,{id:e});return n||(n=s.find(this.props.repos,{id:f})),n||(n=s.last(s.sortBy(this.props.repos,function(e){return s.size(e.details.labels)}))),n||(n=s.first(t)),n||null},getAvailableRepos:function(){var e=this.props.locale.pick,t=this.props.repos;return t=s.filter(t,function(e){return e.details.issues_enabled}),t=s.sortBy(t,function(t){return s.toLower(e(t.details.title)||t.name)})},componentWillReceiveProps:function(e){if(this.props.show!==e.show&&e.show){var t;e.issue||(t=this.getDefaultIssue()),this.setState({issue:t})}},render:function(){var e={show:this.props.show,onBackgroundClick:this.props.onClose};return o.createElement(p,e,o.createElement("div",{className:"issue-dialog-box"},this.renderForm(),o.createElement("div",{className:"controls"},this.renderButtons())))},renderForm:function(){return o.createElement("div",{className:"container"},o.createElement("div",{className:"top"},this.renderTitleInput(),this.renderRepoSelector()),this.renderLabelSelector())},renderTitleInput:function(){var e=this.props.locale.translate,t=this.components.setters,n={id:"title",ref:t.textField,value:this.getIssueProperty("title"),locale:this.props.locale,onChange:this.handleTitleChange};return o.createElement(m,n,e("issue-title"))},renderRepoSelector:function(){var e=this.props.locale.translate,t=this.props.locale.pick,n=this.getAvailableRepos();if(n.length<=1)return null;var r=this.getSelectedRepo(),i=s.map(n,function(e,n){var r=t(e.details.title)||e.name;return o.createElement("option",{key:n,value:e.id},r)});return o.createElement("div",{className:"select-field"},o.createElement("label",null,e("issue-repo")),o.createElement("select",{value:r.id,onChange:this.handleRepoChange},i))},renderLabelSelector:function(){var e=this,t=this.getSelectedRepo();if(!t)return null;for(var n=this.getIssueProperty("labels")||[],i=t.details.labels,a=t.details.label_colors,c=s.map(i,function(t,i){var c={className:"tag",style:{backgroundColor:a[i]},"data-label":t,onClick:e.handleTagClick};return s.includes(n,t)&&(c.className+=" selected"),o.createElement("span",r({key:i},c),t)}),l=1;l<c.length;l+=2)c.splice(l,0," ");return o.createElement("div",{className:"tags"},c)},renderButtons:function(){var e=this.props.locale.translate,t=this.getSelectedRepo(),n=this.getIssueProperty("title"),r=!!s.trim(n),i=!1;this.props.issue&&(r=!!this.state.issue&&!s.isEqual(this.state.issue,this.props.issue),this.props.issue&&this.props.issue.id&&(i=!0)),this.props.allowDeletion||(i=!1);var a={label:e("issue-delete"),emphasized:!1,hidden:!i,onClick:this.handleDeleteClick},c={label:e("issue-cancel"),emphasized:!1,onClick:this.handleCancelClick},l={label:e("issue-ok"),emphasized:!0,disabled:!r||!t,onClick:this.handleOKClick};return o.createElement("div",{className:"buttons"},o.createElement("div",{className:"left"},o.createElement(h,a)),o.createElement("div",{className:"right"},o.createElement(h,c),o.createElement(h,l)))},componentDidMount:function(){this.getIssueProperty("title")||this.components.textField.focus()},handleDeleteClick:function(e){this.props.onConfirm&&this.props.onConfirm({type:"confirm",target:this,issue:null})},handleCancelClick:function(e){this.props.onCancel&&this.props.onCancel({type:"cancel",target:this})},handleOKClick:function(e){var t=(this.props.story,s.clone(this.state.issue)),n=this.getSelectedRepo();t.repo_id=n.id,t.labels=s.intersection(t.labels,n.details.labels),this.props.onConfirm&&this.props.onConfirm({type:"close",target:this,issue:t})},handleTitleChange:function(e){var t=e.target.value;this.setIssueProperty("title",t)},handleRepoChange:function(e){var t=parseInt(e.target.value);this.setIssueProperty("repo_id",t)},handleTagClick:function(e){var t=e.target.getAttribute("data-label"),n=this.getIssueProperty("labels")||[];n=s.includes(n,t)?s.difference(n,[t]):s.union(n,[t]),this.setIssueProperty("labels",n)}});var f=parseInt(window.localStorage.last_selected_repo_id)||void 0},"./dialogs/issue-dialog-box.scss":function(e,t){},"./dialogs/media-dialog-box.jsx":function(e,t,n){"use strict";var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s=n("../../common/node_modules/lodash/lodash.js"),o=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),i=n("../../common/node_modules/react/react.js"),a=i.PropTypes,c=n("../node_modules/hammerjs/hammer.js"),l=n("../../common/src/locale/locale.js"),u=n("../../common/src/theme/theme.js"),d=n("../../common/src/widgets/overlay.jsx"),p=n("./widgets/push-button.jsx"),h=n("../../common/src/widgets/resource-view.jsx");n("./dialogs/media-dialog-box.scss"),e.exports=i.createClass({displayName:"MediaDialogBox",propTypes:{show:a.bool,resources:a.arrayOf(a.object).isRequired,selectedIndex:a.number.isRequired,locale:a.instanceOf(l).isRequired,theme:a.instanceOf(u).isRequired,onClose:a.func},getInitialState:function(){return{selectedIndex:this.props.selectedIndex}},getResourceCount:function(){return this.props.resources.length},getSelectedResourceIndex:function(){var e=this.getResourceCount()-1;return s.min([this.state.selectedIndex,e])},selectResource:function(e){var t=this;return new o(function(n,r){var s=t.getResourceCount();e>=0&&e<s?t.setState({selectedIndex:e},function(){n(e)}):n(t.getSelectedResourceIndex())})},addListeners:function(){document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("mousewheel",this.handleMouseWheel),this.hammer=new c(document.body),this.hammer.on("swipeleft",this.handleSwipeLeft),this.hammer.on("swiperight",this.handleSwipeRight)},removeListeners:function(){document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("mousewheel",this.handleMouseWheel),this.hammer&&(this.hammer.off("swipeleft",this.handleSwipeLeft),this.hammer.off("swiperight",this.handleSwipeRight),this.hammer.element.style.touchAction="",this.hammer.destroy(),this.hammer=null)},componentWillMount:function(){this.props.show&&this.addListeners()},componentWillReceiveProps:function(e){if(this.props.show!==e.show)if(e.show)this.setState({selectedIndex:e.selectedIndex}),this.addListeners();else{var t=this.refs.video;t&&t.pause(),this.removeListeners()}},render:function(){var e={show:this.props.show,onBackgroundClick:this.props.onClose};return i.createElement(d,e,i.createElement("div",{className:"media-dialog-box"},this.renderView(),i.createElement("div",{className:"controls"},this.renderThumbnails(),this.renderButtons())))},renderView:function(){var e=this,t=this.getSelectedResourceIndex(),n=this.props.resources[t];if(n){var r=document.body.parentNode,o=r.clientWidth,a=r.clientHeight;"single-col"===this.props.theme.mode?(o-=10,a-=100):(o-=100,a-=200);var c,l,u=o/a;s.each(this.props.resources,function(t){var n=e.props.theme.getDimensions(t,{clip:null});c>=n.width||(c=n.width),l>=n.height||(l=n.height)});var d=c/l;u>d?l>a&&(l=a,c=Math.round(l*d)):c>o&&(c=o,l=Math.round(c/d));var p,h={width:c,height:l};switch(n.type){case"image":p=this.renderImage(n,c,l);break;case"video":p=this.renderVideo(n,c,l)}return i.createElement("div",{className:"container",style:h},p)}},renderImage:function(e,t,n){var r={key:this.getSelectedResourceIndex(),resource:e,width:e.width,height:e.height,theme:this.props.theme,clip:!1,animation:!0};return r.width>t&&(r.height=Math.round(t*(r.height/r.width)),r.width=t),r.height>n&&(r.width=Math.round(n*(r.width/r.height)),r.height=n),i.createElement(h,r)},renderVideo:function(e){var t=this.props.theme,n=t.getVideoURL(e),r=t.getDimensions(e,{clip:null}),s=t.getImageURL(e,{width:r.width,height:r.height,clip:null,quality:60}),o={ref:"video",src:n,controls:!0,autoPlay:!0,poster:s};return i.createElement("video",o)},renderThumbnails:function(e){var t=this,n=this.getSelectedResourceIndex(),o=s.map(this.props.resources,function(e,s){var o={className:"thumbnail","data-index":s,onClick:t.handleThumbnailClick};s===n&&(o.className+=" selected");var a={resource:e,theme:t.props.theme,width:28,height:28};return i.createElement("div",r({key:s},o),i.createElement(h,a))});return i.createElement("div",{className:"links"},o)},renderButtons:function(){var e=this.props.locale.translate,t={label:e("media-download-original"),emphasized:!1,hidden:"single-col"===this.props.theme.mode,onClick:this.handleDownloadClick},n={label:e("media-close"),emphasized:!0,onClick:this.props.onClose};return i.createElement("div",{className:"buttons"},i.createElement(p,t),i.createElement(p,n))},componentWillUnmount:function(){this.removeListeners()},handleThumbnailClick:function(e){var t=parseInt(e.currentTarget.getAttribute("data-index"));return this.selectResource(t)},handleDownloadClick:function(e){var t=this.getSelectedResourceIndex(),n=this.props.resources[t];if(n){var r,s=document.createElement("A"),o=this.props.theme;switch(n.type){case"image":r=o.getImageURL(n,{original:!0});break;case"video":r=o.getVideoURL(n,{original:!0})}s.href=r,s.download=n.filename||!0,s.click()}},changeSelection:function(e){if(e){var t=this.getResourceCount(),n=this.getSelectedResourceIndex()+e;n>=t?n=0:n<0&&(n=t-1),this.selectResource(n)}},handleKeyDown:function(e){var t=0;if(39===e.keyCode)t=1;else{if(37!=e.keyCode)return;t=-1}this.changeSelection(t),e.preventDefault()},handleMouseWheel:function(e){var t,n=0;if((t=Math.abs(e.deltaX)>=Math.abs(e.deltaY)?e.deltaX:e.deltaY)>0)n=1;else{if(!(t<0))return;n=-1}this.changeSelection(n),e.preventDefault()},handleSwipeLeft:function(e){this.changeSelection(-1)},handleSwipeRight:function(e){this.changeSelection(1)}})},"./dialogs/media-dialog-box.scss":function(e,t){},"./dialogs/membership-request-dialog-box.jsx":function(e,t,n){"use strict";var r=n("../../common/node_modules/lodash/lodash.js"),s=n("../../common/node_modules/react/react.js"),o=s.PropTypes,i=(n("../node_modules/relaks/index.js"),n("../../common/src/objects/utils/user-utils.js")),a=n("../../common/src/locale/locale.js"),c=n("../../common/src/theme/theme.js"),l=n("../../common/src/widgets/overlay.jsx"),u=n("./widgets/push-button.jsx"),d=n("../../common/src/widgets/resource-view.jsx"),p=n("./widgets/scrollable.jsx"),h=n("../../common/src/widgets/collapsible-container.jsx");n("./dialogs/membership-request-dialog-box.scss"),e.exports=s.createClass({displayName:"MembershipRequestDialogBox",propTypes:{show:o.bool,currentUser:o.object.isRequired,project:o.object.isRequired,locale:o.instanceOf(a).isRequired,theme:o.instanceOf(c).isRequired,onConfirm:o.func,onRevoke:o.func,onClose:o.func,onProceed:o.func},getInitialState:function(){return{userJustJoined:!1}},render:function(){var e={show:this.props.show,onBackgroundClick:this.handleCloseClick},t=["membership-request-dialog-box"];return s.createElement(l,e,s.createElement("div",{className:t.join(" ")},this.renderText(),this.renderMessage(),this.renderButtons()))},renderText:function(){var e=this.props.locale.pick,t=this.props.project,n=r.find(t.details.resources,{type:"image"});return s.createElement(p,null,s.createElement("div",{className:"title"},e(t.details.title)||t.name),s.createElement("div",{className:"description"},s.createElement("div",{className:"image"},s.createElement(d,{resource:n,width:160,theme:this.props.theme})),e(t.details.description)))},renderMessage:function(){var e=this.props.locale.translate,t=this.props.locale.name,n=this.props.currentUser,r=this.props.project,o=n?t(n.details.name,n.details.gender):null,a="",c="",l="";return i.isMember(n,r)?(a="accepted",c="user-circle-o",l=this.state.userJustJoined?e("membership-request-$you-are-now-member",o):e("membership-request-$you-are-member",o)):i.isPendingMember(n,r)&&(a="requested",c="clock-o",l=e("membership-request-$you-have-requested-membership",o)),s.createElement(h,{open:!!c},s.createElement("div",{className:"message "+a},s.createElement("i",{className:"fa fa-"+c})," ",l))},renderButtons:function(){var e=this.props.locale.translate,t=this.props.currentUser,n=this.props.project;if(i.isMember(t,n)){var r={label:e("membership-request-cancel"),onClick:this.handleCloseClick},o={label:e("membership-request-proceed"),onClick:this.handleProceedClick,emphasized:!0};return s.createElement("div",{className:"buttons"},s.createElement(u,r),s.createElement(u,o))}if(i.isPendingMember(t,n)){var r={label:e("membership-request-cancel"),onClick:this.handleCloseClick},a={label:e("membership-request-withdraw"),onClick:this.handleWithdrawClick},c={label:e("membership-request-browse"),onClick:this.handleProceedClick,hidden:!i.canViewProject(t,n),emphasized:!0};return s.createElement("div",{className:"buttons"},s.createElement(u,r),s.createElement(u,a),s.createElement(u,c))}var r={label:e("membership-request-cancel"),onClick:this.handleCloseClick},c={label:e("membership-request-browse"),onClick:this.handleProceedClick,hidden:!i.canViewProject(t,n),emphasized:!i.canJoinProject(t,n)},l={label:e("membership-request-join"),onClick:this.handleJoinClick,hidden:!i.canJoinProject(t,n),emphasized:!0};return s.createElement("div",{className:"buttons"},s.createElement(u,r),s.createElement(u,c),s.createElement(u,l))},handleJoinClick:function(e){this.setState({userJustJoined:!0}),this.props.onConfirm&&this.props.onConfirm({type:"confirm",target:this})},handleWithdrawClick:function(e){this.props.onRevoke&&this.props.onRevoke({type:"revoke",target:this})},handleCloseClick:function(e){this.props.onClose&&this.props.onClose({type:"cancel",target:this})},handleProceedClick:function(e){this.props.onProceed&&this.props.onProceed({type:"proceed",target:this})}})},"./dialogs/membership-request-dialog-box.scss":function(e,t){},"./dialogs/mobile-setup-dialog-box.jsx":function(e,t,n){"use strict";function r(e){if(!e)return e;var t=e.match(/.{1,4}/g);return _.toUpper(t.join(" "))}var s=n("../../common/node_modules/react/react.js"),o=s.PropTypes,i=n("../node_modules/relaks/index.js"),a=n("../../common/src/routing/universal-link.js"),c=n("../../common/src/objects/finders/device-finder.js"),l=n("../../common/src/objects/finders/user-finder.js"),u=n("../../common/src/data/database.js"),d=n("../../common/src/routing/route.js"),p=n("../../common/src/locale/locale.js"),h=n("../../common/src/widgets/overlay.jsx"),m=n("./widgets/push-button.jsx"),f=n("./widgets/qr-code.jsx");n("./dialogs/mobile-setup-dialog-box.scss"),e.exports=i.createClass({displayName:"MobileSetupDialogBox.Sync",propTypes:{show:o.bool,system:o.object,database:o.instanceOf(u).isRequired,route:o.instanceOf(d).isRequired,locale:o.instanceOf(p).isRequired,onClose:o.func},renderAsync:function(e){var t=this.props.database.use({by:this}),n={activationCode:null,currentUser:null,devices:null,show:this.props.show,system:this.props.system,route:this.props.route,locale:this.props.locale,onClose:this.props.onClose};return e.show(s.createElement(g,n)),t.start().then(function(e){return l.findUser(t,e).then(function(e){n.currentUser=e})}).then(function(){return t.beginMobileSession("client").then(function(e){n.activationCode=e})}).then(function(){return c.findUserDevices(t,n.currentUser).then(function(e){n.devices=e})}).then(function(){return s.createElement(g,n)})},componentWillUnmount:function(){this.props.database.use({by:this}).releaseMobileSession()}});var g=e.exports.Sync=s.createClass({displayName:"MobileSetupDialogBox.Sync",propTypes:{show:o.bool,activationCode:o.string,devices:o.arrayOf(o.object),currentUser:o.object,route:o.instanceOf(d).isRequired,locale:o.instanceOf(p).isRequired,onClose:o.func},componentWillReceiveProps:function(e){if(this.props.devices!==e.devices){var t=e.activationCode;t&&_.some(e.devices,{session_handle:t})&&this.props.onClose&&this.props.onClose({type:"close",target:this})}},render:function(){var e={show:this.props.show,onBackgroundClick:this.props.onClose};return s.createElement(h,e,s.createElement("div",{className:"mobile-setup-dialog-box"},this.renderContents(),this.renderButtons()))},renderContents:function(){var e,t=this.props.locale.translate,o=(this.props.number,this.props.route),i=_.get(this.props.system,"settings.address");i||(i=o.parameters.address);var c=o.parameters.schema,l=this.props.activationCode;if(l){var u=n("./pages/start-page.jsx"),d=u.getURL({activationCode:l,schema:c});e=a.form(i,d.path,d.query),console.log(e)}return s.createElement("div",{className:"contents"},s.createElement(f,{text:e,scale:6}),s.createElement("div",{className:"info"},s.createElement("div",{className:"label"},t("mobile-setup-address")),s.createElement("div",{className:"value"},i),s.createElement("div",{className:"label"},t("mobile-setup-code")),s.createElement("div",{className:"value"},r(l)),s.createElement("div",{className:"label"},t("mobile-setup-project")),s.createElement("div",{className:"value"},c)))},renderButtons:function(){var e=this.props.locale.translate,t={label:e("mobile-setup-close"),emphasized:!0,onClick:this.props.onClose};return s.createElement("div",{className:"buttons"},s.createElement(m,t))}})},"./dialogs/mobile-setup-dialog-box.scss":function(e,t){},"./dialogs/photo-capture-dialog-box-browser.jsx":function(e,t,n){"use strict";var r=n("../../common/node_modules/lodash/lodash.js"),s=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),o=n("../../common/node_modules/react/react.js"),i=o.PropTypes,a=n("../../common/src/media/frame-grabber.js"),c=n("../../common/src/media/device-manager.js"),l=n("../../common/src/media/media-stream-utils.js"),u=n("../../common/src/transport/blob-manager.js"),d=n("../../common/src/transport/payloads.js"),p=n("../../common/src/locale/locale.js"),h=n("../../common/src/widgets/overlay.jsx"),m=n("./widgets/push-button.jsx"),f=n("./widgets/device-selector.jsx"),g=n("./widgets/device-placeholder.jsx");n("./dialogs/photo-capture-dialog-box-browser.scss"),e.exports=o.createClass({displayName:"PhotoCaptureDialogBox",propTypes:{show:i.bool,cameraDirection:i.oneOf(["front","back"]),payloads:i.instanceOf(d).isRequired,locale:i.instanceOf(p).isRequired,onClose:i.func,onCapturePending:i.func,onCaptureError:i.func,onCapture:i.func},statics:{isAvailable:function(){return!!l.hasSupport()&&("function"==typeof HTMLCanvasElement.prototype.toBlob||"function"==typeof HTMLCanvasElement.prototype.toDataURL)}},getInitialState:function(){var e=c.getDevices("videoinput"),t=f.choose(e,this.props.cameraDirection);return{liveVideoStream:null,liveVideoError:null,liveVideoWidth:640,liveVideoHeight:480,capturedImage:null,videoDevices:e,selectedDeviceId:t?t.deviceId:null}},componentWillMount:function(){this.props.show&&this.initializeCamera(),c.addEventListener("change",this.handleDeviceChange)},componentWillReceiveProps:function(e){var t=this;this.props.show!==e.show&&(e.show?(this.setState({capturedImage:null}),this.initializeCamera()):setTimeout(function(){t.shutdownCamera(),t.setState({capturedImage:null})},500))},initializeCamera:function(){var e=this;this.createLiveVideoStream().then(function(t){var n=l.getVideoDimensions(t);e.setState({liveVideoStream:t,liveVideoError:null,liveVideoWidth:n.width,liveVideoHeight:n.height})}).catch(function(t){console.error(t),e.setState({liveVideoStream:null,liveVideoError:t})})},shutdownCamera:function(){var e=this;this.destroyLiveVideoStream().then(function(){e.setState({liveVideoStream:null,liveVideoError:null})})},reinitializeCamera:function(){var e=this;this.destroyLiveVideoStream().then(function(){e.initializeCamera()})},setLiveVideoNode:function(e){var t=this;this.videoNode=e,this.videoNode&&(this.videoNode.srcObject=this.state.liveVideoStream,this.videoNode.play(),l.getActualVideoDimensions(e,function(e){t.state.liveVideoWidth===e.width&&t.state.liveVideoHeight===e.height||t.setState({liveVideoWidth:e.width,liveVideoHeight:e.height})}))},render:function(){var e={show:this.props.show,onBackgroundClick:this.handleCancelClick};return o.createElement(h,e,o.createElement("div",{className:"photo-capture-dialog-box"},o.createElement("div",{className:"container"},this.renderView()),o.createElement("div",{className:"controls"},this.renderDeviceSelector(),this.renderButtons())))},renderView:function(){return this.state.capturedImage?this.renderCapturedImage():this.state.liveVideoStream?this.renderLiveVideo():this.renderPlaceholder()},renderPlaceholder:function(){var e={blocked:!!this.state.liveVideoError,icon:"camera"};return o.createElement(g,e)},renderLiveVideo:function(){var e={ref:this.setLiveVideoNode,className:"live-video",muted:!0};return o.createElement("div",null,this.renderSpacer(),o.createElement("video",e))},renderSpacer:function(){var e={className:"spacer",width:this.state.liveVideoWidth,height:this.state.liveVideoHeight};return o.createElement("canvas",e)},renderCapturedImage:function(){var e={className:"preview",src:this.state.capturedImage.url};return o.createElement("div",null,this.renderSpacer(),o.createElement("img",e))},renderDeviceSelector:function(){if(this.state.capturedImage)return null;var e={type:"video",devices:this.state.videoDevices,selectedDeviceId:this.state.selectedDeviceId,locale:this.props.locale,onSelect:this.handleDeviceSelect};return o.createElement(f,e)},renderButtons:function(){var e=this.props.locale.translate;if(this.state.capturedImage){var t={label:e("photo-capture-retake"),onClick:this.handleRetakeClick},n={label:e("photo-capture-accept"),onClick:this.handleAcceptClick,emphasized:!0};return o.createElement("div",{className:"buttons"},o.createElement(m,t),o.createElement(m,n))}var r={label:e("photo-capture-cancel"),onClick:this.handleCancelClick},s={label:e("photo-capture-snap"),onClick:this.handleSnapClick,disabled:!this.state.liveVideoStream,emphasized:!0};return o.createElement("div",{className:"buttons"},o.createElement(m,r),o.createElement(m,s))},componentDidUpdate:function(e,t){this.videoNode&&t.liveVideoStream!==this.state.liveVideoStream&&this.setLiveVideoNode(this.videoNode)},componentWillUnmount:function(){this.destroyLiveVideoStream(),c.removeEventListener("change",this.handleDeviceChange)},createLiveVideoStream:function(){return this.videoStreamPromise||(this.videoStreamPromise=l.getSilentVideoStream(this.state.selectedDeviceId)),this.videoStreamPromise},destroyLiveVideoStream:function(){if(!this.videoStreamPromise)return s.resolve();var e=this.videoStreamPromise;return this.videoStreamPromise=null,e.then(function(e){l.stopAllTracks(e)})},captureImage:function(){var e=this.videoNode;return a.capture(e).then(function(t){return{url:u.manage(t),blob:t,width:e.videoWidth,height:e.videoHeight}})},triggerCaptureEvent:function(e){this.props.onCapture&&this.props.onCapture({type:"capture",target:this,resource:e})},triggerCloseEvent:function(){this.props.onClose&&this.props.onClose({type:"close",target:this})},handleSnapClick:function(e){var t=this;this.captureImage().then(function(e){t.setState({capturedImage:e})}).catch(function(e){console.error(e)})},handleRetakeClick:function(e){u.release(this.state.capturedImage.blob),this.setState({capturedImage:null})},handleAcceptClick:function(e){var t=this.state.capturedImage,n=this.props.payloads.add("image");n.attachFile(t.blob);var r=(n.token,{type:"image",payload_token:n.token,width:t.width,height:t.height,format:"jpeg"});this.triggerCloseEvent(!0),this.triggerCaptureEvent(r)},handleCancelClick:function(e){this.triggerCloseEvent(!1)},handleDeviceSelect:function(e){var t=this,n=e.currentTarget.value;this.setState({selectedDeviceId:n},function(){t.reinitializeCamera()})},handleDeviceChange:function(e){var t=this,n=c.getDevices("videoinput"),s=this.state.selectedDeviceId,o=!1;s&&(r.some(n,{deviceId:s})||(s=null,o=!0)),this.setState({videoDevices:n,selectedDeviceId:s},function(){o&&t.reinitializeCamera()})}})},"./dialogs/photo-capture-dialog-box-browser.scss":function(e,t){},"./dialogs/photo-capture-dialog-box.jsx":function(e,t,n){"use strict";e.exports=n("./dialogs/photo-capture-dialog-box-browser.jsx")},"./dialogs/project-description-dialog-box.jsx":function(e,t,n){"use strict";var r=n("../../common/node_modules/lodash/lodash.js"),s=n("../../common/node_modules/react/react.js"),o=s.PropTypes,i=n("../../common/src/locale/locale.js"),a=n("../../common/src/theme/theme.js"),c=n("../../common/src/widgets/overlay.jsx"),l=n("./widgets/push-button.jsx"),u=n("../../common/src/widgets/resource-view.jsx"),d=n("./widgets/scrollable.jsx");n("./dialogs/project-description-dialog-box.scss"),e.exports=s.createClass({displayName:"ProjectDescriptionDialogBox",propTypes:{show:o.bool,project:o.object.isRequired,locale:o.instanceOf(i).isRequired,theme:o.instanceOf(a).isRequired,onClose:o.func},render:function(){var e={show:this.props.show,onBackgroundClick:this.handleCloseClick};return s.createElement(c,e,s.createElement("div",{className:"project-description-dialog-box"},this.renderText(),this.renderButtons()))},renderText:function(){var e=this.props.locale.pick,t=this.props.project,n=r.find(t.details.resources,{type:"image"});return s.createElement(d,null,s.createElement("div",{className:"title"},e(t.details.title)||t.name),s.createElement("div",{className:"description"},s.createElement("div",{className:"image"},s.createElement(u,{resource:n,width:160,theme:this.props.theme})),e(t.details.description)))},renderButtons:function(){var e=this.props.locale.translate,t={label:e("project-description-close"),emphasized:!0,onClick:this.handleCloseClick};return s.createElement("div",{className:"buttons"},s.createElement(l,t))},handleCloseClick:function(e){this.props.onClose&&this.props.onClose({type:"cancel",target:this})}})},"./dialogs/project-description-dialog-box.scss":function(e,t){},"./dialogs/project-management-dialog-box.jsx":function(e,t,n){"use strict";var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s=n("../../common/node_modules/lodash/lodash.js"),o=n("../../common/node_modules/react/react.js"),i=o.PropTypes,a=(n("../node_modules/relaks/index.js"),n("../../common/src/routing/route.js")),c=n("../../common/src/locale/locale.js"),l=n("../../common/src/widgets/overlay.jsx"),u=n("./widgets/push-button.jsx"),d=n("./widgets/scrollable.jsx"),p=n("./widgets/option-button.jsx");n("./dialogs/project-management-dialog-box.scss"),e.exports=o.createClass({displayName:"ProjectManagementDialogBox",propTypes:{show:i.bool,projectLinks:i.arrayOf(i.object).isRequired,route:i.instanceOf(a).isRequired,locale:i.instanceOf(c).isRequired,onDelete:i.func,onCancel:i.func},getInitialState:function(){return{selection:[]}},render:function(){var e={show:this.props.show,onBackgroundClick:this.handleCancelClick};return o.createElement(l,e,o.createElement("div",{className:"project-management-dialog-box"},this.renderList(),this.renderButtons()))},renderList:function(){return o.createElement(d,null,s.map(this.props.projectLinks,this.renderProjectButton))},renderProjectButton:function(e,t){var n=this.props.locale.pick,i={id:e.key,label:n(e.name),iconOn:"times-circle",selected:s.includes(this.state.selection,e.key),onClick:this.handleProjectClick};return o.createElement(p,r({key:t},i))},renderButtons:function(){var e=this.props.locale.translate,t={label:e("project-management-cancel"),onClick:this.handleCancelClick},n={label:e("project-management-remove"),onClick:this.handleRemoveClick,emphasized:!0,disabled:s.isEmpty(this.state.selection)};return o.createElement("div",{className:"buttons"},o.createElement(u,t),o.createElement(u,n))},handleProjectClick:function(e){var t=e.currentTarget.id,n=s.slice(this.state.selection);s.includes(n,t)?s.pull(n,t):n.push(t),this.setState({selection:n})},handleRemoveClick:function(e){this.props.onDelete&&this.props.onDelete({type:"delete",target:this,selection:this.state.selection})},handleCancelClick:function(e){this.props.onCancel&&this.props.onCancel({type:"cancel",target:this})}})},"./dialogs/project-management-dialog-box.scss":function(e,t){},"./dialogs/system-description-dialog-box.jsx":function(e,t,n){"use strict";var r=n("../../common/node_modules/lodash/lodash.js"),s=n("../../common/node_modules/react/react.js"),o=s.PropTypes,i=n("../../common/src/locale/locale.js"),a=n("../../common/src/theme/theme.js"),c=n("../../common/src/widgets/overlay.jsx"),l=n("./widgets/push-button.jsx"),u=n("./widgets/scrollable.jsx");n("./dialogs/system-description-dialog-box.scss"),e.exports=s.createClass({displayName:"SystemDescriptionDialogBox",propTypes:{show:o.bool,system:o.object.isRequired,locale:o.instanceOf(i).isRequired,theme:o.instanceOf(a).isRequired,onClose:o.func},render:function(){var e={show:this.props.show,onBackgroundClick:this.handleCloseClick};return s.createElement(c,e,s.createElement("div",{className:"system-description-dialog-box"},this.renderText(),this.renderButtons()))},renderText:function(){var e=this.props.locale.pick,t=this.props.system,n=e(r.get(t,"details.title")),o=e(r.get(t,"details.description"));return s.createElement(u,null,s.createElement("div",{className:"title"},n),s.createElement("div",{className:"description"},o))},renderButtons:function(){var e=this.props.locale.translate,t={label:e("project-description-close"),emphasized:!0,onClick:this.handleCloseClick};return s.createElement("div",{className:"buttons"},s.createElement(l,t))},handleCloseClick:function(e){this.props.onClose&&this.props.onClose({type:"cancel",target:this})}})},"./dialogs/system-description-dialog-box.scss":function(e,t){},"./dialogs/telephone-number-dialog-box.jsx":function(e,t,n){"use strict";var r=n("../../common/node_modules/react/react.js"),s=r.PropTypes,o=n("../../common/src/locale/locale.js"),i=n("../../common/src/widgets/overlay.jsx"),a=n("./widgets/push-button.jsx"),c=n("./widgets/qr-code.jsx");n("./dialogs/telephone-number-dialog-box.scss"),e.exports=r.createClass({displayName:"TelephoneNumberDialogBox",propTypes:{show:s.bool,number:s.string,locale:s.instanceOf(o).isRequired,onClose:s.func},render:function(){var e={show:this.props.show,onBackgroundClick:this.props.onClose};return r.createElement(i,e,r.createElement("div",{className:"telephone-number-dialog-box"},this.renderContents(),this.renderButtons()))},renderContents:function(){var e=this.props.number,t="tel:"+e;return r.createElement("div",{className:"contents"},r.createElement(c,{text:t,scale:6}),r.createElement("div",{className:"number"},e))},renderButtons:function(){var e=this.props.locale.translate,t={label:e("telephone-dialog-close"),emphasized:!0,onClick:this.props.onClose};return r.createElement("div",{className:"buttons"},r.createElement(a,t))}})},"./dialogs/telephone-number-dialog-box.scss":function(e,t){},"./dialogs/user-selection-dialog-box.jsx":function(e,t,n){"use strict";var r=n("../../common/node_modules/lodash/lodash.js"),s=n("../../common/node_modules/react/react.js"),o=s.PropTypes,i=(n("../node_modules/relaks/index.js"),n("../../common/src/data/database.js")),a=n("../../common/src/routing/route.js"),c=n("../../common/src/locale/locale.js"),l=n("../../common/src/theme/theme.js"),u=n("../../common/src/widgets/overlay.jsx"),d=n("./widgets/push-button.jsx"),p=n("./widgets/scrollable.jsx"),h=n("./lists/user-selection-list.jsx");n("./dialogs/user-selection-dialog-box.scss"),e.exports=s.createClass({displayName:"UserSelectionDialogBox",propTypes:{show:o.bool,selection:o.arrayOf(o.number).isRequired,disabled:o.arrayOf(o.number),database:o.instanceOf(i).isRequired,route:o.instanceOf(a).isRequired,locale:o.instanceOf(c).isRequired,theme:o.instanceOf(l).isRequired,onSelect:o.func,onCancel:o.func},getInitialState:function(){return{selection:this.props.selection}},componentWillReceiveProps:function(e){this.props.selection!==e.selection&&this.setState({selection:e.selection})},render:function(){var e={show:this.props.show,onBackgroundClick:this.handleCancelClick};return s.createElement(u,e,s.createElement("div",{className:"user-selection-dialog-box"},this.renderList(),this.renderButtons()))},renderList:function(){var e={selection:this.state.selection,disabled:this.props.disabled,database:this.props.database,route:this.props.route,locale:this.props.locale,theme:this.props.theme,onSelect:this.handleListSelect};return s.createElement(p,null,s.createElement(h,e))},renderButtons:function(){var e=this.props.locale.translate,t={label:e("selection-cancel"),onClick:this.handleCancelClick},n={label:e("selection-ok"),onClick:this.handleOKClick,emphasized:!0};return s.createElement("div",{className:"buttons"},s.createElement(d,t),s.createElement(d,n))},handleListSelect:function(e){var t=e.selection;r.isEqual(t,this.props.selection)&&(t=this.props.selection),this.setState({selection:t})},handleOKClick:function(e){this.props.onSelect&&this.props.onSelect({type:"select",target:this,selection:this.state.selection})},handleCancelClick:function(e){this.props.onCancel&&this.props.onCancel({type:"cancel",target:this})}})},"./dialogs/user-selection-dialog-box.scss":function(e,t){},"./dialogs/video-capture-dialog-box-browser.jsx":function(e,t,n){"use strict";var r=n("../../common/node_modules/lodash/lodash.js"),s=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),o=n("../../common/node_modules/react/react.js"),i=o.PropTypes,a=n("../../common/src/media/frame-grabber.js"),c=n("../../common/src/media/device-manager.js"),l=n("../../common/src/media/media-stream-utils.js"),u=(n("../../common/src/transport/blob-manager.js"),n("../../common/src/transport/payloads.js")),d=n("../../common/src/locale/locale.js"),p=n("../../common/src/widgets/overlay.jsx"),h=n("./widgets/push-button.jsx"),m=n("./widgets/device-selector.jsx"),f=n("./widgets/device-placeholder.jsx"),g=n("./widgets/duration-indicator.jsx");n("./dialogs/video-capture-dialog-box-browser.scss"),e.exports=o.createClass({displayName:"VideoCaptureDialogBox",propTypes:{show:i.bool,payloads:i.instanceOf(u).isRequired,locale:i.instanceOf(d).isRequired,onClose:i.func,onCapturePending:i.func,onCaptureError:i.func,onCapture:i.func},statics:{isAvailable:function(){return!!l.hasSupport()&&"function"==typeof MediaRecorder}},getInitialState:function(){var e=c.getDevices("videoinput"),t=m.choose(e,this.props.cameraDirection);return{liveVideoStream:null,liveVideoError:null,liveVideoWidth:640,liveVideoHeight:480,mediaRecorder:null,capturedVideo:null,capturedImage:null,previewURL:null,videoDevices:e,selectedDeviceId:t?t.deviceId:null,startTime:null,duration:0}},componentWillMount:function(){this.props.show&&this.initializeCamera(),c.addEventListener("change",this.handleDeviceChange)},componentWillReceiveProps:function(e){var t=this;this.props.show!==e.show&&(e.show?(this.clearCapturedVideo(),this.initializeCamera()):setTimeout(function(){t.shutdownCamera(),t.clearCapturedVideo()},500))},clearCapturedVideo:function(){this.state.capturedVideo&&(URL.revokeObjectURL(this.state.previewURL),this.setState({capturedVideo:null,capturedImage:null,previewURL:null}))},initializeCamera:function(){var e=this;return this.createLiveVideoStream().then(function(t){var n=l.getVideoDimensions(t);e.setState({liveVideoStream:t,liveVideoError:null,liveVideoWidth:n.width,liveVideoHeight:n.height})}).catch(function(t){e.setState({liveVideoStream:null,liveVideoError:t})})},shutdownCamera:function(){var e=this;this.destroyLiveVideoStream().then(function(){e.setState({liveVideoStream:null,liveVideoError:null})})},reinitializeCamera:function(){var e=this;this.destroyLiveVideoStream().then(function(){e.initializeCamera()})},setLiveVideoNode:function(e){var t=this;this.videoNode=e,this.videoNode&&(this.videoNode.srcObject=this.state.liveVideoStream,this.videoNode.play(),l.getActualVideoDimensions(e,function(e){t.state.liveVideoWidth===e.width&&t.state.liveVideoHeight===e.height||t.setState({liveVideoWidth:e.width,liveVideoHeight:e.height})}))},render:function(){var e={show:this.props.show,onBackgroundClick:this.handleCancelClick};return o.createElement(p,e,o.createElement("div",{className:"video-capture-dialog-box"},o.createElement("div",{className:"container"},this.renderView()),o.createElement("div",{className:"controls"},this.renderDeviceSelector(),this.renderButtons(),this.renderDuration())))},renderView:function(){return this.state.capturedVideo?this.renderCapturedVideo():this.state.liveVideoStream?this.renderLiveVideo():this.renderPlaceholder()},renderPlaceholder:function(){var e={blocked:!!this.state.liveVideoError,icon:"video-camera"};return o.createElement(f,e)},renderLiveVideo:function(){var e={ref:this.setLiveVideoNode,key:"live",className:"live-video",muted:!0};return o.createElement("div",null,this.renderSpacer(),o.createElement("video",e))},renderSpacer:function(){var e={className:"spacer",width:this.state.liveVideoWidth,height:this.state.liveVideoHeight};return o.createElement("canvas",e)},renderCapturedVideo:function(){var e={key:"preview",className:"preview",src:this.state.previewURL,controls:!0};return o.createElement("div",null,this.renderSpacer(),o.createElement("video",e))},renderDeviceSelector:function(){if(this.state.mediaRecorder)return null;if(this.state.capturedVideo)return null;var e={type:"video",devices:this.state.videoDevices,selectedDeviceId:this.state.selectedDeviceId,locale:this.props.locale,onSelect:this.handleDeviceSelect};return o.createElement(m,e)},renderDuration:function(){if(!this.state.mediaRecorder)return null;var e={duration:this.state.duration,startTime:this.state.startTime};return o.createElement(g,e)},renderButtons:function(){var e=this.props.locale.translate;if(this.state.mediaRecorder){var t="paused"===this.state.mediaRecorder.state,n={label:e("video-capture-pause"),onClick:this.handlePauseClick,hidden:t},r={label:e("video-capture-resume"),onClick:this.handleResumeClick,hidden:!t,emphasized:!0},s={label:e("video-capture-stop"),onClick:this.handleStopClick,emphasized:!t};return o.createElement("div",{className:"buttons"},o.createElement(h,n),o.createElement(h,r),o.createElement(h,s))}if(this.state.capturedVideo){var i={label:e("video-capture-retake"),onClick:this.handleRetakeClick},a={label:e("video-capture-accept"),onClick:this.handleAcceptClick,emphasized:!0};return o.createElement("div",{className:"buttons"},o.createElement(h,i),o.createElement(h,a))}var c={label:e("video-capture-cancel"),onClick:this.handleCancelClick},l={label:e("video-capture-start"),onClick:this.handleStartClick,disabled:!this.state.liveVideoStream,emphasized:!0};return o.createElement("div",{className:"buttons"},o.createElement(h,c),o.createElement(h,l))},componentDidUpdate:function(e,t){this.videoNode&&t.liveVideoStream!==this.state.liveVideoStream&&this.setLiveVideoNode(this.videoNode)},componentWillUnmount:function(){this.destroyLiveVideoStream(),this.clearCapturedVideo(),c.removeEventListener("change",this.handleDeviceChange)},createLiveVideoStream:function(){return this.videoStreamPromise||(this.videoStreamPromise=l.getVideoStream(this.state.selectedDeviceId)),this.videoStreamPromise},destroyLiveVideoStream:function(){if(!this.videoStreamPromise)return s.resolve();var e=this.videoStreamPromise;return this.videoStreamPromise=null,e.then(function(e){l.stopAllTracks(e)})},captureImage:function(){var e=this.videoNode;return a.capture(e).then(function(t){return{blob:t,width:e.videoWidth,height:e.videoHeight}})},beginRecording:function(){var e=this;return s.try(function(){var t={audioBitsPerSecond:128e3,videoBitsPerSecond:25e5,mimeType:"video/webm"},n=new MediaRecorder(e.state.liveVideoStream,t),r=e.props.payloads.stream();return n.outputStream=r,n.promise=new s(function(e,t){n.resolve=e,n.reject=t}),n.addEventListener("dataavailable",function(e){this.outputStream.push(e.data)}),n.addEventListener("stop",function(e){this.outputStream.close(),n.resolve()}),n.start(3e3),r.start(),n})},pauseRecording:function(){var e=this;return s.try(function(){var t=e.state.mediaRecorder;t&&t.pause()})},resumeRecording:function(){var e=this;return s.try(function(){var t=e.state.mediaRecorder;t&&t.resume()})},endRecording:function(){var e=this;return s.try(function(){var t=e.state.mediaRecorder;if(t)return t.stop(),t.promise})},triggerCaptureEvent:function(e){this.props.onCapture&&this.props.onCapture({type:"capture",target:this,resource:e})},triggerCloseEvent:function(){this.props.onClose&&this.props.onClose({type:"close",target:this})},handleStartClick:function(e){var t=this;return s.join(this.captureImage(),this.beginRecording(),function(e,n){return t.setState({capturedImage:e,mediaRecorder:n,startTime:new Date,duration:0}),null}).catch(function(e){console.error(e)})},handlePauseClick:function(e){var t=this;return this.pauseRecording().then(function(){var e=new Date,n=e-t.state.startTime,r=t.state.duration+n;t.setState({duration:r,startTime:null})})},handleResumeClick:function(e){var t=this;return this.resumeRecording().then(function(){var e=new Date;t.setState({startTime:e})})},handleStopClick:function(e){var t=this;return this.endRecording().then(function(){var e=t.state.mediaRecorder,n=e.outputStream.toBlob(),s=URL.createObjectURL(n),o=0;if(t.state.startTime){o=new Date-t.state.startTime}var i={format:r.last(r.split(e.mimeType,"/")),audioBitsPerSecond:e.audioBitsPerSecond,videoBitsPerSecond:e.videoBitsPerSecond,stream:e.outputStream,duration:t.state.duration+o};t.setState({capturedVideo:i,previewURL:s,mediaRecorder:null})})},handleRetakeClick:function(e){this.clearCapturedVideo()},handleAcceptClick:function(e){var t=this.state.capturedVideo,n=this.state.capturedImage,r=this.props.payloads.add("video");r.attachStream(t.stream),r.attachFile(n.blob,"poster");var s={type:"video",payload_token:r.token,width:n.width,height:n.height,duration:t.duration,format:t.format,bitrates:{audio:t.audioBitsPerSecond,video:t.videoBitsPerSecond}};this.triggerCloseEvent(),this.triggerCaptureEvent(s)},handleCancelClick:function(e){this.triggerCloseEvent()},handleDeviceSelect:function(e){var t=this,n=e.currentTarget.value;this.setState({selectedDeviceId:n},function(){t.reinitializeCamera()})},handleDeviceChange:function(e){var t=this,n=c.getDevices("videoinput"),s=this.state.selectedDeviceId,o=!1;s&&(r.some(n,{deviceId:s})||(s=null,o=!0)),this.setState({videoDevices:n,selectedDeviceId:s},function(){o&&t.reinitializeCamera()})}})},"./dialogs/video-capture-dialog-box-browser.scss":function(e,t){},"./dialogs/video-capture-dialog-box.jsx":function(e,t,n){"use strict";e.exports=n("./dialogs/video-capture-dialog-box-browser.jsx")},"./editors/audio-editor.jsx":function(e,t,n){"use strict";function r(e){var t=e.resource,n=t.duration;return t.width&&t.height?s.createElement(o,e,s.createElement("div",{className:"audio-duration"},i.format(n))):s.createElement("div",{className:"audio-editor"},s.createElement("div",{className:"graphic"},s.createElement("div",{className:"icon"},s.createElement("i",{className:"fa fa-microphone"})),s.createElement("div",{className:"duration"},i.format(n))))}var s=n("../../common/node_modules/react/react.js"),o=(s.PropTypes,n("./editors/image-editor.jsx")),i=n("./widgets/duration-indicator.jsx");e.exports=r,n("./editors/audio-editor.scss"),r.propTypes=o.propTypes},"./editors/audio-editor.scss":function(e,t){},"./editors/image-editor.jsx":function(e,t,n){"use strict";function r(e){return o.startsWith(e,"json:")}function s(e){var t=e.substr(5);return JSON.parse(t)}var o=n("../../common/node_modules/lodash/lodash.js"),i=(n("../../common/node_modules/bluebird/js/browser/bluebird.js"),n("../../common/node_modules/react/react.js")),a=i.PropTypes,c=n("../../common/src/transport/blob-manager.js"),l=(n("../../common/src/transport/payload.js"),n("../../common/src/media/image-cropping.js")),u=n("../../common/src/utils/focus-manager.js"),d=n("../../common/src/utils/component-refs.js"),p=n("../../common/src/locale/locale.js"),h=n("../../common/src/theme/theme.js"),m=n("../../common/src/mixins/update-check.js"),f=n("../../common/src/widgets/image-cropper.jsx");n("./editors/image-editor.scss"),e.exports=i.createClass({displayName:"ImageEditor",mixins:[m],propTypes:{resource:a.object,locale:a.instanceOf(p).isRequired,theme:a.instanceOf(h).isRequired,previewWidth:a.number,previewHeight:a.number,disabled:a.bool,onChange:a.func},getDefaultProps:function(){return{previewWidth:512,previewHeight:512,disabled:!1}},getInitialState:function(){return this.components=d({imageCropper:f}),{fullImageURL:null,loadedImageURL:null,previewImageURL:null,placeholderMessage:null,placeholderIcon:null}},componentWillMount:function(){this.prepareImage(this.props.resource,this.props.disabled)},componentWillReceiveProps:function(e){this.props.resource===e.resource&&this.props.disabled===e.disabled||this.prepareImage(e.resource,e.disabled)},prepareImage:function(e,t){var n=this,i={fullImageURL:null,previewImageURL:null,placeholderMessage:null,placeholderIcon:null},a=this.props.theme.getImageURL(e,{original:!0});if(a){if(r(a)){var l=s(a);i.fullImageURL=l.url}else{var u=c.find(a);u&&(i.fullImageURL=c.url(u))}i.fullImageURL||(i.previewImageURL=this.props.theme.getImageURL(e,{width:this.props.previewWidth,height:this.props.previewHeight}),t||c.fetch(a).then(function(e){n.setState({fullImageURL:c.url(e),previewImageURL:null,placeholderMessage:null,placeholderIcon:null})}))}if(!i.fullImageURL&&!i.previewImageURL){var d=this.props.locale.translate;e.width&&e.height?(i.placeholderMessage=d("image-editor-upload-in-progress"),i.placeholderIcon="cloud-upload"):e.pending||("video"===e.type?(i.placeholderMessage=d("image-editor-poster-extraction-in-progress"),i.placeholderIcon="film"):"website"===e.type&&(i.placeholderMessage=d("image-editor-page-rendering-in-progress"),i.placeholderIcon="file-image-o"))}o.isMatch(this.state,i)||this.setState(i)},render:function(){return i.createElement("div",{className:"image-editor"},this.renderImage(),this.renderSpinner(),this.props.children)},renderImage:function(){return this.state.fullImageURL?this.renderImageCropper():this.state.previewImageURL?this.renderPreviewImage():this.renderPlaceholder()},renderPreviewImage:function(){var e="preview";this.props.disabled&&(e+=" disabled");var t={src:this.state.previewImageURL,width:this.props.previewWidth,height:this.props.previewHeight};return i.createElement("div",{className:e},i.createElement("img",t))},renderSpinner:function(){return this.props.disabled?null:this.state.plaeholderMessage||this.state.placeholderIcon?null:this.state.fullImageURL&&this.state.fullImageURL===this.state.loadedImageURL?null:i.createElement("div",{className:"spinner"},i.createElement("i",{className:"fa fa-refresh fa-spin fa-fw"}))},renderImageCropper:function(){var e=this.components.setters,t=this.props.resource,n={ref:e.imageCropper,url:this.state.fullImageURL,clippingRect:t.clip||l.default(t.width,t.height),vector:"svg"===t.format,disabled:this.props.disabled,onChange:this.handleClipRectChange,onLoad:this.handleFullImageLoad};return i.createElement(f,n)},renderPlaceholder:function(){return this.state.fullImageURL||this.state.previewImageURL?null:this.state.plaeholderMessage||this.state.placeholderIcon?i.createElement("div",{className:"placeholder"},i.createElement("div",{className:"icon"},i.createElement("i",{className:"fa fa-"+this.state.placeholderIcon})),i.createElement("div",{className:"message"},this.state.placeholderMessage)):null},componentDidMount:function(){u.register(this,{type:"ImageEditor"})},componentWillUnmount:function(){u.unregister(this)},focus:function(){var e=this.components.imageCropper;e&&e.focus()},triggerChangeEvent:function(e){this.props.onChange&&this.props.onChange({type:"change",target:this,resource:e})},handleClipRectChange:function(e){var t=o.clone(this.props.resource);t.clip=e.rect,t.mosaic=e.target.extractMosaic(),this.triggerChangeEvent(t)},handleFullImageLoad:function(e){var t=e.target.props.url;this.setState({loadedImageURL:t});var n=o.clone(this.props.resource);n.mosaic||(n.mosaic=this.components.imageCropper.extractMosaic(),this.triggerChangeEvent(n))}})},"./editors/image-editor.scss":function(e,t){},"./editors/media-editor.jsx":function(e,t,n){"use strict";var r=n("../../common/node_modules/lodash/lodash.js"),s=(n("../../common/node_modules/bluebird/js/browser/bluebird.js"),n("../../common/node_modules/react/react.js")),o=s.PropTypes,i=n("../../common/src/locale/locale.js"),a=n("../../common/src/theme/theme.js"),c=n("../../common/src/transport/payloads.js"),l=n("../../common/src/mixins/update-check.js"),u=n("./widgets/media-button.jsx"),d=n("./editors/image-editor.jsx"),p=n("./editors/video-editor.jsx"),h=n("./editors/audio-editor.jsx");n("./editors/media-editor.scss"),e.exports=s.createClass({displayName:"MediaEditor",mixins:[l],propTypes:{allowEmbedding:o.bool,allowShifting:o.bool,resources:o.arrayOf(o.object),resourceIndex:o.number,locale:o.instanceOf(i).isRequired,theme:o.instanceOf(a).isRequired,payloads:o.instanceOf(c).isRequired,onChange:o.func.isRequired,onEmbed:o.func},render:function(){var e=this.props.resourceIndex,t=r.get(this.props.resources,e);if(t)return s.createElement("div",{key:e,className:"media-editor"},s.createElement("div",{className:"resource"},this.renderResource(t),this.renderNavigation()));var n;return"single-col"!==this.props.theme.mode&&(n=this.props.children),s.createElement("div",{className:"media-editor empty"},n)},renderResource:function(e){var t={resource:e,locale:this.props.locale,theme:this.props.theme,payloads:this.props.payloads,onChange:this.handleResourceChange};switch(e.type){case"image":case"website":return s.createElement(d,t);case"video":return s.createElement(p,t);case"audio":return s.createElement(h,t)}},renderNavigation:function(){var e=this.props.locale.translate,t=this.props.resourceIndex,n=r.size(this.props.resources);if(0===n)return null;var o={label:e("media-editor-remove"),icon:"remove",onClick:this.handleRemoveClick},i={label:e("media-editor-embed"),icon:"code",hidden:!this.props.allowEmbedding,onClick:this.handleEmbedClick},a={label:e("media-editor-shift"),icon:"chevron-left",hidden:!(this.props.allowShifting&&n>1),disabled:!(t>0),onClick:this.handleShiftClick},c={index:t,count:n,hidden:!(n>1),onBackwardClick:this.handleBackwardClick,onForwardClick:this.handleForwardClick};return s.createElement("div",{className:"navigation"},s.createElement("div",{className:"left"},s.createElement(u,o),s.createElement(u,i),s.createElement(u,a)),s.createElement("div",{className:"right"},s.createElement(u.Direction,c)))},triggerChangeEvent:function(e,t){return this.props.onChange({type:"change",target:this,resources:e,selection:t})},triggerEmbedEvent:function(e){this.props.onEmbed&&this.props.onEmbed({type:"embed",target:this,resource:e})},handleShiftClick:function(e){var t=this.props.resourceIndex;if(!(t<1)){var n=r.slice(this.props.resources),s=n[t];n.splice(t,1),n.splice(t-1,0,s),this.triggerChangeEvent(n,t-1)}},handleRemoveClick:function(e){var t=this.props.resourceIndex,n=r.slice(this.props.resources),s=n[t];n.splice(t,1);var o=t;t>=n.length&&(o=n.length-1),this.triggerChangeEvent(n,o),s&&s.payload_token&&this.props.payloads.cancel(s.payload_token)},handleEmbedClick:function(e){var t=this.props.resourceIndex,n=this.props.resources[t];this.triggerEmbedEvent(n)},handleBackwardClick:function(e){var t=this.props.resourceIndex,n=this.props.resources;t<=0||this.triggerChangeEvent(n,t-1)},handleForwardClick:function(e){var t=this.props.resourceIndex,n=this.props.resources;t>=r.size(n)-1||this.triggerChangeEvent(n,t+1)},handleResourceChange:function(e){var t=this.props.resourceIndex,n=r.slice(this.props.resources);n[t]=e.resource,this.triggerChangeEvent(n,t)}})},"./editors/media-editor.scss":function(e,t){},"./editors/media-importer.jsx":function(e,t,n){"use strict";function r(e){var t=i.filter(e,function(e){if("string"===e.kind)return/^text\/(html|uri-list)/.test(e.type)}),n={};return i.each(t,function(e){n[e.type]=new a(function(t,n){e.getAsString(t)})}),a.props(n)}function s(e){if(e){var t=document.createElement("DIV");t.innerHTML=e.replace(/<.*?>/g,""),website.title=t.innerText}}function o(e){return i.toUpper(c().format("YYYY-MMM-DD-hhA"))+e}var i=n("../../common/node_modules/lodash/lodash.js"),a=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),c=n("../../common/node_modules/moment/moment.js"),l=n("../../common/node_modules/react/react.js"),u=l.PropTypes,d=n("../../common/src/media/media-loader.js"),p=n("../../common/src/media/media-tag-reader.js"),h=n("../../common/src/utils/link-parser.js"),m=n("../../common/src/media/quick-start.js"),f=n("../../common/src/transport/blob-reader.js"),g=n("../../common/src/objects/types/resource-types.js"),v=n("../../common/src/locale/locale.js"),b=n("../../common/src/theme/theme.js"),y=n("../../common/src/transport/payloads.js"),j=n("../../common/src/mixins/update-check.js"),w=n("./dialogs/photo-capture-dialog-box.jsx"),x=n("./dialogs/audio-capture-dialog-box.jsx"),k=n("./dialogs/video-capture-dialog-box.jsx");n("./editors/media-editor.scss"),e.exports=l.createClass({displayName:"MediaImporter",mixins:[j],propTypes:{resources:u.arrayOf(u.object).isRequired,types:u.arrayOf(u.oneOf(g)),cameraDirection:u.oneOf(["front","back"]),limit:u.number,locale:u.instanceOf(v).isRequired,theme:u.instanceOf(b).isRequired,payloads:u.instanceOf(y).isRequired,onCaptureStart:u.func,onCaptureEnd:u.func,onChange:u.func.isRequired},getDefaultProps:function(){return{types:g,limit:1/0}},getInitialState:function(){return{capturing:null}},isAcceptable:function(e){return i.includes(this.props.types,e)},getResourceType:function(e){var t=d.extractFileCategory(e);if("application"===t)switch(d.extractFileFormat(e)){case"x-mswinurl":case"x-desktop":t="website"}if(this.isAcceptable(t))return t},capture:function(e){this.setState({capturing:e}),this.triggerCaptureStartEvent()},importFiles:function(e){var t=this;e=i.filter(e,function(e){return!!t.getResourceType(e.type)});var n=i.map(e,function(e){return t.getResourceType(e.type)}),r=this.addResourcePlaceholders(n);return a.each(e,function(e,n){return t.importFile(e).then(function(e){return t.updateResource(r[n],e),null}).catch(function(e){return t.removeResource(r[n]),null})})},importFile:function(e){switch(this.getResourceType(e.type)){case"image":return this.importImageFile(e);case"video":return this.importVideoFile(e);case"audio":return this.importAudioFile(e);case"website":return this.importBookmarkFile(e)}},importImageFile:function(e){var t=this.props.payloads.add("image").attachFile(e);return d.getImageMetadata(e).then(function(n){return{type:"image",payload_token:t.token,width:n.width,height:n.height,format:n.format,filename:e.name,imported:!0}}).catch(function(n){return{type:"image",payload_token:t.token,format:d.extractFileFormat(e.type),filename:e.name,imported:!0}})},importVideoFile:function(e){var t=this;return m.process(e).then(function(n){n||(n=e);var r=t.props.payloads.add("video"),s=t.props.payloads.stream().pipe(n);return r.attachStream(s),d.getVideoMetadata(n).then(function(t){return r.attachFile(t.poster,"poster"),{type:"video",payload_token:r.token,width:t.width,height:t.height,format:t.format,duration:t.duration,filename:e.name,imported:!0}}).catch(function(t){return r.attachStep("main","poster"),{type:"video",payload_token:r.token,format:d.extractFileFormat(e.type),filename:e.name,imported:!0}})})},importAudioFile:function(e){var t=this.props.payloads.add("audio"),n=this.props.payloads.stream().pipe(e);return t.attachStream(n),d.getAudioMetadata(e).then(function(n){var r={type:"audio",payload_token:t.token,format:n.format,duration:n.duration,filename:e.name,imported:!0};return p.extractAlbumArt(e).then(function(e){return e?(t.attachFile(e,"poster"),d.getImageMetadata(e).then(function(e){return r.width=e.width,r.height=e.height,r})):r})}).catch(function(n){return{type:"audio",payload_token:t.token,format:d.extractFileFormat(e.type),filename:e.name,imported:!0}})},importBookmarkFile:function(e){var t=this;return f.loadText(e).then(function(n){var r=h.parse(n);if(r&&/https?:/.test(r.url)){return{type:"website",payload_token:t.props.payloads.add("website").attachURL(r.url,"poster").token,url:r.url,title:r.name||i.replace(e.name,/\.\w+$/,"")}}})},importDataItems:function(e){var t=this;return r(e).then(function(e){var n=e["text/html"],r=e["text/uri-list"];if(r){var o=/<img\b/i.test(n)?"image":"website";if(t.isAcceptable(o)){if("image"===o){var i=r.replace(/.*\/([^\?#]*).*/,"$1")||void 0,a=t.props.payloads.add("image").attachURL(r);return{type:"image",payload_token:a.token,filename:i}}if("website"===o){var a=t.props.payloads.add("website").attachURL(r,"poster");return{type:"website",payload_token:a.token,url:r,title:s(n)}}}}}).then(function(e){return e?(t.addResources([e]),null):0})},render:function(){return l.createElement("div",null,this.renderPhotoDialog(),this.renderAudioDialog(),this.renderVideoDialog())},renderPhotoDialog:function(){var e={show:"image"===this.state.capturing,cameraDirection:this.props.cameraDirection,payloads:this.props.payloads,locale:this.props.locale,onLoadStart:this.handleLoadStart,onClose:this.handleClose,onCapturePending:this.handleCapturePending,onCaptureError:this.handleCaptureError,onCapture:this.handleCapture};return l.createElement(w,e)},renderVideoDialog:function(){var e={show:"video"===this.state.capturing,cameraDirection:this.props.cameraDirection,payloads:this.props.payloads,locale:this.props.locale,onLoadStart:this.handleLoadStart,onClose:this.handleClose,onCapturePending:this.handleCapturePending,onCaptureError:this.handleCaptureError,onCapture:this.handleCapture};return l.createElement(k,e)},renderAudioDialog:function(){var e={show:"audio"===this.state.capturing,payloads:this.props.payloads,locale:this.props.locale,onClose:this.handleClose,onCapturePending:this.handleCapturePending,onCaptureError:this.handleCaptureError,onCapture:this.handleCapture};return l.createElement(x,e)},componentWillUnmount:function(){this.state.capturing&&this.triggerCaptureEndEvent()},addResourcePlaceholders:function(e){var t=i.map(e,function(e){return{type:e,pending:"import-"+ ++E,imported:!0}});return this.addResources(t),t},addResources:function(e){if(i.isEmpty(e))return a.resolve(0);var t,n=this.props.resources||[];if(1===this.props.limit){var r=i.first(e),s=i.findIndex(n,{type:r.type});t=i.concat(n,r),-1!==s&&t.splice(s,1)}else t=i.concat(n,e);var o=n.length;this.triggerChangeEvent(t,o)},updateResource:function(e,t){var n=i.slice(this.props.resources),r=i.findIndex(n,e);return-1!==r&&(n[r]=t,this.triggerChangeEvent(n)),null},removeResource:function(e,t){var n=i.slice(this.props.resources),r=i.findIndex(n,e);-1!==r&&(n.splice(r,1),this.triggerChangeEvent(n))},triggerChangeEvent:function(e,t){this.props.onChange&&this.props.onChange({type:"change",target:this,resources:e,selection:t})},triggerCaptureStartEvent:function(){this.props.onCaptureStart&&this.props.onCaptureStart({type:"capturestart",target:this,mediaType:this.state.capturing})},triggerCaptureEndEvent:function(e){this.props.onCaptureEnd&&this.props.onCaptureEnd({type:"captureend",target:this,mediaType:this.state.capturing,resource:e})},handleClose:function(e){this.setState({capturing:null}),this.triggerCaptureEndEvent()},handleCapturePending:function(e){this.resourcePlaceholder={type:e.resourceType,pending:"capture-"+ ++C},this.addResources([this.resourcePlaceholder])},handleCaptureError:function(e){this.resourcePlaceholder&&this.removeResource(this.resourcePlaceholder)},handleCapture:function(e){var t=i.clone(e.resource),n="jpeg"===t.format?"jpg":t.format;t.filename=o("."+n),this.resourcePlaceholder?this.updateResource(this.resourcePlaceholder,t):this.addResources([t])}});var E=0,C=0},"./editors/reaction-editor.jsx":function(e,t,n){"use strict";function r(e){return s.some(e,function(e){if(!e.url&&!e.payload_id)return!0})}var s=n("../../common/node_modules/lodash/lodash.js"),o=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),i=n("../../common/node_modules/react/react.js"),a=i.PropTypes,c=n("../../common/src/utils/memoize.js"),l=n("../../common/src/media/device-manager.js"),u=n("../../common/src/utils/component-refs.js"),d=n("../../common/src/utils/tag-scanner.js"),p=n("../../common/src/utils/markdown.js"),h=n("../../common/src/utils/focus-manager.js"),m=n("../../common/src/objects/utils/reaction-utils.js"),f=n("../../common/src/data/database.js"),g=n("../../common/src/transport/payloads.js"),v=n("../../common/src/routing/route.js"),b=n("../../common/src/locale/locale.js"),y=n("../../common/src/theme/theme.js"),j=n("../../common/src/mixins/update-check.js"),w=n("../../common/src/widgets/autosize-text-area.jsx"),x=n("./widgets/push-button.jsx"),k=(n("./widgets/header-button.jsx"),n("./widgets/profile-image.jsx")),E=(n("./widgets/drop-zone.jsx"),n("./widgets/reaction-media-toolbar.jsx")),C=n("./editors/media-editor.jsx"),_=n("./editors/media-importer.jsx");n("./editors/reaction-editor.scss");e.exports=i.createClass({displayName:"CommentEditor",mixins:[j],propTypes:{reaction:a.object,story:a.object.isRequired,currentUser:a.object,database:a.instanceOf(f).isRequired,payloads:a.instanceOf(g).isRequired,route:a.instanceOf(v).isRequired,locale:a.instanceOf(b).isRequired,theme:a.instanceOf(y).isRequired,onFinish:a.func},getInitialState:function(){this.components=u({mediaImporter:_,textArea:w});var e={draft:null,original:null,selectedResourceIndex:0,hasCamera:l.hasDevice("videoinput"),hasMicrophone:l.hasDevice("audioinput")};return this.updateDraft(e,this.props),this.updateResourceIndex(e,this.props),e},componentWillReceiveProps:function(e){var t=s.clone(this.state);this.props.reaction!==e.reaction&&(this.updateDraft(t,e),this.updateResourceIndex(t,e));var n=s.shallowDiff(t,this.state);s.isEmpty(n)||this.setState(n)},updateDraft:function(e,t){t.reaction?(e.draft=t.reaction,t.reaction.uncommitted||(e.original=t.reaction)):(e.draft=S(t.story,t.currentUser),e.original=null)},updateResourceIndex:function(e,t){var n=s.get(e.draft,"details.resources"),r=s.size(n);e.selectedResourceIndex>=r?e.selectedResourceIndex=r-1:e.selectedResourceIndex<0&&r>0&&(e.selectedResourceIndex=0)},render:function(){return i.createElement("div",{className:"reaction-editor"},i.createElement("div",{className:"profile-image-column"},this.renderProfileImage()),i.createElement("div",{className:"editor-column"},i.createElement("div",{className:"controls"},i.createElement("div",{className:"textarea"},this.renderTextArea()),i.createElement("div",{className:"buttons"},this.renderMediaToolbar(),this.renderActionButtons())),i.createElement("div",{className:"media"},this.renderMediaEditor(),this.renderMediaImporter())))},renderProfileImage:function(){var e={user:this.props.currentUser,theme:this.props.theme,size:"small"};return i.createElement(k,e)},renderTextArea:function(){var e=this.props.locale.languageCode,t=s.get(this.state.draft,["details","text",e],""),n={ref:this.components.setters.textArea,value:t,lang:this.props.locale.localeCode,onChange:this.handleTextChange,onKeyPress:this.handleKeyPress,onPaste:this.handlePaste};return i.createElement(w,n)},renderMediaToolbar:function(){var e={reaction:this.state.draft,capturing:this.state.capturing,locale:this.props.locale,onAction:this.handleAction};return i.createElement(E,e)},renderActionButtons:function(){var e=this.props.locale.translate,t=s.isEmpty(s.get(this.state.draft,"details.text")),n=s.isEmpty(s.get(this.state.draft,"details.resources")),r=s.get(this.state.draft,"published",!1),o={label:e("story-cancel"),onClick:this.handleCancelClick,disabled:r},a={label:e("story-post"),onClick:this.handlePublishClick,emphasized:!0,disabled:t&&n||r};return i.createElement("div",{className:"action-buttons"},i.createElement(x,o),i.createElement(x,a))},renderMediaEditor:function(){var e=(this.props.locale.translate,{ref:this.components.setters.mediaImporter,allowShifting:"single-col"!==this.props.theme.mode,resources:s.get(this.state.draft,"details.resources"),resourceIndex:this.state.selectedResourceIndex,locale:this.props.locale,theme:this.props.theme,payloads:this.props.payloads,onChange:this.handleResourcesChange});return i.createElement(C,e)},renderMediaImporter:function(){var e=(this.props.locale.translate,{ref:this.components.setters.mediaImporter,resources:s.get(this.state.draft,"details.resources"),locale:this.props.locale,theme:this.props.theme,payloads:this.props.payloads,cameraDirection:"back",onCaptureStart:this.handleCaptureStart,onCaptureEnd:this.handleCaptureEnd,onChange:this.handleResourcesChange});return i.createElement(_,e)},componentDidMount:function(){h.register(this,{type:"ReactionEditor",story_id:this.props.story.id,user_id:this.props.currentUser.id})},componentWillUnmount:function(){h.unregister(this)},changeDraft:function(e,t){var n=this;return new o(function(r,s){var o={draft:e};void 0!==t&&(o.selectedResourceIndex=t),n.setState(o,function(){r(e)})})},saveDraft:function(e,t,n){var r=this;return this.changeDraft(e,n).then(function(e){return r.saveReaction(e,t),e})},saveReaction:function(e,t){var n=this,r=this.props.route.parameters,s=this.state.original,o={delay:t?void 0:2e3,onConflict:function(e){m.mergeRemoteChanges(e.local,e.remote,s)&&e.preventDefault()}},i=this.props.database.use({schema:r.schema,by:this});return i.start().then(function(){return i.saveOne({table:"reaction"},e,o).then(function(e){return n.props.payloads.dispatch(e),e})})},removeReaction:function(e){var t=this.props.route,n=t.parameters.schema;return this.props.database.use({schema:n,by:this}).removeOne({table:"reaction"},e)},triggerFinishEvent:function(){this.props.onFinish&&this.props.onFinish({type:"finish",target:this})},focus:function(){var e=this.components.textArea;e&&e.focus()},handleTextChange:function(e){var t=e.currentTarget.value,n=this.props.locale.languageCode,r="details.text."+n,o=s.decoupleSet(this.state.draft,r,t);return void 0===o.details.markdown&&p.detect(t,this.handleReference)&&(o.details.markdown=!0),o.tags=d.findTags(o.details.text),this.saveDraft(o)},handleKeyPress:function(e){var t=e.target;13==e.charCode&&"single-col"===this.props.theme.mode&&(e.preventDefault(),this.handlePublishClick(e),t.blur())},handlePaste:function(e){this.components.mediaImporter.importFiles(e.clipboardData.files),this.components.mediaImporter.importDataItems(e.clipboardData.items)},handlePublishClick:function(e){this.triggerFinishEvent();var t=s.clone(this.state.draft);return t.published=!0,this.saveDraft(t,!0)},handleCancelClick:function(e){var t=this;return o.try(function(){t.triggerFinishEvent();var e=t.props.reaction;return e?e.ptime?(e=s.clone(e),e.published=!0,t.saveReaction(e)):t.removeReaction(e):e})},handleResourcesChange:function(e){var t=s.get(this.state.draft,"details.resources"),n=e.resources,o=e.selection;if(t!==n){var i=s.decoupleSet(this.state.draft,"details.resources",e.resources),a=r(e.resources);return this.saveDraft(i,a,o)}this.setState({selectedResourceIndex:o})},handleCaptureStart:function(e){this.setState({capturing:e.mediaType})},handleCaptureEnd:function(e){this.setState({capturing:null})},handleReference:function(e){var t=this.state.draft.details.resources,n=p.findReferencedResource(t,e.name);if(n){var r;return r=e.forImage?this.props.theme.getImageURL(n,{height:24}):this.props.theme.getURL(n),{href:r,title:void 0}}},handleAction:function(e){switch(e.action){case"markdown-set":var t=s.decoupleSet(this.state.draft,"details.markdown",e.value);this.saveDraft(t);break;case"photo-capture":this.components.mediaImporter.capture("image");break;case"video-capture":this.components.mediaImporter.capture("video");break;case"audio-capture":this.components.mediaImporter.capture("audio");break;case"file-import":this.components.mediaImporter.importFiles(e.files)}}});var S=c(function(e,t){return{type:"comment",story_id:e.id,user_id:t?t.id:null,details:{}}})},"./editors/reaction-editor.scss":function(e,t){},"./editors/story-editor-options.jsx":function(e,t,n){"use strict";var r=n("../../common/node_modules/lodash/lodash.js"),s=n("../../common/node_modules/react/react.js"),o=s.PropTypes,i=n("../../common/src/objects/utils/user-utils.js"),a=n("../../common/src/data/database.js"),c=n("../../common/src/routing/route.js"),l=n("../../common/src/locale/locale.js"),u=n("../../common/src/theme/theme.js"),d=(n("./widgets/header-button.jsx"),n("./widgets/option-button.jsx")),p=n("./dialogs/user-selection-dialog-box.jsx"),h=n("./dialogs/issue-dialog-box.jsx");n("./editors/story-editor-options.scss"),e.exports=s.createClass({displayName:"StoryEditorOptions",propTypes:{section:o.oneOf(["main","preview","both"]),story:o.object.isRequired,repos:o.arrayOf(o.object),currentUser:o.object,options:o.object.isRequired,database:o.instanceOf(a).isRequired,route:o.instanceOf(c).isRequired,locale:o.instanceOf(l).isRequired,theme:o.instanceOf(u).isRequired,onChange:o.func,onComplete:o.func},getDefaultProps:function(){return{section:"both"}},getInitialState:function(){return{selectingRecipients:!1,renderingRecipientDialogBox:!1,enteringIssueDetails:!1,renderingIssueDialogBox:!1}},render:function(){return"both"===this.props.section?s.createElement("div",{className:"story-editor-options"},this.renderButtons("main"),s.createElement("div",{className:"border"}),this.renderButtons("preview")):s.createElement("div",{className:"story-editor-options"},this.renderButtons(this.props.section))},renderButtons:function(e){var t=this.props.locale.translate,n=this.props.options;if("main"===e){var o=this.props.currentUser,a=this.props.story,c=this.props.repos,l=!!o&&r.includes(n.bookmarkRecipients,o.id),u=o?r.without(n.bookmarkRecipients,o.id):[],p={label:t("option-add-bookmark"),selected:l,onClick:this.handleBookmarkClick},h={label:r.isEmpty(u)?t("option-send-bookmarks"):t("option-send-bookmarks-to-$count-users",r.size(u)),hidden:!i.canSendBookmarks(o,a,"read-write"),selected:!r.isEmpty(u),onClick:this.handleSendBookmarkClick},m={label:t("option-add-issue"),selected:!!n.issueDetails,hidden:!i.canAddIssue(o,a,c,"read-write"),onClick:this.handleAddIssueClick},f={label:t("option-hide-story"),selected:n.hidePost,hidden:!i.canHideStory(o,a,"read-write"),onClick:this.handleHidePostClick};return s.createElement("div",{className:e},s.createElement(d,p),s.createElement(d,h),s.createElement(d,m),s.createElement(d,f),this.renderRecipientDialogBox(),this.renderIssueDialogBox())}if("preview"===e){var g={label:t("option-show-media-preview"),selected:"media"===n.preview||!n.preview,onClick:this.handleShowMediaPreviewClick},v={label:t("option-show-text-preview"),selected:"text"===n.preview,onClick:this.handleShowTextPreviewClick};return s.createElement("div",{className:e},s.createElement(d,g),s.createElement(d,v))}},renderRecipientDialogBox:function(){if(!this.state.renderingRecipientDialogBox)return null;var e={show:this.state.selectingRecipients,selection:this.props.options.bookmarkRecipients,database:this.props.database,route:this.props.route,locale:this.props.locale,theme:this.props.theme,onSelect:this.handleRecipientsSelect,onCancel:this.handleRecipientsCancel};return s.createElement(p,e)},renderIssueDialogBox:function(){if(!this.state.renderingIssueDialogBox)return null;var e={show:this.state.enteringIssueDetails,allowDeletion:!1,story:this.props.story,issue:this.props.options.issueDetails,repos:this.props.repos,locale:this.props.locale,theme:this.props.theme,onConfirm:this.handleIssueConfirm,onCancel:this.handleIssueCancel};return s.createElement(h,e)},triggerChangeEvent:function(e){this.props.onChange&&this.props.onChange({type:"change",target:this,options:e})},triggerCompleteEvent:function(){this.props.onComplete&&this.props.onComplete({type:"complete",target:this})},openSelectionDialogBox:function(e){this.state.selectingRecipients||this.setState({selectingRecipients:!0,renderingRecipientDialogBox:!0})},closeSelectionDialogBox:function(){var e=this;this.state.selectingRecipients&&(this.setState({selectingRecipients:!1}),setTimeout(function(){e.state.selectingRecipients||e.setState({renderingRecipientDialogBox:!1})},500))},openIssueDialogBox:function(e){this.state.enteringIssueDetails||this.setState({enteringIssueDetails:!0,renderingIssueDialogBox:!0})},closeIssueDialogBox:function(){var e=this;this.state.enteringIssueDetails&&(this.setState({enteringIssueDetails:!1}),setTimeout(function(){e.state.enteringIssueDetails||e.setState({renderingIssueDialogBox:!1})},500))},handleBookmarkClick:function(e){var t=r.clone(this.props.options),n=this.props.currentUser.id;r.includes(t.bookmarkRecipients,n)?t.bookmarkRecipients=r.difference(t.bookmarkRecipients,[n]):t.bookmarkRecipients=r.union(t.bookmarkRecipients,[n]),this.triggerChangeEvent(t),this.triggerCompleteEvent()},handleSendBookmarkClick:function(e){this.openSelectionDialogBox(e)},handleAddIssueClick:function(e){this.openIssueDialogBox(e)},handleHidePostClick:function(e){var t=r.clone(this.props.options);t.hidePost=!t.hidePost,this.triggerChangeEvent(t),this.triggerCompleteEvent()},handleRecipientsSelect:function(e){var t=r.clone(this.props.options);t.bookmarkRecipients=e.selection,this.triggerChangeEvent(t),this.triggerCompleteEvent(),this.closeSelectionDialogBox()},handleRecipientsCancel:function(e){this.triggerCompleteEvent(),this.closeSelectionDialogBox()},handleIssueConfirm:function(e){var t=r.clone(this.props.options);t.issueDetails=e.issue,this.triggerChangeEvent(t),this.triggerCompleteEvent(),this.closeIssueDialogBox()},handleIssueCancel:function(e){this.triggerCompleteEvent(),this.closeIssueDialogBox()},handleShowMediaPreviewClick:function(e){var t=r.clone(this.props.options);t.preview="media",this.triggerChangeEvent(t),this.triggerCompleteEvent()},handleShowTextPreviewClick:function(e){var t=r.clone(this.props.options);t.preview="text",this.triggerChangeEvent(t),this.triggerCompleteEvent()}})},"./editors/story-editor-options.scss":function(e,t){},"./editors/story-editor.jsx":function(e,t,n){"use strict";function r(e){return{id:b.allocate(),user_ids:[e.id],details:{},public:!0,published:!1}}function s(e){return a.some(e,function(e){if(e.pending)return!0})}function o(e){return a.some(e,function(e){if(!e.url&&!e.payload_id)return!0})}var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a=n("../../common/node_modules/lodash/lodash.js"),c=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),l=n("../../common/node_modules/react/react.js"),u=l.PropTypes,d=(n("../../common/src/utils/memoize.js"),n("../../common/src/utils/list-parser.js")),p=n("../../common/src/utils/markdown.js"),h=n("../../common/src/utils/plain-text.js"),m=n("../../common/src/utils/tag-scanner.js"),f=(n("../../common/src/utils/focus-manager.js"),n("../../common/src/utils/component-refs.js")),g=n("../../common/src/objects/utils/story-utils.js"),v=n("../../common/src/objects/utils/issue-utils.js"),b=n("../../common/src/data/remote-data-source/temporary-id.js"),y=n("../../common/src/utils/random-token.js"),j=n("../../common/src/data/database.js"),w=n("../../common/src/transport/payloads.js"),x=n("../../common/src/routing/route.js"),k=n("../../common/src/locale/locale.js"),E=n("../../common/src/theme/theme.js"),C=n("../../common/src/mixins/update-check.js"),_=n("./widgets/author-names.jsx"),S=n("./widgets/profile-image.jsx"),R=n("./widgets/coauthoring-button.jsx"),N=n("./widgets/push-button.jsx"),O=n("../../common/src/widgets/autosize-text-area.jsx"),P=n("./widgets/media-toolbar.jsx"),T=n("./widgets/text-toolbar.jsx"),D=n("./widgets/header-button.jsx"),A=n("./widgets/drop-zone.jsx"),U=n("./editors/media-editor.jsx"),F=n("./editors/media-importer.jsx"),I=n("./widgets/media-placeholder.jsx"),L=n("./editors/story-editor-options.jsx"),B=n("./widgets/corner-pop-up.jsx"),M=n("./dialogs/confirmation-dialog-box.jsx");n("./editors/story-editor.scss");e.exports=l.createClass({displayName:"StoryEditor",mixins:[C],propTypes:{isStationary:u.bool,highlighting:u.bool,story:u.object,authors:u.arrayOf(u.object),recommendations:u.arrayOf(u.object),recipients:u.arrayOf(u.object),currentUser:u.object,repos:u.arrayOf(u.object),database:u.instanceOf(j).isRequired,payloads:u.instanceOf(w).isRequired,route:u.instanceOf(x).isRequired,locale:u.instanceOf(k).isRequired,theme:u.instanceOf(E).isRequired},getDefaultProps:function(){return{isStationary:!1}},getInitialState:function(){this.components=f({mediaImporter:F,textArea:O,mainPopUp:B,previewPopUp:B});var e={options:q,selectedResourceIndex:0,original:null,draft:null,confirming:!1,capturing:null,action:null};return this.updateDraft(e,this.props),this.updateOptions(e,this.props),this.updateLocaleCode(e,this.props),this.updateLeadAuthor(e,this.props),this.updateBookmarkRecipients(e,this.props),this.updateResourceIndex(e,this.props),e},getClassName:function(){var e="story-editor";return this.props.highlighting&&(e+=" highlighting"),e},isCoauthoring:function(){var e=a.get(this.props.story,"user_ids"),t=a.get(this.props.currentUser,"id");return a.indexOf(e,t)>0},componentWillReceiveProps:function(e){var t=a.clone(this.state);this.props.story!==e.story&&(this.updateDraft(t,e),this.updateOptions(t,e),this.updateLocaleCode(t,e),this.updateResourceIndex(t,e)),this.props.currentUser!==e.currentUser&&this.updateLeadAuthor(t,e),this.props.locale!==e.locale&&this.updateLocaleCode(t,e),this.props.recommendations!==e.recommendations&&this.updateBookmarkRecipients(t,e),this.props.repos!==e.repos&&(this.updateOptions(t,e),this.updateLocaleCode(t,e));var n=a.shallowDiff(t,this.state);a.isEmpty(n)||this.setState(n)},updateDraft:function(e,t){t.story?(e.draft=t.story,t.story.uncommitted||(e.original=t.story)):(e.draft=r(t.currentUser),e.original=null)},updateLeadAuthor:function(e,t){if(!e.story){var n=a.get(t.currentUser,"id");e.draft.user_ids||(e.draft=a.decouple(e.draft,"user_ids",[]),e.draft.user_ids[0]=n)}},updateOptions:function(e,t){t.story?(e.options=a.clone(e.options),e.options.hidePost=!e.draft.public,e.options.issueDetails=v.extractIssueDetails(e.draft,t.repos),e.options.preview||(e.options.preview=this.choosePreview(e.draft))):e.options=q},updateBookmarkRecipients:function(e,t){var n=a.map(t.recommendations,"target_user_id");e.options=a.clone(e.options),e.options.bookmarkRecipients=a.union(e.options.bookmarkRecipients,n)},updateLocaleCode:function(e,t){e.options=a.clone(e.options),e.options.localeCode=this.chooseLocale(e.draft,t.locale)},updateResourceIndex:function(e,t){var n=a.get(e.draft,"details.resources"),r=a.size(n);e.selectedResourceIndex>=r?e.selectedResourceIndex=r-1:e.selectedResourceIndex<0&&r>0&&(e.selectedResourceIndex=0)},choosePreview:function(e){return"survey"===e.type||"task-list"===e.type?"text":a.get(e,"details.markdown",!1)?"text":""},chooseLocale:function(e,t){var n,r=a.get(e,"details.text");if(a.isEmpty(r))n=t.localeCode;else{var s=a.first(a.keys(r));if(s===t.languageCode)n=t.localeCode;else{var o=a.find(t.directory,{code:s});if(o){n=s+"-"+o.defaultCountry}else n=s}}return n},render:function(){switch(this.props.theme.mode){case"single-col":return this.renderSingleColumn();case"double-col":return this.renderDoubleColumn();case"triple-col":return this.renderTripleColumn()}},renderSingleColumn:function(){return l.createElement("div",{className:this.getClassName()},l.createElement("div",{className:"header"},l.createElement("div",{className:"column-1 padded"},this.renderProfileImage(),this.renderAuthorNames(),this.renderPopUpMenu("main"))),l.createElement("div",{className:"body"},l.createElement("div",{className:"column-1 padded"},this.renderCoauthoringButton(),this.renderTextArea(),this.renderButtons())),l.createElement("div",{className:"header"},l.createElement("div",{className:"column-2 padded"},this.renderToolbar(),this.renderPopUpMenu("preview"))),l.createElement("div",{className:"body"},l.createElement("div",{className:"column-2"},this.renderPreview())),this.renderMediaImporter(),this.renderConfirmationDialogBox())},renderDoubleColumn:function(){return l.createElement("div",{className:this.getClassName()},l.createElement("div",{className:"header"},l.createElement("div",{className:"column-1 padded"},this.renderProfileImage(),this.renderAuthorNames(),this.renderPopUpMenu("main")),l.createElement("div",{className:"column-2 padded"},this.renderToolbar(),this.renderPopUpMenu("preview"))),l.createElement("div",{className:"body"},l.createElement("div",{className:"column-1 padded"},this.renderCoauthoringButton(),this.renderTextArea(),this.renderButtons()),l.createElement("div",{className:"column-2"},this.renderPreview())),this.renderMediaImporter(),this.renderConfirmationDialogBox())},renderTripleColumn:function(){var e=this.props.locale.translate;return l.createElement("div",{className:this.getClassName()},l.createElement("div",{className:"header"},l.createElement("div",{className:"column-1 padded"},this.renderProfileImage(),this.renderAuthorNames()),l.createElement("div",{className:"column-2 padded"},this.renderToolbar()),l.createElement("div",{className:"column-3 padded"},l.createElement(D,{icon:"chevron-circle-right",label:e("story-options"),disabled:!0}))),l.createElement("div",{className:"body"},l.createElement("div",{className:"column-1 padded"},this.renderCoauthoringButton(),this.renderTextArea(),this.renderButtons()),l.createElement("div",{className:"column-2"},this.renderPreview()),l.createElement("div",{className:"column-3 padded"},this.renderOptions())),this.renderMediaImporter(),this.renderConfirmationDialogBox())},renderProfileImage:function(){var e={user:a.get(this.props.authors,0),theme:this.props.theme,size:"medium"};return l.createElement(S,e)},renderAuthorNames:function(){var e={authors:this.props.authors,locale:this.props.locale,theme:this.props.theme};return l.createElement(_,e)},renderCoauthoringButton:function(){var e={coauthoring:this.isCoauthoring(),story:this.state.draft,database:this.props.database,route:this.props.route,locale:this.props.locale,theme:this.props.theme,onSelect:this.handleCoauthorSelect,onRemove:this.handleCancelClick};return l.createElement(R,e)},renderTextArea:function(){var e=this.components.setters,t=this.state.options.localeCode,n=t.substr(0,2),r=a.get(this.state.draft,["details","text",n],""),s={value:r,lang:t,onChange:this.handleTextChange,onBeforeInput:this.handleBeforeInput,onKeyDown:this.handleKeyDown,onKeyUp:this.handleKeyUp,onPaste:this.handlePaste};return l.createElement(O,i({ref:e.textArea},s))},renderButtons:function(){var e=this.props.locale.translate,t=this.state.draft,n=a.get(t,"details.text"),r=a.get(t,"details.resources"),o=a.isEmpty(a.pickBy(n)),i=a.isEmpty(r),c=s(r),u=a.get(t,"published",!1),d={label:e("story-cancel"),onClick:this.handleCancelClick,disabled:o&&i||u},p={label:e("story-post"),onClick:this.handlePublishClick,emphasized:!0,disabled:o&&i||c||u};return l.createElement("div",{className:"buttons"},l.createElement(N,d),l.createElement(N,p))},renderToolbar:function(){return"text"===this.state.options.preview?this.renderTextToolbar():this.renderMediaToolbar()},renderTextToolbar:function(){var e={story:this.state.draft,locale:this.props.locale,onAction:this.handleAction};return l.createElement(T,e)},renderMediaToolbar:function(){var e={story:this.state.draft,capturing:this.state.capturing,locale:this.props.locale,onAction:this.handleAction};return l.createElement(P,e)},renderPreview:function(){return"text"===this.state.options.preview?this.renderTextPreview():this.renderMediaPreview()},renderTextPreview:function(){var e;switch(this.state.draft.type){case void 0:case"":case"post":e=this.renderRegularPost();break;case"task-list":e=this.renderTaskListText();break;case"survey":e=this.renderSurveyText()}return l.createElement("div",{className:"story-contents"},e)},renderRegularPost:function(){var e=this.props.locale.pick,t="text story",n=this.state.draft,r=e(n.details.text);return n.details.markdown?(r=p.render(r,this.handleReference),t+=" markdown"):(r=l.createElement("p",null,h.renderEmoji(r)),t+=" plain-text"),l.createElement("div",{className:t,onClick:this.handleTextClick},r)},renderTaskListText:function(){var e,t=this.props.locale.pick,n="text task-list",r=this.state.draft,s=t(r.details.text);return r.details.markdown?(e=p.renderTaskList(s,null,this.handleItemChange,this.handleReference),n+=" markdown"):(e=h.renderTaskList(s,null,this.handleItemChange),e=l.createElement("p",null,e),n+=" plain-text"),l.createElement("div",{className:n,onClick:this.handleTextClick},e)},renderSurveyText:function(){var e,t=this.props.locale.pick,n="text survey",r=this.state.draft,s=t(r.details.text);return r.details.markdown?(e=p.renderSurvey(s,null,this.handleItemChange,this.handleReference),n+=" markdown"):(e=h.renderSurvey(s,null,this.handleItemChange),e=l.createElement("p",null,e),n+=" plain-text"),l.createElement("div",{className:n,onClick:this.handleTextClick},e)},renderMediaPreview:function(){var e={allowEmbedding:!0,allowShifting:!0,resources:a.get(this.state.draft,"details.resources"),resourceIndex:this.state.selectedResourceIndex,locale:this.props.locale,theme:this.props.theme,payloads:this.props.payloads,onChange:this.handleResourcesChange,onEmbed:this.handleResourceEmbed},t={showHints:this.props.isStationary,locale:this.props.locale,theme:this.props.theme};return l.createElement(A,{onDrop:this.handleDrop},l.createElement(U,e,l.createElement(I,t)))},renderMediaImporter:function(){var e={ref:this.components.setters.mediaImporter,resources:a.get(this.state.draft,"details.resources",[]),locale:this.props.locale,theme:this.props.theme,payloads:this.props.payloads,cameraDirection:"back",onCaptureStart:this.handleCaptureStart,onCaptureEnd:this.handleCaptureEnd,onChange:this.handleResourcesChange};return l.createElement(F,e)},renderPopUpMenu:function(e){var t=this.components.setters[e+"PopUp"];return l.createElement(B,{ref:t},this.renderOptions(e))},renderOptions:function(e){var t={section:e,story:this.state.draft,options:this.state.options,currentUser:this.props.currentUser,repos:this.props.repos,database:this.props.database,route:this.props.route,locale:this.props.locale,theme:this.props.theme,onChange:this.handleOptionChange,onComplete:this.handleOptionComplete};return l.createElement(L,t)},renderConfirmationDialogBox:function(){var e,t=this.props.locale.translate,n={show:this.state.confirming,locale:this.props.locale,onClose:this.handleDialogClose};return"delete-post"===this.state.action?(e=t("story-cancel-are-you-sure"),n.onConfirm=this.handleCancelConfirm):"cancel-edit"===this.state.action?(e=t("story-cancel-edit-are-you-sure"),n.onConfirm=this.handleCancelConfirm):(e=t("story-remove-yourself-are-you-sure"),n.onConfirm=this.handleRemoveConfirm),l.createElement(M,n,e)},componentDidUpdate:function(e,t){if(this.repositionCursor){var n=this.repositionCursor.target;n.selectionStart=n.selectionEnd=this.repositionCursor.position,this.repositionCursor=null}},changeDraft:function(e,t){var n=this;return new c(function(r,s){var o=n.state.options;if(!o.preview){var i=n.choosePreview(e);i&&(o=a.decoupleSet(o,"preview",i))}var c={draft:e,options:o};void 0!==t&&(c.selectedResourceIndex=t),n.setState(c,function(){r(e)})})},changeOptions:function(e){var t=this;return new c(function(n,r){t.setState({options:e},function(){n(e)})})},saveDraft:function(e,t,n){var r=this;return e.public=!this.state.options.hidePost,this.changeDraft(e,n).then(function(e){return s(e.details.resources)||r.saveStory(e,t),e})},saveStory:function(e,t){var n=this,r=this.props.route.parameters,s=(e.details.resources,this.state.original),o={delay:t?void 0:2e3,onConflict:function(e){g.mergeRemoteChanges(e.local,e.remote,s)&&e.preventDefault()}},i=this.props.database.use({schema:r.schema,by:this});return i.start().then(function(){return i.saveOne({table:"story"},e,o).then(function(e){return n.props.payloads.dispatch(e),e})})},removeStory:function(e){var t=this.props.route,n=t.parameters.schema;return this.props.database.use({schema:n,by:this}).removeOne({table:"story"},e)},removeSelf:function(){var e=this.props.story,t=a.without(e.user_ids,this.props.currentUser.id),n={id:e.id,user_ids:t},r=this.props.route.parameters,s=this.props.database.use({schema:r.schema,by:this});return s.start().then(function(){return s.saveOne({table:"story"},n)})},saveBookmarks:function(e){if(a.isEmpty(e))return c.resolve([]);var t=this.props.route.parameters,n=this.props.database.use({schema:t.schema,by:this});return n.start().then(function(){return n.save({table:"bookmark"},e)})},removeBookmarks:function(e){if(a.isEmpty(e))return c.resolve([]);var t=this.props.route.parameters,n=this.props.database.use({schema:t.schema,by:this});return n.start().then(function(){return n.remove({table:"bookmark"},e)})},sendBookmarks:function(e,t){var n=this,r=this.props.recommendations,s=[];a.each(t,function(t){if(!a.some(r,{target_user_id:t})){var o={story_id:e.published_version_id||e.id,user_ids:[n.props.currentUser.id],target_user_id:t};s.push(o)}});var o=[];return a.each(r,function(e){a.includes(t,e.target_user_id)||o.push(e)}),this.saveBookmarks(s).then(function(e){return n.removeBookmarks(o).then(function(t){return a.concat(e,t)})})},sendTask:function(e,t){var n={action:e,options:t,user_id:this.props.currentUser.id,token:y.generate()},r=this.props.route.parameters,s=this.props.database.use({schema:r.schema,by:this});return s.start().then(function(){return s.saveOne({table:"task"},n)})},publishStory:function(){var e=this,t=a.clone(this.state.draft),n=this.state.options;if(t.type||(t.type="post"),a.isEmpty(t.role_ids)){var r=a.map(this.props.authors,"role_ids");t.role_ids=a.uniq(a.flatten(r))}return t.published=!0,this.saveDraft(t,!0).then(function(t){return e.sendBookmarks(t,n.bookmarkRecipients).then(function(){var n=v.extractIssueDetails(e.state.draft,e.props.repos),r=e.state.options.issueDetails;if(!a.isEqual(r,n)&&r){var s=a.clone(r);return s.story_id=t.id,e.sendTask("export-issue",s)}})})},handlePublishClick:function(e){this.publishStory()},handleTextChange:function(e){var t=e.currentTarget.value,n=this.state.options.localeCode,r=n.substr(0,2);r=n?n.substr(0,2):this.props.locale.languageCode;var s="details.text."+r,o=a.decoupleSet(this.state.draft,s,t);if(o.details.text=a.pickBy(o.details.text,"length"),a.isEmpty(o.details.text)&&(o.details=a.omit(o.details,"text")),o.type||d.detect(o.details.text)&&(o.type="task-list",void 0===o.details.markdown&&(o.details.markdown=!1)),"task-list"===o.type){var i=[];a.each(o.details.text,function(e){var t=d.extract(e),n=d.count(t,!1);i.push(n)}),o.unfinished_tasks=a.max(i)}void 0===o.details.markdown&&p.detect(t)&&(o.details.markdown=!0),o.tags=m.findTags(o.details.text),this.saveDraft(o)},handleKeyDown:function(e){this.lastInput=null},handleBeforeInput:function(e){var t=e.target;if("\n"===e.data){var n=this.state.draft.type;if("survey"!==n&&"task-list"!==n&&"single-col"===this.props.theme.mode)return e.preventDefault(),this.handlePublishClick(e),void t.blur()}this.lastInput=e.data},handleKeyUp:function(e){var t=e.target;if("\n"===this.lastInput){var n=this.state.draft.type;if("survey"===n||"task-list"===n){var r=t.value,s=t.selectionStart,o=r.substr(0,s),i=a.lastIndexOf(o.substr(0,o.length-1),"\n"),c=o.substr(i+1),l=d.extract(c),u=a.get(l,[0,0]);u instanceof Object&&(u.label?document.execCommand("insertText",!1,"* [ ] "):(t.selectionStart=i+1,document.execCommand("insertText",!1,"\n")))}}else if("]"===this.lastInput){var r=t.value,s=t.selectionStart,o=r.substr(0,s),i=a.lastIndexOf(o,"\n"),c=o.substr(i+1);/^\s*\*\[\]/.test(c)&&(t.selectionStart=s-3,document.execCommand("insertText",!1,"* [ ]"))}},handlePaste:function(e){c.all([this.components.mediaImporter.importFiles(e.clipboardData.files),this.components.mediaImporter.importDataItems(e.clipboardData.items)]),e.clipboardData.files.length>0&&e.preventDefault()},handleCancelClick:function(e){var t;t=this.isCoauthoring()?"remove-self":this.props.isStationary?"delete-post":"cancel-edit",this.setState({confirming:!0,action:t})},handleOptionChange:function(e){return this.changeOptions(e.options)},handleOptionComplete:function(e){var t=e.target.props.section,n=this.components[t+"PopUp"];n&&n.close()},handleDialogClose:function(e){this.setState({confirming:!1})},handleCancelConfirm:function(e){var t=this;this.setState({confirming:!1});var n=this.state.draft;if(this.props.isStationary){var s=r(this.props.currentUser);this.changeDraft(s).then(function(){return n.id?t.removeStory(n):n})}else this.removeStory(n)},handleReference:function(e){var t=this.state.draft.details.resources,r=p.findReferencedResource(t,e.name);if(r){var s,o=this.props.theme;return s=e.forImage?"audio"===r.type?n("../node_modules/file-loader/index.js!../assets/speaker.svg")+"#"+encodeURI(r.url):o.getImageURL(r,{height:24}):o.getURL(r),{href:s,title:e.name}}},handleTextClick:function(e){var t=e.target;t.viewportElement&&(t=t.viewportElement);var n;if("svg"===t.tagName){var r=t.getElementsByTagName("title")[0];r&&(n=r.textContent)}else n=e.target.title;if(n){var s=this.state.draft.details.resources,o=p.findReferencedResource(s,n);if(o){var i=a.indexOf(s,o),c=a.decoupleSet(this.state.options,"preview","media");this.setState({selectedResourceIndex:i,options:c})}}},handleItemChange:function(e){var t=e.currentTarget,n=parseInt(t.name),r=parseInt(t.value),s=t.checked,o=a.decouple(this.state.draft,"details");if("task-list"===o.type){var i=[];o.details.text=a.mapValues(o.details.text,function(e){var t=d.extract(e);d.set(t,n,r,s);var o=d.count(t,!1);return i.push(o),d.join(t)}),o.unfinished_tasks=a.max(i)}else"survey"===o.type&&(o.details.text=a.mapValues(o.details.text,function(e){var t=d.extract(e);return d.set(t,n,r,s,!0),d.join(t)}));this.saveDraft(o)},handleRemoveConfirm:function(e){this.setState({confirming:!1}),this.removeSelf()},handleCoauthorSelect:function(e){var t=a.decoupleSet(this.state.draft,"user_ids",e.selection);this.saveDraft(t,!0)},handleResourcesChange:function(e){var t=this.state.draft.resources,n=e.resources,r=e.selection;if(void 0===r&&(r=this.state.selectedResourceIndex),t!==n){var i=a.decoupleSet(this.state.draft,"details.resources",n),c=!1;s(n)&&o(n)&&(c=!0),this.saveDraft(i,c,r)}else this.setState({selectedResourceIndex:r})},handleResourceEmbed:function(e){var t=this,n=e.resource,r=a.decouple(this.state.draft,"details"),s=r.details.resources,o=a.filter(s,{type:n.type}),i=a.indexOf(o,n);if(-1!==i){var c=a.clone(this.state.options);c.preview="media",this.changeOptions(c).then(function(){a.set(r,"details.markdown",!0),t.changeDraft(r).then(function(){t.components.textArea.getElement().focus(),setTimeout(function(){var e="!["+n.type+"-"+(i+1)+"]";document.execCommand("insertText",!1,e)},10)})})}},handleDrop:function(e){c.all([this.components.mediaImporter.importFiles(e.files),this.components.mediaImporter.importDataItems(e.items)])},handleCaptureStart:function(e){this.setState({capturing:e.mediaType})},handleCaptureEnd:function(e){this.setState({capturing:null})},handleAction:function(e){switch(e.action){case"markdown-set":var t=a.decouple(this.state.draft,"details");t.details.markdown=e.value,this.saveDraft(t);break;case"story-type-set":var t=a.decouple(this.state.draft,"details");if(t.type=e.value,"task-list"===t.type||"survey"===t.type){var n=this.components.textArea.getElement();n.focus(),d.detect(n.value)||setTimeout(function(){var e=n.value,t="* [ ] ",r=n.selectionStart;/[^\n]$/.test(e.substr(0,r))&&(t="\n"+t),document.execCommand("insertText",!1,t)},10)}this.saveDraft(t);break;case"photo-capture":this.components.mediaImporter.capture("image");break;case"video-capture":this.components.mediaImporter.capture("video");break;case"audio-capture":this.components.mediaImporter.capture("audio");break;case"file-import":this.components.mediaImporter.importFiles(e.files)}}});var q={localeCode:"",issueDetails:null,hidePost:!1,bookmarkRecipients:[],preview:""}},"./editors/story-editor.scss":function(e,t){},"./editors/video-editor.jsx":function(e,t,n){"use strict";function r(e){var t=e.resource.duration;return s.createElement(o,e,s.createElement("div",{className:"video-duration"},i.format(t)))}var s=n("../../common/node_modules/react/react.js"),o=(s.PropTypes,n("./editors/image-editor.jsx")),i=n("./widgets/duration-indicator.jsx");e.exports=r,n("./editors/video-editor.scss"),r.propTypes=o.propTypes},"./editors/video-editor.scss":function(e,t){},"./keys.js":function(e,t,n){"use strict"},"./lists/bookmark-list.jsx":function(e,t,n){"use strict";var r=n("../../common/node_modules/lodash/lodash.js"),s=(n("../../common/node_modules/bluebird/js/browser/bluebird.js"),n("../../common/node_modules/react/react.js")),o=s.PropTypes,i=n("../node_modules/relaks/index.js"),a=n("../../common/src/utils/memoize.js"),c=n("../../common/src/data/empty.js"),l=(n("../../common/src/data/merger.js"),n("../../common/src/objects/finders/user-finder.js")),u=n("../../common/src/objects/finders/story-finder.js"),d=n("../../common/src/objects/finders/repo-finder.js"),p=n("../../common/src/objects/finders/bookmark-finder.js"),h=n("../../common/src/objects/finders/reaction-finder.js"),m=n("../../common/src/data/database.js"),f=n("../../common/src/transport/payloads.js"),g=n("../../common/src/routing/route.js"),v=n("../../common/src/locale/locale.js"),b=n("../../common/src/theme/theme.js"),y=n("../../common/src/mixins/update-check.js"),j=n("../../common/src/widgets/smart-list.jsx"),w=n("./views/bookmark-view.jsx"),x=n("./views/story-view.jsx"),k=n("./editors/story-editor.jsx"),E=n("./widgets/new-items-alert.jsx");n("./lists/bookmark-list.scss"),e.exports=i.createClass({displayName:"BookmarkList",propTypes:{access:o.oneOf(["read-only","read-comment","read-write"]).isRequired,bookmarks:o.arrayOf(o.object),currentUser:o.object,project:o.object,selectedStoryId:o.number,database:o.instanceOf(m).isRequired,payloads:o.instanceOf(f).isRequired,route:o.instanceOf(g).isRequired,locale:o.instanceOf(v).isRequired,theme:o.instanceOf(b).isRequired},statics:{parseHash:function(e){var t,n;return(t=g.parseId(e,/S(\d+)/))?n=!0:(t=g.parseId(e,/s(\d+)/))&&(n=!1),{story:t,highlighting:n}},getHash:function(e){return e.story?e.highlighting?"S"+e.story:"s"+e.story:""}},renderAsync:function(e){var t=this.props.route.parameters,n=this.props.database.use({schema:t.schema,by:this}),o={stories:null,draftStories:null,authors:null,senders:null,reactions:null,respondents:null,recommendations:null,recipients:null,repos:null,access:this.props.access,bookmarks:this.props.bookmarks,currentUser:this.props.currentUser,project:this.props.project,database:this.props.database,payloads:this.props.payloads,route:this.props.route,locale:this.props.locale,theme:this.props.theme};return e.show(s.createElement(C,o)),n.start().then(function(e){return d.findProjectRepos(n,o.project).then(function(e){o.repos=e})}).then(function(){return u.findStoriesOfBookmarks(n,o.bookmarks,o.currentUser).then(function(e){o.stories=e})}).then(function(){return e.show(s.createElement(C,o)),u.findDraftStories(n,o.currentUser).then(function(e){o.draftStories=e})}).then(function(){e.show(s.createElement(C,o));var t=r.filter(r.concat(o.draftStories,o.stories));return l.findStoryAuthors(n,t).then(function(e){o.authors=e})}).then(function(){return e.show(s.createElement(C,o)),l.findBookmarkSenders(n,o.bookmarks).then(function(e){o.senders=e})}).then(function(){return e.show(s.createElement(C,o)),h.findReactionsToStories(n,o.stories,o.currentUser).then(function(e){o.reactions=e})}).then(function(){return e.show(s.createElement(C,o)),l.findReactionAuthors(n,o.reactions).then(function(e){o.respondents=e})}).then(function(){return e.show(s.createElement(C,o)),p.findBookmarksByUser(n,o.currentUser).then(function(e){o.recommendations=e})}).then(function(){return e.show(s.createElement(C,o)),l.findBookmarkRecipients(n,o.recommendations).then(function(e){o.recipients=e})}).then(function(){return s.createElement(C,o)})}});var C=e.exports.Sync=s.createClass({displayName:"BookmarkList.Sync",mixins:[y],propTypes:{access:o.oneOf(["read-only","read-comment","read-write"]).isRequired,bookmarks:o.arrayOf(o.object),senders:o.arrayOf(o.object),stories:o.arrayOf(o.object),authors:o.arrayOf(o.object),draftStories:o.arrayOf(o.object),draftAuthors:o.arrayOf(o.object),reactions:o.arrayOf(o.object),respondents:o.arrayOf(o.object),recommendations:o.arrayOf(o.object),recipients:o.arrayOf(o.object),currentUser:o.object,project:o.object,repos:o.arrayOf(o.object),database:o.instanceOf(m).isRequired,payloads:o.instanceOf(f).isRequired,route:o.instanceOf(g).isRequired,locale:o.instanceOf(v).isRequired,theme:o.instanceOf(b).isRequired},getInitialState:function(){return{hiddenStoryIds:[]}},render:function(){var t,n=S(this.props.bookmarks),r=e.exports.parseHash(this.props.route.hash);r.story&&(t="story-"+r.story);var o={items:n,behind:4,ahead:8,anchor:t,offset:20,onIdentity:this.handleBookmarkIdentity,onRender:this.handleBookmarkRender,onAnchorChange:this.handleBookmarkAnchorChange,onBeforeAnchor:this.handleBookmarkBeforeAnchor};return s.createElement("div",{className:"bookmark-list"},s.createElement(j,o),this.renderNewStoryAlert())},renderNewStoryAlert:function(){var t=this.props.locale.translate,n=r.size(this.state.hiddenStoryIds),o={story:r.first(this.state.hiddenStoryIds)},i={hash:e.exports.getHash(o),route:this.props.route,onClick:this.handleNewBookmarkAlertClick};return s.createElement(E,i,t("alert-$count-new-bookmarks",n))},handleBookmarkIdentity:function(e){return"story-"+e.item.story_id},handleBookmarkRender:function(t){var n=this,o=t.item,i=R(this.props.stories,o);if(!i)return null;var a=!1,c=!1;if(i){if("read-write"===this.props.access)if(i.published){var l=r.find(this.props.draftStories,{published_version_id:i.id});l&&(i=l,a=!0)}else a=!0;var u=this.props.route.hash,d=e.exports.parseHash(u);i.id===d.story&&d.highlighting&&(c=!0,setTimeout(function(){n.props.route.reanchor(r.toLower(u))},1e3))}if(a||t.needed)var p=P(this.props.senders,o),h={highlighting:c,bookmark:o,senders:p,currentUser:this.props.currentUser,database:this.props.database,route:this.props.route,locale:this.props.locale,theme:this.props.theme};if(a){var m=O(this.props.authors,i),f=D(this.props.recommendations,i),g=A(this.props.recipients,f);i||(m=_(this.props.currentUser));var v={story:i,authors:m,recommendations:f,recipients:g,currentUser:this.props.currentUser,database:this.props.database,payloads:this.props.payloads,route:this.props.route,locale:this.props.locale,theme:this.props.theme};return s.createElement(w,h,s.createElement(k,v))}if(t.needed){var b=N(this.props.reactions,i),m=O(this.props.authors,i),y=T(this.props.respondents,b),f=D(this.props.recommendations,i),g=A(this.props.recipients,f),j={access:this.props.access,story:i,bookmark:o,reactions:b,authors:m,respondents:y,recommendations:f,recipients:g,repos:this.props.repos,currentUser:this.props.currentUser,database:this.props.database,payloads:this.props.payloads,route:this.props.route,locale:this.props.locale,theme:this.props.theme};return s.createElement(w,h,s.createElement(x,j))}var E=t.previousHeight||t.estimatedHeight||100;return s.createElement("div",{className:"bookmark-view",style:{height:E}})},handleBookmarkAnchorChange:function(t){var n={story:r.get(t.item,"story_id")},s=e.exports.getHash(n);this.props.route.reanchor(s)},handleBookmarkBeforeAnchor:function(e){var t=r.map(e.items,"story_id");this.setState({hiddenStoryIds:t})},handleNewBookmarkAlertClick:function(e){this.setState({hiddenStoryIds:[]})}}),_=a(function(e){return[e]}),S=a(function(e){return r.orderBy(e,["id"],["desc"])}),R=a(function(e,t){return t?r.find(e,{id:t.story_id}):null}),N=a(function(e,t){if(t){var n=r.filter(e,{story_id:t.id});if(!r.isEmpty(n))return n}return c.array}),O=a(function(e,t){if(t){var n=r.filter(r.map(t.user_ids,function(t){return r.find(e,{id:t})}));if(!r.isEmpty(n))return n}return c.array}),P=O,T=a(function(e,t){var n=r.uniq(r.map(t,"user_id")),s=r.filter(r.map(n,function(t){return r.find(e,{id:t})}));return r.isEmpty(s)?c.array:s}),D=a(function(e,t){if(t){var n=t.published_version_id||t.id,s=r.filter(e,{story_id:n});if(!r.isEmpty(s))return s}return c.array}),A=a(function(e,t){var n=r.filter(e,function(e){return r.some(t,{target_user_id:e.id})});return r.isEmpty(n)?c.array:n})},"./lists/bookmark-list.scss":function(e,t){},"./lists/notification-list.jsx":function(e,t,n){"use strict";var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s=n("../../common/node_modules/lodash/lodash.js"),o=n("../../common/node_modules/react/react.js"),i=o.PropTypes,a=n("../node_modules/relaks/index.js"),c=n("../../common/src/utils/memoize.js"),l=(n("../../common/src/data/merger.js"),n("../../common/src/objects/finders/user-finder.js")),u=n("../../common/src/objects/finders/story-finder.js"),d=n("../../common/src/data/database.js"),p=n("../../common/src/routing/route.js"),h=n("../../common/src/locale/locale.js"),m=n("../../common/src/theme/theme.js"),f=n("../../common/src/mixins/update-check.js"),g=n("../../common/src/widgets/smart-list.jsx"),v=n("./views/notification-view.jsx"),b=n("./widgets/new-items-alert.jsx");n("./lists/notification-list.scss"),e.exports=a.createClass({displayName:"NotificationList",propTypes:{notifications:i.arrayOf(i.object),currentUser:i.object,database:i.instanceOf(d).isRequired,route:i.instanceOf(p).isRequired,locale:i.instanceOf(h).isRequired,theme:i.instanceOf(m).isRequired},statics:{parseHash:function(e){var t,n;return(t=p.parseId(e,/N(\d+)/))?n=!0:(t=p.parseId(e,/n(\d+)/))&&(n=!1),{notification:t,highlighting:n}},getHash:function(e){return void 0!=e.notification?e.highlighting?"N"+e.notification:"n"+e.notification:""}},renderAsync:function(e){var t=this.props.route.parameters,n=this.props.database.use({schema:t.schema,by:this}),r={users:null,stories:null,currentUser:this.props.currentUser,notifications:this.props.notifications,database:this.props.database,route:this.props.route,locale:this.props.locale,theme:this.props.theme};return e.show(o.createElement(y,r)),n.start().then(function(e){return l.findNotificationTriggerers(n,r.notifications).then(function(e){r.users=e})}).then(function(){return e.show(o.createElement(y,r)),u.findStoriesOfNotifications(n,r.notifications,r.currentUser).then(function(e){r.stories=e})}).then(function(){return o.createElement(y,r)})}});var y=e.exports.Sync=o.createClass({displayName:"NotificationList.Sync",mixins:[f],propTypes:{notifications:i.arrayOf(i.object),currentUser:i.object,users:i.arrayOf(i.object),database:i.instanceOf(d).isRequired,route:i.instanceOf(p).isRequired,locale:i.instanceOf(h).isRequired,theme:i.instanceOf(m).isRequired},getInitialState:function(){return{hiddenNotificationIds:[]}},render:function(){var t,n=j(this.props.notifications),r=e.exports.parseHash(this.props.route.hash);r.notification&&(t="notification-"+r.notification);var s={items:n,behind:20,ahead:40,anchor:t,offset:10,onIdentity:this.handleNotificationIdentity,onRender:this.handleNotificationRender,onAnchorChange:this.handleNotificationAnchorChange,onBeforeAnchor:this.handleNotificationBeforeAnchor};return o.createElement("div",{className:"notification-list"},o.createElement(g,s),this.renderNewNotificationAlert())},renderNewNotificationAlert:function(){var t=this.props.locale.translate,n=s.size(this.state.hiddenNotificationIds),r={notification:s.first(this.state.hiddenNotificationIds)},i={hash:e.exports.getHash(r),route:this.props.route,onClick:this.handleNewNotificationAlertClick};return o.createElement(b,i,t("alert-$count-new-notifications",n))},componentDidMount:function(){this.scheduleNotificationRead()},componentDidUpdate:function(e,t){e.notifications===this.props.notifications&&t.hiddenNotificationIds===this.state.hiddenNotificationIds||this.scheduleNotificationRead()},scheduleNotificationRead:function(){var e=this;setTimeout(function(){var t=s.filter(e.props.notifications,function(t){if(!t.seen&&!s.includes(e.state.hiddenNotificationIds,t.id))return!0});if(!s.isEmpty(t)){var n=t.length;n>5?n=5:n<2&&(n=2),clearTimeout(e.markAsSeenTimeout),e.markAsSeenTimeout=setTimeout(function(){e.markAsSeen(t)},1e3*n)}},50)},componentWillUnmount:function(){clearTimeout(this.markAsSeenTimeout)},handleNotificationIdentity:function(e){return"notification-"+e.item.id},handleNotificationRender:function(e){if(e.needed){var t=e.item,n=w(this.props.users,t),s={notification:t,user:n,database:this.props.database,route:this.props.route,locale:this.props.locale,theme:this.props.theme,onClick:this.handleNotificationClick};return o.createElement(v,r({key:t.id},s))}var i=e.previousHeight||e.estimatedHeight||25;return o.createElement("div",{className:"notification-view",style:{height:i}})},markAsSeen:function(e){var t=this.props.route.parameters,n=this.props.database.use({schema:t.schema,by:this}),r=s.map(e,function(e){return{id:e.id,seen:!0}});return n.save({table:"notification"},r)},handleNotificationClick:function(e){var t=e.target.props.notification;t.seen||this.markAsSeen([t])},handleNotificationAnchorChange:function(t){var n={notification:s.get(t.item,"id")},r=e.exports.getHash(n);this.props.route.reanchor(r)},handleNotificationBeforeAnchor:function(e){var t=s.map(e.items,"id");this.setState({hiddenNotificationIds:t})},handleNewNotificationAlertClick:function(e){this.setState({hiddenNotificationIds:[]})}}),j=c(function(e){return s.orderBy(e,["ctime"],["desc"])}),w=c(function(e,t){return t?s.find(e,{id:t.user_id}):null})},"./lists/notification-list.scss":function(e,t){},"./lists/reaction-list.jsx":function(e,t,n){"use strict";var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s=n("../../common/node_modules/lodash/lodash.js"),o=n("../../common/node_modules/react/react.js"),i=o.PropTypes,a=(n("../../common/node_modules/react-dom/index.js"),n("../../common/src/utils/memoize.js")),c=(n("../../common/src/data/merger.js"),n("../../common/src/data/database.js")),l=n("../../common/src/transport/payloads.js"),u=n("../../common/src/routing/route.js"),d=n("../../common/src/locale/locale.js"),p=n("../../common/src/theme/theme.js"),h=n("../../common/src/mixins/update-check.js"),m=n("./views/reaction-view.jsx"),f=n("./editors/reaction-editor.jsx"),g=n("../../common/src/widgets/smart-list.jsx");n("./lists/reaction-list.scss"),e.exports=o.createClass({displayName:"ReactionList",mixins:[h],propTypes:{access:i.oneOf(["read-only","read-comment","read-write"]).isRequired,story:i.object.isRequired,reactions:i.arrayOf(i.object),respondents:i.arrayOf(i.object),repo:i.object,currentUser:i.object,database:i.instanceOf(c).isRequired,payloads:i.instanceOf(l).isRequired,route:i.instanceOf(u).isRequired,locale:i.instanceOf(d).isRequired,theme:i.instanceOf(p).isRequired,onFinish:i.func},statics:{parseHash:function(e){var t,n;return(t=u.parseId(e,/R(\d+)/))?n=!0:(t=u.parseId(e,/r(\d+)/))&&(n=!1),{reaction:t,highlighting:n}},getHash:function(e){return void 0!=e.reaction?e.highlighting?"R"+e.reaction:"r"+e.reaction:""}},getInitialState:function(){return{hiddenReactionIds:[]}},render:function(){var t,n=v(this.props.reactions,this.props.currentUser),r=e.exports.parseHash(this.props.route.hash);r.reaction&&(t="reaction-"+r.reaction);var s={items:n,behind:5,ahead:10,anchor:t,offset:4,inverted:!0,fresh:!1,onIdentity:this.handleReactionIdentity,onTransition:this.handleReactionTransition,onRender:this.handleReactionRender,onBeforeAnchor:this.handleReactionBeforeAnchor};return o.createElement("div",{className:"reaction-list"},o.createElement(g,s))},handleReactionIdentity:function(e){if(!e.alternative)return"reaction-"+e.item.id;var t=this.props.route.parameters,n={schema:t.schema,table:"reaction"},r=this.props.database.findTemporaryID(n,e.item.id);return r?"reaction-"+r:void 0},handleReactionTransition:function(e){return!(e.item.id<1)},handleReactionRender:function(t){var n=t.item,s=!1,i=!1,a=!1;if(n){n.published||n.user_id===this.props.currentUser.id&&(s=!0,n.ptime||(i=!0));var c=e.exports.parseHash(this.props.route.hash);n.id===c.reaction&&(a=c.highlighting)}else s=!0,i=!0;if(s){var l=i?0:n.id,u={reaction:n,story:this.props.story,currentUser:this.props.currentUser,database:this.props.database,payloads:this.props.payloads,route:this.props.route,locale:this.props.locale,theme:this.props.theme,onFinish:this.props.onFinish};return o.createElement(f,r({key:l},u))}var d=b(this.props.respondents,n),u={access:this.props.access,highlighting:a,reaction:n,respondent:d,story:this.props.story,repo:this.props.repo,currentUser:this.props.currentUser,database:this.props.database,route:this.props.route,locale:this.props.locale,theme:this.props.theme};return o.createElement(m,r({key:n.id},u))},handleReactionBeforeAnchor:function(e){var t=s.map(e.items,"id");this.setState({hiddenReactionIds:t})}});var v=a(function(e,t){var n=s.orderBy(e,["ptime","id"],["desc","desc"]),r=s.remove(n,{user_id:t,ptime:null});return s.each(r,function(e){n.unshift(e)}),n}),b=a(function(e,t){return t?s.find(e,{id:t.user_id}):null})},"./lists/reaction-list.scss":function(e,t){},"./lists/story-list.jsx":function(e,t,n){"use strict";var r=n("../../common/node_modules/lodash/lodash.js"),s=(n("../../common/node_modules/bluebird/js/browser/bluebird.js"),n("../../common/node_modules/react/react.js")),o=s.PropTypes,i=n("../node_modules/relaks/index.js"),a=n("../../common/src/utils/memoize.js"),c=n("../../common/src/data/empty.js"),l=n("../../common/src/utils/component-refs.js"),u=n("../../common/src/objects/finders/user-finder.js"),d=n("../../common/src/objects/finders/repo-finder.js"),p=n("../../common/src/objects/finders/bookmark-finder.js"),h=n("../../common/src/objects/finders/reaction-finder.js"),m=n("../../common/src/data/database.js"),f=n("../../common/src/transport/payloads.js"),g=n("../../common/src/routing/route.js"),v=n("../../common/src/locale/locale.js"),b=n("../../common/src/theme/theme.js"),y=n("../../common/src/mixins/update-check.js"),j=n("../../common/src/widgets/smart-list.jsx"),w=n("./views/story-view.jsx"),x=n("./editors/story-editor.jsx"),k=n("./widgets/new-items-alert.jsx");n("./lists/story-list.scss"),e.exports=i.createClass({displayName:"StoryList",propTypes:{access:o.oneOf(["read-only","read-comment","read-write"]).isRequired,acceptNewStory:o.bool,stories:o.arrayOf(o.object),draftStories:o.arrayOf(o.object),pendingStories:o.arrayOf(o.object),currentUser:o.object,project:o.object,database:o.instanceOf(m).isRequired,payloads:o.instanceOf(f).isRequired,route:o.instanceOf(g).isRequired,locale:o.instanceOf(v).isRequired,theme:o.instanceOf(b).isRequired},statics:{parseHash:function(e){var t,n;return(t=g.parseId(e,/S(\d+)/))?n=!0:(t=g.parseId(e,/s(\d+)/))&&(n=!1),{story:t,highlighting:n}},getHash:function(e){return e.story?e.highlighting?"S"+e.story:"s"+e.story:""}},getDefaultProps:function(){return{acceptNewStory:!1}},renderAsync:function(e,t){var n=this.props.route.parameters,o=this.props.database.use({schema:n.schema,by:this}),i={authors:null,reactions:null,respondents:null,recommendations:null,recipients:null,repos:null,access:this.props.access,acceptNewStory:this.props.acceptNewStory,stories:this.props.stories,draftStories:this.props.draftStories,pendingStories:this.props.pendingStories,currentUser:this.props.currentUser,project:this.props.project,database:this.props.database,payloads:this.props.payloads,route:this.props.route,locale:this.props.locale,theme:this.props.theme};return e.show(s.createElement(E,i)),o.start().then(function(e){return d.findProjectRepos(o,i.project).then(function(e){i.repos=e})}).then(function(){e.show(s.createElement(E,i));var t=r.filter(r.concat(i.pendingStories,i.draftStories,i.stories));return u.findStoryAuthors(o,t).then(function(e){i.authors=e})}).then(function(){e.show(s.createElement(E,i));var t=r.filter(r.concat(i.pendingStories,i.stories));return h.findReactionsToStories(o,t,i.currentUser).then(function(e){i.reactions=e})}).then(function(){return e.show(s.createElement(E,i)),u.findReactionAuthors(o,i.reactions).then(function(e){i.respondents=e})}).then(function(){e.show(s.createElement(E,i));var t=r.filter(r.concat(i.pendingStories,i.stories));return p.findBookmarksByUser(o,i.currentUser,t).then(function(e){i.recommendations=e})}).then(function(){return e.show(s.createElement(E,i)),u.findBookmarkRecipients(o,i.bookmarks).then(function(e){i.recipients=e})}).then(function(){return s.createElement(E,i)})}});var E=e.exports.Sync=s.createClass({displayName:"StoryList.Sync",mixins:[y],propTypes:{access:o.oneOf(["read-only","read-comment","read-write"]).isRequired,acceptNewStory:o.bool,stories:o.arrayOf(o.object),authors:o.arrayOf(o.object),draftStories:o.arrayOf(o.object),pendingStories:o.arrayOf(o.object),reactions:o.arrayOf(o.object),respondents:o.arrayOf(o.object),recommendations:o.arrayOf(o.object),recipients:o.arrayOf(o.object),currentUser:o.object,project:o.object,repos:o.arrayOf(o.object),database:o.instanceOf(m).isRequired,payloads:o.instanceOf(f).isRequired,route:o.instanceOf(g).isRequired,locale:o.instanceOf(v).isRequired,theme:o.instanceOf(b).isRequired},getInitialState:function(){return this.components=l({list:j}),{hiddenStoryIds:[]}},componentWillReceiveProps:function(e){var t=this;if(this.props.stories!==e.stories||this.props.draftStories!==e.draftStories||this.props.pendingStories!==e.pendingStories){var n=r.concat(this.props.draftStories,this.props.pendingStories,this.props.stories),s=r.concat(e.draftStories,e.pendingStories,e.stories),o=r.keyBy(s,"id");r.each(n,function(n){if(n&&!o[n.id]){var r=t.props.route.parameters,s={address:r.address,schema:r.schema,table:"story"},i=t.props.database.findPermanentID(s,n.id);i&&o[i]||e.payloads.abandon(n)}})}},render:function(){var t=this.components.setters,n=_(this.props.stories,this.props.pendingStories);this.props.acceptNewStory&&(n=S(n,this.props.draftStories,this.props.currentUser));var r,o=e.exports.parseHash(this.props.route.hash);o.story&&(r="story-"+o.story);var i={ref:t.list,items:n,offset:20,behind:4,ahead:8,anchor:r,onIdentity:this.handleStoryIdentity,onRender:this.handleStoryRender,onAnchorChange:this.handleStoryAnchorChange,onBeforeAnchor:this.handleStoryBeforeAnchor};return this.freshList=!1,s.createElement("div",{className:"story-list"},s.createElement(j,i),this.renderNewStoryAlert())},renderNewStoryAlert:function(){var t=this.props.locale.translate,n=r.size(this.state.hiddenStoryIds),o={story:r.first(this.state.hiddenStoryIds)},i={hash:e.exports.getHash(o),route:this.props.route,onClick:this.handleNewStoryAlertClick};return s.createElement(k,i,t("alert-$count-new-stories",n))},handleStoryIdentity:function(e){if(!e.alternative||!e.item)return this.props.acceptNewStory&&0===e.currentIndex?"story-top":"story-"+e.item.id;var t=this.props.route.parameters,n={schema:t.schema,table:"story"},r=this.props.database.findTemporaryID(n,e.item.id);return r?"story-"+r:void 0},handleStoryRender:function(t){var n=this,o=t.item,i=!1,a=!1;if(o){if("read-write"===this.props.access)if(o.published){var c=r.find(this.props.draftStories,{published_version_id:o.id});c&&(o=c,i=!0)}else i=!0;var l=this.props.route.hash,u=e.exports.parseHash(l);o.id===u.story&&u.highlighting&&(a=!0,setTimeout(function(){n.props.route.reanchor(r.toLower(l))},1e3))}else i=!0;if(i){var d=O(this.props.authors,o),p=T(this.props.recommendations,o),h=D(this.props.recipients,p);o||(d=C(this.props.currentUser));var m={highlighting:a,story:o,authors:d,recommendations:p,recipients:h,repos:this.props.repos,isStationary:0===t.currentIndex,currentUser:this.props.currentUser,database:this.props.database,payloads:this.props.payloads,route:this.props.route,locale:this.props.locale,theme:this.props.theme};return s.createElement(x,m)}if(t.needed){var f=N(this.props.reactions,o),d=O(this.props.authors,o),g=P(this.props.respondents,f),p=T(this.props.recommendations,o),h=D(this.props.recipients,p),v=!r.includes(this.props.stories,o),b={highlighting:a,pending:v,access:this.props.access,story:o,reactions:f,authors:d,respondents:g,recommendations:p,recipients:h,repos:this.props.repos,currentUser:this.props.currentUser,database:this.props.database,payloads:this.props.payloads,route:this.props.route,locale:this.props.locale,theme:this.props.theme,onBump:this.handleStoryBump};return s.createElement(w,b)}var y=t.previousHeight||t.estimatedHeight||100;return s.createElement("div",{className:"story-view",style:{height:y}})},handleStoryAnchorChange:function(t){var n={story:r.get(t.item,"id")},s=e.exports.getHash(n);this.props.route.reanchor(s)},handleStoryBeforeAnchor:function(e){var t=r.map(e.items,"id");this.setState({hiddenStoryIds:t})},handleNewStoryAlertClick:function(e){this.setState({hiddenStoryIds:[]})},handleStoryBump:function(e){this.components.list.releaseAnchor()}}),C=a(function(e){return[e]}),_=a(function(e,t){return r.isEmpty(t)||(e=r.slice(e),r.each(t,function(t){t.published_version_id||e.push(t)})),r.orderBy(e,[R,"id"],["desc","desc"])}),S=a(function(e,t,n){var s=r.filter(t,function(e){return!e.published_version_id&&!e.published}),o=function(e){return e.user_ids[0]===n.id};return s=r.orderBy(s,[o,"id"],["desc","desc"]),r.find(s,function(e){if(e.user_ids[0]===n.id)return!0})||s.unshift(null),r.concat(s,e)},[null]),R=function(e){return e.btime||e.ptime},N=a(function(e,t){if(t){var n=r.filter(e,{story_id:t.id});if(!r.isEmpty(n))return n}return c.array}),O=a(function(e,t){if(t){var n=r.keyBy(e,"id"),s=r.filter(r.map(t.user_ids,function(e){return n[e]}));if(!r.isEmpty(s))return s}return c.array}),P=a(function(e,t){var n=r.uniq(r.map(t,"user_id")),s=r.keyBy(e,"id"),o=r.filter(r.map(n,function(e){return s[e]}));return r.isEmpty(o)?c.array:o}),T=a(function(e,t){if(t){var n=t.published_version_id||t.id,s=r.filter(e,{story_id:n});if(!r.isEmpty(s))return s}return c.array}),D=a(function(e,t){var n=r.filter(e,function(e){return r.some(t,{target_user_id:e.id})});return r.isEmpty(n)?c.array:n})},"./lists/story-list.scss":function(e,t){},"./lists/user-activity-list.jsx":function(e,t,n){"use strict";var r=n("../../common/node_modules/lodash/lodash.js"),s=n("../../common/node_modules/react/react.js"),o=s.PropTypes,i=n("../../common/src/utils/memoize.js"),a=n("../../common/src/utils/date-tracker.js"),c=n("../../common/src/routing/route.js"),l=n("../../common/src/locale/locale.js"),u=n("../../common/src/theme/theme.js"),d=n("../../common/src/mixins/update-check.js"),p=(n("./widgets/profile-image.jsx"),n("../../common/src/widgets/time.jsx"));n("./lists/user-activity-list.scss"),e.exports=s.createClass({displayName:"UserActivityList",mixins:[d],propTypes:{user:o.object,stories:o.arrayOf(o.object),storyCountEstimate:o.number,route:o.instanceOf(c).isRequired,locale:o.instanceOf(l).isRequired,theme:o.instanceOf(u).isRequired},render:function(){if(this.props.stories){var e=h(this.props.stories);return s.createElement("div",{className:"user-activity-list"},r.map(e,this.renderActivity))}var t=r.range(0,this.props.storyCountEstimate);return s.createElement("div",{className:"user-activity-list"},r.map(t,this.renderActivityPlaceholder))},renderActivity:function(e){var t=this.props.route,o=[n("./pages/people-page.jsx"),n("./lists/story-list.jsx")],i=r.pick(t.parameters,"schema","date","search");i.user=this.props.user.id,i.story=e.id,i.highlighting=!0;var c=t.find(o,i),l=this.renderText(e),u="label",d=e.btime||e.ptime;return(d>=a.todayISO||d>=a.yesterdayISO)&&(u+=" recent"),s.createElement("div",{key:e.id,className:"activity"},s.createElement(p,{time:e.ptime,locale:this.props.locale,compact:!0}),s.createElement("div",{className:u},s.createElement("a",{href:c},l)))},renderActivityPlaceholder:function(e){return s.createElement("div",{key:e,className:"activity"},"Â ")},renderText:function(e){var t=this.props.locale.translate,n=this.props.locale.name,s=this.props.user,o=n(r.get(s,"details.name"),r.get(s,"details.gender"));switch(e.type){case"push":return t("user-activity-$name-pushed-code",o);case"merge":return t("user-activity-$name-merged-code",o);case"branch":return t("user-activity-$name-created-branch",o);case"tag":return t("user-activity-$name-created-tag",o);case"issue":return t("user-activity-$name-reported-issue",o);case"milestone":return t("user-activity-$name-created-milestone",o);case"merge-request":return t("user-activity-$name-created-merge-request",o);case"wiki":return t("user-activity-$name-edited-wiki-page",o);case"member":case"repo":return t("user-activity-$name-"+e.details.action+"-repo",o);case"post":var i=e.details.resources,a=r.countBy(i,"type");return a.video>0?t("user-activity-$name-posted-$count-video-clips",o,a.video):a.image>0?t("user-activity-$name-posted-$count-pictures",o,a.image):a.audio>0?t("user-activity-$name-posted-$count-audio-clips",o,a.audio):a.website>0?t("user-activity-$name-posted-$count-links",o,a.website):t("user-activity-$name-wrote-post",o);case"survey":return t("user-activity-$name-started-survey",o);case"task-list":return t("user-activity-$name-started-task-list",o);default:return e.type}}});var h=i(function(e){return e=r.orderBy(e,[m],["desc"])}),m=function(e){return e.btime||e.ptime}},"./lists/user-activity-list.scss":function(e,t){},"./lists/user-list.jsx":function(e,t,n){"use strict";var r=n("../../common/node_modules/lodash/lodash.js"),s=n("../../common/node_modules/react/react.js"),o=s.PropTypes,i=(n("../node_modules/relaks/index.js"),n("../../common/node_modules/moment/moment.js"),n("../../common/src/utils/memoize.js")),a=n("../../common/src/data/empty.js"),c=(n("../../common/src/utils/date-tracker.js"),n("../../common/src/utils/date-utils.js"),n("../../common/src/data/database.js")),l=n("../../common/src/routing/route.js"),u=n("../../common/src/locale/locale.js"),d=n("../../common/src/theme/theme.js"),p=n("../../common/src/mixins/update-check.js"),h=n("../../common/src/widgets/smart-list.jsx"),m=n("./views/user-view.jsx");n("./lists/user-list.scss"),e.exports=s.createClass({displayName:"UserList",mixins:[p],propTypes:{users:o.arrayOf(o.object),roles:o.arrayOf(o.object),dailyActivities:o.object,listings:o.arrayOf(o.object),stories:o.arrayOf(o.object),currentUser:o.object,selectedDate:o.string,today:o.string,link:o.oneOf(["user","team"]),database:o.instanceOf(c).isRequired,route:o.instanceOf(l).isRequired,locale:o.instanceOf(u).isRequired,theme:o.instanceOf(d).isRequired,loading:o.bool},statics:{parseHash:function(e){var t,n;return(t=l.parseId(e,/U(\d+)/))?n=!0:(t=l.parseId(e,/u(\d+)/))&&(n=!1),{user:t,highlighting:n}},getHash:function(e){return e.user?e.highlighting?"U"+e.user:"u"+e.user:""}},getInitialState:function(){return{viewOptions:{}}},render:function(){var t,n=f(this.props.users,this.props.locale),r=e.exports.parseHash(this.props.route.hash);r.user&&(t="user-"+r.user);var o={items:n,offset:16,behind:4,ahead:8,anchor:t,onIdentity:this.handleUserIdentity,onRender:this.handleUserRender,onAnchorChange:this.handleUserAnchorChange};return s.createElement("div",{className:"user-list"},s.createElement(h,o))},handleUserIdentity:function(e){return"user-"+e.item.id},handleUserRender:function(e){if(e.needed){var t,n=e.item,o=g(this.props.roles,n),i=r.get(this.props.dailyActivities,n.id);if(this.props.listings){var a=v(this.props.listings,n);t=b(this.props.stories,a)}else t=y(this.props.stories,n);t&&t.length>5&&(t=r.slice(t,-5));var c=this.state.viewOptions[n.id]||{},l={user:n,roles:o,dailyActivities:i,stories:t,options:c,currentUser:this.props.currentUser,database:this.props.database,route:this.props.route,locale:this.props.locale,theme:this.props.theme,selectedDate:this.props.selectedDate,today:this.props.today,link:this.props.link,onOptionChange:this.handleOptionChange};return s.createElement(m,l)}var u=e.previousHeight||e.estimatedHeight||100;return s.createElement("div",{className:"user-view",style:{height:u}})},handleUserAnchorChange:function(t){var n={user:r.get(t.item,"id")},s=e.exports.getHash(n);this.props.route.reanchor(s)},handleOptionChange:function(e){var t=r.clone(this.state.viewOptions);t[e.user.id]=e.options,this.setState({viewOptions:t})}});var f=i(function(e,t){var n=t.pick,s=function(e){return n(e.details.name)};return r.orderBy(e,[s],["asc"])}),g=i(function(e,t){if(t){var n=r.filter(r.map(t.role_ids,function(t){return r.find(e,{id:t})}));if(!r.isEmpty(n))return n}return a.array}),v=i(function(e,t){return t?r.find(e,function(e){if(e.filters.user_ids[0]===t.id)return!0}):null}),b=i(function(e,t){if(t){var n=r.keyBy(e,"id"),s=r.filter(r.map(t.story_ids,function(e){return n[e]}));if(!r.isEmpty(s))return s}return a.array}),y=i(function(e,t){var n=r.filter(e,function(e){return r.includes(e.user_ids,t.id)});return r.isEmpty(n)?a.array:n})},"./lists/user-list.scss":function(e,t){},"./lists/user-selection-list.jsx":function(e,t,n){"use strict";function r(e){var t=["user"];e.selected&&t.push("selected"),e.disabled&&t.push("disabled");var n=p.getDisplayName(e.user,e.locale),r={className:t.join(" "),"data-user-id":e.user.id,onClick:e.disabled?null:e.onClick},s={user:e.user,theme:e.theme,size:"small"};return i.createElement("div",r,i.createElement(v,s),i.createElement("span",{className:"name"},n),i.createElement("i",{className:"fa fa-check-circle"}))}var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o=n("../../common/node_modules/lodash/lodash.js"),i=n("../../common/node_modules/react/react.js"),a=i.PropTypes,c=n("../node_modules/relaks/index.js"),l=n("../../common/src/utils/memoize.js"),u=n("../../common/src/objects/finders/project-finder.js"),d=n("../../common/src/objects/finders/user-finder.js"),p=n("../../common/src/objects/utils/user-utils.js"),h=n("../../common/src/data/database.js"),m=n("../../common/src/routing/route.js"),f=n("../../common/src/locale/locale.js"),g=n("../../common/src/theme/theme.js"),v=n("./widgets/profile-image.jsx");n("./lists/user-selection-list.scss"),e.exports=c.createClass({displayName:"UserSelectionList",propTypes:{selection:a.arrayOf(a.number),disabled:a.arrayOf(a.number),database:a.instanceOf(h).isRequired,route:a.instanceOf(m).isRequired,locale:a.instanceOf(f).isRequired,theme:a.instanceOf(g).isRequired,onSelect:a.func},renderAsync:function(e){var t=(this.props.route.parameters,this.props.database.use({by:this})),n={users:null,selection:this.props.selection,disabled:this.props.disabled,locale:this.props.locale,theme:this.props.theme,onSelect:this.props.onSelect};return e.show(i.createElement(b,n)),t.start().then(function(e){return u.findCurrentProject(t).then(function(e){return d.findProjectMembers(t,e).then(function(e){n.users=e})})}).then(function(){return i.createElement(b,n)})}});var b=e.exports.Sync=i.createClass({displayName:"UserSelectionList.Sync",propTypes:{users:a.arrayOf(a.object),selection:a.arrayOf(a.number),disabled:a.arrayOf(a.number),locale:a.instanceOf(f).isRequired,theme:a.instanceOf(g).isRequired,onSelect:a.func},render:function(){var e=y(this.props.users,this.props.locale);return i.createElement("div",{className:"user-selection-list"},o.map(e,this.renderUser))},renderUser:function(e){var t={user:e,selected:o.includes(this.props.selection,e.id),disabled:o.includes(this.props.disabled,e.id),locale:this.props.locale,theme:this.props.theme,onClick:this.handleUserClick};return i.createElement(r,s({key:e.id},t))},triggerSelectEvent:function(e){this.props.onSelect&&this.props.onSelect({type:"select",target:this,selection:e})},handleUserClick:function(e){var t=parseInt(e.currentTarget.getAttribute("data-user-id")),n=this.props.selection;n=o.includes(n,t)?o.difference(n,[t]):o.union(n,[t]),this.triggerSelectEvent(n)}}),y=l(function(e,t){var n=t.pick,r=function(e){return n(e.details.name)};return o.orderBy(e,[r],["asc"])})},"./lists/user-selection-list.scss":function(e,t){},"./pages/bookmarks-page.jsx":function(e,t,n){"use strict";var r=n("../../common/node_modules/lodash/lodash.js"),s=n("../../common/node_modules/react/react.js"),o=s.PropTypes,i=n("../node_modules/relaks/index.js"),a=n("../../common/src/objects/finders/user-finder.js"),c=n("../../common/src/objects/finders/bookmark-finder.js"),l=n("../../common/src/objects/finders/project-finder.js"),u=n("../../common/src/objects/settings/project-settings.js"),d=n("../../common/src/data/database.js"),p=n("../../common/src/transport/payloads.js"),h=n("../../common/src/routing/route.js"),m=n("../../common/src/locale/locale.js"),f=n("../../common/src/theme/theme.js"),g=n("./widgets/page-container.jsx"),v=n("./lists/bookmark-list.jsx"),b=n("./widgets/loading-animation.jsx"),y=n("./widgets/empty-message.jsx");n("./pages/bookmarks-page.scss"),e.exports=i.createClass({displayName:"BookmarksPage",propTypes:{database:o.instanceOf(d).isRequired,payloads:o.instanceOf(p).isRequired,route:o.instanceOf(h).isRequired,locale:o.instanceOf(m).isRequired,theme:o.instanceOf(f).isRequired},statics:{parseURL:function(e,t){return h.match(e,["/:schema/bookmarks/?"],function(e){return{schema:e.schema}})},getURL:function(e){var t="/"+e.schema+"/bookmarks/";return{path:t,query:void 0}},configureUI:function(e){return{navigation:{route:{schema:e.parameters.schema},section:"bookmarks"}}}},renderAsync:function(e){var t=this.props.route.parameters,n=this.props.database.use({schema:t.schema,by:this}),r={bookmarks:null,currentUser:null,project:null,database:this.props.database,payloads:this.props.payloads,route:this.props.route,locale:this.props.locale,theme:this.props.theme};return e.show(s.createElement(j,r)),n.start().then(function(e){return a.findUser(n,e).then(function(e){r.currentUser=e})}).then(function(){return l.findCurrentProject(n).then(function(e){r.project=e})}).then(function(e){return c.findBookmarksForUser(n,r.currentUser).then(function(e){r.bookmarks=e})}).then(function(){return s.createElement(j,r)})}});var j=e.exports.Sync=s.createClass({displayName:"BookmarksPage.Sync",propTypes:{bookmarks:o.arrayOf(o.object),currentUser:o.object,project:o.object,database:o.instanceOf(d).isRequired,route:o.instanceOf(h).isRequired,locale:o.instanceOf(m).isRequired,theme:o.instanceOf(f).isRequired},getAccessLevel:function(){var e=this.props,t=e.project,n=e.currentUser;return u.getUserAccessLevel(t,n)||"read-only"},render:function(){return s.createElement(g,{className:"bookmarks-page"},this.renderList(),this.renderEmptyMessage())},renderList:function(){var e=(this.props.route.parameters,{access:this.getAccessLevel(),bookmarks:this.props.bookmarks,currentUser:this.props.currentUser,project:this.props.project,database:this.props.database,payloads:this.props.payloads,route:this.props.route,locale:this.props.locale,theme:this.props.theme});return s.createElement(v,e)},renderEmptyMessage:function(){var e=this.props.bookmarks;if(!r.isEmpty(e))return null;if(e){var t={locale:this.props.locale,online:this.props.database.online,phrase:"bookmarks-no-bookmarks"};return s.createElement(y,t)}return s.createElement(b,null)}})},"./pages/bookmarks-page.scss":function(e,t){},"./pages/error-page.jsx":function(e,t,n){"use strict";var r=n("../../common/node_modules/react/react.js"),s=r.PropTypes,o=n("../../common/src/errors/http-error.js"),i=n("../../common/src/data/database.js"),a=n("../../common/src/routing/route.js"),c=n("../../common/src/locale/locale.js"),l=n("../../common/src/theme/theme.js"),u=n("./widgets/page-container.jsx");n("./pages/error-page.scss"),e.exports=r.createClass({displayName:"ErrorPage",propTypes:{database:s.instanceOf(i).isRequired,route:s.instanceOf(a).isRequired,locale:s.instanceOf(c).isRequired,theme:s.instanceOf(l).isRequired},statics:{parseURL:function(e,t,n){return a.match(e,["/:schema/error/:code","/error/:code"],function(e){return{schema:e.schema,code:parseInt(e.code)}})},getURL:function(e){var t="/error/"+e.code;return e.schema&&(t="/"+e.schema+t),{path:t,query:void 0,hash:void 0}},configureUI:function(e){var t=e.parameters,n=!!t.schema;return{navigation:{top:n,bottom:n}}}},render:function(){var e,t=this.props.route.parameters,s=new o(t.code),i=n("../assets/unicorn.svg");return e=404===t.code?"The page you're trying to reach doesn't exist. But then again, who does?":"The application is behaving in ways its maker never intended.",r.createElement(u,{className:"error-page"},r.createElement("div",{className:"graphic"},r.createElement(i,null)),r.createElement("div",{className:"text"},r.createElement("h1",{className:"title"},s.statusCode," ",s.message),r.createElement("p",null,e)))}})},"./pages/error-page.scss":function(e,t){},"./pages/news-page.jsx":function(e,t,n){"use strict";var r=n("../../common/node_modules/lodash/lodash.js"),s=n("../../common/node_modules/react/react.js"),o=s.PropTypes,i=(n("../../common/node_modules/react-dom/index.js"),n("../../common/node_modules/moment/moment.js")),a=n("../node_modules/relaks/index.js"),c=n("../../common/src/objects/finders/user-finder.js"),l=n("../../common/src/objects/finders/project-finder.js"),u=n("../../common/src/objects/finders/story-finder.js"),d=n("../../common/src/objects/settings/project-settings.js"),p=n("../../common/src/utils/tag-scanner.js"),h=n("../../common/src/data/database.js"),m=n("../../common/src/transport/payloads.js"),f=n("../../common/src/routing/route.js"),g=n("../../common/src/locale/locale.js"),v=n("../../common/src/theme/theme.js"),b=n("../../common/src/mixins/update-check.js"),y=n("./widgets/page-container.jsx"),j=n("./lists/story-list.jsx"),w=n("./widgets/loading-animation.jsx"),x=n("./widgets/empty-message.jsx");n("./pages/news-page.scss"),e.exports=a.createClass({displayName:"NewsPage",propTypes:{database:o.instanceOf(h).isRequired,payloads:o.instanceOf(m).isRequired,route:o.instanceOf(f).isRequired,locale:o.instanceOf(g).isRequired,theme:o.instanceOf(v).isRequired},statics:{parseURL:function(e,t){return f.match(e,["/:schema/news/?"],function(e){return{schema:e.schema,roles:f.parseIdList(t.roles),search:t.search,date:f.parseDate(t.date)}})},getURL:function(e){var t="/"+e.schema+"/news/",n={};return void 0!=e.date&&(n.date=e.date),void 0!=e.roles&&(n.roles=e.roles.join(" ")),void 0!=e.search&&(n.search=e.search),{path:t,query:n}},configureUI:function(e){var t=e.parameters,n={schema:t.schema},r={type:"daily-activities",schema:t.schema,public:"guest"};return{calendar:{route:n,statistics:r},filter:{route:n},search:{route:n,statistics:r},navigation:{route:n,section:"news"}}}},renderAsync:function(e){var t,n=this,o=this.props.route.parameters,i=this.props.database.use({schema:o.schema,by:this});o.search&&!p.removeTags(o.search)&&(t=p.findTags(o.search));var a={stories:null,draftStories:null,pendingStories:null,project:null,currentUser:null,acceptNewStory:!o.date&&r.isEmpty(o.roles)&&!o.search,database:this.props.database,payloads:this.props.payloads,route:this.props.route,locale:this.props.locale,theme:this.props.theme},d=!e.revising();return e.show(s.createElement(k,a)),i.start().then(function(e){return c.findUser(i,e).then(function(e){a.currentUser=e})}).then(function(){return l.findCurrentProject(i).then(function(e){a.project=e})}).then(function(){return e.show(s.createElement(k,a)),t?u.findStoriesWithTags(i,t,a.currentUser).then(function(e){a.stories=e}):o.search?u.findStoriesMatchingText(i,o.search,a.locale,a.currentUser).then(function(e){a.stories=e}):o.date?u.findStoriesOnDate(i,o.date,a.currentUser).then(function(e){a.stories=e}):r.isEmpty(o.roles)?u.findStoriesInListing(i,"news",a.currentUser,d).then(function(e){a.stories=e}).then(function(){return e.show(s.createElement(k,a)),u.findDraftStories(i,a.currentUser).then(function(e){a.draftStories=e})}).then(function(){return u.findUnlistedStories(i,a.currentUser,a.stories).then(function(e){a.pendingStories=e})}):u.findStoriesWithRolesInListing(i,"news",o.roles,a.currentUser,d).then(function(e){a.stories=e})}).then(function(){if(!o.date){var e=j.parseHash(n.props.route.hash);if(e.story&&e.highlighting){var t=r.concat(a.stories,a.draftStories,a.pendingStories);if(!r.find(t,{id:e.story}))return u.findStory(i,e.story).then(function(e){return n.redirectToStory(o.schema,e)}).catch(function(e){})}}}).then(function(){return s.createElement(k,a)})},redirectToStory:function(e,t){if(t.ptime&&t.published&&!1!==t.ready){if(i()-i(t.ptime)<6e4)return}var r=[n("./pages/news-page.jsx"),n("./lists/story-list.jsx")],s={schema:e,date:i(t.ptime).format("YYYY-MM-DD"),story:t.id,highlighting:!0};return this.props.route.replace(r,s)}});var k=e.exports.Sync=s.createClass({displayName:"NewsPage.Sync",mixins:[b],propTypes:{acceptNewStory:o.bool,listing:o.object,stories:o.arrayOf(o.object),draftStories:o.arrayOf(o.object),pendingStories:o.arrayOf(o.object),currentUser:o.object,project:o.object,database:o.instanceOf(h).isRequired,payloads:o.instanceOf(m).isRequired,route:o.instanceOf(f).isRequired,locale:o.instanceOf(g).isRequired,theme:o.instanceOf(v).isRequired},getAccessLevel:function(){var e=this.props,t=e.project,n=e.currentUser;return d.getUserAccessLevel(t,n)||"read-only"},render:function(){return s.createElement(y,{className:"news-page"},this.renderList(),this.renderEmptyMessage())},renderList:function(){if(!this.props.stories)return null;var e=this.getAccessLevel(),t=(this.props.route.parameters,{access:e,acceptNewStory:this.props.acceptNewStory&&"read-write"===e,stories:this.props.stories,draftStories:this.props.draftStories,pendingStories:this.props.pendingStories,currentUser:this.props.currentUser,project:this.props.project,database:this.props.database,payloads:this.props.payloads,route:this.props.route,locale:this.props.locale,theme:this.props.theme,onMissingStory:this.handleMissingStory});return s.createElement(j,t)},renderEmptyMessage:function(){var e=this.props.stories;if(!r.isEmpty(e))return null;if(e){var t,n=this.props.route.parameters;t=n.date?"news-no-stories-on-date":r.isEmpty(n.roles)?n.search?"news-no-stories-found":"news-no-stories-yet":"news-no-stories-by-role";var o={locale:this.props.locale,online:this.props.database.online,phrase:t};return s.createElement(x,o)}return s.createElement(w,null)},handleMissingStory:function(e){}})},"./pages/news-page.scss":function(e,t){},"./pages/notifications-page.jsx":function(e,t,n){"use strict";var r=n("../../common/node_modules/lodash/lodash.js"),s=n("../../common/node_modules/react/react.js"),o=s.PropTypes,i=n("../node_modules/relaks/index.js"),a=(n("../../common/node_modules/moment/moment.js"),n("../../common/src/utils/date-tracker.js"),n("../../common/src/objects/finders/user-finder.js")),c=n("../../common/src/objects/finders/notification-finder.js"),l=n("../../common/src/data/database.js"),u=n("../../common/src/routing/route.js"),d=n("../../common/src/locale/locale.js"),p=n("../../common/src/theme/theme.js"),h=n("./widgets/page-container.jsx"),m=n("./lists/notification-list.jsx"),f=n("./widgets/loading-animation.jsx"),g=n("./widgets/empty-message.jsx");n("./pages/notifications-page.scss"),e.exports=i.createClass({displayName:"NotificationsPage",propTypes:{database:o.instanceOf(l).isRequired,route:o.instanceOf(u).isRequired,locale:o.instanceOf(d).isRequired,theme:o.instanceOf(p).isRequired},statics:{parseURL:function(e,t){return u.match(e,["/:schema/notifications/:date/?","/:schema/notifications/?"],function(e){return{schema:e.schema,date:u.parseDate(e.date)}})},getURL:function(e){var t="/"+e.schema+"/notifications/";return void 0!=e.date&&(t+=(e.date||"date")+"/"),{path:t,query:void 0}},configureUI:function(e){var t=e.parameters,n={schema:t.schema};return{calendar:{route:n,statistics:{type:"daily-notifications",schema:t.schema,user_id:"current"}},navigation:{route:n,section:"notifications"}}}},renderAsync:function(e){var t=this.props.route.parameters,n=this.props.database.use({schema:t.schema,by:this}),r={currentUser:null,notifications:null,database:this.props.database,route:this.props.route,locale:this.props.locale,theme:this.props.theme};return e.show(s.createElement(v,r)),n.start().then(function(e){return a.findUser(n,e).then(function(e){r.currentUser=e})}).then(function(){return t.date?c.findNotificationsForUserOnDate(n,r.currentUser,t.date).then(function(e){r.notifications=e}):c.findNotificationsForUser(n,r.currentUser).then(function(e){r.notifications=e})}).then(function(){return s.createElement(v,r)})}});var v=e.exports.Sync=s.createClass({displayName:"NotificationsPage.Sync",propTypes:{notifications:o.arrayOf(o.object),currentUser:o.object,database:o.instanceOf(l).isRequired,route:o.instanceOf(u).isRequired,locale:o.instanceOf(d).isRequired,theme:o.instanceOf(p).isRequired},render:function(){return s.createElement(h,{className:"notifications-page"},this.renderList(),this.renderEmptyMessage())},renderList:function(){var e={notifications:this.props.notifications,currentUser:this.props.currentUser,database:this.props.database,route:this.props.route,locale:this.props.locale,theme:this.props.theme};return s.createElement(m,e)},renderEmptyMessage:function(){var e=this.props.notifications;if(!r.isEmpty(e))return null;if(e){var t,n=this.props.route.parameters;t=n.date?"notifications-no-notifications-on-date":"notifications-no-notifications-yet";var o={locale:this.props.locale,online:this.props.database.online,phrase:t};return s.createElement(g,o)}return s.createElement(f,null)}})},"./pages/notifications-page.scss":function(e,t){},"./pages/people-page.jsx":function(e,t,n){"use strict";var r=n("../../common/node_modules/lodash/lodash.js"),s=(n("../../common/node_modules/bluebird/js/browser/bluebird.js"),n("../../common/node_modules/react/react.js")),o=s.PropTypes,i=n("../node_modules/relaks/index.js"),a=n("../../common/node_modules/moment/moment.js"),c=n("../../common/src/utils/memoize.js"),l=(n("../../common/src/data/empty.js"),n("../../common/src/utils/date-tracker.js")),u=n("../../common/src/objects/finders/project-finder.js"),d=n("../../common/src/objects/settings/project-settings.js"),p=n("../../common/src/objects/finders/statistics-finder.js"),h=n("../../common/src/objects/finders/story-finder.js"),m=n("../../common/src/objects/finders/user-finder.js"),f=n("../../common/src/utils/tag-scanner.js"),g=n("../../common/src/data/database.js"),v=n("../../common/src/transport/payloads.js"),b=n("../../common/src/routing/route.js"),y=n("../../common/src/locale/locale.js"),j=n("../../common/src/theme/theme.js"),w=n("./widgets/page-container.jsx"),x=n("./lists/user-list.jsx"),k=n("./lists/story-list.jsx"),E=n("./widgets/loading-animation.jsx"),C=n("./widgets/empty-message.jsx");n("./pages/people-page.scss"),e.exports=i.createClass({displayName:"PeoplePage",propTypes:{database:o.instanceOf(g).isRequired,payloads:o.instanceOf(v).isRequired,route:o.instanceOf(b).isRequired,locale:o.instanceOf(y).isRequired,theme:o.instanceOf(j).isRequired},statics:{parseURL:function(e,t){return b.match(e,["/:schema/people/:user/?","/:schema/people/?"],function(e){return{schema:e.schema,search:t.search,user:b.parseId(e.user),date:b.parseDate(t.date),roles:b.parseIdList(t.roles)}})},getURL:function(e){var t="/"+e.schema+"/people/",n={};return e.user&&(t+=e.user+"/"),void 0!=e.date&&(n.date=e.date),void 0!=e.roles&&(n.roles=e.roles.join(" ")),void 0!=e.search&&(n.search=e.search),{path:t,query:n}},configureUI:function(e){var t=e.parameters,n={schema:t.schema,user:t.user},s={type:"daily-activities",schema:t.schema,user_id:t.user};return t.user?{calendar:{route:n,statistics:s},search:{route:n,statistics:s},navigation:{route:r.omit(n,"user"),section:"people"}}:{calendar:{route:n,statistics:s},filter:{route:n},search:{route:n,statistics:s},navigation:{route:n,section:"people"}}}},getInitialState:function(){return{today:l.today}},renderAsync:function(e){var t,n=this,o=this.props.route.parameters,i=this.props.database.use({schema:o.schema,by:this});o.search&&!f.removeTags(o.search)&&(t=f.findTags(o.search),r.isEmpty(t)&&(t=null));var a={project:null,members:null,stories:null,currentUser:null,selectedUser:null,visibleUsers:null,selectedDate:o.date,today:this.state.today,database:this.props.database,payloads:this.props.payloads,route:this.props.route,locale:this.props.locale,theme:this.props.theme},c=!e.revising();return e.show(s.createElement(_,a)),i.start().then(function(e){return m.findUser(i,e).then(function(e){a.currentUser=e})}).then(function(){return u.findCurrentProject(i).then(function(e){a.project=e})}).then(function(e){return m.findProjectMembers(i,a.project).then(function(e){if(a.members=e,o.user){var t=r.find(e,{id:o.user});if(t)return m.findUser(i,o.user).then(function(e){a.selectedUser=e,a.visibleUsers=[e]});a.selectedUser=t,a.visibleUsers=[t]}else o.search||o.date||(r.isEmpty(o.roles)?a.visibleUsers=e:a.visibleUsers=S(e,o.roles))})}).then(function(){"single-col"!==n.props.theme.mode&&e.show(s.createElement(_,a));var c="guest"===a.currentUser.type;return p.findDailyActivitiesOfUsers(i,a.project,a.members,c).then(function(e){if(a.dailyActivities=e,a.visibleUsers){if(a.selectedUser&&!r.some(a.members,{id:a.selectedUser}))return p.findDailyActivitiesOfUser(i,a.project,a.selectedUser,c).then(function(e){r.set(a.dailyActivities,a.selectedUser.id,e)})}else{var n;o.date?n=R(a.members,e,o.date):o.search&&t&&(n=N(a.members,e,t)),n&&(r.isEmpty(o.roles)?a.visibleUsers=n:a.visibleUsers=S(n,o.roles))}})}).then(function(){return e.show(s.createElement(_,a),"initial"),o.search?t?h.findStoriesWithTags(i,t,5).then(function(e){a.stories=e,a.selectedUser||(a.visibleUsers=O(a.members,e))}):h.findStoriesMatchingText(i,o.search,n.props.locale,5).then(function(e){a.stories=e,a.selectedUser||(a.visibleUsers=O(a.members,e))}):o.date?h.findStoriesOnDate(i,o.date,5).then(function(e){a.stories=e,a.selectedUser||(a.visibleUsers=O(a.members,e))}):h.findStoriesByUsersInListings(i,"news",a.visibleUsers,a.currentUser,5,c).then(function(e){a.stories=e})}).then(function(){if(e.show(s.createElement(_,a)),a.selectedUser)return o.search?t?h.findStoriesByUserWithTags(i,a.selectedUser,t).then(function(e){a.selectedUserStories=e}):h.findStoriesByUserMatchingText(i,a.selectedUser,o.search,n.props.locale).then(function(e){a.selectedUserStories=e}):o.date?h.findStoriesByUserOnDate(i,a.selectedUser,o.date).then(function(e){a.selectedUserStories=e}):h.findStoriesByUserInListing(i,"news",a.selectedUser,a.currentUser,c).then(function(e){a.selectedUserStories=e});var l=r.uniq(r.flatten(r.map(a.stories,"user_ids"))),u=r.map(a.members,"id"),d=r.difference(l,u),f="guest"===a.currentUser.type;return r.isEmpty(d)?void 0:m.findUsers(i,d).then(function(t){return a.visibleUsers=r.concat(a.visibleUsers,t),e.show(s.createElement(_,a)),p.findDailyActivitiesOfUsers(i,a.project,t,f).then(function(e){a.dailyActivities=r.assign({},a.dailyActivities,e)})})}).then(function(){if(!o.date){var e=k.parseHash(n.props.route.hash);if(e.story&&e.highlighting){var t=a.selectedUserStories;if(!r.find(t,{id:e.story}))return h.findStory(i,e.story).then(function(e){return n.redirectToStory(o.schema,e)}).catch(function(e){})}}}).then(function(){return s.createElement(_,a)})},redirectToStory:function(e,t){if(t.ptime&&t.published&&!1!==t.ready){if(a()-a(t.ptime)<6e4)return}var r=[n("./pages/people-page.jsx"),n("./lists/story-list.jsx")],s={schema:e,date:a(t.ptime).format("YYYY-MM-DD"),user:t.user_ids[0],story:t.id,highlighting:!0};return this.props.route.replace(r,s)},componentDidMount:function(){l.addEventListener("change",this.handleDateChange)},componentWillUnmount:function(){l.removeEventListener("change",this.handleDateChange)},handleDateChange:function(){this.setState({today:l.today})}});var _=e.exports.Sync=s.createClass({displayName:"PeoplePageSync",propTypes:{project:o.object,members:o.arrayOf(o.object),selectedUser:o.object,visibleUsers:o.arrayOf(o.object),dailyActivities:o.object,listings:o.arrayOf(o.object),stories:o.arrayOf(o.object),selectedUserStories:o.arrayOf(o.object),currentUser:o.object,selectedDate:o.string,today:o.string,database:o.instanceOf(g).isRequired,route:o.instanceOf(b).isRequired,locale:o.instanceOf(y).isRequired,theme:o.instanceOf(j).isRequired},getInitialState:function(){return{chartType:void 0}},getAccessLevel:function(){var e=this.props,t=e.project,n=e.currentUser;return d.getUserAccessLevel(t,n)||"read-only"},componentWillReceiveProps:function(e){this.props.selectedUser&&!e.selectedUser&&(this.previouslySelectedUser=this.props.selectedUser)},render:function(){return s.createElement(w,{className:"people-page"},this.renderUserList(),this.renderSelectedUserStoryList(),this.renderEmptyMessage())},renderUserList:function(){var e=(this.props.route.parameters,{users:this.props.visibleUsers,dailyActivities:this.props.dailyActivities,listings:this.props.listings,stories:this.props.stories,currentUser:this.props.currentUser,selectedDate:this.props.selectedDate,today:this.props.today,link:this.props.selectedUser?"team":"user",database:this.props.database,route:this.props.route,locale:this.props.locale,theme:this.props.theme});return s.createElement(x,e)},renderSelectedUserStoryList:function(){if(!this.props.selectedUser||!this.props.selectedUserStories)return null;var e=(this.props.route.parameters,{access:this.getAccessLevel(),stories:this.props.selectedUserStories,currentUser:this.props.currentUser,project:this.props.project,database:this.props.database,payloads:this.props.payloads,route:this.props.route,locale:this.props.locale,theme:this.props.theme});return s.createElement(k,e)},renderEmptyMessage:function(){var e;if(e=this.props.selectedUser?this.props.selectedUserStories:this.props.visibleUsers,!r.isEmpty(e))return null;if(e){var t,n=this.props.route.parameters;t=n.date?"people-no-stories-on-date":r.isEmpty(n.roles)?n.search?"people-no-stories-found":"people-no-users-yet":"people-no-users-by-role";var o={locale:this.props.locale,online:this.props.database.online,phrase:t};return s.createElement(C,o)}return s.createElement(E,null)}}),S=c(function(e,t){return r.filter(e,function(e){return r.some(e.role_ids,function(e){return r.includes(t,e)})})}),R=c(function(e,t,n){var s=r.filter(e,function(e){var r=t[e.id];if(r)return r.daily[n]});return r.isEmpty(s),s}),N=c(function(e,t,n){var s=r.filter(e,function(e){var s=t[e.id];if(s)return r.some(s.daily,function(e,t){return r.some(n,function(t){return!!e[t]})})});return r.isEmpty(s),s}),O=c(function(e,t){var n=r.filter(e,function(e){return r.some(t,function(t){return r.includes(t.user_ids,e.id)})});return r.isEmpty(n),n})},"./pages/people-page.scss":function(e,t){},"./pages/settings-page.jsx":function(e,t,n){"use strict";var r=n("../../common/node_modules/lodash/lodash.js"),s=n("../../common/node_modules/react/react.js"),o=s.PropTypes,i=n("../node_modules/relaks/index.js"),a=n("../../common/src/utils/konami-code.js"),c=n("../../common/src/objects/finders/device-finder.js"),l=n("../../common/src/objects/finders/project-finder.js"),u=n("../../common/src/objects/finders/repo-finder.js"),d=n("../../common/src/objects/finders/system-finder.js"),p=n("../../common/src/objects/finders/user-finder.js"),h=n("../../common/src/objects/utils/user-utils.js"),m=n("../../common/src/data/database.js"),f=n("../../common/src/transport/payloads.js"),g=n("../../common/src/routing/route.js"),v=n("../../common/src/locale/locale.js"),b=n("../../common/src/theme/theme.js"),y=n("./widgets/page-container.jsx"),j=n("./panels/development-panel.jsx"),w=n("./panels/project-panel.jsx"),x=n("./panels/device-panel.jsx"),k=n("./panels/user-info-panel.jsx"),E=n("./panels/user-image-panel.jsx"),C=n("./panels/notification-panel.jsx"),_=n("./panels/web-alert-panel.jsx"),S=n("./panels/mobile-alert-panel.jsx"),R=n("./panels/social-network-panel.jsx"),N=n("./panels/language-panel.jsx"),O=n("./panels/diagnostics-panel.jsx");n("./pages/settings-page.scss");e.exports=i.createClass({displayName:"SettingsPage",propTypes:{database:o.instanceOf(m).isRequired,payloads:o.instanceOf(f).isRequired,route:o.instanceOf(g).isRequired,locale:o.instanceOf(v).isRequired,theme:o.instanceOf(b).isRequired},statics:{parseURL:function(e,t){return g.match(e,["/global/settings/?","/:schema/settings/?"],function(e){return{schema:e.schema,diagnostics:!!t.diagnostics}})},getURL:function(e){var t="/"+(e.schema||"global")+"/settings/",n={};return e.diagnostics&&(n.diagnostics=1),{path:t,query:n}},configureUI:function(e){return{navigation:{route:{schema:e.parameters.schema},section:"settings"}}}},renderAsync:function(e){var t=this.props.route.parameters,n=this.props.database.use({schema:t.schema,by:this}),r={currentUser:null,currentProject:null,projectLinks:null,repos:null,devices:null,system:null,database:this.props.database,payloads:this.props.payloads,route:this.props.route,locale:this.props.locale,theme:this.props.theme};return e.show(s.createElement(P,r)),n.start().then(function(e){return p.findUser(n,e).then(function(e){r.currentUser=e})}).then(function(){return l.findProjectLinks(n).then(function(e){r.projectLinks=e})}).then(function(){return l.findCurrentProject(n).then(function(e){r.currentProject=e})}).then(function(){return e.show(s.createElement(P,r)),c.findUserDevices(n,r.currentUser,1).then(function(e){r.devices=e})}).then(function(){return e.show(s.createElement(P,r)),u.findProjectRepos(n,r.currentProject).then(function(e){r.repos=e})}).then(function(){return e.show(s.createElement(P,r)),d.findSystem(n).then(function(e){r.system=e})}).then(function(){return s.createElement(P,r)})}});var P=e.exports.Sync=s.createClass({displayName:"SettingsPage.Sync",propTypes:{currentUser:o.object,currentProject:o.object,projectLinks:o.arrayOf(o.object),repos:o.arrayOf(o.object),devices:o.arrayOf(o.object),system:o.object,database:o.instanceOf(m).isRequired,payloads:o.instanceOf(f).isRequired,route:o.instanceOf(g).isRequired,locale:o.instanceOf(v).isRequired,theme:o.instanceOf(b).isRequired},getInitialState:function(){return{user:null,original:null}},getUser:function(){return this.state.user||this.props.currentUser},componentWillReceiveProps:function(e){if(this.props.currentUser!==e.currentUser){var t={user:null};e.currentUser&&!e.currentUser.uncommitted&&(t.original=e.currentUser),this.setState({user:null})}},render:function(){return this.props.route.parameters.diagnostics?this.renderDiagnostics():this.renderSettings()},renderSettings:function(){return this.props.currentUser?s.createElement(y,{className:"settings-page"},s.createElement("div",{className:"panels"},this.renderDevelopmentPanel(),this.renderProjectPanel(),this.renderDevicePanel(),this.renderNotificationPanel(),this.renderWebAlertPanel(),this.renderMobileAlertPanel(),this.renderUserInfoPanel(),this.renderUserImagePanel(),this.renderSocialNetworkPanel(),this.renderLanguagePanel())):null},renderDiagnostics:function(){return s.createElement(y,{className:"settings-page"},s.createElement("div",{className:"panels diagnostics"},s.createElement(O,{type:"connectivity-monitor",title:"Network"}),s.createElement(O,{type:"websocket-notifier",title:"Web Socket"}),s.createElement(O,{type:"push-notifier",title:"Push Notification"}),s.createElement(O,{type:"subscription-manager",title:"Data Subscription"}),s.createElement(O,{type:"session-manager",title:"Sessions"}),s.createElement(O,{type:"link-manager",title:"Project Links"}),s.createElement(O,{type:"locale-manager",title:"Locale Manager"}),s.createElement(O,{type:"indexed-db-cache",title:"IndexedDB Cache"}),s.createElement(O,{type:"sqlite-cache",title:"SQLite Cache"}),s.createElement(O,{type:"remote-data-source",title:"Remote Data Source"}),s.createElement(O,{type:"payload-manager",title:"Payload Manager"}),s.createElement(O,{type:"code-push",title:"CodePush"})))},renderDevelopmentPanel:function(){var e=this.getUser();if(!r.get(e,"settings.development.show_panel"))return null;var t={currentUser:e,route:this.props.route,locale:this.props.locale,onChange:this.handleChange};return s.createElement(j,t)},renderProjectPanel:function(){var e={system:this.props.system,currentUser:this.getUser(),currentProject:this.props.currentProject,projectLinks:this.props.projectLinks,database:this.props.database,route:this.props.route,locale:this.props.locale,theme:this.props.theme,onChange:this.handleChange};return s.createElement(w,e)},renderDevicePanel:function(){if(r.isEmpty(this.props.devices))return null;var e={devices:this.props.devices,database:this.props.database,route:this.props.route,locale:this.props.locale,theme:this.props.theme};return s.createElement(x,e)},renderUserInfoPanel:function(){var e={currentUser:this.getUser(),locale:this.props.locale,onChange:this.handleChange};return s.createElement(k,e)},renderUserImagePanel:function(){var e={currentUser:this.getUser(),payloads:this.props.payloads,locale:this.props.locale,theme:this.props.theme,onChange:this.handleChange};return s.createElement(E,e)},renderSocialNetworkPanel:function(){var e={currentUser:this.getUser(),locale:this.props.locale,onChange:this.handleChange};return s.createElement(R,e)},renderNotificationPanel:function(){var e={currentUser:this.getUser(),repos:this.props.repos,locale:this.props.locale,onChange:this.handleChange};return s.createElement(C,e)},renderWebAlertPanel:function(){var e={currentUser:this.getUser(),repos:this.props.repos,locale:this.props.locale,onChange:this.handleChange};return s.createElement(_,e)},renderMobileAlertPanel:function(){if(r.isEmpty(this.props.devices))return null;var e={currentUser:this.getUser(),repos:this.props.repos,locale:this.props.locale,onChange:this.handleChange};return s.createElement(S,e)},renderLanguagePanel:function(){var e={locale:this.props.locale};return s.createElement(N,e)},componentDidMount:function(){a.addListener(this.handleKonamiCode)},componentWillUnmount:function(){a.removeListener(this.handleKonamiCode)},saveUser:function(e,t){var n=this,r=this.state.original,s={delay:t?void 0:2e3,onConflict:function(e){h.mergeRemoteChanges(e.local,e.remote,r)&&e.preventDefault()}};return this.props.database.use({schema:"global",by:this}).saveOne({table:"user"},e,s).then(function(e){return n.props.payloads.dispatch(e),e})},handleChange:function(e){var t=this,n=e.user;this.setState({user:n},function(){t.saveUser(n,e.immediate||!1)})},handleKonamiCode:function(e){var t=this,n=r.decoupleSet(this.getUser(),"settings.development.show_panel",!0);this.setState({user:n},function(){t.saveUser(n,!0)})}})},"./pages/settings-page.scss":function(e,t){},"./pages/start-page.jsx":function(e,t,n){"use strict";function r(e){switch(e){case"facebook":return"facebook-official";default:return e}}var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o=n("../../common/node_modules/lodash/lodash.js"),i=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),a=n("../../common/node_modules/react/react.js"),c=a.PropTypes,l=n("../node_modules/relaks/index.js"),u=(n("../../common/src/transport/http-request.js"),n("../../common/src/utils/memoize.js")),d=(n("../../common/src/routing/universal-link.js"),n("../../common/src/objects/finders/project-finder.js")),p=n("../../common/src/objects/finders/system-finder.js"),h=n("../../common/src/objects/finders/user-finder.js"),m=n("../../common/src/objects/utils/user-utils.js"),f=n("../../common/src/data/database.js"),g=n("../../common/src/routing/route.js"),v=n("../../common/src/locale/locale.js"),b=n("../../common/src/theme/theme.js"),y=n("./widgets/scrollable.jsx"),j=n("./widgets/push-button.jsx"),w=(n("./widgets/profile-image.jsx"),n("../../common/src/widgets/resource-view.jsx")),x=n("./dialogs/membership-request-dialog-box.jsx"),k=n("./widgets/loading-animation.jsx"),E=n("./widgets/empty-message.jsx"),C=n("../../common/src/mixins/update-check.js");n("./pages/start-page.scss");var _=e.exports=l.createClass({displayName:"StartPage",propTypes:{canAccessServer:c.bool,canAccessSchema:c.bool,database:c.instanceOf(f).isRequired,route:c.instanceOf(g).isRequired,locale:c.instanceOf(v).isRequired,theme:c.instanceOf(b).isRequired,onEntry:c.func,onExit:c.func,onAvailableSchemas:c.func},statics:{parseURL:function(e,t){return g.match(e,["/:extra?"],function(e){return o.trimEnd(e.extra,"/")?null:{add:!!t.add,activationCode:t.ac,schema:t.p}})},getURL:function(e){var t={};return e&&(e.add&&(t.add=1),e.activationCode&&(t.ac=e.activationCode),e.schema&&(t.p=e.schema)),{path:"/",query:t}},configureUI:function(e){return{navigation:{top:!1,bottom:!1}}}},renderAsync:function(e){var t=this,n=this.props.route.parameters,r=this.props.database.use({schema:"global",by:this}),s={currentUser:null,system:this.sessionStartSystem||null,servers:null,projects:null,projectLinks:null,canAccessServer:this.props.canAccessServer,canAccessSchema:this.props.canAccessSchema,database:this.props.database,route:this.props.route,locale:this.props.locale,theme:this.props.theme,onEntry:this.props.onEntry,onExit:this.props.onExit,onAvailableSchemas:this.props.onAvailableSchemas};return this.props.canAccessServer?(n.add||e.delay(void 0,300),e.show(a.createElement(S,s)),r.start().then(function(e){return h.findUser(r,e).then(function(e){s.currentUser=e})}).then(function(){return e.show(a.createElement(S,s)),p.findSystem(r).then(function(e){s.system=e})}).then(function(){return e.show(a.createElement(S,s)),d.findActiveProjects(r,1).then(function(e){s.projects=e})}).then(function(){return e.show(a.createElement(S,s)),d.findProjectLinks(r).then(function(e){s.projectLinks=e})}).then(function(){return a.createElement(S,s)})):(e.show(a.createElement(S,s)),r.beginSession("client").then(function(e){return t.sessionStartSystem=e.system,s.system=e.system,s.servers=e.servers,a.createElement(S,s)}))}}),S=e.exports.Sync=a.createClass({displayName:"StartPage.Sync",mixins:[C],propTypes:{currentUser:c.object,system:c.object,servers:c.arrayOf(c.object),projects:c.arrayOf(c.object),projectLinks:c.arrayOf(c.object),canAccessServer:c.bool,canAccessSchema:c.bool,serverError:c.instanceOf(Error),database:c.instanceOf(f).isRequired,route:c.instanceOf(g).isRequired,locale:c.instanceOf(v).isRequired,theme:c.instanceOf(b).isRequired,onEntry:c.func,onExit:c.func,onAvailableSchemas:c.func},getInitialState:function(){return{transition:null,selectedProjectId:0,oauthErrors:{},renderingProjectDialog:!1,showingProjectDialog:!1}},getTargetPage:function(){return n(this.props.route.parameters.add?"./pages/settings-page.jsx":"./pages/news-page.jsx")},componentWillReceiveProps:function(e){if(this.props.route!==e.route||this.props.canAccessServer!==e.canAccessServer||this.props.canAccessSchema!==e.canAccessSchema){e.route.component!==_&&(this.state.transition||e.canAccessSchema&&e.canAccessServer&&this.transitionOut(e.route))}this.props.projects!==e.projects&&this.state.renderingProjectDialog&&(o.some(e.projects,{id:this.state.selectedProjectId})||this.setState({renderingProjectDialog:!1,showingProjectDialog:!1,selectedProjectId:0})),this.state.receivedCorrectQRCode&&e.serverError&&this.setState({receivedCorrectQRCode:!1,receivedInvalidQRCode:!1}),this.state.addingServer&&this.props.route!==e.route&&this.setState({addingServer:!1})},render:function(){return this.renderForBrowser()},renderForBrowser:function(){var e,t=this.props.locale.translate;if(this.props.system){var n=o.get(this.props.system,"details.resources"),r=o.find(n,{type:"image"});if(r){e={backgroundImage:"url("+this.props.theme.getImageURL(r,{width:1024,quality:40})+")"}}}var s="start-page browser";return this.state.transition&&(s+=" "+this.state.transition),a.createElement("div",{className:s,style:e},a.createElement("div",{className:"bar"},a.createElement("h1",{className:"welcome"},t("start-welcome")),a.createElement("div",{className:"content-area"},this.renderDescription(),this.renderChoices())),this.renderProjectDialog())},renderForCordova:function(){return},renderDescription:function(){var e=this.props.locale.translate,t=this.props.locale.pick,n=this.props.system;if(!n)return null;var r=t(o.get(n,"details.title"))||e("start-system-title-default"),s=t(o.get(n,"details.description"));return a.createElement("div",{className:"section description"},a.createElement("h2",null,r),a.createElement(y,null,a.createElement("p",null,s)))},renderTitle:function(){return},renderMobileGreeting:function(){return},renderActivationControls:function(){return a.createElement("div",null,this.renderActivationInstructions(),this.renderActivationButtons(),this.renderQRScannerDialogBox(),this.renderActivationDialogBox())},renderActivationInstructions:function(){return},renderActivationButtons:function(){return},renderActivationSelector:function(){return},renderChoices:function(){return this.props.canAccessServer?this.renderProjectButtons():this.renderOAuthButtons()},renderEmptyMessage:function(){if(this.props.canAccessServer){var e=this.props.projects;if(!o.isEmpty(e))return null;if(e){var t={locale:this.props.locale,online:this.props.database.online,phrase:"start-no-projects"};return a.createElement(E,t)}return a.createElement(k,null)}var n=this.props.servers;if(!o.isEmpty(n))return null;if(n){var t={locale:this.props.locale,online:this.props.database.online,phrase:"start-no-servers"};return a.createElement(E,t)}},renderOAuthButtons:function(){var e=this.props.locale.translate,t=N(this.props.servers,this.props.locale);return t?a.createElement("div",{className:"section buttons"},a.createElement("h2",null,e("start-social-login")),a.createElement(y,null,this.renderEmptyMessage(),a.createElement("p",null,o.map(t,this.renderOAuthButton)))):null},renderOAuthButton:function(e,t){var n=this.props.locale.translate,o=this.props.locale.pick,i=o(e.details.title)||n("server-type-"+e.type),c=r(e.type),l=this.props.database.getOAuthURL(e),u={className:"oauth-button",href:l,onClick:this.handleOAuthButtonClick,"data-type":e.type},d=this.state.oauthErrors[e.type];if(d){var n=this.props.locale.translate,p=n("start-error-"+d.reason);return u.className+=" error",a.createElement("a",s({key:t},u),a.createElement("span",{className:"icon"},a.createElement("i",{className:"fa fa-fw fa-"+c})),a.createElement("span",{className:"error"},p))}return a.createElement("a",s({key:t},u),a.createElement("span",{className:"icon"},a.createElement("i",{className:"fa fa-fw fa-"+c})),a.createElement("span",{className:"label"},i))},renderProjectButtons:function(){var e=this.props.locale.translate,t=R(this.props.projects,this.props.locale);return a.createElement("div",{className:"section buttons"},a.createElement("h2",null,t?e("start-projects"):""),a.createElement(y,null,this.renderEmptyMessage(),o.map(t,this.renderProjectButton)))},renderProjectButton:function(e,t){var r,i=(this.props.locale.translate,this.props.locale.pick),c=i(e.details.title)||e.name,l=i(e.details.description),u=o.get(e,"details.resources"),d=o.find(u,{type:"image"});if(d)r=a.createElement(w,{resource:d,width:56,height:56,theme:this.props.theme});else{var p=n("../assets/trambar-logo.svg"),h=e.id%5+1;r=a.createElement("div",{className:"default v"+h},a.createElement(p,null))}var f;m.isMember(this.props.currentUser,e)?f=a.createElement("i",{className:"fa fa-user-circle-o badge"}):m.isPendingMember(this.props.currentUser,e)&&(f=a.createElement("i",{className:"fa fa-clock-o badge"}));var g={"data-project-id":e.id,className:"project-button"},v=!1,b=this.props.route.parameters;return b.add||(v=o.some(this.props.projectLinks,{address:b.address,schema:e.name})),v?g.href=this.props.route.find(this.getTargetPage(),{schema:e.name}):g.onClick=this.handleProjectButtonClick,a.createElement("a",s({key:e.id},g),a.createElement("div",{className:"icon"},r),a.createElement("div",{className:"text"},f,a.createElement("div",{className:"title"},c),a.createElement("div",{className:"description"},a.createElement("div",{className:"contents"},l,a.createElement("div",{className:"ellipsis"},a.createElement("i",{className:"fa fa-ellipsis-h"}))))))},renderAvailableServers:function(){var e=this.props.locale.translate,t=o.uniq(o.map(this.props.projectLinks,"address")).sort();if(o.isEmpty(t))return null;var n={label:e("start-activation-return"),hidden:!this.props.canAccessServer,onClick:this.handleReturnClick};return a.createElement("div",{className:"other-servers"},a.createElement("h2",{className:"title"},e("start-activation-others-servers")),a.createElement("ul",null,o.map(t,this.renderServerLink)),a.createElement("div",{className:"activation-buttons"},a.createElement("div",{className:"right"},a.createElement(j,n))))},renderServerLink:function(e,t){var r=this.props.route,s={address:e,add:r.parameters.add},o=r.find(n("./pages/start-page.jsx"),s);return a.createElement("li",{key:t},a.createElement("a",{href:o},a.createElement("i",{className:"fa fa-home"})," ",e))},renderProjectDialog:function(){if(!this.state.renderingProjectDialog)return null;var e=o.find(this.props.projects,{id:this.state.selectedProjectId});if(!e)return null;var t=this.props.currentUser,n={show:this.state.showingProjectDialog,currentUser:t,project:e,database:this.props.database,route:this.props.route,locale:this.props.locale,theme:this.props.theme,onConfirm:this.handleMembershipRequestConfirm,onRevoke:this.handleMembershipRequestRevoke,onClose:this.handleMembershipRequestClose,onProceed:this.handleMembershipRequestProceed};return a.createElement(x,n)},componentDidUpdate:function(e,t){var n=this;if(e.projects!==this.props.projects||e.currentUser!==this.props.currentUser){var r=o.filter(this.props.projects,function(e){return m.canViewProject(n.props.currentUser,e)});o.isEmpty(r)||this.props.onAvailableSchemas&&this.props.onAvailableSchemas({type:"availableschemas",target:this,schemas:o.map(r,"name")})}},componentDidMount:function(){this.props.onEntry&&this.props.onEntry({type:"entry",target:this})},transitionOut:function(e){var t=this,n="fast",r=1300,s=e.parameters;!o.some(this.props.projectLinks,{address:s.address,schema:s.schema})&&(n="slow",r=3700),this.setState({transition:"transition-out-"+n},function(){setTimeout(function(){t.props.onExit&&t.props.onExit({type:"exit",target:t})},r)})},openPopUpWindow:function(e){return new i(function(t,n){var r={width:800,height:600,left:window.screenLeft+Math.round((window.outerWidth-800)/2),top:window.screenTop+Math.round((window.outerHeight-600)/2),toolbar:"no",menubar:"no",status:"no"},s=o.map(r,function(e,t){return t+"="+e}),i=window.open(e,"login",s.join(","));if(i){i.location=e;var a=setInterval(function(){i.closed&&(clearInterval(a),t())},50)}else n(new Error("Unable to open popup"))})},handleOAuthButtonClick:function(e){var t=this,n=e.currentTarget.getAttribute("href"),r=e.currentTarget.getAttribute("data-type");return e.preventDefault(),this.openPopUpWindow(n).then(function(){return t.props.database.use({by:t}).checkSession().catch(function(e){var n=o.clone(t.state.oauthErrors);n[r]=e,t.setState({oauthErrors:n})})})},handleProjectButtonClick:function(e){var t=parseInt(e.currentTarget.getAttribute("data-project-id"));this.setState({selectedProjectId:t,showingProjectDialog:!0,renderingProjectDialog:!0})},handleMembershipRequestConfirm:function(e){var t=this.state.selectedProjectId,n=(o.find(this.props.projects,{id:t}),this.props.database.use({schema:"global",by:this})),r=o.clone(this.props.currentUser);return r.requested_project_ids=o.union(r.requested_project_ids,[t]),n.saveOne({table:"user"},r)},handleMembershipRequestRevoke:function(e){var t=this.state.selectedProjectId,n=(o.find(this.props.projects,{id:t}),this.props.database.use({schema:"global",by:this})),r=o.clone(this.props.currentUser);return r.requested_project_ids=o.difference(r.requested_project_ids,[t]),n.saveOne({table:"user"},r)},handleMembershipRequestClose:function(e){var t=this;this.setState({showingProjectDialog:!1}),setTimeout(function(){t.setState({renderingProjectDialog:!1})},500)},handleMembershipRequestProceed:function(e){this.setState({showingProjectDialog:!1,renderingProjectDialog:!1});var t=this.state.selectedProjectId,n=o.find(this.props.projects,{id:t});this.props.route.push(this.getTargetPage(),{schema:n.name})},renderQRScannerDialogBox:function(){return},renderActivationDialogBox:function(){return},handleScanClick:function(e){},handleManualClick:function(e){this.setState({enteringManually:!0})},handleAddClick:function(e){this.setState({addingServer:!0})},handleReturnClick:function(e){this.setState({addingServer:!1})},handleCancelScan:function(e){},handleScanResult:function(e){return},handleActivationCancel:function(e){this.setState({enteringManually:!1})},handleActivationConfirm:function(e){this.handleActivationCancel();var t={cors:!0,address:e.address,schema:e.schema,activationCode:e.code};this.props.route.push(_,t)}}),R=u(function(e,t){var n=t.pick;return o.sortBy(e,function(e){return n(e.details.title)||e.name})}),N=u(function(e,t){var n=t.pick;return o.sortBy(e,function(e){return n(e.details.title)||e.name})})},"./pages/start-page.scss":function(e,t){},"./panels/development-panel.jsx":function(e,t,n){"use strict";var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s=n("../../common/node_modules/lodash/lodash.js"),o=(n("../../common/node_modules/bluebird/js/browser/bluebird.js"),n("../../common/node_modules/react/react.js")),i=o.PropTypes,a=n("../../common/src/routing/route.js"),c=n("../../common/src/locale/locale.js"),l=n("../../common/src/mixins/update-check.js"),u=n("./widgets/settings-panel.jsx"),d=n("./widgets/push-button.jsx"),p=n("./widgets/option-button.jsx");n("./panels/development-panel.scss"),e.exports=o.createClass({displayName:"DevelopmentPanel",mixins:[l],propTypes:{currentUser:i.object,route:i.instanceOf(a).isRequired,locale:i.instanceOf(c).isRequired,onChange:i.func},getInitialState:function(){return{selectedDeploymentName:null}},setUserProperty:function(e,t){if(this.props.currentUser){var n=s.decoupleSet(this.props.currentUser,e,t);this.props.onChange&&this.props.onChange({type:"change",target:this,user:n})}},componentWillMount:function(){},render:function(){var e=this.props.locale.translate;return o.createElement(u,{className:"diagnostics"},o.createElement("header",null,o.createElement("div",{className:"icon"},o.createElement("i",{className:"fa fa-bug"}),o.createElement("i",{className:"fa fa-search icon-overlay"}))," ",e("settings-development")),o.createElement("body",null,this.renderDevelopmentOptions(),this.renderDeploymentOptions()),o.createElement("footer",null,this.renderButtons()))},renderDeploymentOptions:function(){return null},renderDevelopmentOptions:function(){var e=["show-panel"];return s.map(e,this.renderDevelopmentOption)},renderDevelopmentOption:function(e,t){var n=this.props.locale.translate,i=s.snakeCase(e),a=s.get(this.props.currentUser,"settings",{}),c=!!s.get(a,"development."+i),l={label:n("development-"+e),selected:c,onClick:this.handleDevelopmentOptionClick,id:i};return o.createElement(p,r({key:t},l))},renderDeploymentOption:function(e,t){return null},renderButtons:function(){var e=this.props.locale.translate,t={label:e("development-show-diagnostics"),onClick:this.handleShowClick};return o.createElement("div",{className:"buttons"},o.createElement(d,t))},handleDevelopmentOptionClick:function(e){var t=e.currentTarget.id,n="development."+t,r=s.clone(s.get(this.props.currentUser,"settings",{}));!s.get(r,n)?s.set(r,n,!0):s.unset(r,n),this.setUserProperty("settings",r)},handleDeploymentOptionClick:function(e){return null},handleShowClick:function(e){var t=this.props.route,r={schema:t.parameters.schema,diagnostics:!0};t.push(n("./pages/settings-page.jsx"),r)}})},"./panels/development-panel.scss":function(e,t){},"./panels/device-panel.jsx":function(e,t,n){"use strict";function r(e){var t;switch(e.type){case"ios":case"osx":t="apple";break;default:t=e.type}return i.createElement("div",{className:"device-icon"},i.createElement("i",{className:"fa fa-tablet background"}),i.createElement("i",{className:"fa fa-"+t+" icon-overlay"}))}function s(e){var t=e.details.manufacturer,n=e.details.display_name||e.details.name;return o.includes(o.toLower(n),o.toLower(t))||(n=t+" "+n),n}var o=n("../../common/node_modules/lodash/lodash.js"),i=(n("../../common/node_modules/bluebird/js/browser/bluebird.js"),n("../../common/node_modules/react/react.js")),a=i.PropTypes,c=n("../../common/src/data/database.js"),l=n("../../common/src/routing/route.js"),u=n("../../common/src/locale/locale.js"),d=n("../../common/src/theme/theme.js"),p=n("../../common/src/mixins/update-check.js"),h=n("./widgets/settings-panel.jsx"),m=(n("./widgets/push-button.jsx"),n("./dialogs/confirmation-dialog-box.jsx"));n("./panels/device-panel.scss"),e.exports=i.createClass({displayName:"DevicePanel",mixins:[p],propTypes:{devices:a.arrayOf(a.object),database:a.instanceOf(c).isRequired,route:a.instanceOf(l).isRequired,locale:a.instanceOf(u).isRequired,theme:a.instanceOf(d).isRequired},getInitialState:function(){return{renderingDialog:null,showingDialog:!1,selectedDeviceId:null}},render:function(){var e,t=this.props.locale.translate;return e=t(1===o.size(this.props.devices)?"settings-device":"settings-devices"),i.createElement(h,{className:"device"},i.createElement("header",null,i.createElement("i",{className:"fa fa-tablet"})," ",e),i.createElement("body",null,this.renderDevices(),this.renderDialogBox()))},renderDevices:function(){return o.map(this.props.devices,this.renderDevice)},renderDevice:function(e){var t=this.props.locale.translate,n=s(e);return i.createElement("div",{key:e.id,className:"device-option-button selected"},i.createElement("div",{className:"icon"},i.createElement(r,{type:e.type})),i.createElement("div",{className:"text"},i.createElement("span",{className:"name"},n),i.createElement("div",{"data-device-id":e.id,className:"revoke",onClick:this.handleRevokeClick},i.createElement("i",{className:"fa fa-ban"})," ",i.createElement("span",null,t("mobile-device-revoke")))))},renderDialogBox:function(){if("revoke"!==this.state.renderingDialog)return null;var e=this.props.locale.translate,t={show:this.state.showingDialog,locale:this.props.locale,onClose:this.handleDialogClose,onConfirm:this.handleRevokeConfirm};return i.createElement(m,t,e("mobile-device-revoke-are-you-sure"))},handleRevokeClick:function(e){var t=parseInt(e.currentTarget.getAttribute("data-device-id"));this.setState({renderingDialog:"revoke",showingDialog:!0,selectedDeviceId:t})},handleRevokeConfirm:function(e){var t=this,n=o.find(this.props.devices,{id:this.state.selectedDeviceId}),r=this.props.database.use({schema:"global",by:this});r.removeOne({table:"device"},n).then(function(){return r.endMobileSession(n.session_handle)}).finally(function(){t.handleDialogClose()})},handleDialogClose:function(e){var t=this;this.setState({showingDialog:!1},function(){setTimeout(function(){t.setState({renderingDialog:!1})},500)})}})},"./panels/device-panel.scss":function(e,t){},"./panels/diagnostics-panel.jsx":function(e,t,n){"use strict";var r=(n("../../common/node_modules/lodash/lodash.js"),n("../../common/node_modules/bluebird/js/browser/bluebird.js"),n("../../common/node_modules/react/react.js")),s=r.PropTypes,o=n("./widgets/settings-panel.jsx"),i=n("../../common/src/widgets/diagnostics.jsx");n("./panels/diagnostics-panel.scss"),e.exports=r.createClass({displayName:"DiagnosticsPanel",propTypes:{type:s.string.isRequired,title:s.string.isRequired},getInitialState:function(){return{contents:i.get(this.props.type)}},render:function(){if(!this.state.contents)return null;var e="diagnostics "+this.props.type;return r.createElement(o,{className:e},r.createElement("header",null,r.createElement("i",{className:"fa fa-gear"})," ",this.props.title),r.createElement("body",null,this.state.contents))},componentDidMount:function(){i.addListener(this.handleChange)},componentWillUnmount:function(){i.removeListener(this.handleChange)},handleChange:function(){var e=i.get(this.props.type);this.state.contents!==e&&this.setState({contents:e})}})},"./panels/diagnostics-panel.scss":function(e,t){},"./panels/language-panel.jsx":function(e,t,n){"use strict";var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s=n("../../common/node_modules/lodash/lodash.js"),o=(n("../../common/node_modules/bluebird/js/browser/bluebird.js"),n("../../common/node_modules/react/react.js")),i=o.PropTypes,a=(n("../node_modules/relaks/index.js"),n("../../common/src/locale/locale.js")),c=n("../../common/src/mixins/update-check.js"),l=n("./widgets/settings-panel.jsx"),u=n("./widgets/option-button.jsx");n("./panels/language-panel.scss"),e.exports=o.createClass({displayName:"LanguagePanel",mixins:[c],propTypes:{locale:i.instanceOf(a).isRequired},render:function(){var e=this.props.locale.translate;return o.createElement(l,{className:"language"},o.createElement("header",null,o.createElement("i",{className:"fa fa-language"})," ",e("settings-language")),o.createElement("body",null,this.renderList()))},renderList:function(){var e=s.filter(this.props.locale.directory,function(e){return!!e.module});return s.map(e,this.renderButton)},renderButton:function(e){var t=this.renderCountrySelect(e),n={label:o.createElement("span",null,e.name,t),selected:e.code===this.props.locale.languageCode,onClick:this.handleLanguageClick,id:e.code};return o.createElement(u,r({key:e.code},n))},renderCountrySelect:function(e){var t=this.props.locale.languageCode,n=this.props.locale.countryCode;n||(n=e.defaultCountry);var i=s.map(e.countries,function(e,t){return o.createElement("option",{key:t,value:t},e)}),a={value:n,onChange:this.handleCountryChange};return(e.code!==t||s.size(e.countries)<=1)&&(a.className="sole"),o.createElement("select",r({key:1},a),i)},handleLanguageClick:function(e){var t=e.currentTarget.id;if(t!==this.props.locale.languageCode){var n=s.find(this.props.locale.directory,{code:t}),r=n.code+"-"+n.defaultCountry;this.props.locale.change(r)}},handleCountryChange:function(e){var t=e.currentTarget.value;if(t!==this.props.locale.countryCode){var n=this.props.locale.languageCode,r=n+"-"+t;this.props.locale.change(r)}}})},"./panels/language-panel.scss":function(e,t){},"./panels/mobile-alert-panel.jsx":function(e,t,n){"use strict";var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s=n("../../common/node_modules/lodash/lodash.js"),o=(n("../../common/node_modules/bluebird/js/browser/bluebird.js"),n("../../common/node_modules/react/react.js")),i=o.PropTypes,a=n("../../common/src/objects/types/notification-types.js"),c=n("../../common/src/objects/utils/user-utils.js"),l=n("../../common/src/locale/locale.js"),u=n("../../common/src/mixins/update-check.js"),d=n("./widgets/settings-panel.jsx"),p=n("./widgets/option-button.jsx");n("./panels/mobile-alert-panel.scss"),e.exports=o.createClass({displayName:"WebAlertPanel",mixins:[u],propTypes:{currentUser:i.object,locale:i.instanceOf(l).isRequired,onChange:i.func},setUserProperty:function(e,t){if(this.props.currentUser){var n=s.decoupleSet(this.props.currentUser,e,t);this.props.onChange&&this.props.onChange({type:"change",target:this,user:n})}},render:function(){var e=this.props.locale.translate;return o.createElement(d,{className:"mobile-alert"},o.createElement("header",null,o.createElement("div",{className:"icon"},o.createElement("i",{className:"fa fa-tablet"}),o.createElement("i",{className:"fa fa-exclamation-circle icon-overlay"}))," ",e("settings-mobile-alert")),o.createElement("body",null,this.renderOptions()))},renderOptions:function(){var e=a;return"admin"!==s.get(this.props.currentUser,"type")&&(e=s.without(e,a.admin)),e=s.concat(e,"web-session"),s.map(e,this.renderOption)},renderOption:function(e,t){var n=this.props.locale.translate,i=s.snakeCase(e),a=s.get(this.props.currentUser,"settings",{}),l=!!s.get(a,"notification."+i),u=!!s.get(a,"mobile_alert."+i),d=c.canReceiveNotification(this.props.currentUser,this.props.repos,e),h={label:n("notification-option-"+e),selected:u&&(l||"web-session"===e),hidden:!d,disabled:!(l||"web-session"===e),onClick:this.handleOptionClick,id:i};return o.createElement(p,r({key:t},h))},handleOptionClick:function(e){var t=e.currentTarget.id,n="mobile_alert."+t,r=s.clone(s.get(this.props.currentUser,"settings",{}));!s.get(r,n)?s.set(r,n,!0):s.unset(r,n),this.setUserProperty("settings",r)}})},"./panels/mobile-alert-panel.scss":function(e,t){},"./panels/notification-panel.jsx":function(e,t,n){"use strict";var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s=n("../../common/node_modules/lodash/lodash.js"),o=(n("../../common/node_modules/bluebird/js/browser/bluebird.js"),n("../../common/node_modules/react/react.js")),i=o.PropTypes,a=n("../../common/src/objects/types/notification-types.js"),c=n("../../common/src/objects/utils/user-utils.js"),l=n("../../common/src/locale/locale.js"),u=n("../../common/src/mixins/update-check.js"),d=n("./widgets/settings-panel.jsx"),p=n("./widgets/option-button.jsx");n("./panels/notification-panel.scss"),e.exports=o.createClass({displayName:"NotificationPanel",mixins:[u],propTypes:{currentUser:i.object,repos:i.arrayOf(i.object),locale:i.instanceOf(l).isRequired,onChange:i.func},setUserProperty:function(e,t){if(this.props.currentUser){var n=s.decoupleSet(this.props.currentUser,e,t);this.props.onChange&&this.props.onChange({type:"change",target:this,user:n})}},render:function(){var e=this.props.locale.translate;return o.createElement(d,{className:"notification"},o.createElement("header",null,o.createElement("i",{className:"fa fa-exclamation-circle"})," ",e("settings-notification")),o.createElement("body",null,this.renderOptions()))},renderOptions:function(){var e=a;return"admin"!==s.get(this.props.currentUser,"type")&&(e=s.without(e,a.admin)),s.map(e,this.renderOption)},renderOption:function(e,t){var n=this.props.locale.translate,i=s.snakeCase(e),a=s.get(this.props.currentUser,"settings",{}),l=!!s.get(a,"notification."+i),u=c.canReceiveNotification(this.props.currentUser,this.props.repos,e),d={label:n("notification-option-"+e),selected:l,hidden:!u,onClick:this.handleOptionClick,id:i};return o.createElement(p,r({key:t},d))},handleOptionClick:function(e){var t=e.currentTarget.id,n=["notification."+t,"web_alert."+t,"mobile_alert."+t],r=s.clone(s.get(this.props.currentUser,"settings",{})),o=!!s.get(r,n[0]);s.each(n,function(e,n){o?s.unset(r,e):0===n&&"merge"===t?s.set(r,e,"master"):s.set(r,e,!0)}),this.setUserProperty("settings",r)}})},"./panels/notification-panel.scss":function(e,t){},"./panels/project-panel.jsx":function(e,t,n){"use strict";function r(e){return e.hidden?null:o.createElement("div",{className:"item"},o.createElement("span",{className:"button",onClick:e.onClick},o.createElement("i",{className:"fa fa-fw fa-"+e.icon}),o.createElement("span",{className:"label"},e.label)))}var s=n("../../common/node_modules/lodash/lodash.js"),o=(n("../../common/node_modules/bluebird/js/browser/bluebird.js"),n("../../common/node_modules/react/react.js")),i=o.PropTypes,a=n("../../common/src/objects/utils/user-utils.js"),c=n("../../common/src/data/database.js"),l=n("../../common/src/routing/route.js"),u=n("../../common/src/locale/locale.js"),d=n("../../common/src/theme/theme.js"),p=n("../../common/src/mixins/update-check.js"),h=n("./widgets/settings-panel.jsx"),m=n("./widgets/push-button.jsx"),f=n("./dialogs/system-description-dialog-box.jsx"),g=n("./dialogs/project-description-dialog-box.jsx"),v=n("./dialogs/mobile-setup-dialog-box.jsx"),b=n("./dialogs/confirmation-dialog-box.jsx"),y=n("./dialogs/project-management-dialog-box.jsx");n("./panels/project-panel.scss"),e.exports=o.createClass({displayName:"ProjectPanel",mixins:[p],propTypes:{system:i.object,currentUser:i.object,currentProject:i.object,projectLinks:i.arrayOf(i.object),database:i.instanceOf(c).isRequired,route:i.instanceOf(l).isRequired,locale:i.instanceOf(u).isRequired,theme:i.instanceOf(d).isRequired,onChange:i.func},getInitialState:function(){return{renderingDialog:null,showingDialog:!1}},componentWillReceiveProps:function(e){var t=this.props.currentProject,n=e.currentProject,r=this.props.currentUser;if(t!==n&&t&&n&&t.id===n.id){var s=a.isMember(r,t),o=a.isMember(r,n);!s&&o&&(this.state.renderingDialog||this.setState({renderingDialog:"membership",showingDialog:!0}))}},render:function(){var e=this.props.locale.translate;return o.createElement(h,{className:"project"},o.createElement("header",null,o.createElement("i",{className:"fa fa-database"})," ",e("settings-projects")),o.createElement("body",null,this.renderProjects(),this.renderDialogBox()),o.createElement("footer",null,this.renderButtons()))},renderProjects:function(){return s.map(this.props.projectLinks,this.renderProject)},renderProject:function(e,t){var n=this.props.locale.translate,i=this.props.locale.pick,a=this.props.route.parameters;if(e.schema===a.schema&&e.address==a.address){var c=!0,l=!1,u=this.props.currentProject,d=this.props.currentUser;u&&d&&(s.includes(u.user_ids,d.id)||(c=!1,s.includes(d.requested_project_ids,u.id)&&(l=!0)));var p={icon:"home",label:e.address,onClick:this.handleSystemDescriptionClick},h={icon:"info-circle",label:n("project-management-description"),onClick:this.handleProjectDescriptionClick},m={icon:"qrcode",label:n("project-management-mobile-set-up"),hidden:!1,onClick:this.handleMobileSetupClick},f={icon:l?"clock-o":"user-circle-o",label:n("project-management-"+(l?"withdraw-request":"join-project")),hidden:c,onClick:l?this.handleCancelJoinClick:this.handleJoinClick},g={icon:"sign-out",label:n("project-management-sign-out"),onClick:this.handleSignOutClick};return o.createElement("div",{key:t,className:"project-option-button selected"},o.createElement("i",{className:"icon fa fa-check-circle"}),o.createElement("div",{className:"text"},o.createElement("span",{className:"name"},i(e.name)),o.createElement("div",{className:"supplemental"},o.createElement(r,p),o.createElement(r,h),o.createElement(r,m),o.createElement(r,f),o.createElement(r,g))))}return o.createElement("div",{key:t,"data-key":e.key,className:"project-option-button",onClick:this.handleProjectClick},o.createElement("i",{className:"icon fa fa-circle-o"}),o.createElement("div",{className:"text"},o.createElement("span",{className:"name"},i(e.name))))},renderButtons:function(){var e=this.props.locale.translate,t={label:e("project-management-add"),onClick:this.handleAddClick},n={label:e("project-management-manage"),onClick:this.handleManageClick};return o.createElement("div",{className:"buttons"},o.createElement(m,n),o.createElement(m,t))},renderDialogBox:function(){return this.props.currentProject?o.createElement("div",null,this.renderSystemDescriptionDialogBox(),this.renderProjectDescriptionDialogBox(),this.renderMobileSetupDialogBox(),this.renderSignOutDialogBox(),this.renderProjectManagementDialogBox(),this.renderMembershipDialogBox()):null},renderSystemDescriptionDialogBox:function(){if("system-description"!==this.state.renderingDialog)return null;var e={show:this.state.showingDialog,system:this.props.system,locale:this.props.locale,theme:this.props.theme,onClose:this.handleDialogClose};return o.createElement(f,e)},renderProjectDescriptionDialogBox:function(){if("project-description"!==this.state.renderingDialog)return null;var e={show:this.state.showingDialog,project:this.props.currentProject,locale:this.props.locale,theme:this.props.theme,onClose:this.handleDialogClose};return o.createElement(g,e)},renderMobileSetupDialogBox:function(){if("mobile-setup"!==this.state.renderingDialog)return null;var e={show:this.state.showingDialog,system:this.props.system,database:this.props.database,route:this.props.route,locale:this.props.locale,onClose:this.handleDialogClose};return o.createElement(v,e)},renderSignOutDialogBox:function(){if("sign-out"!==this.state.renderingDialog)return null;var e=this.props.locale.translate,t={show:this.state.showingDialog,locale:this.props.locale,onClose:this.handleDialogClose,onConfirm:this.handleSignOutConfirm};return o.createElement(b,t,e("project-management-sign-out-are-you-sure"))},renderMembershipDialogBox:function(){if("membership"!==this.state.renderingDialog)return null;var e=this.props.locale.translate,t=this.props.locale.name,n=this.props.currentUser,r=t(s.get(n,"details.name"),s.get(n,"details.gender")),i={show:this.state.showingDialog,locale:this.props.locale,onConfirm:this.handleDialogClose};return o.createElement(b,i,e("membership-request-$you-are-now-member",r))},renderProjectManagementDialogBox:function(){if("management"!==this.state.renderingDialog)return null;var e={show:this.state.showingDialog,projectLinks:this.props.projectLinks,route:this.props.route,locale:this.props.locale,onDelete:this.handleProjectDelete,onCancel:this.handleDialogClose};return o.createElement(y,e)},handleProjectClick:function(e){var t=e.currentTarget.getAttribute("data-key"),r=s.find(this.props.projectLinks,{key:t});if(r){var o=window.location.origin,i={address:r.address,schema:r.schema,cors:o!==r.address};this.props.route.replace(n("./pages/settings-page.jsx"),i)}},handleAddClick:function(e){this.props.route.push(n("./pages/start-page.jsx"),{add:!0})},handleManageClick:function(e){this.setState({renderingDialog:"management",showingDialog:!0})},handleSystemDescriptionClick:function(e){this.setState({renderingDialog:"system-description",showingDialog:!0})},handleProjectDescriptionClick:function(e){this.setState({renderingDialog:"project-description",showingDialog:!0})},handleMobileSetupClick:function(e){this.setState({renderingDialog:"mobile-setup",showingDialog:!0})},handleJoinClick:function(e){var t=s.cloneDeep(this.props.currentUser);t.requested_project_ids=s.union(t.requested_project_ids,[this.props.currentProject.id]),this.props.onChange&&this.props.onChange({type:"change",target:this,user:t})},handleCancelJoinClick:function(e){var t=s.cloneDeep(this.props.currentUser);s.pull(t.requested_project_ids,this.props.currentProject.id),this.props.onChange&&this.props.onChange({type:"change",target:this,user:t})},handleSignOutClick:function(e){this.setState({renderingDialog:"sign-out",showingDialog:!0})},handleDialogClose:function(e){var t=this;this.setState({showingDialog:!1},function(){setTimeout(function(){t.setState({renderingDialog:null})},500)})},handleProjectDelete:function(e){var t=this;this.handleDialogClose();var r=this.props.route.parameters,o=s.includes(e.selection,r.address+"/"+r.schema),i=s.map(e.selection,function(e){return{key:e}});this.props.database.use({by:this}).remove({schema:"local",table:"project_link"},i).then(function(){if(o)return t.props.route.replace(n("./pages/start-page.jsx"))})},handleSignOutConfirm:function(e){var t=this,r=this.props.route.parameters,o=this.props.database.use({by:this});o.endSession().then(function(){var e=s.filter(t.props.projectLinks,{address:r.address});return o.remove({schema:"local",table:"project_link"},e).then(function(){return t.props.route.replace(n("./pages/start-page.jsx"))})})}})},"./panels/project-panel.scss":function(e,t){},"./panels/social-network-panel.jsx":function(e,t,n){"use strict";function r(e,t){if(/https?:/.test(e)){e=s.trim(e.replace(/\?.*/,""));var n=s.filter(e.split("/"));return n[n.length-1]}return e}var s=n("../../common/node_modules/lodash/lodash.js"),o=(n("../../common/node_modules/bluebird/js/browser/bluebird.js"),n("../../common/node_modules/react/react.js")),i=o.PropTypes,a=(n("../node_modules/relaks/index.js"),n("../../common/src/locale/locale.js")),c=n("../../common/src/mixins/update-check.js"),l=n("./widgets/settings-panel.jsx"),u=(n("./widgets/push-button.jsx"),n("./widgets/text-field.jsx"));n("./panels/social-network-panel.scss"),e.exports=o.createClass({displayName:"UserPanel",mixins:[c],propTypes:{currentUser:i.object,locale:i.instanceOf(a).isRequired,onChange:i.func},getUserProperty:function(e){return s.get(this.props.currentUser,e)},setUserProperty:function(e,t){if(this.props.currentUser){var n=s.decoupleSet(this.props.currentUser,e,t);this.props.onChange&&this.props.onChange({type:"change",target:this,user:n})}},render:function(){var e=this.props.locale.translate;return o.createElement(l,{className:"user"},o.createElement("header",null,o.createElement("i",{className:"fa fa-handshake-o"})," ",e("settings-social-networks")),o.createElement("body",null,this.renderSkypeNameInput(),this.renderIChatInput(),this.renderTwitterInput(),this.renderGithubURLInput(),this.renderGitlabURLInput(),this.renderLinkedInURLInput(),this.renderStackoverflowURLInput()))},renderSkypeNameInput:function(){var e=this.props.locale.translate,t={id:"skype",value:this.getUserProperty("details.skype_username"),locale:this.props.locale,onChange:this.handleSkypeUsernameChange};return o.createElement(u,t,e("social-network-skype"))},renderIChatInput:function(){var e=this.props.locale.translate,t={id:"ichat",value:this.getUserProperty("details.ichat_username"),locale:this.props.locale,onChange:this.handleIchatUsernameChange};return o.createElement(u,t,e("social-network-ichat"))},renderTwitterInput:function(){var e=this.props.locale.translate,t={id:"twitter",value:this.getUserProperty("details.twitter_username"),locale:this.props.locale,onChange:this.handleTwitterUsernameChange};return o.createElement(u,t,e("social-network-twitter"))},renderGithubURLInput:function(){var e=this.props.locale.translate,t={id:"github",value:this.getUserProperty("details.github_url"),locale:this.props.locale,onChange:this.handleGitHubURLChange};return o.createElement(u,t,e("social-network-github"))},renderGitlabURLInput:function(){var e=this.props.locale.translate,t={id:"github",value:this.getUserProperty("details.gitlab_url"),locale:this.props.locale,onChange:this.handleGitlabURLChange};return o.createElement(u,t,e("social-network-gitlab"))},renderLinkedInURLInput:function(){var e=this.props.locale.translate,t={id:"linkedin",value:this.getUserProperty("details.linkedin_url"),locale:this.props.locale,onChange:this.handleLinkedinURLChange};return o.createElement(u,t,e("social-network-linkedin"))},renderStackoverflowURLInput:function(){var e=this.props.locale.translate,t={id:"stackoverflow",value:this.getUserProperty("details.stackoverflow_url"),locale:this.props.locale,onChange:this.handleStackoverflowURLChange};return o.createElement(u,t,e("social-network-stackoverflow"))},handleSkypeUsernameChange:function(e){var t=s.trim(e.target.value);this.setUserProperty("details.skype_username",t)},handleIchatUsernameChange:function(e){var t=s.trim(e.target.value);this.setUserProperty("details.ichat_username",t)},handleTwitterUsernameChange:function(e){var t=r(e.target.value);this.setUserProperty("details.twitter_username",t)},handleLinkedinURLChange:function(e){var t=s.trim(e.target.value);this.setUserProperty("details.linkedin_url",t)},handleGitHubURLChange:function(e){var t=s.trim(e.target.value);this.setUserProperty("details.github_url",t)},handleGitlabURLChange:function(e){var t=s.trim(e.target.value);this.setUserProperty("details.gitlab_url",t)},handleStackoverflowURLChange:function(e){var t=s.trim(e.target.value);this.setUserProperty("details.stackoverflow_url",t)}})},"./panels/social-network-panel.scss":function(e,t){},"./panels/user-image-panel.jsx":function(e,t,n){"use strict";var r=n("../../common/node_modules/lodash/lodash.js"),s=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),o=(n("../../common/node_modules/moment/moment.js"),n("../../common/node_modules/react/react.js")),i=o.PropTypes,a=(n("../node_modules/relaks/index.js"),n("../../common/src/utils/component-refs.js")),c=(n("../../common/src/utils/focus-manager.js"),n("../../common/src/media/device-manager.js")),l=n("../../common/src/transport/payloads.js"),u=n("../../common/src/locale/locale.js"),d=n("../../common/src/theme/theme.js"),p=n("../../common/src/mixins/update-check.js"),h=n("./widgets/settings-panel.jsx"),m=n("./widgets/push-button.jsx"),f=n("./editors/image-editor.jsx"),g=n("./editors/media-importer.jsx"),v=n("./dialogs/photo-capture-dialog-box.jsx");n("./panels/user-image-panel.scss"),e.exports=o.createClass({displayName:"UserImagePanel",mixins:[p],propTypes:{currentUser:i.object,payloads:i.instanceOf(l).isRequired,locale:i.instanceOf(u).isRequired,theme:i.instanceOf(d).isRequired,onChange:i.func},getInitialState:function(){return this.components=a({importer:g}),{action:null,image:null,hasCamera:c.hasDevice("videoinput")}},getUserProperty:function(e){return r.get(this.props.currentUser,e)},getImage:function(){if(this.state.image)return this.state.image;var e=this.getUserProperty("details.resources");return r.find(e,{type:"image"})},setUserProperty:function(e,t){if(this.props.currentUser){var n=r.decoupleSet(this.props.currentUser,e,t);this.props.onChange&&this.props.onChange({type:"change",target:this,user:n,immediate:!0})}},render:function(){var e=this.props.locale.translate;return o.createElement(h,{className:"user-image"},o.createElement("header",null,o.createElement("i",{className:"fa fa-image"})," ",e("settings-profile-image")),o.createElement("body",null,this.renderProfilePicture(),this.renderMediaImporter()),o.createElement("footer",null,this.renderButtons()))},renderProfilePicture:function(){var e,t=this.getImage();if(t){var r={resource:t,locale:this.props.locale,theme:this.props.theme,previewWidth:256,previewHeight:256,disabled:"adjust"!==this.state.action,onChange:this.handleImageChange};e=o.createElement(f,r)}else{var s=n("../node_modules/octicons/build/svg/person.svg");e=o.createElement("div",{className:"no-image"},o.createElement(s,{className:""}))}return o.createElement("div",{className:"image-container"},e)},renderMediaImporter:function(){var e,t=this.components.setters;e=this.state.image?[this.state.image]:r.get(this.props.currentUser,"details.resources",[]);var n={ref:t.importer,types:["image"],limit:1,schema:"global",resources:e,locale:this.props.locale,theme:this.props.theme,payloads:this.props.payloads.override({schema:"global"}),cameraDirection:"front",onChange:this.handleChange,onCaptureEnd:this.handleCaptureEnd};return o.createElement(g,n)},renderButtons:function(){var e=this.props.locale.translate,t=!!this.getImage();if("adjust"===this.state.action&&t){var n={label:e("user-image-cancel"),onClick:this.handleCancelClick},r={label:e("user-image-save"),emphasized:!0,disabled:!this.state.image,onClick:this.handleSaveClick};return o.createElement("div",{key:"adjust",className:"buttons"},o.createElement(m,n),o.createElement(m,r))}if("replace"===this.state.action&&t){var n={label:e("user-image-cancel"),onClick:this.handleCancelClick},s={label:e("user-image-snap"),hidden:!v.isAvailable()||!this.state.hasCamera,onClick:this.handleTakeClick},i={label:e("user-image-select"),accept:"image/*",onChange:this.handleFileChange};return o.createElement("div",{key:"replace",className:"buttons"},o.createElement(m,n),o.createElement(m,s),o.createElement(m.File,i))}if(t){var a={label:e("user-image-adjust"),onClick:this.handleAdjustClick},c={label:e("user-image-replace"),onClick:this.handleReplaceClick};return o.createElement("div",{key:"action",className:"buttons"},o.createElement(m,a),o.createElement(m,c))}var s={label:e("user-image-snap"),hidden:!v.isAvailable()||!this.state.hasCamera,onClick:this.handleTakeClick},i={label:e("user-image-select"),accept:"image/*",onChange:this.handleFileChange};return o.createElement("div",{key:"add",className:"buttons"},o.createElement(m,s),o.createElement(m.File,i))},componentDidMount:function(){c.addEventListener("change",this.handleDeviceChange)},componentWillUnmount:function(){c.removeEventListener("change",this.handleDeviceChange)},handleCancelClick:function(e){this.setState({action:null,image:null})},handleAdjustClick:function(e){this.setState({action:"adjust"})},handleReplaceClick:function(e){this.setState({action:"replace"})},handleTakeClick:function(e){this.components.importer.capture("image")},handleFileChange:function(e){var t=e.target.files;this.components.importer.importFiles(t)},handleSaveClick:function(e){this.state.image&&(this.setUserProperty("details.resources",[this.state.image]),this.setState({action:null,image:null}))},handleImageChange:function(e){this.setState({image:e.resource})},handleChange:function(e){return this.setState({image:e.resources[0],action:"adjust"}),s.resolve()},handleCaptureEnd:function(e){},handleDeviceChange:function(e){this.setState({hasCamera:c.hasDevice("videoinput")})}})},"./panels/user-image-panel.scss":function(e,t){},"./panels/user-info-panel.jsx":function(e,t,n){"use strict";var r=n("../../common/node_modules/lodash/lodash.js"),s=(n("../../common/node_modules/bluebird/js/browser/bluebird.js"),n("../../common/node_modules/react/react.js")),o=s.PropTypes,i=(n("../node_modules/relaks/index.js"),n("../../common/src/locale/locale.js")),a=n("../../common/src/mixins/update-check.js"),c=n("./widgets/settings-panel.jsx"),l=(n("./widgets/push-button.jsx"),n("./widgets/text-field.jsx"));n("./panels/user-info-panel.scss"),e.exports=s.createClass({displayName:"UserInfoPanel",mixins:[a],propTypes:{currentUser:o.object,locale:o.instanceOf(i).isRequired,onChange:o.func},getUserProperty:function(e){return r.get(this.props.currentUser,e)},setUserProperty:function(e,t){if(this.props.currentUser){var n=r.decoupleSet(this.props.currentUser,e,t);this.props.onChange&&this.props.onChange({type:"change",target:this,user:n})}},render:function(){var e=this.props.locale.translate;return s.createElement(c,{className:"user-info"},s.createElement("header",null,s.createElement("i",{className:"fa fa-user-circle"})," ",e("settings-user-information")),s.createElement("body",null,this.renderNameInput(),this.renderEmailInput(),this.renderPhoneInput(),this.renderGenderSelector()))},renderNameInput:function(){var e=this.props.locale.translate,t=this.props.locale.pick,n=this.getUserProperty("details.name"),r={id:"name",value:t(n),locale:this.props.locale,onChange:this.handleNameChange};return s.createElement(l,r,e("user-info-name"))},renderEmailInput:function(){var e=this.props.locale.translate,t={id:"email",value:this.getUserProperty("details.email"),locale:this.props.locale,onChange:this.handleEmailChange};return s.createElement(l,t,e("user-info-email"))},renderPhoneInput:function(){var e=this.props.locale.translate,t={id:"email",value:this.getUserProperty("details.phone"),locale:this.props.locale,onChange:this.handlePhoneChange};return s.createElement(l,t,e("user-info-phone"))},renderGenderSelector:function(){var e=this.props.locale.translate,t={id:"gender",value:this.getUserProperty("details.gender")||"",size:3,onChange:this.handleGenderChange};return s.createElement("div",{className:"gender-selector"},s.createElement("label",{htmlFor:"gender"},e("user-info-gender")),s.createElement("select",t,s.createElement("option",{value:"male"},e("user-info-gender-male")),s.createElement("option",{value:"female"},e("user-info-gender-female")),s.createElement("option",{value:""},e("user-info-gender-unspecified"))))},handleNameChange:function(e){var t=e.target.value;this.setUserProperty("details.name",t)},handleEmailChange:function(e){var t=e.target.value;this.setUserProperty("details.email",t)},handlePhoneChange:function(e){var t=e.target.value;this.setUserProperty("details.phone",t)},handleGenderChange:function(e){var t=e.target.value;this.setUserProperty("details.gender",t||void 0)}})},"./panels/user-info-panel.scss":function(e,t){},"./panels/web-alert-panel.jsx":function(e,t,n){"use strict";function r(){var e=navigator.userAgent;for(var t in m){if(m[t].test(e))return t}return"globe"}var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o=n("../../common/node_modules/lodash/lodash.js"),i=(n("../../common/node_modules/bluebird/js/browser/bluebird.js"),n("../../common/node_modules/react/react.js")),a=i.PropTypes,c=n("../../common/src/objects/types/notification-types.js"),l=n("../../common/src/objects/utils/user-utils.js"),u=n("../../common/src/locale/locale.js"),d=n("../../common/src/mixins/update-check.js"),p=n("./widgets/settings-panel.jsx"),h=n("./widgets/option-button.jsx");n("./panels/web-alert-panel.scss"),e.exports=i.createClass({displayName:"WebAlertPanel",mixins:[d],propTypes:{currentUser:a.object,locale:a.instanceOf(u).isRequired,onChange:a.func},setUserProperty:function(e,t){if(this.props.currentUser){var n=o.decoupleSet(this.props.currentUser,e,t);this.props.onChange&&this.props.onChange({type:"change",target:this,user:n})}},render:function(){var e=this.props.locale.translate,t=r();return i.createElement(p,{className:"web-alert"},i.createElement("header",null,i.createElement("div",{className:"icon"},i.createElement("i",{className:"fa fa-"+t}),i.createElement("i",{className:"fa fa-exclamation-circle icon-overlay"}))," ",e("settings-web-alert")),i.createElement("body",null,this.renderOptions()))},renderOptions:function(){var e=c;return"admin"!==o.get(this.props.currentUser,"type")&&(e=o.without(e,c.admin)),o.map(e,this.renderOption)},renderOption:function(e,t){var n=this.props.locale.translate,r=o.snakeCase(e),a=o.get(this.props.currentUser,"settings",{}),c=!!o.get(a,"notification."+r),u=!!o.get(a,"web_alert."+r),d=l.canReceiveNotification(this.props.currentUser,this.props.repos,e),p={label:n("notification-option-"+e),selected:u&&c,hidden:!d,disabled:!c,onClick:this.handleOptionClick,id:r};return i.createElement(h,s({key:t},p))},handleOptionClick:function(e){var t=e.currentTarget.id,n="web_alert."+t,r=o.clone(o.get(this.props.currentUser,"settings",{}));!o.get(r,n)?o.set(r,n,!0):o.unset(r,n),this.setUserProperty("settings",r)}});var m={edge:/(Edge|Internet Explorer)/,chrome:/Chrome/,safari:/Safari/,firefox:/Firefox/}},"./panels/web-alert-panel.scss":function(e,t){},"./views/app-component.jsx":function(e,t,n){"use strict";var r=(n("../../common/node_modules/lodash/lodash.js"),n("../../common/node_modules/react/react.js")),s=r.PropTypes,o=n("../../common/node_modules/mark-gor/react.js"),i=n("../../common/src/theme/theme.js"),a=n("../../common/src/locale/locale.js"),c=n("../../common/src/widgets/resource-view.jsx");n("./views/app-component.scss"),e.exports=r.createClass({displayName:"AppComponent",propTypes:{component:s.object.isRequired,theme:s.instanceOf(i),locale:s.instanceOf(a),onSelect:s.func},render:function(){return r.createElement("div",{className:"app-component",onClick:this.handleClick},this.renderPicture(),this.renderText())},renderPicture:function(){var e=this.props.component;if(e.image)return r.createElement("div",{className:"picture"},r.createElement(c,{resource:e.image,height:48,theme:this.props.theme}));var t=e.icon||{},n=t.class||"fa-cubes",s={color:t.color,backgroundColor:t.backgroundColor};return r.createElement("div",{className:"picture"},r.createElement("div",{className:"icon",style:s},r.createElement("i",{className:"fa fa-fw "+n})))},renderText:function(){var e=this.props.locale.pick,t=e(this.props.component.text),n=o.parse(t);return r.createElement("div",{className:"description"},r.createElement("div",{className:"description-contents"},n,r.createElement("div",{className:"ellipsis"},r.createElement("i",{className:"fa fa-ellipsis-h"}))))},handleClick:function(e){this.props.onSelect&&this.props.onSelect({type:"select",target:this,component:this.props.component})}})},"./views/app-component.scss":function(e,t){},"./views/bookmark-view.jsx":function(e,t,n){"use strict";var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s=n("../../common/node_modules/lodash/lodash.js"),o=n("../../common/node_modules/react/react.js"),i=o.PropTypes,a=n("../../common/src/objects/utils/user-utils.js"),c=n("../../common/src/data/database.js"),l=n("../../common/src/routing/route.js"),u=n("../../common/src/locale/locale.js"),d=n("../../common/src/theme/theme.js"),p=n("./widgets/multiple-user-names.jsx");n("./views/bookmark-view.scss"),e.exports=o.createClass({displayName:"BookmarkView",propTypes:{highlighting:i.bool,bookmark:i.object,senders:i.arrayOf(i.object),currentUser:i.object,database:i.instanceOf(c).isRequired,route:i.instanceOf(l).isRequired,locale:i.instanceOf(u).isRequired,theme:i.instanceOf(d).isRequired},render:function(){var e="bookmark-view";return this.props.highlighting&&(e+=" highlighting"),o.createElement("div",{className:e},o.createElement("div",{className:"title"},this.renderSenderNames()),o.createElement("div",{className:"story"},this.props.children))},renderSenderNames:function(){var e,t=this.props.locale.translate,n=s.get(this.props.currentUser,"id"),i=s.some(this.props.senders,{id:n}),c=s.filter(this.props.senders,function(e){return e.id!==n});if(i){var l=this.props.currentUser,u=a.getDisplayNameWithGender(l,this.props.locale);switch(c.length){case 0:e=t("bookmark-$you-bookmarked-it",u);break;case 1:var d=a.getDisplayNameWithGender(c[0],this.props.locale);e=t("bookmark-$you-bookmarked-it-and-$name-recommends-it",u,d);break;default:var h={users:c,label:t("bookmark-$count-users",c.length),title:t("bookmark-recommendations"),locale:this.props.locale,theme:this.props.theme},m=o.createElement(p,r({key:1},h));e=t("bookmark-$you-bookmarked-it-and-$others-recommends-it",u,m,c.length)}}else switch(c.length){case 0:e="Â ";break;case 1:var d=a.getDisplayNameWithGender(c[0],this.props.locale);e=t("bookmark-$name-recommends-this",d);break;case 2:e=t("bookmark-$name1-and-$name2-recommend-this",a.getDisplayNameWithGender(c[0],this.props.locale),a.getDisplayNameWithGender(c[1],this.props.locale));break;default:var d=a.getDisplayNameWithGender(c[0],this.props.locale),f=s.slice(c,1),h={users:f,label:t("bookmark-$count-other-users",f.length),title:t("bookmark-recommendations"),locale:this.props.locale,theme:this.props.theme},m=o.createElement(p,r({key:1},h));e=t("bookmark-$name1-and-$others-recommend-this",d,m,c.length-1)}return o.createElement("span",{className:"name"},e)},removeBookmark:function(e){var t=this.props.route.parameters;return this.props.database.use({schema:t.schema,by:this}).removeOne({table:"bookmark"},e)},handleCloseClick:function(e){this.removeBookmark(this.props.bookmark)}})},"./views/bookmark-view.scss":function(e,t){},"./views/media-view.jsx":function(e,t,n){"use strict";function r(e){return s.first(s.keys(e.versions))||null}var s=n("../../common/node_modules/lodash/lodash.js"),o=n("../../common/node_modules/react/react.js"),i=o.PropTypes,a=(n("../../common/src/transport/http-request.js"),n("../../common/src/utils/memoize.js")),c=n("../../common/src/utils/component-refs.js"),l=(n("../../common/src/transport/payload.js"),n("../../common/src/media/image-cropping.js"),n("../../common/src/locale/locale.js")),u=n("../../common/src/theme/theme.js"),d=(n("../../common/src/widgets/overlay.jsx"),n("./widgets/media-button.jsx")),p=n("./dialogs/media-dialog-box.jsx"),h=n("../../common/src/widgets/resource-view.jsx"),m=n("./widgets/duration-indicator.jsx"),f=n("../../common/src/mixins/update-check.js");n("./views/media-view.scss"),e.exports=o.createClass({displayName:"MediaView",mixins:[f],propTypes:{resources:i.arrayOf(i.object).isRequired,locale:i.instanceOf(l).isRequired,theme:i.instanceOf(u).isRequired,width:i.number.isRequired},getInitialState:function(){return this.components=c({audioPlayer:HTMLAudioElement}),{selectedIndex:0,renderingDialogBox:!1,showingDialogBox:!1,audioURL:null}},getResourceCount:function(){return this.props.resources.length},getSelectedResourceIndex:function(){var e=this.getResourceCount()-1;return Math.min(this.state.selectedIndex,e)},getSelectedResource:function(){var e=this.getSelectedResourceIndex();return-1!==e?this.props.resources[e]:null},selectResource:function(e){var t=this;return new Promise(function(n,r){var s=t.getResourceCount();e>=0&&e<s?t.setState({selectedIndex:e},function(){n(e)}):n(t.getSelectedResourceIndex())})},render:function(){return o.createElement("div",{className:"media-view"},o.createElement("div",{className:"container"},this.renderResource(),this.renderNavigation(),this.renderAudioPlayer(),this.renderDialogBox()))},renderNavigation:function(){var e=this.getResourceCount();if(e<=1)return null;var t=Math.min(e-1,this.state.selectedIndex),n={index:t,count:e,onBackwardClick:this.handleBackwardClick,onForwardClick:this.handleForwardClick};return o.createElement("div",{className:"navigation"},o.createElement("div",{className:"right"},o.createElement(d.Direction,n)))},renderAudioPlayer:function(){if(!this.state.audioURL)return null;var e={ref:this.components.setters.audioPlayer,src:this.state.audioURL,autoPlay:!0,controls:!0,onEnded:this.handleAudioEnded};return o.createElement("audio",e)},renderDialogBox:function(){if(!this.state.renderingDialogBox)return null;var e=g(this.props.resources),t=this.getSelectedResourceIndex(),n=s.indexOf(e,this.props.resources[t]),r={show:this.state.showingDialogBox,resources:e,selectedIndex:n,locale:this.props.locale,theme:this.props.theme,onClose:this.handleDialogClose};return o.createElement(p,r)},renderResource:function(){var e=this.props.resources.length,t=Math.min(e-1,this.state.selectedIndex),n=this.props.resources[t];switch(n.type){case"image":return this.renderImage(n,t);case"video":return this.renderVideo(n,t);case"audio":return this.renderAudio(n,t);case"website":return this.renderWebsite(n,t)}},renderImage:function(e,t){return o.createElement("div",{key:t,className:"image",onClick:this.handleImageClick},this.renderImageElement(e))},renderVideo:function(e,t){var n="video",r=this.renderImageElement(e);return r||(n+=" posterless"),o.createElement("div",{key:t,className:n,onClick:this.handleVideoClick},r,o.createElement("div",{className:"overlay"},o.createElement("div",{className:"icon"},o.createElement("i",{className:"fa fa-play-circle-o"})),o.createElement("div",{className:"duration"},m.format(e.duration))))},renderAudio:function(e,t){var n="audio";this.props.theme.getImageURL(e)||(n+=" posterless");var r=this.state.audioURL?"stop":"play";return o.createElement("div",{key:t,className:n,onClick:this.handleAudioClick},this.renderImageElement(e),o.createElement("div",{className:"overlay"},o.createElement("div",{className:"icon"},o.createElement("i",{className:"fa fa-"+r+"-circle"})),o.createElement("div",{className:"duration"},m.format(e.duration))))},renderWebsite:function(e,t){return o.createElement("div",{key:t,className:"website"},o.createElement("a",{href:e.url,target:"_blank"},this.renderImageElement(e),o.createElement("div",{className:"overlay hidden"},o.createElement("div",{className:"icon"},o.createElement("i",{className:"fa fa-external-link"})))))},renderImageElement:function(e){var t={resource:e,theme:this.props.theme,width:this.props.width,height:this.props.width,mosaic:!0};return o.createElement(h,t)},pauseAudio:function(){var e=this.components.audioPlayer;e&&e.pause()},handleBackwardClick:function(e){var t=this.getSelectedResourceIndex();return this.selectResource(t-1)},handleForwardClick:function(e){var t=this.getSelectedResourceIndex();return this.selectResource(t+1)},handleImageClick:function(e){this.setState({showingDialogBox:!0,renderingDialogBox:!0})},handleVideoClick:function(e){this.pauseAudio(),this.setState({showingDialogBox:!0,renderingDialogBox:!0})},handleAudioClick:function(e){if(this.state.audioURL)this.setState({audioURL:null});else{var t=this.getSelectedResource(),n=r(t),s=this.props.theme.getAudioURL(t,{version:n});this.setState({audioURL:s})}},handleAudioEnded:function(e){this.setState({audioURL:null})},handleDialogClose:function(e){var t=this;this.setState({showingDialogBox:!1},function(){setTimeout(function(){t.setState({renderingDialogBox:!1})},1e3)})}});var g=a(function(e){return s.filter(e,function(e){switch(e.type){case"image":case"video":return!0}})})},"./views/media-view.scss":function(e,t){},"./views/notification-view.jsx":function(e,t,n){"use strict";function r(e,t){var r=o.clone(t.parameters);switch(e.type){case"like":case"comment":case"issue":case"vote":case"task-completion":case"coauthor":case"note":case"assignment":case"push":case"merge":case"survey":case"issue":case"mention":var s=[n("./pages/news-page.jsx"),n("./lists/story-list.jsx"),n("./lists/reaction-list.jsx")];return r.story=e.story_id,r.reaction=e.reaction_id||void 0,r.highlighting=!0,t.find(s,r);case"bookmark":var s=[n("./pages/bookmarks-page.jsx"),n("./lists/story-list.jsx")];return r.story=e.story_id,r.highlighting=!0,t.find(s,r);case"join-request":return"/admin/projects/"+o.get(e,"details.project_id")+"/members/"}}function s(e){switch(e.type){case"join-request":return"admin"}return""}var o=n("../../common/node_modules/lodash/lodash.js"),i=n("../../common/node_modules/react/react.js"),a=i.PropTypes,c=n("../../common/src/objects/utils/user-utils.js"),l=n("../../common/src/data/database.js"),u=n("../../common/src/routing/route.js"),d=n("../../common/src/locale/locale.js"),p=n("../../common/src/theme/theme.js"),h=n("../../common/src/mixins/update-check.js"),m=n("../../common/src/widgets/time.jsx"),f=n("./widgets/profile-image.jsx");n("./views/notification-view.scss"),e.exports=i.createClass({displayName:"NotificationView",mixins:[h],propTypes:{notification:a.object.isRequired,user:a.object,database:a.instanceOf(l).isRequired,route:a.instanceOf(u).isRequired,locale:a.instanceOf(d).isRequired,theme:a.instanceOf(p).isRequired,onClick:a.func},render:function(){var e={className:"notification-view "+this.props.theme.mode,href:this.getNotificationURL(),target:this.getNotificationTarget(),onClick:this.handleClick};return this.props.notification.seen||(e.className+=" unread"),i.createElement("a",e,i.createElement("div",{className:"event"},this.renderProfileImage(),this.renderText()),i.createElement("div",{className:"date"},this.renderTime(),this.renderIcon()))},renderProfileImage:function(){var e={user:this.props.user,theme:this.props.theme,size:"small"};return i.createElement(f,e)},renderText:function(){var e=this.getNotificationText();return i.createElement("span",{className:"text"},e)},renderTime:function(){var e={time:this.props.notification.ctime,locale:this.props.locale};return i.createElement(m,e)},renderIcon:function(){return i.createElement("i",{className:"fa fa-"+this.getNotificationIcon()+" fa-fw"})},getNotificationURL:function(){return r(this.props.notification,this.props.route)},getNotificationTarget:function(){return s(this.props.notification)},getNotificationText:function(){var e=this.props.locale.translate,t=this.props.notification,n=c.getDisplayNameWithGender(this.props.user,this.props.locale);switch(t.type){case"like":return e("notification-$name-likes-your-$story",n,t.details.story_type);case"comment":return e("notification-$name-commented-on-your-$story",n,t.details.story_type);case"issue":return e("notification-$name-opened-an-issue",n);case"vote":return e("notification-$name-voted-in-your-survey",n);case"task-completion":return e("notification-$name-completed-task",n);case"coauthor":return e("notification-$name-added-you-as-coauthor",n);case"note":return e("notification-$name-posted-a-note-about-your-$story",n,t.details.story_type);case"assignment":return e("notification-$name-is-assigned-to-your-issue",n);case"push":return e("notification-$name-pushed-code-to-$branch",n,t.details.branch);case"merge":return e("notification-$name-merged-code-to-$branch",n,t.details.branch);case"survey":return e("notification-$name-posted-a-survey",n);case"bookmark":return e("notification-$name-sent-bookmark-to-$story",n,t.details.story_type);case"mention":if(t.details.story_type)return e("notification-$name-mentioned-you-in-$story",n,t.details.story_type);if(t.details.reaction_type)return e("notification-$name-mentioned-you-in-$reaction",n,t.details.reaction_type);break;case"join-request":return e("notification-$name-requested-to-join",n)}},getNotificationIcon:function(){switch(this.props.notification.type){case"like":return"thumbs-up";case"comment":return"comment";case"issue":return"exclamation-circle";case"vote":return"check-square-o";case"task-completion":return"star";case"note":return"sticky-note";case"assignment":return"hand-o-right";case"push":case"merge":return"cubes";case"coauthor":return"handshake-o";case"survey":return"list-url";case"bookmark":return"bookmark";case"mention":return"at";case"join-request":return"user-circle"}},handleClick:function(e){this.props.onClick&&this.props.onClick({type:"click",target:this})}}),e.exports.getNotificationURL=r,e.exports.getNotificationTarget=s},"./views/notification-view.scss":function(e,t){},"./views/reaction-view-options.jsx":function(e,t,n){"use strict";var r=n("../../common/node_modules/lodash/lodash.js"),s=n("../../common/node_modules/react/react.js"),o=s.PropTypes,i=(n("../../common/node_modules/moment/moment.js"),n("../../common/src/objects/utils/user-utils.js")),a=n("../../common/src/locale/locale.js"),c=n("../../common/src/theme/theme.js"),l=n("./widgets/pop-up-menu.jsx"),u=n("./widgets/option-button.jsx");n("./views/reaction-view-options.scss"),e.exports=s.createClass({displayName:"ReactionViewOptions",propTypes:{access:o.oneOf(["read-only","read-comment","read-write"]).isRequired,currentUser:o.object.isRequired,reaction:o.object.isRequired,story:o.object.isRequired,options:o.object.isRequired,locale:o.instanceOf(a),theme:o.instanceOf(c)},getInitialState:function(){return{open:!1}},render:function(){var e=this.props.access,t=this.props.currentUser,n=this.props.story,r=this.props.reaction,o=!1;i.canHideReaction(t,n,r,e)&&(o=!0),i.canEditReaction(t,n,r,e)&&(o=!0),i.canRemoveReaction(t,n,r,e)&&(o=!0);var a={className:"reaction-view-options",disabled:!o,popOut:!0,onOpen:this.handleOpen,onClose:this.handleClose};return s.createElement(l,a,s.createElement("button",null,s.createElement("i",{className:"fa fa-ellipsis-v"})),s.createElement("menu",null,this.renderOptions()))},renderOptions:function(){if(!this.state.open)return null;var e=this.props.locale.translate,t=this.props.options,n=this.props.access,r=this.props.currentUser,o=this.props.story,a=this.props.reaction,c={label:e("option-hide-comment"),hidden:!i.canHideReaction(r,o,a,n),selected:t.hideReaction,onClick:this.handleHideClick},l={label:e("option-edit-comment"),hidden:!i.canEditReaction(r,o,a,n),selected:t.editReaction,onClick:this.handleEditClick},d={label:e("option-remove-comment"),hidden:!i.canRemoveReaction(r,o,a,n),selected:t.removeReaction,onClick:this.handleRemoveClick};return s.createElement("div",{className:"view-options in-menu"},s.createElement(u,c),s.createElement(u,l),s.createElement(u,d))},triggerChangeEvent:function(e){this.props.onChange&&this.props.onChange({type:"change",target:this,options:e})},handleOpen:function(e){this.setState({open:!0})},handleClose:function(e){this.setState({open:!1})},handleHideClick:function(e){var t=r.clone(this.props.options);t.hideReaction=!t.hideReaction,this.triggerChangeEvent(t)},handleEditClick:function(e){var t=r.clone(this.props.options);t.editReaction=!0,this.triggerChangeEvent(t)},handleRemoveClick:function(e){var t=r.clone(this.props.options);t.removeReaction=!0,this.triggerChangeEvent(t)}})},"./views/reaction-view-options.scss":function(e,t){},"./views/reaction-view.jsx":function(e,t,n){"use strict";function r(e){return o.first(o.keys(e.versions))||null}function s(e){var t=o.get(e,"note.id");return t?"#note_"+t:""}var o=n("../../common/node_modules/lodash/lodash.js"),i=n("../../common/node_modules/react/react.js"),a=i.PropTypes,c=n("../../common/src/utils/markdown.js"),l=n("../../common/src/utils/plain-text.js"),u=n("../../common/src/utils/memoize.js"),d=n("../../common/src/utils/component-refs.js"),p=n("../../common/src/objects/utils/external-data-utils.js"),h=n("../../common/src/objects/utils/user-utils.js"),m=n("../../common/src/data/database.js"),f=n("../../common/src/routing/route.js"),g=n("../../common/src/locale/locale.js"),v=n("../../common/src/theme/theme.js"),b=n("../../common/src/mixins/update-check.js"),y=n("./widgets/profile-image.jsx"),j=n("./views/media-view.jsx"),w=n("./dialogs/media-dialog-box.jsx"),x=n("./widgets/reaction-progress.jsx"),k=(n("../../common/src/widgets/time.jsx"),n("./views/reaction-view-options.jsx"));n("./views/reaction-view.scss"),e.exports=i.createClass({displayName:"ReactionView",mixins:[b],propTypes:{access:a.oneOf(["read-only","read-comment","read-write"]).isRequired,highlighting:a.bool,reaction:a.object.isRequired,respondent:a.object,story:a.object.isRequired,currentUser:a.object.isRequired,repo:a.object,database:a.instanceOf(m).isRequired,route:a.instanceOf(f).isRequired,locale:a.instanceOf(g).isRequired,theme:a.instanceOf(v).isRequired},getInitialState:function(){this.components=d({audioPlayer:HTMLAudioElement});var e={options:E,selectedResourceURL:null,showingReferencedMediaDialog:!1,renderingReferencedMediaDialog:!1};return this.updateOptions(e,this.props),e},getClassName:function(){var e="reaction-view";return this.props.highlighting&&(e+=" highlighting"),e},componentWillReceiveProps:function(e){var t=this,n=o.clone(this.state);this.props.reaction!==e.reaction&&this.updateOptions(n,e);var r=o.pickBy(n,function(e,n){return t.state[n]!==e});o.isEmpty(r)||this.setState(r)},updateOptions:function(e,t){(e.options=o.clone(e.options)).hideReaction=!t.reaction.public},render:function(){return i.createElement("div",{className:this.getClassName()},i.createElement("div",{className:"profile-image-column"},this.renderProfileImage()),i.createElement("div",{className:"contents-column"},i.createElement("div",{className:"text"},this.renderOptionButton(),this.renderProgress(),this.renderText(),this.renderReferencedMediaDialog()),this.renderAudioPlayer(),this.renderMedia()))},renderProfileImage:function(){var e={user:this.props.respondent,theme:this.props.theme,size:"small"};return this.props.respondent&&(e.url=this.props.route.find(n("./pages/people-page.jsx"),{schema:this.props.route.parameters.schema,user:this.props.respondent.id})),i.createElement(y,e)},renderText:function(){var e=this.props.locale.translate,t=this.props.locale.pick,n=this.props.reaction,r=this.props.currentUser,a=this.props.story,u=this.props.repo,d=h.getDisplayName(this.props.respondent,this.props.locale);if(this.resourcesReferenced={},!n.published||!1===n.ready){var m;return m=n.published?"reaction-$name-is-sending":n.ptime?"reaction-$name-is-editing":"reaction-$name-is-writing",i.createElement("span",{className:"in-progress"},e(m,d))}switch(n.type){case"like":return i.createElement("span",{className:"like"},e("reaction-$name-likes-this",d));case"comment":var f=o.get(n,"details.text");if(o.get(n,"details.markdown",!1)){var g=c.render(t(f),this.handleReference);return g[0]&&"p"===g[0].type&&(g[0]=i.createElement("span",{key:0},g[0].props.children)),i.createElement("span",{className:"comment markdown",onClick:this.handleMarkdownClick},d,": ",g)}return i.createElement("span",{className:"comment"},d,": ",l.renderEmoji(t(f)));case"vote":return i.createElement("span",{className:"vote"},e("reaction-$name-cast-a-vote",d));case"task-completion":return i.createElement("span",{className:"task-completion"},e("reaction-$name-completed-a-task",d));case"note":var v,b,r=this.props.currentUser,u=this.props.repo;if(h.canAccessRepo(r,u))switch(a.type){case"push":case"merge":var y=p.findLinkByRelations(n,"note","commit");if(y){var j=y.commit.id,w=s(y);v=u.details.web_url+"/commit/"+j+w,b=y.type}break;case"issue":var y=p.findLinkByRelations(n,"note","issue");if(y){var x=y.issue.number,w=s(y);v=u.details.web_url+"/issues/"+x+w,b=y.type}break;case"merge-request":var y=p.findLinkByRelations(n,"note","merge_request");if(y){var k=y.merge_request.number,w=s(y);v=u.details.web_url+"/merge_requests/"+k+w,b=y.type}}return i.createElement("a",{className:"note",href:v,target:b},e("reaction-$name-commented-on-"+a.type,d));case"assignment":if("issue"===a.type||"post"===a.type){var v,b;if(h.canAccessRepo(r,u)){var y=p.findLinkByRelations(n,"issue");if(y){var x=o.get(y,"issue.number"),w=s(y);v=u.details.web_url+"/issues/"+x+w,b=y.type}}return i.createElement("a",{className:"issue-assignment",href:v,target:b},e("reaction-$name-is-assigned-to-issue",d))}if("merge-request"===a.type){var v,b;if(h.canAccessRepo(r,u)){var y=p.findLinkByRelations(n,"merge_request");if(y){var k=y.merge_request.number,w=s(y);v=u.details.web_url+"/merge_requests/"+k+w,b=y.type}}return i.createElement("a",{className:"issue-assignment",href:v,target:b},e("reaction-$name-is-assigned-to-merge-request",d))}case"tracking":var v,b;if(h.canAccessRepo(r,u)){var y=p.findLinkByRelations(n,"issue");if(y){var x=y.issue.number;v=u.details.web_url+"/issues/"+x,b=y.type}}return i.createElement("a",{className:"issue-tracking",href:v,target:b},e("reaction-$name-added-story-to-issue-tracker",d))}},renderOptionButton:function(){if(!this.props.reaction.published)return null;var e={access:this.props.access,currentUser:this.props.currentUser,reaction:this.props.reaction,story:this.props.story,locale:this.props.locale,theme:this.props.theme,options:this.state.options,onChange:this.handleOptionsChange};return i.createElement(k,e)},renderProgress:function(){if(!this.props.reaction.published)return null;var e={reaction:this.props.reaction,locale:this.props.locale};return i.createElement(x,e)},renderAudioPlayer:function(){if(!this.state.audioURL)return null;var e={ref:this.components.setters.audioPlayer,src:this.state.audioURL,autoPlay:!0,controls:!0,onEnded:this.handleAudioEnded};return i.createElement("audio",e)},renderMedia:function(){var e=o.get(this.props.reaction,"details.resources");if(o.isEmpty(this.resourcesReferenced)||(e=o.difference(e,o.values(this.resourcesReferenced))),o.isEmpty(e))return null;var t={locale:this.props.locale,theme:this.props.theme,resources:e,width:"signle-col"===this.props.theme.mode?220:300};return i.createElement("div",{className:"media"},i.createElement(j,t))},renderReferencedMediaDialog:function(){if(!this.state.renderingReferencedMediaDialog)return null;var e=this.resourcesReferenced[this.state.selectedResourceURL],t=C(this.resourcesReferenced),n=o.indexOf(t,e);if(-1===n)return null;var r={show:this.state.showingReferencedMediaDialog,resources:t,selectedIndex:n,locale:this.props.locale,theme:this.props.theme,onClose:this.handleReferencedMediaDialogClose};return i.createElement(w,r)},saveReaction:function(e){var t=this.props.route.parameters,n=this.props.database.use({schema:t.schema,by:this});return n.start().then(function(){return n.saveOne({table:"reaction"},e)})},removeReaction:function(e){var t=this.props.route.parameters;return this.props.database.use({schema:t.schema,by:this}).removeOne({table:"reaction"},e)},setOptions:function(e){var t=this,n=this.state.options;this.setState({options:e},function(){if(e.editReaction&&!n.editReaction){var r=o.clone(t.props.reaction);r.published=!1,t.saveReaction(r)}if(e.removeReaction&&!n.removeReaction&&t.removeReaction(t.props.reaction),e.hideReaction!==n.hideReaction){var r=o.clone(t.props.reaction);r.public=!e.hideReaction,t.saveReaction(r)}})},handleReference:function(e){var t=this.props.reaction.details.resources,r=c.findReferencedResource(t,e.name);if(r){var s,o=this.props.theme;return s=e.forImage?"audio"===r.type?n("../node_modules/file-loader/index.js!../assets/speaker.svg")+"#"+encodeURI(r.url):o.getImageURL(r,{height:24}):o.getURL(r),this.resourcesReferenced[s]=r,{href:s,title:void 0}}},handleMarkdownClick:function(e){var t=e.target;if("IMG"===t.tagName){var n=t.getAttribute("src"),s=this.resourcesReferenced[n];if(s){if("image"===s.type||"video"===s.type)this.setState({selectedResourceURL:n,renderingReferencedMediaDialog:!0,showingReferencedMediaDialog:!0});else if("website"===s.type)window.open(s.url);else if("audio"===s.type){var o=r(s),i=this.props.theme.getAudioURL(s,{version:o});this.setState({audioURL:i})}}else{var a=t.getBoundingClientRect(),c=t.naturalWidth+50,l=t.naturalHeight+50,u=a.left+window.screenLeft,d=a.top+window.screenTop;window.open(t.src,"_blank","width="+c+",height="+l+",left="+u+",top="+d+"status=no,menubar=no")}}},handleReferencedMediaDialogClose:function(e){var t=this;this.setState({showingReferencedMediaDialog:!1},function(){setTimeout(function(){t.state.showingReferencedMediaDialog||t.setState({renderingReferencedMediaDialog:!1,selectedResourceURL:null})},500)})},handleOptionsChange:function(e){this.setOptions(e.options)},handleAudioEnded:function(e){this.setState({audioURL:null})}});var E={hideReaction:!1,editReaction:!1,removeReaction:!1},C=u(function(e){return o.filter(e,function(e){switch(e.type){case"image":case"video":return!0}})})},"./views/reaction-view.scss":function(e,t){},"./views/story-contents.jsx":function(e,t,n){"use strict";function r(e){return o.first(o.keys(e.versions))||null}var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o=n("../../common/node_modules/lodash/lodash.js"),i=n("../../common/node_modules/react/react.js"),a=i.PropTypes,c=(n("../../common/node_modules/moment/moment.js"),n("../../common/src/utils/memoize.js")),l=n("../../common/src/utils/list-parser.js"),u=n("../../common/src/utils/markdown.js"),d=n("../../common/src/utils/plain-text.js"),p=n("../../common/src/utils/component-refs.js"),h=n("../../common/src/objects/utils/external-data-utils.js"),m=n("../../common/src/objects/utils/user-utils.js"),f=(n("../../common/src/transport/payload.js"),n("../../common/src/locale/locale.js")),g=n("../../common/src/theme/theme.js"),v=n("../../common/src/mixins/update-check.js"),b=n("./views/media-view.jsx"),y=n("./dialogs/media-dialog-box.jsx"),j=n("./views/app-component.jsx"),w=n("./dialogs/app-component-dialog-box.jsx"),x=n("./widgets/scrollable.jsx"),k=n("./widgets/push-button.jsx");n("./views/story-contents.scss"),e.exports=i.createClass({displayName:"StoryContents",mixins:[v],propTypes:{access:a.oneOf(["read-only","read-comment","read-write"]).isRequired,story:a.object.isRequired,authors:a.arrayOf(a.object),currentUser:a.object.isRequired,reactions:a.arrayOf(a.object),repo:a.object,locale:a.instanceOf(f).isRequired,theme:a.instanceOf(g).isRequired,onChange:a.func,onReaction:a.func},getInitialState:function(){this.components=p({audioPlayer:HTMLAudioElement});var e={voteSubmitted:!1,selectedComponent:null,showingComponentDialog:!1,renderingComponentDialog:!1,selectedResourceName:null,showingReferencedMediaDialog:!1,renderingReferencedMediaDialog:!1,audioURL:null};return this.updateUserAnswers({},e),e},getAuthorName:function(){var e=this.props.locale.name,t=o.first(this.props.authors);return t?e(t.details.name,t.details.gender):""},componentWillReceiveProps:function(e){var t=o.clone(this.state);this.props.story!==e.story&&this.updateUserAnswers(t,e);var n=o.shallowDiff(t,this.state);o.isEmpty(n)||this.setState(n)},updateUserAnswers:function(e,t){if(t.story)if("survey"===t.story.type){var n=t.locale.pick,r=n(t.story.details.text),s=l.extract(r),i=e.userAnswers;o.each(s,function(e,t){o.each(e,function(e,t){e.checked&&(i&&void 0!==i[e.list]||(i=o.decoupleSet(i,[e.list],e.key)))})}),e.userAnswers=i}else"task-list"===t.story.type&&(e.userAnswers=null)},isCurrentUserAuthor:function(){var e=this.props.story.user_ids,t=this.props.currentUser.id;return o.includes(e,t)},hasUserVoted:function(){if(null!==this.props.reactions){return!!C(this.props.reactions,this.props.currentUser)}},canUserVote:function(){return"read-write"===this.props.access},componentDidUpdate:function(e){if(this.props.reactions!==e.reactions&&this.state.voteSubmitted){C(e.reactions,e.currentUser)&&this.setState({voteSubmitted:!1})}},render:function(){return i.createElement("div",{className:"story-contents"},this.renderText(),this.renderAudioPlayer(),this.renderMedia(),this.renderReferencedMediaDialog(),this.renderAppComponents(),this.renderButtons())},renderText:function(){var e=this.props.story;switch(this.resourcesReferenced=[],e.type){case"post":return this.renderStoryText();case"task-list":return this.renderTaskListText();case"survey":return this.renderSurveyText();case"repo":return this.renderRepoText();case"member":return this.renderMemberText();case"push":case"merge":return this.renderPushText();case"branch":case"tag":return this.renderBranchText();case"issue":return e.details.exported?this.renderStoryText():this.renderIssueText();case"merge-request":return this.renderMergeRequestText();case"milestone":return this.renderMilestoneText();case"wiki":return this.renderWikiText()}},renderStoryText:function(){var e,t=this.props.locale.pick,n=this.props.story,r=o.trimEnd(t(n.details.text));return n.details.labels&&(e=this.renderLabels()),r||e?n.details.markdown?i.createElement("div",{className:"text story markdown",onClick:this.handleMarkdownClick},u.render(r,this.handleReference),e):i.createElement("div",{className:"text story plain-text"},i.createElement("p",null,d.renderEmoji(r)),e):null},renderTaskListText:function(){var e=this.props.locale.pick,t=this.props.story,n=o.trimEnd(e(t.details.text));if(!n)return null;var r=this.state.userAnswers,s=this.isCurrentUserAuthor()?this.handleTaskListItemChange:null,a=this.handleReference;if(t.details.markdown){var c=u.renderTaskList(n,r,s,a);return i.createElement("div",{className:"text task-list markdown",onClick:this.handleMarkdownClick},c)}var c=d.renderTaskList(n,r,s);return i.createElement("div",{className:"text task-list plain-text"},i.createElement("p",null,c))},renderSurveyText:function(){var e=this.props.locale.pick,t=this.props.story,n=o.trimEnd(e(t.details.text));if(!n)return null;var r=this.handleSurveyItemChange,s=this.handleReference;if(this.canUserVote()&&!this.hasUserVoted()){var a=this.state.userAnswers;if(t.details.markdown){var c=u.renderSurvey(n,a,r,s);return i.createElement("div",{className:"text survey markdown",onClick:this.handleMarkdownClick},c)}var c=d.renderSurvey(n,a,r);return i.createElement("div",{className:"text survey plain-text"},i.createElement("p",null,c))}var l=E(this.props.reactions)||{};if(t.details.markdown){var p=u.renderSurveyResults(n,l,s);return i.createElement("div",{className:"text survey markdown",onClick:this.handleMarkdownClick},p)}var p=d.renderSurveyResults(n,l);return i.createElement("div",{className:"text survey plain-text"},i.createElement("p",null,p))},renderRepoText:function(){var e=this.props.locale.translate,t=this.props.locale.pick,n=this.props.story,r=this.getAuthorName(),s=n.details.action,a=this.props.repo,c=t(o.get(a,"details.title"))||o.get(a,"name"),l=o.get(a,"details.web_url");return i.createElement("div",{className:"text repo"},i.createElement("p",null,i.createElement("a",{href:l,target:"_blank"},e("story-$name-"+s+"-$repo",r,c))))},renderMemberText:function(){var e=this.props.locale.translate,t=this.props.locale.pick,n=this.props.story,r=this.getAuthorName(),s=n.details.action,a=this.props.repo,c=t(o.get(a,"details.title"))||o.get(a,"name"),l=o.get(a,"details.web_url");return i.createElement("div",{className:"text member"},i.createElement("p",null,i.createElement("a",{href:l,target:"_blank"},e("story-$name-"+s+"-$repo",r,c))))},renderIssueText:function(){var e,t,n=this.props.locale.translate,r=this.props.locale.pick,s=this.props.story,o=this.getAuthorName(),a=s.details.title,c=this.props.repo,l=h.findLinkByRelations(this.props.story,"issue");if(m.canAccessRepo(this.props.currentUser,c)&&l){var u=l.issue.number;e=c.details.web_url+"/issues/"+u,t=l.type}var d=l?l.issue.number:"";return i.createElement("div",{className:"text issue"},i.createElement("p",null,i.createElement("a",{href:e,target:t},n("story-$name-opened-issue-$number-$title",o,d,r(a)))),this.renderStatus(),this.renderLabels())},renderMilestoneText:function(){var e,t=this.props.locale.translate,n=this.props.locale.pick,r=this.props.story,s=this.getAuthorName(),o=this.props.repo,a=r.details.title;if(m.canAccessRepo(this.props.currentUser,o)){var c=h.findLinkByRelations(this.props.story,"milestone");c&&(e=o.details.web_url+"/milestones/"+c.milestone.id)}return i.createElement("div",{className:"text milestone"},i.createElement("p",null,i.createElement("a",{href:e,target:"_blank"},t("story-$name-created-$milestone",s,n(a)))))},renderMergeRequestText:function(){var e,t=this.props.locale.translate,n=(this.props.locale.pick,this.props.story),r=this.getAuthorName(),s=this.props.repo,a=o.get(n,"details.source_branch"),c=o.get(n,"details.branch");if(m.canAccessRepo(this.props.currentUser,s)){var l=h.findLinkByRelations(this.props.story,"merge_request");l&&(e=s.details.web_url+"/merge_requests/"+l.merge_request.id)}return i.createElement("div",{className:"text merge-request"},i.createElement("p",null,i.createElement("a",{href:e,target:"_blank"},t("story-$name-requested-merge-$branch1-into-$branch2",r,a,c))),this.renderStatus(),this.renderLabels())},renderWikiText:function(){var e=this.props.locale.translate,t=this.props.story,n=this.getAuthorName(),r=t.details.url,s=o.capitalize(t.details.title),a=t.details.action+"d";return"deleted"===a&&(r=void 0),i.createElement("div",{className:"text wiki"},i.createElement("p",null,i.createElement("a",{href:r,target:"_blank"},e("story-$name-"+a+"-$page",n,s))))},renderPushText:function(){var e,t=this.props.locale.translate,n=this.props.locale.pick,r=this.props.story,s=this.getAuthorName(),a=(o.get(this.props.story,"details.commit_ids.length"),this.props.repo),c=n(o.get(a,"details.title"))||o.get(a,"name"),l=r.details.branch;if(m.canAccessRepo(this.props.currentUser,a)){var u=r.details.commit_before,d=r.details.commit_after;e=u?a.details.web_url+"/compare/"+u+"..."+d:a.details.web_url+"/commit/"+d}var p;if("push"===r.type)p=t("story-$name-pushed-to-$branch-of-$repo",s,l,c);else if("merge"===r.type){var h=r.details.source_branches;p=t("story-$name-merged-$branches-into-$branch-of-$repo",s,h,l,c)}return i.createElement("div",{className:"text push"},i.createElement("p",null,i.createElement("a",{href:e,target:"_blank"},p)),this.renderChanges())},renderBranchText:function(){var e,t=this.props.locale.translate,n=this.props.locale.pick,r=this.props.story,s=this.getAuthorName(),a=this.props.repo,c=n(o.get(a,"details.title"))||o.get(a,"name"),l=r.details.branch;m.canAccessRepo(this.props.currentUser,a)&&("branch"===r.type?e=a.details.web_url+"/commits/"+l:"tag"===r.type&&(e=a.details.web_url+"/tags/"+l));var u;return"branch"===r.type?u=t("story-$name-created-$branch-in-$repo",s,l,c):"tag"===r.type&&(u=t("story-$name-created-$tag-in-$repo",s,l,c)),i.createElement("div",{className:"text push"},i.createElement("p",null,i.createElement("a",{href:e,target:"_blank"},u)),this.renderChanges())},renderChanges:function(){var e=this.props.locale.translate,t=o.get(this.props.story,"details.files");if(o.isEmpty(t))return null;var n=["added","deleted","modified","renamed"],r=o.transform(n,function(n,r,s){var o=t[r];o>0&&n.push(i.createElement("li",{key:s,className:r},e("story-push-"+r+"-$count-files",o)))},[]),s=o.get(this.props.story,"details.lines"),a=["added","deleted","modified"],c=o.transform(a,function(t,n,r){var o=s[n];o>0&&t.push(i.createElement("li",{key:r,className:n},e("story-push-"+n+"-$count-lines",o)))},[]);return i.createElement("div",null,i.createElement("ul",{className:"files"},r),i.createElement("ul",{className:"lines"},c))},renderStatus:function(){var e=this.props.locale.translate,t=this.props.story.details.state;return t?i.createElement("p",{className:"status-"+t},i.createElement("span",null,e("story-issue-current-status"))," ",i.createElement("span",null,e("story-issue-status-"+t))):null},renderLabels:function(){var e=o.sortBy(this.props.story.details.labels);if(o.isEmpty(e))return null;for(var t=this.props.repo,n=o.map(e,function(e,n){var r;if(t){var s=o.indexOf(t.details.labels,e),a=o.get(t.details.label_colors,s);a&&(r={backgroundColor:a})}return i.createElement("span",{key:n,className:"tag",style:r},e)}),r=1;r<n.length;r+=2)n.splice(r,0," ");return i.createElement("p",{className:"tags"},n)},renderButtons:function(){if("survey"!==this.props.story.type)return null;if(!this.canUserVote())return null;if(!1!==this.hasUserVoted())return null;var e=this.props.locale.translate,t={label:e("story-vote-submit"),emphasized:!o.isEmpty(this.state.userAnswers),disabled:this.state.voteSubmitted||o.isEmpty(this.state.userAnswers),onClick:this.handleVoteSubmitClick};return i.createElement("div",{className:"buttons"},i.createElement(k,t))},renderAudioPlayer:function(){if(!this.state.audioURL)return null;var e={ref:this.components.setters.audioPlayer,src:this.state.audioURL,autoPlay:!0,controls:!0,onEnded:this.handleAudioEnded};return i.createElement("audio",e)},renderMedia:function(){var e=o.get(this.props.story,"details.resources");if(o.isEmpty(this.resourcesReferenced)||(e=o.difference(e,this.resourcesReferenced)),o.isEmpty(e))return null;var t={locale:this.props.locale,theme:this.props.theme,resources:e,width:Math.min(512,screen.width)};return i.createElement(b,t)},renderReferencedMediaDialog:function(){if(!this.state.renderingReferencedMediaDialog)return null;var e=this.props.story.details.resources,t=u.findReferencedResource(e,this.state.selectedResourceName);if(!t)return null;var n=_(this.resourcesReferenced),r=o.indexOf(n,t);if(-1===r)return null;var s={show:this.state.showingReferencedMediaDialog,resources:n,selectedIndex:r,locale:this.props.locale,theme:this.props.theme,onClose:this.handleReferencedMediaDialogClose};return i.createElement(y,s)},renderAppComponents:function(){var e=this.props.locale.translate,t=(o.get(this.props.story,"type"),o.get(this.props.story,"details.components"));return o.isEmpty(t)?null:(t=S(t,this.props.locale),i.createElement("div",{className:"impact"},i.createElement("p",{className:"message"},e("story-push-components-changed")),i.createElement(x,null,o.map(t,this.renderAppComponent)),this.renderAppComponentDialog()))},renderAppComponent:function(e,t){var n={component:e,locale:this.props.locale,theme:this.props.theme,onSelect:this.handleComponentSelect};return i.createElement(j,s({key:t},n))},renderAppComponentDialog:function(){if(!this.state.renderingComponentDialog)return null;var e={show:this.state.showingComponentDialog,component:this.state.selectedComponent,locale:this.props.locale,theme:this.props.theme,onClose:this.handleComponentDialogClose};return i.createElement(w,e)},triggerChangeEvent:function(e){this.props.onChange&&this.props.onChange({type:"change",target:this,story:e})},triggerReactionEvent:function(e){this.props.onReaction&&this.props.onReaction({type:"reaction",target:this,reaction:e})},handleReference:function(e){var t=this.props.story.details.resources,r=u.findReferencedResource(t,e.name);if(r){var s,o=this.props.theme;return s=e.forImage?"audio"===r.type?n("../node_modules/file-loader/index.js!../assets/speaker.svg")+"#"+encodeURI(r.url):o.getImageURL(r,{height:24}):o.getURL(r),this.resourcesReferenced.push(r),{href:s,title:e.name}}},handleMarkdownClick:function(e){var t=e.target;t.viewportElement&&(t=t.viewportElement);var n;if("svg"===t.tagName){var s=t.getElementsByTagName("title")[0];s&&(n=s.textContent)}else n=e.target.title;if(n){var o=this.props.story.details.resources,i=u.findReferencedResource(o,n);if(i)if("image"===i.type||"video"===i.type)this.setState({selectedResourceName:n,renderingReferencedMediaDialog:!0,showingReferencedMediaDialog:!0});else if("website"===i.type)window.open(i.url,"_blank");else if("audio"===i.type){var a=r(i),c=this.props.theme.getAudioURL(i,{version:a});this.setState({audioURL:c})}}else if("IMG"===t.tagName){var l=(t.getAttribute("src"),t.getBoundingClientRect()),d=t.naturalWidth+50,p=t.naturalHeight+50,h=l.left+window.screenLeft,m=l.top+window.screenTop;window.open(t.src,"_blank","width="+d+",height="+p+",left="+h+",top="+m+"status=no,menubar=no")}},handleTaskListItemChange:function(e){var t=this,n=e.currentTarget,r=parseInt(n.name),s=parseInt(n.value),i=n.checked,a=o.decoupleSet(this.state.userAnswers,[r,s],i);this.setState({userAnswers:a});var c=o.cloneDeep(this.props.story),u=[];c.details.text=o.mapValues(c.details.text,function(e){var t=l.extract(e);l.set(t,r,s,i);var n=l.count(t,!1);return u.push(n),l.join(t)}),c.unfinished_tasks=o.max(u),this.triggerChangeEvent(c);var d={list:r,item:s};if(i){var p={type:"task-completion",story_id:c.id,user_id:this.props.currentUser.id,published:!0,public:!0,details:{task:d}};this.triggerReactionEvent(p)}else{var p=o.find(this.props.reactions,function(e){if("task-completion"===e.type&&e.user_id===t.props.currentUser.id)return o.isEqual(e.details.task,d)});p&&(p=o.clone(p),p.deleted=!0,this.triggerReactionEvent(p))}},handleSurveyItemChange:function(e){var t=e.currentTarget,n=t.name,r=t.value,s=o.decoupleSet(this.state.userAnswers,[n],r);this.setState({userAnswers:s})},handleVoteSubmitClick:function(e){var t=this.props.story,n={type:"vote",story_id:t.id,user_id:this.props.currentUser.id,published:!0,public:!0,details:{answers:this.state.userAnswers}};this.triggerReactionEvent(n),this.setState({voteSubmitted:!0})},handleComponentSelect:function(e){this.setState({renderingComponentDialog:!0,showingComponentDialog:!0,selectedComponent:e.component})},handleComponentDialogClose:function(e){var t=this;this.setState({showingComponentDialog:!1},function(){setTimeout(function(){t.state.showingComponentDialog||t.setState({renderingComponentDialog:!1,selectedComponent:null})},500)})},handleReferencedMediaDialogClose:function(e){var t=this;this.setState({showingReferencedMediaDialog:!1},function(){setTimeout(function(){t.state.showingReferencedMediaDialog||t.setState({renderingReferencedMediaDialog:!1,selectedResourceURL:null})},500)})},handleAudioEnded:function(e){this.setState({audioURL:null})}});var E=c(function(e){var t={};return o.each(e,function(e){"vote"===e.type&&o.forIn(e.details.answers,function(e,n){var r=[n,"total"],s=o.get(t,r,0)+1;o.set(t,r,s);var i=[n,"answers",e],a=o.get(t,i,0)+1;o.set(t,i,a)})}),t}),C=c(function(e,t){return t?o.find(e,{type:"vote",user_id:t.id}):null}),_=c(function(e){return o.filter(e,function(e){switch(e.type){case"image":case"video":return!0}})}),S=c(function(e,t){var n=t.pick;return o.sortBy(e,function(e){return o.toLower(n(e.text))})})},"./views/story-contents.scss":function(e,t){},"./views/story-view-options.jsx":function(e,t,n){"use strict";var r=n("../../common/node_modules/lodash/lodash.js"),s=n("../../common/node_modules/react/react.js"),o=s.PropTypes,i=n("../../common/src/objects/utils/user-utils.js"),a=n("../../common/src/data/database.js"),c=n("../../common/src/routing/route.js"),l=n("../../common/src/locale/locale.js"),u=n("../../common/src/theme/theme.js"),d=n("./widgets/option-button.jsx"),p=n("./dialogs/user-selection-dialog-box.jsx"),h=n("./dialogs/issue-dialog-box.jsx");n("./views/story-view-options.scss"),e.exports=s.createClass({displayName:"StoryViewOptions",propTypes:{section:o.oneOf(["main","both"]),access:o.oneOf(["read-only","read-comment","read-write"]).isRequired,story:o.object.isRequired,reactions:o.arrayOf(o.object),repos:o.arrayOf(o.object),currentUser:o.object.isRequired,options:o.object.isRequired,database:o.instanceOf(a).isRequired,route:o.instanceOf(c).isRequired,locale:o.instanceOf(l).isRequired,theme:o.instanceOf(u).isRequired,onChange:o.func,onComplete:o.func},getDefaultProps:function(){return{section:"both"}},getInitialState:function(){return{selectingRecipients:!1,renderingRecipientDialogBox:!1,enteringIssueDetails:!1,renderingIssueDialogBox:!1}},render:function(){this.props.locale.translate;return s.createElement("div",{className:"story-view-options"},this.renderButtons("main"))},renderButtons:function(e){var t=this.props.locale.translate,n=this.props.options,o=this.props.access,a=this.props.currentUser,c=this.props.story,l=this.props.repos;if("main"===e){var u;if(void 0===n.keepBookmark){var p=!!a&&r.includes(n.bookmarkRecipients,a.id);u={label:t("option-add-bookmark"),selected:p,hidden:!i.canCreateBookmark(a,c,o),onClick:this.handleAddBookmarkClick}}else u={label:t("option-keep-bookmark"),selected:n.keepBookmark,onClick:this.handleKeepBookmarkClick};var h=a?r.without(n.bookmarkRecipients,a.id):[],m={label:r.isEmpty(h)?t("option-send-bookmarks"):t("option-send-bookmarks-to-$count-users",r.size(h)),hidden:!i.canSendBookmarks(a,c,o),selected:!r.isEmpty(h)||this.state.selectingRecipients,onClick:this.handleSendBookmarkClick},f={label:t("option-add-issue"),hidden:!i.canAddIssue(a,c,l,o),selected:!!n.issueDetails||this.state.enteringIssueDetails,onClick:this.handleAddIssueClick},g={label:t("option-hide-story"),hidden:!i.canHideStory(a,c,o),selected:n.hideStory,onClick:this.handleHideClick},v={label:t("option-edit-post"),hidden:!i.canEditStory(a,c,o),selected:n.editStory,onClick:this.handleEditClick},b={label:t("option-remove-story"),hidden:!i.canRemoveStory(a,c,o),selected:n.removeStory,onClick:this.handleRemoveClick},y={label:t("option-bump-story"),hidden:!i.canBumpStory(a,c,o),selected:n.bumpStory,onClick:this.handleBumpClick};return s.createElement("div",{className:e},s.createElement(d,u),s.createElement(d,m),s.createElement(d,f),s.createElement(d,g),s.createElement(d,v),s.createElement(d,b),s.createElement(d,y),this.renderRecipientDialogBox(),this.renderIssueDialogBox())}},renderRecipientDialogBox:function(){if(!this.state.renderingRecipientDialogBox)return null;var e={show:this.state.selectingRecipients,selection:this.props.options.bookmarkRecipients,database:this.props.database,route:this.props.route,locale:this.props.locale,theme:this.props.theme,onSelect:this.handleRecipientsSelect,onCancel:this.handleRecipientsCancel};return s.createElement(p,e)},renderIssueDialogBox:function(){if(!this.state.renderingIssueDialogBox)return null;var e={show:this.state.enteringIssueDetails,allowDeletion:!r.some(this.props.reactions,{type:"assignment "}),story:this.props.story,issue:this.props.options.issueDetails,repos:this.props.repos,locale:this.props.locale,theme:this.props.theme,onConfirm:this.handleIssueConfirm,onCancel:this.handleIssueCancel};return s.createElement(h,e)},triggerChangeEvent:function(e){this.props.onChange&&this.props.onChange({type:"change",target:this,options:e})},triggerCompleteEvent:function(){this.props.onComplete&&this.props.onComplete({type:"complete",target:this})},openSelectionDialogBox:function(e){this.state.selectingRecipients||this.setState({selectingRecipients:!0,renderingRecipientDialogBox:!0})},closeSelectionDialogBox:function(){var e=this;this.state.selectingRecipients&&(this.setState({selectingRecipients:!1}),setTimeout(function(){e.state.selectingRecipients||e.setState({renderingRecipientDialogBox:!1})},500))},openIssueDialogBox:function(e){this.state.enteringIssueDetails||this.setState({enteringIssueDetails:!0,renderingIssueDialogBox:!0})},closeIssueDialogBox:function(){var e=this;this.state.enteringIssueDetails&&(this.setState({enteringIssueDetails:!1}),setTimeout(function(){e.state.enteringIssueDetails||e.setState({renderingIssueDialogBox:!1})},500))},handleAddBookmarkClick:function(e){var t=r.clone(this.props.options),n=this.props.currentUser.id;r.includes(t.bookmarkRecipients,n)?t.bookmarkRecipients=r.difference(t.bookmarkRecipients,[n]):t.bookmarkRecipients=r.union(t.bookmarkRecipients,[n]),this.triggerChangeEvent(t),this.triggerCompleteEvent()},handleKeepBookmarkClick:function(e){var t=r.clone(this.props.options);this.props.currentUser.id;t.keepBookmark=!1,this.triggerChangeEvent(t),this.triggerCompleteEvent()},handleSendBookmarkClick:function(e){this.openSelectionDialogBox(e)},handleAddIssueClick:function(e){this.openIssueDialogBox(e)},handleHideClick:function(e){var t=r.clone(this.props.options);t.hideStory=!t.hideStory,this.triggerChangeEvent(t),this.triggerCompleteEvent()},handleEditClick:function(e){var t=r.clone(this.props.options);t.editStory=!0,this.triggerChangeEvent(t),this.triggerCompleteEvent()},handleRemoveClick:function(e){var t=r.clone(this.props.options);t.removeStory=!0,this.triggerChangeEvent(t),this.triggerCompleteEvent()},handleBumpClick:function(e){var t=r.clone(this.props.options);t.bumpStory=!0,this.triggerChangeEvent(t),this.triggerCompleteEvent()},handleRecipientsSelect:function(e){var t=r.clone(this.props.options);t.bookmarkRecipients=e.selection,this.triggerChangeEvent(t),this.triggerCompleteEvent(),this.closeSelectionDialogBox()},handleRecipientsCancel:function(e){this.triggerCompleteEvent(),this.closeSelectionDialogBox()},handleIssueConfirm:function(e){var t=r.clone(this.props.options);t.issueDetails=e.issue,this.triggerChangeEvent(t),this.triggerCompleteEvent(),this.closeIssueDialogBox()},handleIssueCancel:function(e){this.triggerCompleteEvent(),this.closeIssueDialogBox()}})},"./views/story-view-options.scss":function(e,t){},"./views/story-view.jsx":function(e,t,n){"use strict";var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s=n("../../common/node_modules/lodash/lodash.js"),o=n("../../common/node_modules/react/react.js"),i=o.PropTypes,a=n("../../common/node_modules/moment/moment.js"),c=n("../../common/src/utils/memoize.js"),l=n("../../common/src/utils/component-refs.js"),u=n("../../common/src/utils/focus-manager.js"),d=n("../../common/src/objects/utils/external-data-utils.js"),p=n("../../common/src/objects/utils/issue-utils.js"),h=n("../../common/src/objects/utils/story-utils.js"),m=n("../../common/src/utils/random-token.js"),f=n("../../common/src/data/database.js"),g=n("../../common/src/transport/payloads.js"),v=n("../../common/src/routing/route.js"),b=n("../../common/src/locale/locale.js"),y=n("../../common/src/theme/theme.js"),j=n("../../common/src/mixins/update-check.js"),w=n("./widgets/profile-image.jsx"),x=n("./widgets/author-names.jsx"),k=n("./widgets/story-progress.jsx"),E=n("./widgets/story-emblem.jsx"),C=(n("./widgets/scrollable.jsx"),n("./widgets/reaction-toolbar.jsx")),_=n("./lists/reaction-list.jsx"),S=n("./widgets/header-button.jsx"),R=n("./views/story-contents.jsx"),N=n("./views/story-view-options.jsx"),O=n("./widgets/corner-pop-up.jsx");n("./views/story-view.scss");e.exports=o.createClass({displayName:"StoryView",mixins:[j],propTypes:{access:i.oneOf(["read-only","read-comment","read-write"]).isRequired,highlighting:i.bool,pending:i.bool,story:i.object.isRequired,bookmark:i.object,authors:i.arrayOf(i.object),reactions:i.arrayOf(i.object),respondents:i.arrayOf(i.object),recommendations:i.arrayOf(i.object),recipients:i.arrayOf(i.object),repos:i.arrayOf(i.object),currentUser:i.object.isRequired,selectedReactionId:i.number,database:i.instanceOf(f).isRequired,payloads:i.instanceOf(g).isRequired,route:i.instanceOf(v).isRequired,locale:i.instanceOf(b).isRequired,theme:i.instanceOf(y).isRequired,onBump:i.func},getInitialState:function(){this.components=l({reactionContainer:HTMLDivElement,reactionList:_,mainPopUp:O});var e={options:T,commentsExpanded:this.shouldExpandComments(this.props),isTall:!1};return this.updateOptions(e,this.props),e},getClassName:function(){var e="story-view";return this.props.highlighting&&(e+=" highlighting"),e},hasUserDraft:function(){var e=this;return s.some(this.props.reactions,function(t){if(!t.published&&t.user_id===e.props.currentUser.id)return!0})},shouldExpandComments:function(e){if(e.reactions&&e.respondents){var t=s.get(this.props.currentUser,"id");return!!s.includes(e.story.user_ids,t)||(!!s.some(e.reactions,{user_id:t})||!(!e.selectedReactionId||!s.some(e.reactions,{id:e.selectedReactionId})))}},componentWillReceiveProps:function(e){var t=s.clone(this.state);this.props.story===e.story&&this.props.recommendations===e.recommendations||this.updateOptions(t,e),this.props.reactions===e.reactions&&this.props.respondents===e.respondents||!0!==t.commentsExpanded&&this.shouldExpandComments(e)&&(t.commentsExpanded=!0);var n=s.shallowDiff(t,this.state);s.isEmpty(n)||this.setState(n)},updateOptions:function(e,t){var n=e.options=s.clone(e.options);n.hideStory=!t.story.public,n.bookmarkRecipients=s.map(t.recommendations,"target_user_id"),n.issueDetails=p.extractIssueDetails(t.story,t.repos),n.keepBookmark=!!t.bookmark||void 0},render:function(){switch(this.props.theme.mode){case"single-col":return this.renderSingleColumn();case"double-col":return this.renderDoubleColumn();case"triple-col":return this.renderTripleColumn()}},renderSingleColumn:function(){var e=this.renderReactionToolbar(),t=this.renderReactionLink(),n=!1;return(e||t)&&(n=!0,e||(e="Â ")),o.createElement("div",{className:this.getClassName()},o.createElement("div",{className:"header"},o.createElement("div",{className:"column-1 padded"},this.renderProfileImage(),this.renderAuthorNames(),this.renderPopUpMenu("main"))),o.createElement("div",{className:"body"},o.createElement("div",{className:"column-1 padded"},this.renderProgress(),this.renderEmblem(),this.renderContents())),o.createElement("div",{className:"header"},o.createElement("div",{className:"column-2"+(n?" padded":"")},e,t)),o.createElement("div",{className:"body"},o.createElement("div",{className:"column-2"},this.renderReactions())))},renderDoubleColumn:function(){return o.createElement("div",{className:this.getClassName()},o.createElement("div",{className:"header"},o.createElement("div",{className:"column-1 padded"},this.renderProfileImage(),this.renderAuthorNames(),this.renderPopUpMenu("main")),o.createElement("div",{className:"column-2 padded"},this.renderReactionToolbar())),o.createElement("div",{className:"body"},o.createElement("div",{className:"column-1 padded"},this.renderProgress(),this.renderEmblem(),this.renderContents()),o.createElement("div",{className:"column-2"},this.renderReactions())))},renderTripleColumn:function(){var e=this.props.locale.translate;return o.createElement("div",{className:this.getClassName()},o.createElement("div",{className:"header"},o.createElement("div",{className:"column-1 padded"},this.renderProfileImage(),this.renderAuthorNames()),o.createElement("div",{className:"column-2 padded"},this.renderReactionToolbar()),o.createElement("div",{className:"column-3 padded"},o.createElement(S,{icon:"chevron-circle-right",label:e("story-options"),disabled:!0}))),o.createElement("div",{className:"body"},o.createElement("div",{className:"column-1 padded"},this.renderProgress(),this.renderEmblem(),this.renderContents()),o.createElement("div",{className:"column-2"},this.renderReactions()),o.createElement("div",{className:"column-3 padded"},this.renderOptions())))},renderProfileImage:function(){var e=s.get(this.props.authors,0),t={user:e,theme:this.props.theme,size:"medium"};return e&&(t.href=this.props.route.find(n("./pages/people-page.jsx"),{schema:this.props.route.parameters.schema,user:e.id})),o.createElement(w,t)},renderAuthorNames:function(){var e={authors:this.props.authors,locale:this.props.locale,theme:this.props.theme};return o.createElement(x,e)},renderReactionToolbar:function(){var e=this.props.access;if("read-comment"!==e&&"read-write"!==e)return null;var t={access:e,currentUser:this.props.currentUser,reactions:this.props.reactions,respondents:this.props.respondents,locale:this.props.locale,theme:this.props.theme,disabled:!h.isSaved(this.props.story),onAction:this.handleAction};return o.createElement(C,t)},renderReactionLink:function(){var e=s.size(this.props.reactions);if(0===e)return null;if(this.state.commentsExpanded)return"Â ";var t=this.props.locale.translate;return o.createElement("span",{className:"reaction-link",onClick:this.handleExpansionClick},t("story-$count-reactions",e))},renderProgress:function(){var e;!1===this.props.story.ready&&(e=this.props.payloads.inquire(this.props.story));var t={status:e,story:this.props.story,pending:this.props.pending,locale:this.props.locale};return o.createElement(k,t)},renderEmblem:function(){var e={story:this.props.story};return o.createElement(E,e)},renderContents:function(){var e={access:this.props.access,story:this.props.story,authors:this.props.authors,currentUser:this.props.currentUser,reactions:this.props.reactions,repo:D(this.props.repos,this.props.story),locale:this.props.locale,theme:this.props.theme,onChange:this.handleStoryChange,onReaction:this.handleStoryReaction};return o.createElement(R,e)},renderReactions:function(){if(s.isEmpty(this.props.reactions))return null;if("single-col"===this.props.theme.mode&&!this.state.commentsExpanded)return null;var e=this.components.setters,t={access:this.props.access,story:this.props.story,reactions:this.props.reactions,respondents:this.props.respondents,repo:D(this.props.repos,this.props.story),currentUser:this.props.currentUser,database:this.props.database,payloads:this.props.payloads,route:this.props.route,locale:this.props.locale,theme:this.props.theme,selectedReactionId:this.props.selectedReactionId},n="scrollable";return this.state.isTall&&"single-col"!==this.props.theme.mode&&(n+=" abs"),o.createElement("div",{ref:e.reactionContainer,className:n},o.createElement(_,r({ref:e.reactionList},t)))},adjustReactionContainer:function(){if("single-col"!==this.props.theme.mode){var e=this.components.reactionContainer;if(e){var t=e.parentNode;if(!P){var n=getComputedStyle(e);P=parseInt(n.maxHeight)}var r=t.offsetHeight>P;this.state.isTall!==r&&this.setState({isTall:r})}}},renderPopUpMenu:function(e){var t=this.components.setters[e+"PopUp"];return o.createElement(O,{ref:t},this.renderOptions(e))},renderOptions:function(e){var t={section:e,access:this.props.access,story:this.props.story,reactions:this.props.reactions,repos:this.props.repos,currentUser:this.props.currentUser,options:this.state.options,database:this.props.database,route:this.props.route,locale:this.props.locale,theme:this.props.theme,onChange:this.handleOptionsChange,onComplete:this.handleOptionsComplete};return o.createElement(N,t)},componentDidMount:function(){this.adjustReactionContainer()},componentDidUpdate:function(e,t){this.adjustReactionContainer()},saveStory:function(e,t){var n=this,r=this.props.route.parameters,o={delay:t?void 0:2e3,onConflict:function(e){h.mergeRemoteChanges(e.local,e.remote,original)&&e.preventDefault()}},i=this.props.database.use({schema:r.schema,by:this});return i.start().then(function(){var t=!h.isSaved(e),r=n.state.options.bookmarkRecipients;return i.saveOne({table:"story"},e,o).then(function(e){return t&&!s.isEmpty(r)?n.sendBookmarks(e,r).then(function(t){return e}):e})})},removeStory:function(e){var t=this.props.route.parameters;return this.props.database.use({schema:t.schema,by:this}).removeOne({table:"story"},e)},saveReaction:function(e){var t=this.props.route.parameters,n=this.props.database.use({schema:t.schema,by:this});return n.start().then(function(){return n.saveOne({table:"reaction"},e)})},removeReaction:function(e){var t=this.props.route.parameters,n=this.props.database.use({schema:t.schema,by:this});return n.start().then(function(){return n.removeOne({table:"reaction"},e)})},saveBookmarks:function(e){if(s.isEmpty(e))return Promise.resolve([]);var t=this.props.route.parameters,n=this.props.database.use({schema:t.schema,by:this});return n.start().then(function(){return n.save({table:"bookmark"},e)})},removeBookmarks:function(e){if(s.isEmpty(e))return Promise.resolve([]);var t=this.props.route.parameters,n=this.props.database.use({schema:t.schema,by:this});return n.start().then(function(){return n.remove({table:"bookmark"},e)})},sendBookmarks:function(e,t){var n=this,r=this.props.recommendations,o=[];s.each(t,function(t){if(!s.some(r,{target_user_id:t})){var i={story_id:e.published_version_id||e.id,user_ids:[n.props.currentUser.id],target_user_id:t};o.push(i)}});var i=[];return s.each(r,function(e){s.includes(t,e.target_user_id)||i.push(e)}),this.saveBookmarks(o).then(function(e){return n.removeBookmarks(i).then(function(t){return s.concat(e,t)})})},sendTask:function(e,t){var n={action:e,options:t,user_id:this.props.currentUser.id,token:m.generate()},r=this.props.route.parameters,s=this.props.database.use({schema:r.schema,by:this});return s.start().then(function(){return s.saveOne({table:"task"},n)})},setOptions:function(e){var t=this,n=this.state.options;this.setState({options:e},function(){var r=t.props.story;if(e.editStory&&!n.editStory)if(r.id>1){var o=s.omit(r,"id","published","ptime");o.published_version_id=r.id,t.saveStory(o)}else{var i=s.clone(r);i.published=!1,t.saveStory(i)}if(e.removeStory&&!n.removeStory&&t.removeStory(r),e.bumpStory&&!n.bumpStory){var i=s.clone(r);i.bump=!0,i.btime=a().toISOString(),t.saveStory(i),t.props.onBump&&t.props.onBump({type:"bump",target:t})}if(e.hideStory!==n.hideStory){var i=s.clone(r);i.public=!e.hideStory,t.saveStory(i)}if(e.keepBookmark!==n.keepBookmark&&t.props.bookmark&&!e.keepBookmark&&t.removeBookmarks([t.props.bookmark]),!s.isEqual(e.issueDetails,n.issueDetails)){var c=s.clone(e.issueDetails)||{};c.story_id=r.id,t.sendTask("export-issue",c)}s.isEqual(e.bookmarkRecipients,n.bookmarkRecipients)||(h.isSaved(r)?t.sendBookmarks(t.props.story,e.bookmarkRecipients):t.saveStory(r))})},handleStoryChange:function(e){this.saveStory(e.story)},handleStoryReaction:function(e){e.reaction.deleted?this.removeReaction(e.reaction):this.saveReaction(e.reaction)},handleExpansionClick:function(e){this.setState({commentsExpanded:!0})},handleOptionsChange:function(e){this.setOptions(e.options);var t=e.target.props.section,n=this.components[t+"PopUp"];n&&n.close()},handleOptionsComplete:function(e){var t=e.target.props.section,n=this.components[t+"PopUp"];n&&n.close()},handleAction:function(e){switch(e.action){case"like-add":var t={type:"like",story_id:this.props.story.id,user_id:this.props.currentUser.id,published:!0,public:!0};this.saveReaction(t);break;case"like-remove":this.removeReaction(e.like);break;case"reaction-add":this.state.commentsExpanded||this.setState({commentsExpanded:!0});if(!s.some(this.props.reactions,{user_id:this.props.currentUser.id,published:!1})){var n={type:"comment",story_id:this.props.story.id,user_id:this.props.currentUser.id,details:{},published:!1,public:!0};this.saveReaction(n)}u.focus({type:"ReactionEditor",story_id:this.props.story.id,user_id:this.props.currentUser.id});break;case"reaction-expand":this.setState({commentsExpanded:!0})}}});var P,T={issueDetails:null,hideStory:!1,editStory:!1,removeStory:!1,bumpStory:!1,bookmarkRecipients:[],keepBookmark:void 0},D=c(function(e,t){return s.find(e,function(e){return!!d.findLinkByRelative(t,e,"project")})});c(function(e){var t=s.map(e,"user_id");return s.size(s.uniq(t))},0)},"./views/story-view.scss":function(e,t){},"./views/user-statistics.jsx":function(e,t,n){"use strict";function r(e){return e.format("YYYY-MM-DD")}function s(e){return c.createElement("div",{className:"item"},c.createElement("svg",{className:"ct-chart-bar",viewBox:"0 0 10 10",xmlns:"http://www.w3.org/2000/svg"},c.createElement("g",{className:"ct-series ct-series-"+e.series},c.createElement("line",{className:"ct-bar",x1:0,y1:5,x2:10,y2:5}))),c.createElement("span",{className:"label"},e.label))}function o(e){var t=Math.round(.75*e.columns)+"em";return e.scrollable?c.createElement("div",{className:"scroll-container-frame"},c.createElement("div",{className:"scroll-container"},c.createElement("div",{className:"scroll-container-contents",style:{width:t}},e.children))):e.children}var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a=n("../../common/node_modules/lodash/lodash.js"),c=n("../../common/node_modules/react/react.js"),l=c.PropTypes,u=n("../../common/src/widgets/chartist.jsx"),d=n("../../common/node_modules/moment/moment.js"),p=n("../../common/src/utils/memoize.js"),h=(n("../../common/src/utils/date-tracker.js"),n("../../common/src/objects/types/story-types.js")),m=n("../../common/src/routing/route.js"),f=n("../../common/src/locale/locale.js"),g=n("../../common/src/theme/theme.js"),v=n("../../common/src/mixins/update-check.js");n("./views/user-statistics.scss"),e.exports=c.createClass({displayName:"UserStatistics",mixins:[v],propTypes:{chartType:l.oneOf(["bar","line","pie"]),chartRange:l.oneOf(["biweekly","monthly","full"]),dailyActivities:l.object,selectedDate:l.string,today:l.string,user:l.object,route:l.instanceOf(m).isRequired,locale:l.instanceOf(f).isRequired,theme:l.instanceOf(g).isRequired},getDefaultProps:function(){return{chartRange:"biweekly"}},getInitialState:function(){var e={dates:[],labels:[],series:[],indices:[],upperRange:0,selectedDateIndex:-1};return this.updateSeries(e,this.props),e},componentWillReceiveProps:function(e){var t=a.shallowDiff(e,this.props);if(t.chartRange||t.dailyActivities||t.selectedDate||t.today){var n=a.clone(this.state);this.updateSeries(n,e),this.setState(n)}},updateSeries:function(e,t){var n=t.selectedDate||t.today,r=a.get(t.dailyActivities,"daily",{}),s=t.locale.localeCode,o=t.locale.translate;switch(t.chartRange){case"biweekly":var i=t.selectedDate?6:0;e.dates=_(n,i),e.labels=x(e.dates,s);break;case"monthly":e.dates=S(n),e.labels=k(e.dates,s);break;case"full":var c=a.get(t.dailyActivities,"range");e.dates=c?R(c.start,c.end):S(t.today),e.labels=E(e.dates,s)}var l="bar"===t.chartType;if(e.series=y(r,e.dates),e.upperRange=j(e.series,l),e.indices=b(r,e.dates),e.selectedDateIndex=a.indexOf(e.dates,n),t.selectedDate){var u=d(t.selectedDate);e.selectedDateLabel=u.locale(s).format("l")}else e.selectedDateLabel=o("user-statistics-today");var p=w(e.dates,s);e.tooltips=a.map(e.series,function(e){return a.map(e.data,function(t,n){return o("user-statistics-tooltip-$count-"+e.name,t)+"\n"+p[n]})})},render:function(){return c.createElement("div",{className:"user-statistics"},this.renderLegend(),this.renderChart())},renderLegend:function(){if(!this.props.chartType)return null;var e=this.props.locale.translate,t=a.map(this.state.indices,function(t,n){var r={series:String.fromCharCode("a".charCodeAt(0)+t),label:e("user-statistics-legend-"+n)};return c.createElement(s,i({key:t},r))});return a.isEmpty(t)&&(t="Â "),c.createElement("div",{className:"legend"},t)},renderChart:function(){switch(this.props.chartType){case"bar":return this.renderBarChart();case"line":return this.renderLineChart();case"pie":return this.renderPieChart();default:return null}},renderBarChart:function(){var e={type:"bar",data:{labels:this.state.labels,series:this.state.series},options:{stackBars:!0,chartPadding:{left:-25,right:30},high:this.state.upperRange,low:0},onDraw:this.handleChartDraw,onClick:this.handleChartClick};return c.createElement(o,{scrollable:"full"===this.props.chartRange,columns:this.state.dates.length},c.createElement(u,e))},renderLineChart:function(){var e={type:"line",data:{labels:this.state.labels,series:this.state.series},options:{fullWidth:!0,chartPadding:{left:-25,right:30},showPoint:!1,high:this.state.upperRange,low:0},onDraw:this.handleChartDraw};return c.createElement(o,{scrollable:"full"===this.props.chartRange,columns:this.state.dates.length},c.createElement(u,e))},renderPieChart:function(){var e={type:"pie",data:{series:a.map(this.state.series,function(e){return a.sum(e.data)})},options:{labelInterpolationFnc:function(e){if(e)return e}}};return c.createElement(u,e)},handleChartDraw:function(e){if("label"===e.type&&"y"===e.axis.units.pos)e.element.attr({x:e.axis.chartRect.width()+5});else if("grid"===e.type&&"x"===e.axis.units.pos){if(e.index===this.state.dates.length-1&&"bar"===this.props.chartType){var t=new u.Svg("line");t.attr({x1:e.x2+e.axis.stepLength,y1:e.y1,x2:e.x2+e.axis.stepLength,y2:e.y2,class:"ct-grid ct-vertical"}),e.group.append(t)}if("full"===this.props.chartRange){var n=this.state.labels[e.index];n&&e.element.addClass("month-start")}if(e.index===this.state.selectedDateIndex){var r=e.x2;"bar"===this.props.chartType&&(r+=.5*e.axis.stepLength);var s=e.y1+12,o=new u.Svg("text");o.text(this.state.selectedDateLabel),o.attr({x:r,y:s,"text-anchor":"middle",class:"date-label"}),e.group.append(o);var i=new u.Svg("text");i.text("ïƒ"),i.attr({x:r,y:s+8,"text-anchor":"middle",class:"date-arrow"}),e.group.append(i),e.label="Hello"}}else if("grid"===e.type&&"y"===e.axis.units.pos){if(e.index===e.axis.ticks.length-1){var n=e.group.querySelector(".date-label"),i=e.group.querySelector(".date-arrow");n&&e.group.append(n),i&&e.group.append(i)}}else if("bar"===e.type){var c=a.get(this.state.tooltips,[e.seriesIndex,e.index]),l=this.state.dates[e.index],d=new u.Svg("title");d.text(c),e.element.append(d),e.element.attr({"data-date":l})}},handleChartClick:function(e){var t=e.target.getAttribute("data-date");if(t){var r=this.props.route,s={schema:r.parameters.schema,user:this.props.user.id,date:t};r.push(n("./pages/people-page.jsx"),s)}}});var b=p(function(e,t){var n={};a.each(t,function(t){var r=e[t];a.forIn(r,function(e,t){e&&(n[t]=!0)})});var r={};return a.each(h,function(e,t){n[e]&&(r[e]=t)}),r}),y=p(function(e,t){return a.map(h,function(n){var r=!0,s=a.map(t,function(t){var s=a.get(e,[t,n],0);return s&&(r=!1),s});return r?[]:{name:n,data:s}})}),j=p(function(e,t){var n=0;if(t){var r=[];a.each(e,function(e){var t=e.data;a.each(t,function(e,t){r[t]=r[t]?r[t]+e:e})}),a.isEmpty(r)||(n=a.max(r))}else a.each(e,function(e){var t=e.data,r=a.max(t);r>n&&(n=r)});if(n<=17)return 20;if(n<=42)return 50;for(var s=100*Math.ceil(n/100);n/s>.85;)s+=100;return s}),w=p(function(e,t){return a.map(e,function(e){return d(e).locale(t).format("l")})}),x=p(function(e,t){return a.map(e,function(e){return d(e).locale(t).format("dd")})}),k=p(function(e,t){return a.map(e,function(e){var n=d(e);return n.date()%2==0?n.locale(t).format("D"):""})}),E=p(function(e,t){return a.map(e,function(e){var n=d(e);return 1===n.date()?n.locale(t).format("MMMM"):""})}),C=p(function(e,t){for(var n=d(e),s=d(t),o=[],i=n.clone();i<=s;){var a=r(i);o.push(a),i.add(1,"day")}return o},[],!1),_=p(function(e,t){var n=d(e).add(t,"day"),s=r(n),o=r(n.subtract(13,"day"));return C(o,s)},[],!1),S=p(function(e){var t=d(e).startOf("month"),n=r(t),s=r(d(e).endOf("month"));return C(n,s)},[],!1),R=p(function(e,t){return e=r(d(e).startOf("month")),t=r(d(t).endOf("month")),C(e,t)},[],!1)},"./views/user-statistics.scss":function(e,t){},"./views/user-view-options.jsx":function(e,t,n){"use strict";var r=n("../../common/node_modules/lodash/lodash.js"),s=n("../../common/node_modules/react/react.js"),o=s.PropTypes,i=n("../../common/src/locale/locale.js"),a=n("../../common/src/theme/theme.js"),c=n("./widgets/option-button.jsx"),l=n("./dialogs/telephone-number-dialog-box.jsx");n("./views/user-view-options.scss"),e.exports=s.createClass({displayName:"UserViewOptions",propTypes:{section:o.oneOf(["main","statistics","both"]),user:o.object,options:o.object.isRequired,locale:o.instanceOf(i).isRequired,theme:o.instanceOf(a).isRequired,onChange:o.func,onComplete:o.func},getDefaultProps:function(){return{section:"both"}},getInitialState:function(){return{showingPhoneDialog:!1,renderingPhoneDialog:!1}},render:function(){return"both"===this.props.section?s.createElement("div",{className:"user-view-options"},this.renderButtons("main"),s.createElement("div",{className:"border"}),this.renderButtons("statistics")):s.createElement("div",{className:"user-view-options"},this.renderButtons(this.props.section))},renderButtons:function(e){var t=this.props.locale.translate,n=r.get(this.props.user,"details",{});if("main"===e){var o={label:t("action-contact-by-phone"),icon:"phone-square",url:"tel:"+n.phone,hidden:!n.phone,onClick:this.handlePhoneClick},i={label:t("action-contact-by-email"),icon:"envelope",url:"mailto:"+n.email,hidden:!n.email,onClick:this.handleLinkClick},a={label:t("action-contact-by-skype"),icon:"skype",url:"skype:"+n.skype_username,hidden:!n.skype_username,onClick:this.handleLinkClick},l={label:t("action-contact-by-ichat"),icon:"apple",url:"ichat:"+n.ichat_username,hidden:!n.ichat_username,onClick:this.handleLinkClick},u={label:t("action-contact-by-twitter"),icon:"twitter",url:"https://twitter.com/"+n.twitter_username,target:"_blank",hidden:!n.twitter_username,onClick:this.handleLinkClick},d={label:t("action-view-gitlab-page"),icon:"gitlab",url:n.gitlab_url,target:"_blank",hidden:!n.gitlab_url,onClick:this.handleLinkClick},p={label:t("action-view-github-page"),icon:"github",url:n.github_url,target:"_blank",hidden:!n.github_url,onClick:this.handleLinkClick},h={label:t("action-view-linkedin-page"),icon:"linkedin",url:n.linkedin_url,target:"_blank",hidden:!n.linkedin_url,onClick:this.handleLinkClick},m={label:t("action-view-stackoverflow-page"),icon:"stack-overflow",url:n.stackoverflow_url,target:"_blank",hidden:!n.stackoverflow_url,onClick:this.handleLinkClick};return s.createElement("div",{className:e},s.createElement(c,o),s.createElement(c,i),s.createElement(c,a),s.createElement(c,l),s.createElement(c,u),s.createElement(c,d),s.createElement(c,p),s.createElement(c,h),s.createElement(c,m),this.renderPhoneDialog())}var f=this.props.options,g={label:t("option-statistics-biweekly"),selected:"biweekly"===f.chartRange||!f.chartRange,onClick:this.handleBiweeklyActivitiesClick},v={label:t("option-statistics-monthly"),selected:"monthly"===f.chartRange,onClick:this.handleMonthlyActivitiesClick},b={label:t("option-statistics-to-date"),selected:"full"===f.chartRange,onClick:this.handleActivitiesToDateClick};return s.createElement("div",{className:e},s.createElement(c,g),s.createElement(c,v),s.createElement(c,b))},renderPhoneDialog:function(){if(!this.state.renderingPhoneDialog)return null;var e={show:this.state.showingPhoneDialog,number:this.props.user.details.phone,locale:this.props.locale,onClose:this.handlePhoneDialogClose};return s.createElement(l,e)},triggerChangeEvent:function(e){var t=r.assign({},this.props.options,e);this.props.onChange&&this.props.onChange({type:"change",target:this,options:t})},triggerCompleteEvent:function(){this.props.onComplete&&this.props.onComplete({type:"complete",target:this})},handlePhoneClick:function(e){e.preventDefault(),this.setState({renderingPhoneDialog:!0,showingPhoneDialog:!0})},handlePhoneDialogClose:function(e){var t=this;this.setState({showingPhoneDialog:!1},function(){t.triggerCompleteEvent(),setTimeout(function(){t.state.showingPhoneDialog||t.setState({renderingPhoneDialog:!1})},500)})},handleBiweeklyActivitiesClick:function(e){var t=this.props.options.chartType||"bar";this.triggerChangeEvent({chartRange:"biweekly",chartType:t}),this.triggerCompleteEvent()},handleMonthlyActivitiesClick:function(e){var t=this.props.options.chartType||"bar";this.triggerChangeEvent({chartRange:"monthly",chartType:t}),this.triggerCompleteEvent()},handleActivitiesToDateClick:function(e){var t=this.props.options.chartType||"bar";this.triggerChangeEvent({chartRange:"full",chartType:t}),this.triggerCompleteEvent()},handleLinkClick:function(e){this.triggerCompleteEvent()}})},"./views/user-view-options.scss":function(e,t){},"./views/user-view.jsx":function(e,t,n){"use strict";var r=n("../../common/node_modules/lodash/lodash.js"),s=n("../../common/node_modules/react/react.js"),o=s.PropTypes,i=n("../../common/src/utils/component-refs.js"),a=n("../../common/src/utils/tag-scanner.js"),c=n("../../common/src/objects/utils/user-utils.js"),l=n("../../common/src/data/database.js"),u=n("../../common/src/routing/route.js"),d=n("../../common/src/locale/locale.js"),p=n("../../common/src/theme/theme.js"),h=n("../../common/src/mixins/update-check.js"),m=n("./widgets/profile-image.jsx"),f=n("./widgets/chart-toolbar.jsx"),g=n("./widgets/header-button.jsx"),v=n("./lists/user-activity-list.jsx"),b=n("./views/user-statistics.jsx"),y=n("./views/user-view-options.jsx"),j=n("./widgets/corner-pop-up.jsx");n("./views/user-view.scss"),e.exports=s.createClass({displayName:"UserView",mixins:[h],propTypes:{user:o.object,roles:o.arrayOf(o.object),stories:o.arrayOf(o.object),options:o.object.isRequired,dailyActivities:o.object,currentUser:o.object,selectedDate:o.string,today:o.string,link:o.oneOf(["user","team"]),database:o.instanceOf(l).isRequired,route:o.instanceOf(u).isRequired,locale:o.instanceOf(d).isRequired,theme:o.instanceOf(p).isRequired,onOptionChange:o.func},getInitialState:function(){return this.components=i({mainPopUp:j,statisticsPopUp:j}),{}},getChartType:function(){var e=this.props.options.chartType;return e||"single-col"!==this.props.theme.mode&&(e="bar"),e},getChartRange:function(){var e=this.props.options.chartRange;return e||(e="biweekly"),e},getStoryCountEstimate:function(){if(this.props.dailyActivities){var e,t=this.props.route.parameters;if(t.search){if(a.removeTags(t.search))return;e=a.findTags(t.search),r.isEmpty(e)&&(e=null)}var n,s=0;if(this.props.selectedDate){var o=this.props.dailyActivities.daily[this.props.selectedDate];n=o?[o]:[]}else n=r.values(this.props.dailyActivities.daily);return r.each(n,function(t){if(r.each(t,function(t,n){e&&!r.includes(e,n)||(s+=t)}),s>5)return!1}),Math.min(5,s)}},getUserPageURL:function(){if("user"!==this.props.link)return null;var e=this.props.route,t=r.pick(e.parameters,"schema","date","search");return t.user=this.props.user.id,e.find(n("./pages/people-page.jsx"),t)},getTeamPageURL:function(){if("team"!==this.props.link)return null;var e=this.props.route,t=r.pick(e.parameters,"schema","date","search");return e.find(n("./pages/people-page.jsx"),t)+"#"+n("./lists/user-list.jsx").getHash({user:this.props.user.id})},render:function(){switch(this.props.theme.mode){case"single-col":return this.renderSingleColumn();case"double-col":return this.renderDoubleColumn();case"triple-col":return this.renderTripleColumn()}},renderSingleColumn:function(){return s.createElement("div",{className:"user-view"},s.createElement("div",{className:"header"},s.createElement("div",{className:"column-1 padded selectable"},this.renderProfileImage(),this.renderRoles(),this.renderPopUpMenu("main"))),s.createElement("div",{className:"body"},s.createElement("div",{className:"column-1 padded"},this.renderName(),this.renderTag(),this.renderBackLink(),this.renderRecentActivities())),s.createElement("div",{className:"header"},s.createElement("div",{className:"column-2 padded"},this.renderChartToolbar(),this.renderPopUpMenu("statistics"))),s.createElement("div",{className:"body"},s.createElement("div",{className:"column-2"},this.renderStatistics())))},renderDoubleColumn:function(){return s.createElement("div",{className:"user-view"},s.createElement("div",{className:"header"},s.createElement("div",{className:"column-1 padded selectable"},this.renderProfileImage(),this.renderRoles(),this.renderPopUpMenu("main")),s.createElement("div",{className:"column-2 padded"},this.renderChartToolbar(),this.renderPopUpMenu("statistics"))),s.createElement("div",{className:"body"},s.createElement("div",{className:"column-1 padded"},this.renderName(),this.renderTag(),this.renderBackLink(),this.renderRecentActivities()),s.createElement("div",{className:"column-2"},this.renderStatistics())))},renderTripleColumn:function(){var e=this.props.locale.translate;return s.createElement("div",{className:"user-view triple-col"},s.createElement("div",{className:"header"},s.createElement("div",{className:"column-1 padded selectable"},this.renderProfileImage(),this.renderRoles()),s.createElement("div",{className:"column-2 padded"},this.renderChartToolbar()),s.createElement("div",{className:"column-3 padded"},s.createElement(g,{icon:"chevron-circle-right",label:e("user-actions"),disabled:!0}))),s.createElement("div",{className:"body"},s.createElement("div",{className:"column-1 padded"},this.renderName(),this.renderTag(),this.renderBackLink(),this.renderRecentActivities()),s.createElement("div",{className:"column-2"},this.renderStatistics()),s.createElement("div",{className:"column-3 padded"},this.renderOptions())))},renderProfileImage:function(){var e={user:this.props.user,theme:this.props.theme,size:"large"},t=this.getUserPageURL();return s.createElement("a",{href:t},s.createElement(m,e))},renderRoles:function(){var e=this.props.locale.pick,t=r.map(this.props.roles,function(t){return e(t.details.title)||t.name});return s.createElement("span",{className:"roles"},t.join(", ")||"Â ")},renderChartToolbar:function(){var e={chartType:this.getChartType(),locale:this.props.locale,onAction:this.handleAction};return s.createElement(f,e)},renderName:function(){var e=c.getDisplayName(this.props.user,this.props.locale),t=this.getUserPageURL();return s.createElement("h2",{className:"name"},s.createElement("a",{href:t},e))},renderTag:function(){var e,t,r=(this.props.locale.translate,this.props.user);if(r){var o=this.props.route,i=o.parameters;e="@"+r.username,t=o.find(n("./pages/news-page.jsx"),{schema:i.schema,search:e})}return s.createElement("h3",{className:"tag"},s.createElement("a",{href:t},e||"Â "))},renderRecentActivities:function(){var e=this.getStoryCountEstimate(),t={stories:this.props.stories,storyCountEstimate:e,user:this.props.user,route:this.props.route,locale:this.props.locale,theme:this.props.theme};return s.createElement(v,t)},renderBackLink:function(){var e=this.getTeamPageURL();if(!e)return null;var t=this.props.locale.translate;this.props.route;return s.createElement("div",{className:"back-link"},s.createElement("a",{href:e},s.createElement("i",{className:"fa fa-chevron-left"})," ",t("user-activity-back")))},renderStatistics:function(){var e={user:this.props.user,story:this.props.story,dailyActivities:this.props.dailyActivities,chartType:this.getChartType(),chartRange:this.getChartRange(),selectedDate:this.props.selectedDate,today:this.props.today,database:this.props.database,route:this.props.route,locale:this.props.locale,theme:this.props.theme};return s.createElement(b,e)},renderPopUpMenu:function(e){var t=this.components.setters[e+"PopUp"];return s.createElement(j,{ref:t},this.renderOptions(e))},renderOptions:function(e){var t={section:e,user:this.props.user,options:this.props.options,locale:this.props.locale,theme:this.props.theme,onChange:this.handleOptionChange,onComplete:this.handleOptionComplete};return s.createElement(y,t)},handleAction:function(e){switch(e.action){case"chart-type-set":var t=r.clone(this.props.options);"single-col"===this.props.theme.mode&&t.chartType===e.value?t.chartType=null:t.chartType=e.value,this.props.onOptionChange&&this.props.onOptionChange({type:"optionchange",target:this,user:this.props.user,options:t})}},handleOptionChange:function(e){this.props.onOptionChange&&this.props.onOptionChange({type:"optionchange",target:this,user:this.props.user,options:e.options})},handleOptionComplete:function(e){var t=e.target.props.section,n=this.components[t+"PopUp"];n&&n.close()}})},"./views/user-view.scss":function(e,t){},"./widgets/author-names.jsx":function(e,t,n){"use strict";function r(e){var t,n=e.locale.translate,r=e.authors,a=o.map(r,function(t){return c.getDisplayName(t,e.locale)});switch(o.size(r)){case 0:t="Â ";break;case 1:t=i.createElement("span",{key:1,className:"sole author"},a[0]);break;case 2:var l=i.createElement("span",{key:1,className:"lead author"},a[0]);t=n("story-author-$name1-and-$name2",l,i.createElement("span",{key:3,className:"co author"},a[1]));break;default:var l=i.createElement("span",{key:1,className:"lead author"},a[0]),u=o.slice(r,1),e={users:u,label:n("story-author-$count-others",u.length),title:n("story-coauthors"),locale:e.locale,theme:e.theme};t=n("story-author-$name1-and-$name2",l,i.createElement(d,s({key:3},e)))}return i.createElement("span",{className:"author-names selectable"},t)}var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o=n("../../common/node_modules/lodash/lodash.js"),i=n("../../common/node_modules/react/react.js"),a=i.PropTypes,c=n("../../common/src/objects/utils/user-utils.js"),l=n("../../common/src/locale/locale.js"),u=n("../../common/src/theme/theme.js"),d=n("./widgets/multiple-user-names.jsx");e.exports=r,n("./widgets/author-names.scss"),r.propTypes={authors:a.arrayOf(a.object),locale:a.instanceOf(l).isRequired,theme:a.instanceOf(u).isRequired}},"./widgets/author-names.scss":function(e,t){},"./widgets/bottom-navigation.jsx":function(e,t,n){"use strict";function r(e){var t="button";return e.className&&(t+=" "+e.className),e.active&&(t+=" active"),e.stacking&&(t+=" stacking"),e.stacking?o.createElement(w,{className:t,url:e.url,onClick:e.onClick},o.createElement("i",{className:"fa fa-"+e.icon}),e.children," ",o.createElement("span",{className:"label"},e.label)):o.createElement(w,{className:t,url:e.url,onClick:e.onClick},o.createElement("i",{className:"fa fa-"+e.icon})," ",o.createElement("span",{className:"label"},e.label),e.children)}var s=n("../../common/node_modules/lodash/lodash.js"),o=n("../../common/node_modules/react/react.js"),i=o.PropTypes,a=n("../node_modules/relaks/index.js"),c=n("../../common/src/utils/component-refs.js"),l=(n("../../common/src/errors/http-error.js"),n("../../common/src/objects/finders/notification-finder.js")),u=n("../../common/src/objects/finders/user-finder.js"),d=n("../../common/src/data/database.js"),p=n("../../common/src/routing/route.js"),h=n("../../common/src/locale/locale.js"),m=n("../../common/src/theme/theme.js"),f=n("./pages/news-page.jsx"),g=n("./pages/people-page.jsx"),v=n("./pages/notifications-page.jsx"),b=n("./pages/bookmarks-page.jsx"),y=n("./pages/settings-page.jsx"),j=n("../../common/src/mixins/update-check.js"),w=n("./widgets/link.jsx");n("./widgets/bottom-navigation.scss"),e.exports=o.createClass({displayName:"BottomNavigation",mixins:[j],propTypes:{settings:i.object.isRequired,hasAccess:i.bool,database:i.instanceOf(d).isRequired,route:i.instanceOf(p).isRequired,locale:i.instanceOf(h).isRequired,theme:i.instanceOf(m).isRequired},getInitialState:function(){return this.components=c({container:HTMLDivElement}),{height:this.isHidden()?0:"auto",stacking:!1}},isHidden:function(e){return e||(e=this.props.settings),!s.get(e,"navigation.bottom",!0)},getPageURL:function(e,t){t||(t=this.props.route);var n=e.configureUI?e.configureUI(t):null,r=s.get(n,"navigation.route");return r?t.find(e,r):null},componentWillReceiveProps:function(e){var t=this,n=this.isHidden(),r=this.isHidden(e.settings);if(n!==r){var s=this.components.container,o=s.offsetHeight;r?(this.setState({height:o}),setTimeout(function(){t.isHidden()&&t.setState({height:0})},0)):(this.setState({height:o}),setTimeout(function(){t.isHidden()||t.setState({height:"auto"})},1e3))}},render:function(){var e={height:this.state.height};return o.createElement("footer",{className:"bottom-navigation",style:e},this.renderButtons())},renderButtons:function(){var e=this.props.locale.translate,t=this.components.setters,n=(this.props.route,s.get(this.props.settings,"navigation.section")),i={label:e("bottom-nav-news"),icon:"newspaper-o",active:"news"===n,stacking:this.state.stacking,url:this.getPageURL(f),onClick:"news"===n?this.handleActiveButtonClick:null},a={label:e("bottom-nav-notifications"),icon:"comments",active:"notifications"===n,stacking:this.state.stacking,url:this.getPageURL(v),onClick:"notifications"===n?this.handleActiveButtonClick:null},c={label:e("bottom-nav-bookmarks"),icon:"bookmark",active:"bookmarks"===n,stacking:this.state.stacking,url:this.getPageURL(b),onClick:"bookmarks"===n?this.handleActiveButtonClick:null},l={label:e("bottom-nav-people"),icon:"users",active:"people"===n,stacking:this.state.stacking,url:this.getPageURL(g),onClick:"people"===n?this.handleActiveButtonClick:null},u={label:e("bottom-nav-settings"),icon:"gears",active:"settings"===n,stacking:this.state.stacking,url:this.getPageURL(y),onClick:"settings"===n?this.handleActiveButtonClick:null},d={hasAccess:this.props.hasAccess,database:this.props.database,route:this.props.route};return o.createElement("div",{ref:t.container,className:"container"},o.createElement(r,i),o.createElement(r,a,o.createElement(k,d)),o.createElement(r,c),o.createElement(r,l),o.createElement(r,u))},componentDidMount:function(){this.detectStacking(),window.addEventListener("resize",this.handleWindowResize)},componentWillUnmount:function(){window.removeEventListener("resize",this.handleWindowResize)},detectStacking:function(){var e=this.components.container;if(e){var t=e.getElementsByClassName("fa")[1],n=e.getElementsByClassName("label")[1],r=n.offsetTop>=t.offsetTop+t.offsetHeight;this.state.stacking!==r&&this.setState({stacking:r})}},handleWindowResize:function(e){this.detectStacking()},handleActiveButtonClick:function(e){var t=document.getElementsByClassName("page-container")[0];t&&t.scrollTop>0&&(/iPhone|iPad|iPod/.test(navigator.userAgent)?(t.style.overflowY="hidden",t.scrollTop=0,t.style.overflowY="scroll"):t.scrollTop=0)}});var x,k=a.createClass({displayName:"NewNotificationsBadge",propTypes:{stacking:i.bool,hasAccess:i.bool,database:i.instanceOf(d).isRequired,route:i.instanceOf(p).isRequired},renderAsync:function(e){var t=this.props.route.parameters;if(!t.schema)return null;if(!this.props.hasAccess)return null;var n=this.props.database.use({schema:t.schema,by:this});return n.start().then(function(e){return u.findUser(n,e).then(function(e){return l.findNotificationsUnseenByUser(n,e).then(function(e){var t=e.length;return E(t),C(t),t?o.createElement("span",{className:"badge"},o.createElement("span",{className:"number"},t)):null})})})}}),E=function(e){if(!x){var t=n("../assets/favicon-notification recursive \\.png$").keys();x=s.map(t,function(e){var t=e.substring(e.indexOf("/")+1,e.lastIndexOf("."));return{withoutBadge:n("../assets/favicon recursive ^\\.\\/.*\\.png$")("./"+t+".png"),withBadge:n("../assets/favicon-notification recursive ^\\.\\/.*\\.png$")("./"+t+".png")}})}var r=s.filter(document.head.getElementsByTagName("LINK"),function(e){if("icon"===e.rel||"apple-touch-icon-precomposed"===e.rel)return!0});s.each(r,function(t){var n=t.getAttribute("href");if(e>0){var r=s.find(x,{withoutBadge:n});r&&(t.href=r.withBadge)}else{var r=s.find(x,{withBadge:n});r&&(t.href=r.withoutBadge)}})},C=function(e){var t=s.replace(document.title,/^\(\d+\)\s*/,"");e>0&&(t="("+e+") "+t),document.title=t}},"./widgets/bottom-navigation.scss":function(e,t){},"./widgets/calendar-bar.jsx":function(e,t,n){"use strict";var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s=n("../../common/node_modules/lodash/lodash.js"),o=n("../../common/node_modules/react/react.js"),i=o.PropTypes,a=n("../node_modules/relaks/index.js"),c=n("../../common/node_modules/moment/moment.js"),l=n("../../common/src/objects/finders/statistics-finder.js"),u=n("../../common/src/objects/finders/user-finder.js"),d=n("../../common/src/data/database.js"),p=n("../../common/src/routing/route.js"),h=n("../../common/src/locale/locale.js"),m=n("../../common/src/mixins/update-check.js"),f=n("./widgets/calendar.jsx");n("./widgets/calendar-bar.scss"),e.exports=a.createClass({displayName:"CalendarBar",propTypes:{settings:i.object.isRequired,database:i.instanceOf(d).isRequired,route:i.instanceOf(p).isRequired,locale:i.instanceOf(h).isRequired},renderAsync:function(e){var t=this,n=this.props.route.parameters,r=this.props.database.use({schema:n.schema,by:this}),i={dailyActivities:null,settings:this.props.settings,route:this.props.route,locale:this.props.locale};return e.show(o.createElement(g,i)),r.start().then(function(e){return u.findUser(r,e)}).then(function(e){var n=s.clone(t.props.settings.statistics);return"current"===n.user_id&&(n.user_id=e.id),"guest"===n.public&&(n.public="guest"===e.type),l.find(r,n)}).then(function(e){return i.dailyActivities=e,o.createElement(g,i)})}});var g=e.exports.Sync=o.createClass({displayName:"CalendarBar.Sync",mixins:[m],propTypes:{settings:i.object.isRequired,dailyActivities:i.object,route:i.instanceOf(p).isRequired,locale:i.instanceOf(h).isRequired},render:function(){var e=this,t=c().endOf("month"),n=[],i=!1,a=s.get(this.props.dailyActivities,"range.start"),l=s.get(this.props.dailyActivities,"range.end"),u=this.props.route.parameters.date;if(a&&l){var d=c(a).startOf("month"),p=c(l).endOf("month");d.year()!=p.year()&&(i=!0),t>p&&(p=t);for(var h=d.clone();h<=p;h.add(1,"month"))n.push({year:h.year(),month:h.month()+1})}else n.push({year:t.year(),month:t.month()+1});n.reverse();var m=s.map(n,function(t,n){var s={year:t.year,month:t.month,showYear:i,selection:u,locale:e.props.locale,onDateURL:e.handleDateURL};return o.createElement(f,r({key:n},s))});return o.createElement("div",{className:"calendar-bar"},m)},handleDateURL:function(e){if(s.get(this.props.dailyActivities,["daily",e.date])){var t=this.props.route,n=s.assign({date:e.date},this.props.settings.route);return t.find(t.component,n)}}})},"./widgets/calendar-bar.scss":function(e,t){},"./widgets/calendar.jsx":function(e,t,n){"use strict";function r(e,t,n){return e+"-"+s(t)+"-"+s(n)}function s(e){var t=String(e);return 1===t.length&&(t="0"+t),t}var o=n("../../common/node_modules/lodash/lodash.js"),i=n("../../common/node_modules/react/react.js"),a=i.PropTypes,c=n("../../common/node_modules/moment/moment.js"),l=n("../../common/src/utils/date-tracker.js"),u=n("../../common/src/locale/locale.js");n("./widgets/calendar.scss"),e.exports=i.createClass({displayName:"Calendar",propTypes:{year:a.number.isRequired,month:a.number.isRequired,showYear:a.bool,selection:a.string,locale:a.instanceOf(u).isRequired,onDateURL:a.func},getDefaultProps:function(){return{showYear:!1}},render:function(){var e=this,t=this.props.locale.localeCode,n=c.localeData(t),a=this.props.year,u=this.props.month,d=this.props.selection,p=c(r(a,u,1)).locale(t),h=n.firstDayOfWeek(),m=p.daysInMonth(),f=p.day(),g=[[null,null,null,null,null,null,null],[null,null,null,null,null,null,null],[null,null,null,null,null,null,null],[null,null,null,null,null,null,null],[null,null,null,null,null,null,null],[null,null,null,null,null,null,null]],v=0,b=f-h;b<0&&(b+=7);for(var y=1;y<=m;y++)g[v][b++]=y,b>=7&&(b=0,v++);for(var j=o.slice(n.weekdaysShort()),w=[!0,!1,!1,!1,!1,!1,!0],x=0;x<h;x++)j.push(j.shift()),w.push(w.shift());var k=this.props.showYear?"MMMM YYYY":"MMMM",E=p.format(k),C=o.map(j,function(e,t){var n=[w[t]?"weekend":"workweek"];return i.createElement("th",{className:n.join(" "),key:t},e)}),_=o.map(g,function(t){return o.map(t,function(t,n){var r,o,c,p=[w[n]?"weekend":"workweek"];return t?(o=a+"-"+s(u)+"-"+s(t),r=t,c=e.getDateURL(o)):r="Â ",d&&d===o&&p.push("selected"),o===l.today&&p.push("today"),i.createElement("td",{key:n,className:p.join(" ")},i.createElement("a",{href:c},r))})});return i.createElement("table",{className:"calendar"},i.createElement("thead",null,i.createElement("tr",{className:"title"},i.createElement("th",{colSpan:7},E)),i.createElement("tr",{className:"headings"},C)),i.createElement("tbody",null,i.createElement("tr",{className:"dates"},_[0]),i.createElement("tr",{className:"dates"},_[1]),i.createElement("tr",{className:"dates"},_[2]),i.createElement("tr",{className:"dates"},_[3]),i.createElement("tr",{className:"dates"},_[4]),i.createElement("tr",{className:"dates"},_[5])))},getDateURL:function(e){if(this.props.onDateURL)return this.props.onDateURL({type:"dateurl",target:this,date:e})}})},"./widgets/calendar.scss":function(e,t){},"./widgets/chart-toolbar.jsx":function(e,t,n){"use strict";var r=n("../../common/node_modules/lodash/lodash.js"),s=n("../../common/node_modules/react/react.js"),o=s.PropTypes,i=n("../../common/src/locale/locale.js"),a=n("./widgets/header-button.jsx");n("./widgets/chart-toolbar.scss"),e.exports=s.createClass({displayName:"ChartToolbar",propTypes:{chartType:o.oneOf(["bar","line","pie"]),locale:o.instanceOf(i).isRequired,onAction:o.func},render:function(){var e=this.props.locale.translate,t={label:e("statistics-bar"),icon:"bar-chart",highlighted:"bar"===this.props.chartType,onClick:this.handleBarChartClick},n={label:e("statistics-line"),icon:"line-chart",highlighted:"line"===this.props.chartType,onClick:this.handleLineChartClick},r={label:e("statistics-pie"),icon:"pie-chart",highlighted:"pie"===this.props.chartType,onClick:this.handlePieChartClick};return s.createElement("div",{className:"chart-toolbar"},s.createElement(a,t),s.createElement(a,n),s.createElement(a,r))},triggerActionEvent:function(e,t){this.props.onAction&&this.props.onAction(r.extend({type:"action",target:this,action:e},t))},handleBarChartClick:function(e){this.triggerActionEvent("chart-type-set",{value:"bar"})},handleLineChartClick:function(e){this.triggerActionEvent("chart-type-set",{value:"line"})},handlePieChartClick:function(e){this.triggerActionEvent("chart-type-set",{value:"pie"})}})},"./widgets/chart-toolbar.scss":function(e,t){},"./widgets/chartist.scss":function(e,t){},"./widgets/coauthoring-button.jsx":function(e,t,n){"use strict";var r=n("../../common/node_modules/lodash/lodash.js"),s=n("../../common/node_modules/react/react.js"),o=s.PropTypes,i=(n("../../common/src/media/device-manager.js"),n("../../common/src/data/database.js")),a=n("../../common/src/routing/route.js"),c=n("../../common/src/locale/locale.js"),l=n("../../common/src/theme/theme.js"),u=(n("./widgets/header-button.jsx"),n("./dialogs/user-selection-dialog-box.jsx"));n("./widgets/coauthoring-button.scss"),e.exports=s.createClass({displayName:"CoauthoringButton",propTypes:{coauthoring:o.bool,story:o.object.isRequired,database:o.instanceOf(i).isRequired,route:o.instanceOf(a).isRequired,locale:o.instanceOf(c).isRequired,theme:o.instanceOf(l).isRequired,onSelect:o.func,onRemove:o.func},getInitialState:function(){return{selecting:!1}},render:function(){var e,t,n=this.props.locale.translate;return this.props.coauthoring?(e="minus-square",t=n("story-remove-yourself")):(e="plus-square",t=n(this.props.story.user_ids.length>1?"story-add-remove-coauthor":"story-add-coauthor")),s.createElement("span",{className:"coauthoring-button",onClick:this.handleClick},s.createElement("i",{className:"fa fa-"+e}),s.createElement("span",{className:"label"},t),this.renderDialogBox())},renderDialogBox:function(){var e={show:this.state.selecting,selection:this.props.story.user_ids,disabled:r.slice(this.props.story.user_ids,0,1),database:this.props.database,route:this.props.route,locale:this.props.locale,theme:this.props.theme,onSelect:this.handleSelect,onCancel:this.handleCancel};return s.createElement(u,e)},handleClick:function(e){this.props.coauthoring?this.props.onRemove&&this.props.onRemove({type:"remove",target:this}):this.setState({selecting:!0})},handleCancel:function(e){this.setState({selecting:!1})},handleSelect:function(e){this.props.onSelect&&this.props.onSelect({type:"select",target:this,selection:e.selection}),this.setState({selecting:!1})}})},"./widgets/coauthoring-button.scss":function(e,t){},"./widgets/corner-pop-up.jsx":function(e,t,n){"use strict";var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s=n("../../common/node_modules/react/react.js"),o=s.PropTypes,i=n("../../common/src/utils/component-refs.js"),a=n("./widgets/pop-up-menu.jsx");n("./widgets/corner-pop-up.scss"),e.exports=s.createClass({displayName:"CornerPopUp",propType:{onOpen:o.func,onClose:o.func},getInitialState:function(){return this.components=i({popUpMenu:a}),{open:!1}},close:function(){this.setState({open:!1}),this.components.popUpMenu.close()},render:function(){var e=this.components.setters,t={onOpen:this.handleOpen,onClose:this.handleClose},n=this.state.open?"left":"down";return s.createElement(a,r({ref:e.popUpMenu,className:"corner-pop-up"},t),s.createElement("button",null,s.createElement("i",{className:"fa fa-chevron-circle-"+n})),s.createElement("menu",null,this.props.children))},handleOpen:function(e){this.setState({open:!0}),this.props.onOpen&&this.props.onOpen({type:open,target:this})},handleClose:function(e){this.setState({open:!1}),this.props.onClose&&this.props.onClose({type:open,target:this})}})},"./widgets/corner-pop-up.scss":function(e,t){},"./widgets/device-placeholder.jsx":function(e,t,n){"use strict";function r(e){var t="device-placeholder";e.blocked&&(t+=" blocked");var n=e.icon;return s.createElement("div",{className:t},s.createElement("span",{className:"fa-stack fa-lg"},s.createElement("i",{className:"fa fa-"+n+" fa-stack-1x"}),s.createElement("i",{className:"fa fa-ban fa-stack-2x"})))}var s=n("../../common/node_modules/react/react.js"),o=s.PropTypes;e.exports=r,n("./widgets/device-placeholder.scss"),r.propTypes={blocked:o.bool,icon:o.oneOf(["camera","video-camera","microphone"]).isRequired}},"./widgets/device-placeholder.scss":function(e,t){},"./widgets/device-selector.jsx":function(e,t,n){"use strict";function r(e){var t=e.locale.translate,n=e.devices;if(n.length<2)return null;var r=2===n.length&&i.every(n,function(e){if(/front|back/i.test(e.label))return!0}),s=i.map(n,function(n,s){var i;"video"===e.type?i=r?t(/front/i.test(n.label)?"device-selector-camera-front":"device-selector-camera-back"):t("device-selector-camera-$number",s+1):"audio"===type&&(i=t("device-selector-mic-$number",s+1));var c={value:n.deviceId,selected:n.deviceId===e.selectedDeviceId};return a.createElement("option",o({key:s},c),i)});return a.createElement("div",{className:"device-selector"},a.createElement("select",{onChange:e.onSelect},s))}function s(e,t){return i.find(e,function(e){return"front"===t?/front/i.test(e.label):"back"===t?/back/i.test(e.label):void 0})}var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},i=n("../../common/node_modules/lodash/lodash.js"),a=n("../../common/node_modules/react/react.js");a.PropTypes;e.exports=r,e.exports.choose=s,n("./widgets/device-selector.scss")},"./widgets/device-selector.scss":function(e,t){},"./widgets/drop-zone.jsx":function(e,t,n){"use strict";var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s=n("../../common/node_modules/react/react.js"),o=s.PropTypes;n("./widgets/drop-zone.scss"),e.exports=s.createClass({displayName:"DropZone",propTypes:{onDrop:o.func},getInitialState:function(){return{active:!1}},render:function(){return s.createElement("div",{className:"drop-zone",onDragEnter:this.handleDragEnter},this.props.children,this.renderOverlay())},renderOverlay:function(){if(!this.state.active)return null;var e={onDragLeave:this.handleDragLeave,onDragOver:this.handleDragOver,onDrop:this.handleDrop};return s.createElement("div",r({className:"overlay"},e))},handleDragEnter:function(e){this.setState({active:!0})},handleDragLeave:function(e){this.setState({active:!1})},handleDragOver:function(e){e.preventDefault()},handleDrop:function(e){return e.preventDefault(),this.state.active&&this.props.onDrop&&this.props.onDrop({type:"drop",files:e.dataTransfer.files,items:e.dataTransfer.items}),this.setState({active:!1}),null}})},"./widgets/drop-zone.scss":function(e,t){},"./widgets/duration-indicator.jsx":function(e,t,n){"use strict";function r(e){if("number"!=typeof e)return"";var t=String(Math.floor(e/36e5)),n=String(Math.floor(e/6e4)%60),r=String(Math.round(e/1e3)%60);return 1===n.length&&(n="0"+n),1===r.length&&(r="0"+r),t+":"+n+":"+r}var s=n("../../common/node_modules/react/react.js"),o=s.PropTypes,i=n("../../common/src/mixins/update-check.js");n("./widgets/duration-indicator.scss"),e.exports=s.createClass({displayName:"DurationIndicator",mixins:[i],propTypes:{duration:o.number,startTime:o.instanceOf(Date)},calculateDuration:function(){var e=this.props.duration;if(this.props.startTime){e+=new Date-this.props.startTime}return e},componentWillMount:function(){this.props.startTime&&this.startTimer()},componentWillReceiveProps:function(e){!this.props.startTime&&e.startTime?this.startTimer():this.props.startTime&&!e.startTime&&this.stopTimer()},render:function(){var e=this.calculateDuration(),t="icon";return this.props.startTime&&(t+=" blinking"),s.createElement("div",{className:"duration-indiactor"},s.createElement("span",{className:t},s.createElement("i",{className:"fa fa-circle"})),s.createElement("span",{className:"duration"},r(e)))},componentWillUnmount:function(){this.stopTimer()},startTimer:function(){var e=this;this.interval||(this.interval=setInterval(function(){e.forceUpdate()},500))},stopTimer:function(){this.interval&&(clearInterval(this.interval),this.interval=null)}}),e.exports.format=r},"./widgets/duration-indicator.scss":function(e,t){},"./widgets/empty-message.jsx":function(e,t,n){"use strict";function r(e){var t=e.locale.translate,n=e.phrase;return e.online||(n="empty-currently-offline"),s.createElement("div",{className:"empty-message"},s.createElement("div",{className:"text"},t(n)))}var s=n("../../common/node_modules/react/react.js"),o=s.PropTypes,i=n("../../common/src/locale/locale.js");e.exports=r,n("./widgets/empty-message.scss"),r.propTypes={locale:o.instanceOf(i).isRequired,online:o.bool,phrase:o.string.isRequired},r.defaultProps={online:!0}},"./widgets/empty-message.scss":function(e,t){},"./widgets/header-button.jsx":function(e,t,n){"use strict";function r(e){return e.hidden?null:a.createElement("label",{className:o(e),onClick:e.disabled?null:e.onClick},a.createElement("i",{className:i(e)}),a.createElement("span",{className:"label"},e.label))}function s(e){if(e.hidden)return null;var t={type:"file",value:"",disabled:e.disabled,multiple:e.multiple,onChange:e.onChange};return l?(t.id="file-input-"+u++,a.createElement("span",{className:o(e)},a.createElement("label",{htmlFor:t.id},a.createElement("i",{className:i(e)}),a.createElement("span",{className:"label"},e.label)),a.createElement("input",t))):a.createElement("label",{className:o(e)},a.createElement("i",{className:i(e)}),a.createElement("span",{className:"label"},e.label),a.createElement("input",t))}function o(e){var t=["header-button"];return e.className&&t.push(e.className),e.highlighted&&t.push("highlighted"),e.disabled&&t.push("disabled"),t.join(" ")}function i(e){var t=[];return e.icon&&t.push("fa","fa-"+e.icon),t.join(" ")}var a=n("../../common/node_modules/react/react.js"),c=a.PropTypes;e.exports=r,e.exports.File=s,n("./widgets/header-button.scss"),r.propTypes={label:c.string,icon:c.string,hidden:c.bool,highlighted:c.bool,disabled:c.bool,onClick:c.func};var l=/Edge/.test(navigator.userAgent),u=1;s.propTypes={label:c.string,icon:c.string,hidden:c.bool,highlighted:c.bool,disabled:c.bool,multiple:c.bool,onChange:c.func}},"./widgets/header-button.scss":function(e,t){},"./widgets/link.jsx":function(e,t,n){"use strict";var r=n("../../common/node_modules/lodash/lodash.js"),s=n("../../common/node_modules/react/react.js"),o=s.PropTypes;e.exports=s.createClass({displayName:"Link",propTypes:{url:o.string,alwaysAsLink:o.bool},getDefaultProps:function(){return{alwaysAsLink:!1}},getInitialState:function(){return{hasFocus:!1}},render:function(){var e=r.omit(this.props,"url","alwaysAsLink");return this.props.url&&(this.props.alwaysAsLink?e.href=this.props.url:(this.state.hasFocus?e.href=this.props.url:e["data-url"]=this.props.url,void 0===e.tabIndex&&(e.tabIndex=0),e.onFocus=this.handleFocus,e.onBlur=this.handleBlur)),s.createElement("a",e,this.props.children)},handleFocus:function(e){this.setState({hasFocus:!0})},handleBlur:function(e){this.setState({hasFocus:!1})}})},"./widgets/loading-animation.jsx":function(e,t,n){"use strict";function r(e){return s.createElement("div",{className:"loading-animation"},s.createElement("div",{className:"first dot"}),s.createElement("div",{className:"second dot"}),s.createElement("div",{className:"third dot"}),s.createElement("div",{className:"fourth dot"}))}var s=n("../../common/node_modules/react/react.js");e.exports=r,n("./widgets/loading-animation.scss")},"./widgets/loading-animation.scss":function(e,t){},"./widgets/media-button.jsx":function(e,t,n){"use strict";function r(e){return e.hidden?null:a.createElement("label",{className:o(e),onClick:e.disabled?null:e.onClick},a.createElement("i",{className:i(e)}),a.createElement("span",{className:"label"},e.label))}function s(e){if(e.hidden)return null;var t=e.index+1+" / "+e.count;return a.createElement("div",{className:"media-direction"},a.createElement("label",{className:"backward-button",onClick:e.onBackwardClick},a.createElement("i",{className:"fa fa-caret-left"})),a.createElement("span",{className:"position"},t),a.createElement("label",{className:"forward-button",onClick:e.onForwardClick},a.createElement("i",{className:"fa fa-caret-right"})))}function o(e){var t=["media-button"];return e.className&&t.push(e.className),e.disabled&&t.push("disabled"),t.join(" ")}function i(e){var t=[];return e.icon&&t.push("fa","fa-"+e.icon),t.join(" ")}var a=n("../../common/node_modules/react/react.js"),c=a.PropTypes;e.exports=r,e.exports.Direction=s,n("./widgets/media-button.scss"),s.propTypes={index:c.number,count:c.number,hidden:c.bool,onBackwardClick:c.func,onForwardClick:c.func},s.propTypes={label:c.string,icon:c.string,hidden:c.bool,highlighted:c.bool,disabled:c.bool,onChange:c.func}},"./widgets/media-button.scss":function(e,t){},"./widgets/media-placeholder.jsx":function(e,t,n){"use strict";function r(e){if("columns-1"===e.theme.mode)return null;var t,n=e.locale.translate;e.showHints&&(t=["story-drop-files-here","story-paste-image-here"]);var r=s.map(t,function(e,t){var r={animationDelay:10*t+"s"};return o.createElement("div",{key:t,className:"message",style:r},n(e))});return o.createElement("div",{className:"media-placeholder"},r)}var s=n("../../common/node_modules/lodash/lodash.js"),o=n("../../common/node_modules/react/react.js"),i=o.PropTypes,a=n("../../common/src/locale/locale.js"),c=n("../../common/src/theme/theme.js");e.exports=r,n("./widgets/media-placeholder.scss"),r.propTypes={showHints:i.bool,locale:i.instanceOf(a).isRequired,theme:i.instanceOf(c).isRequired}},"./widgets/media-placeholder.scss":function(e,t){},"./widgets/media-toolbar.jsx":function(e,t,n){"use strict";var r=n("../../common/node_modules/lodash/lodash.js"),s=n("../../common/node_modules/react/react.js"),o=s.PropTypes,i=n("../../common/src/media/device-manager.js"),a=n("../../common/src/locale/locale.js"),c=n("./widgets/header-button.jsx"),l=n("./dialogs/photo-capture-dialog-box.jsx"),u=n("./dialogs/video-capture-dialog-box.jsx"),d=n("./dialogs/audio-capture-dialog-box.jsx");n("./widgets/media-toolbar.scss"),e.exports=s.createClass({displayName:"MediaToolbar",propTypes:{story:o.object.isRequired,capturing:o.oneOf(["image","video","audio"]),locale:o.instanceOf(a).isRequired,onAction:o.func},getInitialState:function(){return{hasCamera:i.hasDevice("videoinput"),hasMicrophone:i.hasDevice("audioinput")}},getResourceCounts:function(){var e={photo:0,video:0,audio:0,file:0},t=r.get(this.props.story,"details.resources");return r.each(t,function(t){if(t.imported)e.file++;else switch(t.type){case"image":e.photo++;break;case"video":e.video++;break;case"audio":e.audio++}}),e},render:function(){var e=this.props.locale.translate,t=this.getResourceCounts(),n=this.state.hasCamera&&l.isAvailable(),r=this.state.hasCamera&&u.isAvailable(),o=this.state.hasMicrophone&&d.isAvailable(),i={label:e("story-photo"),icon:"camera",hidden:!t.photo&&!n,disabled:!n,highlighted:t.photo>0||"image"===this.props.capturing,onClick:this.handlePhotoClick},a={label:e("story-video"),icon:"video-camera",hidden:!t.video&&!r,disabled:!r,highlighted:t.video>0||"video"===this.props.capturing,onClick:this.handleVideoClick},p={label:e("story-audio"),icon:"microphone",hidden:!t.audio&&!o,disabled:!o,highlighted:t.audio>0||"audio"===this.props.capturing,onClick:this.handleAudioClick},h={label:e("story-file"),icon:"file-photo-o",multiple:!0,highlighted:t.file>0,onChange:this.handleFileSelect};return s.createElement("div",{className:"media-toolbar"},s.createElement(c,i),s.createElement(c,a),s.createElement(c,p),s.createElement(c.File,h))},componentDidMount:function(){i.addEventListener("change",this.handleDeviceChange)},componentWillUnmount:function(){i.removeEventListener("change",this.handleDeviceChange)},triggerActionEvent:function(e,t){this.props.onAction&&this.props.onAction(r.extend({type:"action",target:this,action:e},t))},handlePhotoClick:function(e){this.triggerActionEvent("photo-capture")},handleVideoClick:function(e){this.triggerActionEvent("video-capture")},handleAudioClick:function(e){this.triggerActionEvent("audio-capture")},handleFileSelect:function(e){var t=e.target.files;r.isEmpty(t)||this.triggerActionEvent("file-import",{files:t})},handleDeviceChange:function(e){this.setState({hasCamera:i.hasDevice("videoinput"),hasMicrophone:i.hasDevice("audioinput")})}})},"./widgets/media-toolbar.scss":function(e,t){},"./widgets/multiple-user-names.jsx":function(e,t,n){"use strict";function r(e){var t=["user"],n={user:e.user,theme:e.theme,size:"small"},r=c.getDisplayName(e.user,e.locale);return i.createElement("div",{className:t.join(" ")},i.createElement(m,n),i.createElement("span",{className:"name"},r))}var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o=n("../../common/node_modules/lodash/lodash.js"),i=n("../../common/node_modules/react/react.js"),a=i.PropTypes,c=n("../../common/src/objects/utils/user-utils.js"),l=n("../../common/src/locale/locale.js"),u=n("../../common/src/theme/theme.js"),d=n("../../common/src/widgets/overlay.jsx"),p=n("./widgets/push-button.jsx"),h=n("./widgets/scrollable.jsx"),m=n("./widgets/profile-image.jsx");n("./widgets/multiple-user-names.scss"),e.exports=i.createClass({displayName:"MultipleUserNames",propTypes:{label:a.string,title:a.string,users:a.arrayOf(a.object).isRequired,popupLimit:a.number,locale:a.instanceOf(l).isRequired,theme:a.instanceOf(u).isRequired},getDefaultProps:function(){return{popupLimit:8}},getInitialState:function(){return{showingPopUp:!1,showingDialogBox:!1,renderingDialogBox:!1}},render:function(){var e="multiple-user-names";this.props.className&&(e+=" "+this.props.className);var t={className:e,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave},n={className:"label",onClick:this.handleClick};return i.createElement("span",t,i.createElement("span",n,this.props.label),this.renderPopUp(),this.renderDialogBox())},renderPopUp:function(){return this.state.showingPopUp?i.createElement("div",{className:"popup-container"},i.createElement("div",{className:"popup"},this.renderUserList(this.props.popupLimit))):null},renderDialogBox:function(){if(!this.state.renderingDialogBox)return null;var e={show:this.state.showingDialogBox,onBackgroundClick:this.handleDialogBoxClose},t={label:"OK",emphasized:!0,onClick:this.handleDialogBoxClose};return i.createElement(d,e,i.createElement("div",{className:"multiple-user-names-dialog-box"},i.createElement(h,null,i.createElement("div",{className:"list"},this.renderUserList())),i.createElement("div",{className:"buttons"},i.createElement(p,t))))},renderUserList:function(e){var t=this.props.locale.pick,n=o.sortBy(this.props.users,function(e){return t(e.details.name)});if(n.length>e){var r=this.props.locale.translate,s=o.slice(n,e),a=o.map(s,this.renderUser);return a.push(i.createElement("div",{key:0,className:"more"},r("list-$count-more",n.length-s.length))),a}return o.map(n,this.renderUser)},renderUser:function(e,t){var n={user:e,theme:this.props.theme,locale:this.props.locale};return i.createElement(r,s({key:e.id},n))},handleMouseEnter:function(e){this.setState({showingPopUp:!0})},handleMouseLeave:function(e){this.setState({showingPopUp:!1})},handleClick:function(e){this.setState({showingPopUp:!1,showingDialogBox:!0,renderingDialogBox:!0})},handleDialogBoxClose:function(e){var t=this;this.setState({showingDialogBox:!1},function(){setTimeout(function(){t.setState({renderingDialogBox:!1})},1e3)})}})},"./widgets/multiple-user-names.scss":function(e,t){},"./widgets/new-items-alert.jsx":function(e,t,n){"use strict";function r(e){var t=o.replace(e.route.url,/#(.*)/,""),n={className:"new-items-alert "+(e.show?"show":"hide"),href:t+"#"+e.hash,onClick:e.onClick};return i.createElement("a",n,i.createElement("i",{className:"fa fa-arrow-up"}),e.children)}var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o=n("../../common/node_modules/lodash/lodash.js"),i=n("../../common/node_modules/react/react.js"),a=i.PropTypes,c=n("../../common/node_modules/react-dom/index.js"),l=n("../../common/src/routing/route.js");n("./widgets/new-items-alert.scss"),e.exports=i.createClass({displayName:"NewItemsAlertProxy",propTypes:{hash:a.string,route:a.instanceOf(l).isRequired,onClick:a.func},render:function(){return null},componentDidMount:function(){this.props.hash&&this.show(this.props)},componentWillReceiveProps:function(e){!this.props.hash&&e.hash?this.show(e):this.props.hash&&!e.hash?this.hide(this.props):this.props.children===e.children&&this.props.hash===e.hash||e.hash&&this.redraw(e,!0)},componentWillUnmount:function(){this.hide(this.props)},show:function(e){var t=this;this.containerNode?this.containerRemovalTimeout&&(clearTimeout(this.containerRemovalTimeout),this.containerRemovalTimeout=0):(this.containerNode=document.createElement("DIV"),this.viewport=document.getElementsByClassName("page-view-port")[0],this.viewport.appendChild(this.containerNode)),this.redraw(e,!1),setTimeout(function(){t.redraw(e,!0)},10)},redraw:function(e,t){this.props.route;c.render(i.createElement(r,s({},e,{show:t})),this.containerNode)},hide:function(e){var t=this;this.containerNode&&(this.containerRemovalTimeout||(this.containerRemovalTimeout=setTimeout(function(){c.unmountComponentAtNode(t.containerNode),t.viewport.removeChild(t.containerNode),t.viewport=null,t.containerNode=null,t.containerRemovalTimeout=0},500)),this.redraw(e,!1))}})},"./widgets/new-items-alert.scss":function(e,t){},"./widgets/option-button.jsx":function(e,t,n){"use strict";function r(e){if(e.hidden)return null;var t={className:s(e),id:e.id,href:e.url,target:e.target,onClick:e.disabled?null:e.onClick};return i.createElement("a",t,i.createElement("div",{className:"icon"},i.createElement("i",{className:o(e)})),i.createElement("div",{className:"label"},e.label))}function s(e){var t=["option-button"];return e.className&&t.push(e.className),e.selected&&t.push("selected"),e.disabled&&t.push("disabled"),t.join(" ")}function o(e){var t=["fa"];return e.icon?t.push("fa-"+e.icon):e.selected?t.push("fa-"+e.iconOn):t.push("fa-"+e.iconOff),t.join(" ")}var i=n("../../common/node_modules/react/react.js"),a=i.PropTypes;e.exports=r,n("./widgets/option-button.scss"),r.propTypes={label:a.node,id:a.string,icon:a.string,iconOn:a.string,iconOff:a.string,url:a.string,target:a.string,hidden:a.bool,selected:a.bool,disabled:a.bool,onClick:a.func},r.defaultProps={iconOn:"check-circle",iconOff:"circle-o"}},"./widgets/option-button.scss":function(e,t){},"./widgets/page-container.jsx":function(e,t,n){"use strict";var r=n("../../common/node_modules/react/react.js");n("./widgets/page-container.scss"),e.exports=r.createClass({displayName:"PageContainer",setNode:function(e){if(e){var t=document.activeElement;t&&t!==document.body||e.focus()}},render:function(){var e="page-container";return this.props.className&&(e+=" "+this.props.className),r.createElement("div",{className:e,tabIndex:0,ref:this.setNode},r.createElement("div",{className:"contents"},this.props.children))}})},"./widgets/page-container.scss":function(e,t){},"./widgets/pop-up-menu.jsx":function(e,t,n){"use strict";function r(e,t){for(var n=e;n!==document.body.parentNode;n=n.parentNode)if(n===t)return!0;return!1}function s(e,t){for(var n=e.offsetLeft,r=e.offsetTop,s=e.offsetParent;s&&s!==t;s=s.offsetParent)n+=s.offsetLeft-s.scrollLeft,r+=s.offsetTop-s.scrollTop;return{left:n,top:r}}function o(){return document.getElementById("app-container").getElementsByClassName("page-container")[0]}var i=n("../../common/node_modules/lodash/lodash.js"),a=n("../../common/node_modules/react/react.js"),c=a.PropTypes,l=n("../../common/node_modules/react-dom/index.js"),u=n("../node_modules/scroll-into-view-if-needed/es/index.js").default,d=n("../../common/src/widgets/overlay.jsx"),p=n("../../common/src/utils/component-refs.js");n("./widgets/pop-up-menu.scss"),e.exports=a.createClass({displayName:"PopUpMenu",propTypes:{disabled:c.bool,popOut:c.bool},getDefaultProps:function(){return{disabled:!1,popOut:!1}},getInitialState:function(){return this.components=p({container:HTMLDivElement,menu:HTMLDivElement}),{open:!1}},getContents:function(e){var t=a.Children.toArray(this.props.children),n=i.find(t,{type:e});if(n)return n.props.children},close:function(){return this.setState({open:!1})},render:function(){var e="pop-up-menu";return this.props.className&&(e+=" "+this.props.className),this.state.open&&(e+=" open"),a.createElement("span",{className:e},this.renderButton(),this.props.popOut?null:this.renderMenu())},renderButton:function(){var e="button";return this.props.disabled||(e+=" active"),a.createElement("span",{className:e,onClick:this.handleButtonClick},this.getContents("button"))},renderMenu:function(){if(!this.state.open)return null;var e=this.components.setters;return a.createElement("div",{ref:e.container,className:"container"},a.createElement("div",{ref:e.menu,className:"menu"},this.getContents("menu")))},redrawPopOutMenu:function(){var e=l.findDOMNode(this),t=o(),n=this.components.setters,r=s(e,t),i={position:"absolute",left:r.left+e.offsetWidth,top:r.top},c="pop-up-menu";this.props.className&&(c+=" "+this.props.className);var u=a.createElement("div",{className:c,style:i},a.createElement("div",{ref:n.container,className:"container"},a.createElement("div",{ref:n.menu,className:"menu",onClick:this.handleMenuClick},this.getContents("menu"))));l.render(u,this.popOutContainer)},componentDidUpdate:function(e,t){var n=this,r=document.getElementById("application");!t.open&&this.state.open?(r.addEventListener("mousedown",this.handleBodyMouseDown),this.props.popOut&&this.addPopOutContainer()):t.open&&!this.state.open&&(r.removeEventListener("mousedown",this.handleBodyMouseDown),this.props.popOut&&this.removePopOutContainer()),this.state.open&&this.props.popOut&&this.redrawPopOutMenu(),this.state.open&&!e.open&&setTimeout(function(){var e=n.components.menu;if(e){u(e,{behavior:"smooth",scrollMode:"if-needed",block:"end"})}},50)},componentWillUnmount:function(){document.getElementById("application").removeEventListener("mousedown",this.handleBodyMouseDown),this.removePopOutContainer()},addPopOutContainer:function(){if(!this.popOutContainer){var e=o();this.popOutContainer=document.createElement("DIV"),this.popOutContainer.style.left="0",this.popOutContainer.style.top="0",e.appendChild(this.popOutContainer),this.popOutContainer.style.position="absolute"}},removePopOutContainer:function(){this.popOutContainer&&(this.popOutContainer.parentNode.removeChild(this.popOutContainer),this.popOutContainer=null)},triggerEvent:function(e){e?this.props.onOpen&&this.props.onOpen({type:"open",target:this}):this.props.onClose&&this.props.onClose({type:"close",target:this})},handleButtonClick:function(e){this.props.disabled||(this.triggerEvent(!this.state.open),this.setState({open:!this.state.open}))},handleBodyMouseDown:function(e){if(0===e.button&&!d.active){var t=l.findDOMNode(this),n=r(e.target,t);!n&&this.popOutContainer&&(n=r(e.target,this.popOutContainer)),n||(this.setState({open:!1}),this.triggerEvent(!1))}}})},"./widgets/pop-up-menu.scss":function(e,t){},"./widgets/profile-image.jsx":function(e,t,n){"use strict";function r(e){var t,r="profile-image "+e.size,i=s.get(e.user,"details.resources"),c=s.find(i,{type:"image"});if(c){var u=l[e.size];t=o.createElement(a,{resource:c,mosaic:!0,theme:e.theme,width:u,height:u})}else{var d=n("../node_modules/octicons/build/svg/person.svg");t=o.createElement("div",{className:"placeholder"},o.createElement(d,null))}return e.href?o.createElement("a",{className:r,href:e.href},t):o.createElement("span",{className:r},t)}var s=n("../../common/node_modules/lodash/lodash.js"),o=n("../../common/node_modules/react/react.js"),i=o.PropTypes,a=(n("../../common/src/transport/blob-manager.js"),n("../../common/src/widgets/resource-view.jsx")),c=n("../../common/src/theme/theme.js");e.exports=r,n("./widgets/profile-image.scss"),r.propTypes={user:i.object,size:i.oneOf(["small","medium","large"]),theme:i.instanceOf(c).isRequired},r.defaultProps={size:"small"};var l={small:24,medium:48,large:96}},"./widgets/profile-image.scss":function(e,t){},"./widgets/push-button.jsx":function(e,t,n){"use strict";function r(e){if(e.hidden)return null;var t=["push-button"];return e.emphasized&&t.push("emphasized"),o.createElement("button",{className:t.join(" "),disabled:e.disabled,onClick:e.onClick},e.label)}function s(e){if(e.hidden)return null;var t={type:"file",value:"",disabled:e.disabled,multiple:e.multiple,accept:e.accept,onChange:e.onChange},n=["push-button"];return e.emphasized&&n.push("emphasized"),o.createElement("label",{className:n.join(" "),disabled:e.disabled,onClick:e.onClick},e.label,o.createElement("input",t))}var o=n("../../common/node_modules/react/react.js"),i=o.PropTypes;n("./widgets/push-button.scss"),e.exports=r,e.exports.File=s,s.propTypes={label:i.string,icon:i.string,hidden:i.bool,disabled:i.bool,multiple:i.bool,onChange:i.func}},"./widgets/push-button.scss":function(e,t){},"./widgets/qr-code.jsx":function(e,t,n){"use strict";var r=n("../../common/node_modules/react/react.js"),s=r.PropTypes,o=n("../node_modules/qrcode/lib/browser.js");e.exports=r.createClass({displayName:"QRCode",propTypes:{text:s.string,scale:s.number},getDefaultProps:function(){return{scale:4}},render:function(){return r.createElement("canvas",{ref:"canvas",className:"qr-code"})},componentDidMount:function(){this.redraw()},componentDidUpdate:function(e,t){this.redraw()},redraw:function(){var e=this.refs.canvas,t={scale:this.props.scale};o.toCanvas(e,this.props.text,t,function(e){})}})},"./widgets/reaction-media-toolbar.jsx":function(e,t,n){"use strict";var r=n("../../common/node_modules/lodash/lodash.js"),s=n("../../common/node_modules/react/react.js"),o=s.PropTypes,i=n("../../common/src/media/device-manager.js"),a=n("../../common/src/locale/locale.js"),c=n("./widgets/header-button.jsx"),l=n("./dialogs/photo-capture-dialog-box.jsx"),u=n("./dialogs/video-capture-dialog-box.jsx"),d=n("./dialogs/audio-capture-dialog-box.jsx");n("./widgets/reaction-media-toolbar.scss"),e.exports=s.createClass({displayName:"ReactionMediaToolbar",propTypes:{reaction:o.object.isRequired,capturing:o.oneOf(["image","video","audio"]),locale:o.instanceOf(a).isRequired,onAction:o.func},getInitialState:function(){return{hasCamera:i.hasDevice("videoinput"),hasMicrophone:i.hasDevice("audioinput")}},getResourceCounts:function(){var e={photo:0,video:0,audio:0,file:0},t=r.get(this.props.reaction,"details.resources");return r.each(t,function(t){if(t.imported)e.file++;else switch(t.type){case"image":e.photo++;break;case"video":e.video++;break;case"audio":e.audio++}}),e},render:function(){var e=this.props.locale.translate,t=this.getResourceCounts(),n=this.state.hasCamera&&l.isAvailable(),o=this.state.hasCamera&&u.isAvailable(),i=this.state.hasMicrophone&&d.isAvailable(),a={tooltip:e("story-photo"),icon:"camera",hidden:!t.photo&&!n,disabled:!n,highlighted:t.photo>0||"image"===this.props.capturing,onClick:this.handlePhotoClick},p={tooltip:e("story-video"),icon:"video-camera",hidden:!t.video&&!o,disabled:!o,highlighted:t.video>0||"video"===this.props.capturing,onClick:this.handleVideoClick},h={tooltip:e("story-audio"),icon:"microphone",hidden:!t.audio&&!i,disabled:!i,highlighted:t.audio>0||"audio"===this.props.capturing,onClick:this.handleAudioClick},m={tooltip:e("story-file"),icon:"file-photo-o",multiple:!0,highlighted:t.file>0,onChange:this.handleFileSelect},f=r.get(this.props.reaction,"details.markdown",!1),g={tooltip:e("story-markdown"),icon:"pencil-square",highlighted:f,onClick:this.handleMarkdownClick};return s.createElement("div",{className:"reaction-media-toolbar"},s.createElement(c,a),s.createElement(c,p),s.createElement(c,h),s.createElement(c.File,m),s.createElement(c,g))},componentDidMount:function(){i.addEventListener("change",this.handleDeviceChange)},componentWillUnmount:function(){i.removeEventListener("change",this.handleDeviceChange)},triggerActionEvent:function(e,t){this.props.onAction&&this.props.onAction(r.extend({type:"action",target:this,action:e},t))},handlePhotoClick:function(e){this.triggerActionEvent("photo-capture")},handleVideoClick:function(e){this.triggerActionEvent("video-capture")},handleAudioClick:function(e){this.triggerActionEvent("audio-capture")},handleFileSelect:function(e){var t=e.target.files;r.isEmpty(t)||this.triggerActionEvent("file-import",{files:t})},handleMarkdownClick:function(e){var t=this.props.reaction,n=!t.details.markdown;this.triggerActionEvent("markdown-set",{value:n})},handleDeviceChange:function(e){this.setState({hasCamera:i.hasDevice("videoinput"),hasMicrophone:i.hasDevice("audioinput")})}})},"./widgets/reaction-media-toolbar.scss":function(e,t){},"./widgets/reaction-progress.jsx":function(e,t,n){"use strict";function r(e){var t,n=e.locale.translate;if(i.isActuallyPublished(e.reaction)){var r=e.status;t=r?n("reaction-status-"+r.action):s.createElement(c,{time:e.reaction.ptime,compact:!0,locale:e.locale})}else t=n("reaction-status-storage-pending");return s.createElement("span",{className:"reaction-progress"},t)}var s=n("../../common/node_modules/react/react.js"),o=s.PropTypes,i=n("../../common/src/objects/utils/reaction-utils.js"),a=n("../../common/src/locale/locale.js"),c=n("../../common/src/widgets/time.jsx");e.exports=r,n("./widgets/reaction-progress.scss"),r.propTypes={status:o.object,reaction:o.object.isRequired,locale:o.instanceOf(a).isRequired}},"./widgets/reaction-progress.scss":function(e,t){},"./widgets/reaction-toolbar.jsx":function(e,t,n){"use strict";var r=n("../../common/node_modules/lodash/lodash.js"),s=n("../../common/node_modules/react/react.js"),o=s.PropTypes,i=n("../../common/src/locale/locale.js"),a=n("../../common/src/theme/theme.js"),c=n("./widgets/header-button.jsx");n("./widgets/reaction-toolbar.scss"),e.exports=s.createClass({displayName:"ReactionToolbar",propTypes:{access:o.oneOf(["read-only","read-comment","read-write"]),currentUser:o.object,reactions:o.arrayOf(o.object),respondents:o.arrayOf(o.object),addingComment:o.bool,disabled:o.bool,locale:o.instanceOf(i),theme:o.instanceOf(a),onAction:o.func},getCurrentUserLike:function(){return r.find(this.props.reactions,{type:"like",user_id:r.get(this.props.currentUser,"id")})},getCurrentUserComments:function(){var e=r.get(this.props.currentUser,"id");return r.filter(this.props.reactions,function(t){if(t.user_id===e&&("comment"===t.type||"note"===t.type))return!0})},render:function(){var e=this.props.locale.translate,t=this.props.access,n="read-comment"===t||"read-write"===t,o={icon:"thumbs-up",label:e("story-like"),hidden:!n,highlighted:!!this.getCurrentUserLike(),disabled:this.props.disabled,onClick:this.handleLikeClick},i={icon:"comment",label:e("story-comment"),hidden:!n,highlighted:!r.isEmpty(this.getCurrentUserComments())||this.props.addingComment,disabled:this.props.disabled,onClick:this.handleCommentClick};return s.createElement("div",{className:"reaction-toolbar"},s.createElement(c,o),s.createElement(c,i))},triggerActionEvent:function(e,t){this.props.onAction&&this.props.onAction(r.extend({type:"action",target:this,action:e},t))},handleLikeClick:function(e){var t=this.getCurrentUserLike();t?this.triggerActionEvent("like-remove",{like:t}):this.triggerActionEvent("like-add")},handleCommentClick:function(e){this.triggerActionEvent("reaction-add")},handleShowClick:function(e){this.triggerActionEvent("reaction-expand")}})},"./widgets/reaction-toolbar.scss":function(e,t){},"./widgets/role-filter-bar.jsx":function(e,t,n){"use strict";var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s=n("../../common/node_modules/lodash/lodash.js"),o=n("../../common/node_modules/react/react.js"),i=o.PropTypes,a=n("../node_modules/relaks/index.js"),c=n("../../common/src/utils/memoize.js"),l=n("../../common/src/objects/finders/project-finder.js"),u=n("../../common/src/objects/finders/role-finder.js"),d=n("../../common/src/objects/finders/user-finder.js"),p=n("../../common/src/data/database.js"),h=n("../../common/src/routing/route.js"),m=n("../../common/src/locale/locale.js"),f=n("../../common/src/theme/theme.js"),g=(n("../../common/src/mixins/update-check.js"),n("./widgets/role-filter-button.jsx"));n("./widgets/role-filter-bar.scss"),e.exports=a.createClass({displayName:"RoleFilterBar",propTypes:{settings:i.object.isRequired,database:i.instanceOf(p).isRequired,route:i.instanceOf(h).isRequired,locale:i.instanceOf(m).isRequired,theme:i.instanceOf(f).isRequired},renderAsync:function(e){var t=this.props.route.parameters,n=this.props.database.use({schema:t.schema,by:this}),r={roles:null,users:null,project:null,settings:this.props.settings,locale:this.props.locale,route:this.props.route,theme:this.props.theme};return e.show(o.createElement(v,r)),n.start().then(function(e){return l.findCurrentProject(n).then(function(e){r.project=e})}).then(function(){return d.findProjectMembers(n,r.project).then(function(e){r.users=e})}).then(function(){return u.findRolesOfUsers(n,r.users).then(function(e){r.roles=e})}).then(function(e){return o.createElement(v,r)})}});var v=e.exports.Sync=o.createClass({displayName:"RoleFilterBar.Sync",propTypes:{settings:i.object.isRequired,project:i.object,roles:i.arrayOf(i.object),users:i.arrayOf(i.object),route:i.instanceOf(h).isRequired,locale:i.instanceOf(m).isRequired,theme:i.instanceOf(f).isRequired},render:function(){return o.createElement("div",{className:"role-filter-bar"},this.renderButtons())},renderButtons:function(){var e=this.props.roles;if(s.isEmpty(e)){var t={role:null!==e?null:void 0,locale:this.props.locale,theme:this.props.theme};return o.createElement(g,t)}return s.map(e,this.renderButton)},renderButton:function(e){var t=b(this.props.users,e),n=this.props.route,i=n.parameters.roles,a=s.clone(this.props.settings.route);s.includes(i,e.id)?a.roles=s.without(i,e.id):a.roles=s.concat(i,e.id);var c=n.find(n.component,a),l={role:e,users:t,url:c,locale:this.props.locale,theme:this.props.theme,selected:s.includes(i,e.id),onRoleClick:this.handleRoleClick};return o.createElement(g,r({key:e.id},l))}}),b=c(function(e,t){var n=s.filter(e,function(e){return s.includes(e.role_ids,t.id)});return s.isEmpty(n),n})},"./widgets/role-filter-bar.scss":function(e,t){},"./widgets/role-filter-button.jsx":function(e,t,n){"use strict";var r=n("../../common/node_modules/lodash/lodash.js"),s=n("../../common/node_modules/react/react.js"),o=s.PropTypes,i=n("../../common/src/locale/locale.js"),a=n("../../common/src/theme/theme.js"),c=n("./widgets/profile-image.jsx");n("./widgets/role-filter-button.scss"),e.exports=s.createClass({displayName:"RoleFilterButton",propTypes:{role:o.object,users:o.arrayOf(o.object),selected:o.bool,url:o.string,locale:o.instanceOf(i).isRequired,theme:o.instanceOf(a).isRequired},render:function(){var e="role-filter-button";return this.props.selected&&(e+=" selected"),this.props.role||(e+=" no-roles"),s.createElement("a",{className:e,href:this.props.url},s.createElement("div",{className:"contents"},this.renderImageRow(0,4),this.renderImageRow(0,0),this.renderImageRow(4,4),this.renderTitle()))},renderImageRow:function(e,t){var n=r.filter(this.props.users,function(e){return r.some(e.details.resources,{type:"image"})});return n=r.slice(n,e,t),s.createElement("div",{className:"row"},r.map(n,this.renderProfileImage))},renderProfileImage:function(e,t){return s.createElement(c,{key:t,user:e,size:"medium",theme:this.props.theme})},renderTitle:function(){if(!this.props.role)return this.renderMessage();var e=this.props.locale.pick,t=this.props.role;return s.createElement("div",{className:"band"},s.createElement("div",{className:"title"},e(t.details.title)||t.name,this.renderUserCount()))},renderMessage:function(){if(void 0===this.props.role)return null;var e=this.props.locale.translate;return s.createElement("div",{className:"message"},e("role-filter-no-roles"))},renderUserCount:function(){if(!this.props.users)return null;var e=this.props.users.length;return s.createElement("div",{className:"user-count"},s.createElement("i",{className:"fa fa-male"}),s.createElement("span",{className:"number"},e))}})},"./widgets/role-filter-button.scss":function(e,t){},"./widgets/scrollable.jsx":function(e,t,n){"use strict";function r(e){var t="scrollable";return e.className&&(t+=" "+e.className),e=s.clone(e),e.className=t,o.createElement("div",e,e.children)}var s=n("../../common/node_modules/lodash/lodash.js"),o=n("../../common/node_modules/react/react.js");e.exports=r,n("./widgets/scrollable.scss")},"./widgets/scrollable.scss":function(e,t){},"./widgets/search-bar.jsx":function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e){return e=u.replace(e,/\+/g,""),e=u.replace(e,/\s+/g," "),u.split(e).join(" ")}function o(e){return u.map(g.findTags(e),u.toLower)}function i(e){var t;return u.some(e,function(e){if(void 0===t)t=e.offsetTop;else if(e.offsetTop>t)return!0})}function a(e){if(!e)return[];var t={},n={};u.each(e.daily,function(e,r){u.each(e,function(e,s){var o;if(o=r===f.today?4:r===f.yesterday?2:r>=f.oneWeekAgo?1:r>=f.twoWeeksAgo?.5:.25,/^#/.test(s)){var i=e*o;t[s]=(t[s]||0)+i,n[s]=(n[s]||0)+e}})});var r={},s={};u.each(t,function(e,t){var n=u.toLower(t),o=r[n];o||(o=r[n]=[]),o.push(t),s[n]=(s[n]||0)+e});var o={};u.each(s,function(e,t){var s=r[t];s.length>1&&(s=u.orderBy(s,function(e){return n[e]},"desc"));var i=s[0];o[i]=e});var i=u.transform(o,function(e,t,n){e.push({name:n,score:t})},[]);return u.sortBy(i,"name")}var c,l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},u=n("../../common/node_modules/lodash/lodash.js"),d=n("../../common/node_modules/react/react.js"),p=d.PropTypes,h=n("../node_modules/relaks/index.js"),m=n("../../common/src/utils/component-refs.js"),f=n("../../common/src/utils/date-tracker.js"),g=n("../../common/src/utils/tag-scanner.js"),v=n("../../common/src/objects/finders/statistics-finder.js"),b=n("../../common/src/objects/finders/user-finder.js"),y=n("../../common/src/data/database.js"),j=n("../../common/src/routing/route.js"),w=n("../../common/src/locale/locale.js"),x=n("../../common/src/mixins/update-check.js");n("./widgets/search-bar.scss"),e.exports=h.createClass({displayName:"SearchBar",propTypes:{settings:p.object.isRequired,database:p.instanceOf(y),route:p.instanceOf(j),locale:p.instanceOf(w)},renderAsync:function(e){var t=this,n=this.props.route.parameters,r=this.props.database.use({schema:n.schema,by:this}),s={dailyActivities:null,settings:this.props.settings,route:this.props.route,locale:this.props.locale};return e.show(d.createElement(k,s)),r.start().then(function(e){return b.findUser(r,e)}).then(function(e){var n=u.clone(t.props.settings.statistics);return"current"===n.user_id&&(n.user_id=e.id),"guest"===n.public&&(n.public="guest"===e.type),v.find(r,n)}).then(function(e){return s.dailyActivities=e,d.createElement(k,s)})}});var k=e.exports.Sync=d.createClass((c={displayName:"SearchBar.Sync",mixins:[x],propTypes:{settings:p.object.isRequired,dailyActivities:p.object,route:p.instanceOf(j),locale:p.instanceOf(w)},getInitialState:function(){this.components=m({tags:HTMLDivElement});var e=this.props.route,t=e.query.search||"";return{keywords:t,hashTags:a(this.props.dailyActivities),selectedHashTags:o(t)}},componentWillReceiveProps:function(e){if(this.props.route!==e.route){var t=e.route,n=this.state.keywords,r=t.query.search||"";u.isEqual(s(n),s(r))||this.setState({keywords:r,selectedHashTags:o(r)})}if(this.props.dailyActivities!==e.dailyActivities){var i=a(e.dailyActivities);this.setState({hashTags:i})}},render:function(){return d.createElement("div",{className:"search-bar"},this.renderTextInput(),this.renderHashTags())},renderTextInput:function(){var e=this.props.locale.translate,t={type:"text",value:this.state.keywords,placeholder:e("search-bar-keywords"),onChange:this.handleTextChange,onKeyDown:this.handleKeyDown,onFocus:this.handleFocus};return d.createElement("div",{className:"text-input"},d.createElement("input",t))},renderHashTags:function(){var e=this.components.setters;return d.createElement("div",{ref:e.tags,className:"tags"},u.map(this.state.hashTags,this.renderHashTag))},renderHashTag:function(e,t){var n=this.props.route,r=u.assign({search:e.name},this.props.settings.route),s=n.find(n.component,r),o={className:"tag",onClick:this.handleHashTagClick,"data-tag":e.name,href:s};return u.includes(this.state.selectedHashTags,u.toLower(e.name))&&(o.className+=" selected"),d.createElement("a",l({key:t},o),e.name)},componentDidMount:function(){window.addEventListener("resize",this.handleWindowResize)},componentDidUpdate:function(){this.hideUnpopularTags()}},r(c,"componentDidMount",function(){window.addEventListener("resize",this.handleWindowResize)}),r(c,"hideUnpopularTags",function(){var e=this.components.tags;if(e){var t={};u.each(e.children,function(e){"none"===e.style.display&&(e.style.display="");var n=e.getAttribute("data-tag");t[n]=e});for(var n=u.sortBy(this.state.hashTags,"score");i(t);){var r=n.shift();if(!r)break;var s=t[r.name];delete t[r.name],s.style.display="none"}}}),r(c,"performSearch",function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null);var e=this.props.route,t=u.clone(e.parameters);t.search=s(this.state.keywords),e.push(e.component,t)}),r(c,"handleTextChange",function(e){var t=e.target.value,n=o(t);this.setState({keywords:t,selectedHashTags:n}),this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(this.performSearch,800)}),r(c,"handleKeyDown",function(e){13===e.keyCode&&this.performSearch()}),r(c,"handleFocus",function(e){var t=e.target;t.selectionStart=0,t.selectionEnd=t.value.length}),r(c,"handleHashTagClick",function(e){this.timeout&&(clearTimeout(this.timeout),this.timeout=null)}),r(c,"handleWindowResize",function(e){this.hideUnpopularTags()}),c))},"./widgets/search-bar.scss":function(e,t){},"./widgets/settings-panel.jsx":function(e,t,n){"use strict";var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s=n("../../common/node_modules/lodash/lodash.js"),o=n("../../common/node_modules/react/react.js");o.PropTypes;n("./widgets/settings-panel.scss"),e.exports=o.createClass({displayName:"SettingsPanel",propTypes:{},render:function(){var e="settings-panel";return this.props.className&&(e+=" "+this.props.className),o.createElement("div",{className:e},this.renderPart("header"),this.renderPart("subheader"),this.renderPart("body"),this.renderPart("footer"))},renderPart:function(e){var t=o.Children.toArray(this.props.children),n=s.find(t,{type:e});return n?o.createElement("div",r({className:e},n.props),n.props.children):null}})},"./widgets/settings-panel.scss":function(e,t){},"./widgets/story-emblem.jsx":function(e,t,n){"use strict";function r(e){if(s.includes(e.story.tags,"#yippeekiyay"))return o.createElement("div",{className:"story-emblem die-hard"},o.createElement("img",{src:n("../assets/explosion.gif")}));var t=e.story.type,r="story-emblem";if(!s.includes(a.git,t))return null;r+=" git";var i=a.icons[t];if("issue"===t){var c=e.story.details.state;i=a.icons[t+"."+c]}return i?o.createElement("div",{className:r},o.createElement(i,{className:t})):null}var s=n("../../common/node_modules/lodash/lodash.js"),o=n("../../common/node_modules/react/react.js"),i=o.PropTypes,a=n("../../common/src/objects/types/story-types.js");e.exports=r,n("./widgets/story-emblem.scss"),r.propTypes={story:i.object.isRequired}},"./widgets/story-emblem.scss":function(e,t){},"./widgets/story-progress.jsx":function(e,t,n){"use strict";function r(e){var t,n=e.locale.translate;if(i.isActuallyPublished(e.story)){var r=e.status;r?t=n("story-status-"+r.action+"-$progress",r.progress):(t=s.createElement(c,{time:e.story.ptime,locale:e.locale}),e.pending&&(t=s.createElement("span",null,t," ",s.createElement("i",{className:"fa fa-spinner fa-pulse"}))))}else t=n("story-status-storage-pending");return s.createElement("span",{className:"story-progress"},t)}var s=n("../../common/node_modules/react/react.js"),o=s.PropTypes,i=n("../../common/src/objects/utils/story-utils.js"),a=n("../../common/src/locale/locale.js"),c=n("../../common/src/widgets/time.jsx");e.exports=r,n("./widgets/story-progress.scss"),r.propTypes={status:o.object,story:o.object.isRequired,locale:o.instanceOf(a).isRequired}},"./widgets/story-progress.scss":function(e,t){},"./widgets/text-field.jsx":function(e,t,n){"use strict";var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s=n("../../common/node_modules/lodash/lodash.js"),o=n("../../common/node_modules/react/react.js"),i=o.PropTypes,a=n("../../common/src/utils/component-refs.js"),c=n("../../common/src/locale/locale.js"),l=n("../../common/src/widgets/autosize-text-area.jsx");n("./widgets/text-field.scss"),e.exports=o.createClass({displayName:"TextField",propTypes:{locale:i.instanceOf(c).isRequired},getDefaultProps:function(){return{type:"text"}},getInitialState:function(){return this.components=a({input:HTMLInputElement}),{}},render:function(){var e=["text-field"],t="input",n=s.omit(this.props,"children","locale");if("textarea"===this.props.type&&(t=l,n=s.omit(n,"type")),this.props.readOnly){e.push("readonly");var i=this.props.locale.translate;n.placeholder=i("text-field-placeholder-none"),n.spellCheck=!1}return n.value=n.value||"",o.createElement("div",{className:e.join(" ")},o.createElement("label",{htmlFor:this.props.id},this.props.children),o.createElement(t,r({ref:this.components.setters.input},n)))},focus:function(){this.components.input.focus()}})},"./widgets/text-field.scss":function(e,t){},"./widgets/text-toolbar.jsx":function(e,t,n){"use strict";var r=n("../../common/node_modules/lodash/lodash.js"),s=n("../../common/node_modules/react/react.js"),o=s.PropTypes,i=n("../../common/src/locale/locale.js"),a=n("./widgets/header-button.jsx");n("./widgets/text-toolbar.scss"),e.exports=s.createClass({displayName:"TextToolbar",propTypes:{story:o.object.isRequired,locale:o.instanceOf(i).isRequired,onAction:o.func},render:function(){var e=this.props.locale.translate,t=this.props.story,n={label:e("story-markdown"),icon:"pencil-square",highlighted:t.details.markdown,onClick:this.handleMarkdownClick},r={label:e("story-task-list"),icon:"list-ol",highlighted:"task-list"===t.type,onClick:this.handleTaskListClick},o={label:e("story-survey"),icon:"list-ul",highlighted:"survey"===t.type,onClick:this.handleSurveyClick};return s.createElement("div",{className:"text-toolbar"},s.createElement(a,n),s.createElement(a,r),s.createElement(a,o))},triggerActionEvent:function(e,t){this.props.onAction&&this.props.onAction(r.extend({type:"action",target:this,action:e},t))},handleMarkdownClick:function(e){var t=this.props.story,n=!t.details.markdown;this.triggerActionEvent("markdown-set",{value:n})},handleTaskListClick:function(e){var t=this.props.story,n="task-list"!==t.type?"task-list":"post";this.triggerActionEvent("story-type-set",{value:n})},handleSurveyClick:function(e){var t=this.props.story,n="survey"!==t.type?"survey":"post";this.triggerActionEvent("story-type-set",{value:n})}})},"./widgets/text-toolbar.scss":function(e,t){},"./widgets/top-navigation.jsx":function(e,t,n){"use strict";function r(e){var t="button",n=e.onClick;return e.className&&(t+=" "+e.className),e.active&&(t+=" active"),e.url||(t+=" disabled",n=null),i.createElement(h,{className:t,url:e.url,onClick:n},i.createElement("i",{className:"fa fa-"+e.icon}))}function s(e){var t=e.locale.translate;if(e.uploading){var n=o.fileSize(e.uploading.bytes),r=e.uploading.files,s=t("upload-progress-uploading-$count-files-$size-remaining",r,n);return i.createElement("span",{className:"connection",title:s},i.createElement("i",{className:"fa fa-cloud-upload"}))}if(e.searching)return i.createElement("span",{className:"connection"},i.createElement("i",{className:"fa fa-refresh"}));if(e.online){if(e.connected)return null;var s=t("warning-no-connection",r,n);return i.createElement("span",{className:"connection",title:s},i.createElement("i",{className:"fa fa-warning"}))}return i.createElement("span",{className:"connection"},i.createElement("i",{className:"fa fa-wifi"}),i.createElement("i",{className:"fa fa-ban"}))}var o=n("../../common/node_modules/lodash/lodash.js"),i=n("../../common/node_modules/react/react.js"),a=i.PropTypes,c=n("../../common/src/data/database.js"),l=n("../../common/src/transport/payloads.js"),u=n("../../common/src/routing/route.js"),d=n("../../common/src/locale/locale.js"),p=n("../../common/src/theme/theme.js"),h=n("./widgets/link.jsx"),m=n("../../common/src/widgets/collapsible-container.jsx"),f=n("./widgets/calendar-bar.jsx"),g=n("./widgets/role-filter-bar.jsx"),v=n("./widgets/search-bar.jsx");n("./widgets/top-navigation.scss"),e.exports=i.createClass({displayName:"TopNavigation",propTypes:{settings:a.object.isRequired,online:a.bool,connected:a.bool,searching:a.bool,database:a.instanceOf(c).isRequired,payloads:a.instanceOf(l).isRequired,route:a.instanceOf(u).isRequired,locale:a.instanceOf(d).isRequired,theme:a.instanceOf(p).isRequired},getDefaultProps:function(){return{online:!0,connected:!0}},getInitialState:function(){return{height:o.get(this.props.settings,"navigation.top",!0)?"auto":0}},isHidden:function(e){return e||(e=this.props.settings),!o.get(e,"navigation.top",!0)},getSelectedControl:function(e){e||(e=this.props.route);var t=e.parameters;return void 0!=t.search?"search":void 0!=t.date?"calendar":void 0!=t.roles?"filter":null},getControlURL:function(e){var t=this.getSelectedControl(),n=o.get(this.props.settings,e);if(!n)return null;var r=o.clone(n.route);if(e!==t)switch(e){case"search":r.search="";break;case"calendar":r.date="";break;case"filter":r.roles=[]}return this.props.route.find(this.props.route.component,r)},componentWillReceiveProps:function(e){var t=this,n=this.isHidden(),r=this.isHidden(e.settings);if(n!==r){var s=this.refs.container,o=s.offsetHeight;r?(this.setState({height:o}),setTimeout(function(){t.isHidden()&&t.setState({height:0})},0)):(this.setState({height:o}),setTimeout(function(){t.isHidden()||t.setState({height:"auto"})},1e3))}},render:function(){var e={height:this.state.height};return i.createElement("header",{className:"top-navigation",style:e},i.createElement("div",{ref:"container",className:"container"},this.renderButtonBar(),this.renderCollapsibleControl()))},renderButtonBar:function(){var e=this.getSelectedControl(),t={icon:"calendar",className:"calendar-btn",url:this.getControlURL("calendar"),active:"calendar"===e,onClick:this.handleButtonClick},n={icon:"filter",className:"filter-btn",url:this.getControlURL("filter"),active:"filter"===e,onClick:this.handleButtonClick},o={icon:"search",className:"search-btn",url:this.getControlURL("search"),active:"search"===e,onClick:this.handleButtonClick},a={locale:this.props.locale,uploading:this.props.payloads.uploading,searching:this.props.searching,online:this.props.online,connected:this.props.connected};return i.createElement("div",null,i.createElement(r,t),i.createElement(r,n),i.createElement(r,o),i.createElement(s,a))},renderCollapsibleControl:function(){var e=this.getSelectedControl();return i.createElement(m,{open:!!e},this.renderControl())},renderControl:function(){switch(this.getSelectedControl()){case"calendar":return this.renderCalendarBar();case"filter":return this.renderRoleFilterBar();case"search":return this.renderSearchBar()}},renderCalendarBar:function(){var e={settings:this.props.settings.calendar,database:this.props.database,route:this.props.route,locale:this.props.locale};return i.createElement(f,e)},renderRoleFilterBar:function(){var e={settings:this.props.settings.filter,database:this.props.database,route:this.props.route,locale:this.props.locale,theme:this.props.theme};return i.createElement(g,e)},renderSearchBar:function(){var e={settings:this.props.settings.search,database:this.props.database,route:this.props.route,locale:this.props.locale};return i.createElement(v,e)},handleButtonClick:function(e){}})},"./widgets/top-navigation.scss":function(e,t){}});